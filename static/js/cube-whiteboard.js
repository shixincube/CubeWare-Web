!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=164)}({0:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.CubeError=function e(t,i){r(this,e),this.code=t,this.message=i}},10:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.FileInfo=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(18);t.FileInfo=function(){function e(t,i,n,o,a,s,u,l,h,c,d){r(this,e),this.fileId=t,this.name=i,this.progress=n,this.size=o,this.type=a,this.md5=s,this.createTime=u,this.parentId=l,this.permission=h,this.url=c,this.expires=d,this.file=null}return o(e,[{key:"getType",value:function(){if(!this.type){var e=this.name.split(".");if(e.length>0){var t=e[e.length-1],i={"":a.FileType.Folder,png:a.FileType.Image,jpeg:a.FileType.Image,jpg:a.FileType.Image,gif:a.FileType.Image,doc:a.FileType.Word,docx:a.FileType.Word,xls:a.FileType.Excel,xlsx:a.FileType.Excel,pdf:a.FileType.Pdf,pptx:a.FileType.Ptt,mp3:a.FileType.Audio,wma:a.FileType.Audio,wav:a.FileType.Audio,avi:a.FileType.Video,rmvb:a.FileType.Video,rm:a.FileType.Video,exe:a.FileType.App,com:a.FileType.App,app:a.FileType.App,rar:a.FileType.Zip,zip:a.FileType.Zip};this.type=null==i[t]?a.FileType.Other:i[t]}}return this.type}}],[{key:"parse",value:function(t){null!=t&&"object"==(void 0===t?"undefined":n(t))||nucleus.getLogger().e("CubeFileInfo#parse","Error of parameters");var i=new e;for(var r in t)i.hasOwnProperty(r)&&(i[r]=t[r]);return i.getType(),i}}]),e}()},102:function(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)}([function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsEntity=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(1);t.GraphicsEntity=function(){function e(t){r(this,e),this.name=t,this.board=null,this.exclusive=!1}return n(e,[{key:"setColor",value:function(e){this.color=e}},{key:"setBorderColor",value:function(e){this.borderColor=e}},{key:"setLineWeight",value:function(e){this.weight=e}},{key:"setBorderWidth",value:function(e){this.borderWidth=e}},{key:"dispose",value:function(){this.board=null}},{key:"getCursorPos",value:function(e){var t=o.Utils.getCursorPosition(e),i=t.x,r=t.y,n=this.board.paperDom.createSVGPoint();return n.x=i,n.y=r,n=n.matrixTransform(this.board.paperDom.getScreenCTM().inverse()),i=n.x,r=n.y,{x:i,y:r}}},{key:"onDraw",value:function(e){}},{key:"onResize",value:function(e,t){}},{key:"onClick",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onTouchMove",value:function(e){}},{key:"onTouchStart",value:function(e){}},{key:"onTouchEnd",value:function(e){}},{key:"onKeyPress",value:function(e){}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=navigator.userAgent.toLowerCase();t.Utils={isIPhone:"iphone os"==r.match(/iphone os/i),isAndroid:"android"==r.match(/android/i),getElementChildren:function(e){if(e.children)return e.children;for(var t=[],i=e.childNodes,r=0;r<i.length;++r)1===i[r].nodeType&&t.push(i[r]);return t},getCursorPosition:function(e){return void 0===e.touches?{x:e.clientX||e.pageX,y:e.clientY||e.pageY}:e.touches.length>0?{x:e.touches[0].pageX||e.touches[0].clientX||e.clientX,y:e.touches[0].pageY||e.touches[0].clientY||e.clientY}:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}},getDrawPosition:function(e,t){var i=void 0===t.touches?this.getMousePos(t):this.getTouchPos(t),r=this.getX(e),n=this.getY(e);return{x:i.x-r,y:i.y-n}},getMousePos:function(e){var t=e||window.event,i=document.documentElement.scrollLeft||document.body.scrollLeft,r=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.pageX||t.clientX+i,y:t.pageY||t.clientY+r}},getTouchPos:function(e){var t=e||window.event,i=document.documentElement.scrollLeft||document.body.scrollLeft,r=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.touches[0].pageX||t.clientX+i,y:t.touches[0].pageY||t.clientY+r}},getX:function(e){for(var t=e.offsetLeft,i=e;null!=(i=i.offsetParent);)t+=i.offsetLeft;return t},getY:function(e){for(var t=e.offsetTop,i=e;null!=(i=i.offsetParent);)t+=i.offsetTop;return t},fixNumber:function(e){var t=new Number(e);return Number(t.toFixed(2))},fixNumberToString:function(e){return new Number(e).toFixed(2)},unselectable:function(e){e.setAttribute("unselectable","on"),e.onmousedown=function(){return!1};var t=e.style;t.userSelect="none",t.webkitUserSelect="none",t.MozUserSelect="-moz-none"}}},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SlideEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(6);t.SlideEntity=function(e){function t(e,i,r){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return a.file=null,a.obscure=!1,a.from=null,a.group=null,a.cursor=0,a.presentedImage=null,a.presentedWidth=0,a.presentedHeight=0,a.scale=1,a.prevImage=null,a.prevWidth=0,a.prevHeight=0,a.nextImage=null,a.nextWidth=0,a.nextHeight=0,a.pageLock=!1,a.loadedImageList=[],a.loadedImageSizes=[],a.changedCallback=null,a.notes=null,a.restore=!0,a.isFirstSharing=!1,a.exclusive=!1,a.file=e,a.obscure=void 0!==i&&i,void 0!==r&&(a.cursor=r-1),a}return a(t,e),s(t,null,[{key:"Name",get:function(){return"slide"}}]),s(t,[{key:"getSize",value:function(){return{width:this.presentedWidth,height:this.presentedHeight}}},{key:"getPosition",value:function(){if(null!=this.presentedImage&&null!=this.presentedImage.node)return{x:parseInt(this.presentedImage.node.getAttribute("x")),y:parseInt(this.presentedImage.node.getAttribute("y"))}}},{key:"getDocName",value:function(){return this.file.name}},{key:"currentPage",value:function(){return this.cursor+1}},{key:"numPages",value:function(){return this.file.urls.length}},{key:"prevPage",value:function(){if(0!=this.cursor&&!this.pageLock){this.pageLock=!0,this.board.erase(!0,!1),this.board.showMask();var e=this,t=e.cursor-1;null==e.prevImage?e._loadImage(e.board.paper,e.file.urls[t],function(t,i,r){e._backupImage(t,i,r),e.prevImage=t,e.prevWidth=i,e.prevHeight=r,e._page(e.prevImage,function(){e.cursor-=1,e._preparePrev(),e.restore&&e.restoreNote(e.cursor+1),e.pageLock=!1,e.board.hideMask()})},function(t){e.board.delegate.onWhiteboardFailed(e.board,CubeErrorCode.LoadFileFailed),e.pageLock=!1,e.board.hideMask()}):e._page(e.prevImage,function(){e.cursor-=1,e._preparePrev(),e.restore&&e.restoreNote(e.cursor+1),e.pageLock=!1,e.board.hideMask()})}}},{key:"nextPage",value:function(){if(!(this.cursor>=this.file.urls.length-1||this.pageLock)){this.pageLock=!0,this.board.erase(!0,!1),this.board.showMask();var e=this,t=e.cursor+1;null==e.nextImage?e._loadImage(e.board.paper,e.file.urls[t],function(t,i,r){e._backupImage(t,i,r),e.nextImage=t,e.nextWidth=i,e.nextHeight=r,e._page(e.nextImage,function(){e.cursor+=1,e._prepareNext(),e.restore&&e.restoreNote(e.cursor+1),e.pageLock=!1,e.board.hideMask()})},function(t){e.board.delegate.onWhiteboardFailed(e.board,CubeErrorCode.LoadFileFailed),e.pageLock=!1,e.board.hideMask()}):e._page(e.nextImage,function(){e.cursor+=1,e._prepareNext(),e.restore&&e.restoreNote(e.cursor+1),e.pageLock=!1,e.board.hideMask()})}}},{key:"gotoPage",value:function(e){var t=e-1;if(!(t==this.cursor||t<0||t>this.file.urls.length-1)){this.board.erase(!0,!1),this.board.showMask();var i=this,r=function(){if(null!=i.prevImage&&i.prevImage.remove(),null!=i.nextImage&&i.nextImage.remove(),null!=i.presentedImage&&i.presentedImage.remove(),i._loadImage(i.board.paper,i.file.urls[t],function(e,t,r){i._presentImage(e,t,r),i.board.hideMask()},function(e){i.board.delegate.onWhiteboardFailed(i.board,CubeErrorCode.LoadFileFailed),i.board.hideMask()}),t>0&&i._loadImage(i.board.paper,i.file.urls[t-1],function(e,t,r){i._backupImage(e,t,r),i.prevImage=e,i.prevWidth=t,i.prevHeight=r}),t<i.file.urls.length-1&&i._loadImage(i.board.paper,i.file.urls[t+1],function(e,t,r){i._backupImage(e,t,r),i.nextImage=e,i.nextWidth=t,i.nextHeight=r}),i.cursor=t,i.restore&&i.restoreNote(i.cursor+1),i.pageLock=!1,null!=i.changedCallback&&i.changedCallback.call(i.board,i,"="),!i.obscure){var e={whiteboardId:i.board.name,from:i.board.sessionName,command:{name:"slide",param:i.file,attr:{cursor:i.cursor,page:"="}}};this.board.triggerChange(e)}};this.pageLock?setTimeout(function(){i.pageLock=!0,r()},200):r()}}},{key:"reload",value:function(){var e=this;e.board.showMask(),e._loadImage(e.board.paper,e.file.urls[e.cursor],function(t,i,r){e._presentImage(t,i,r),e.board.hideMask()},function(t){e.board.delegate.onWhiteboardFailed(e.board,CubeErrorCode.LoadFileFailed),e.board.hideMask()})}},{key:"dispose",value:function(){this.board.hideMask(),null!=this.presentedImage&&(this.presentedImage.remove(),this.presentedImage=null),null!=this.nextImage&&(this.nextImage.remove(),this.nextImage=null),null!=this.prevImage&&(this.prevImage.remove(),this.prevImage=null),this.board.dom.style.overflow="hidden",this.board.viewport.reset(),this.faultListener=null,u.GraphicsEntity.prototype.dispose.call(this)}},{key:"appendNote",value:function(e){var t=this.cursor+1;if(void 0!==e.page&&null!=e.page&&(t=e.page),null==this.notes){this.notes=new HashMap;var i=new l.SlideNote(t);i.append(e),this.notes.put(t,i)}else{var i=this.notes.get(t);null==i?(i=new l.SlideNote(t),i.append(e),this.notes.put(t,i)):i.append(e)}}},{key:"popNote",value:function(){if(null==this.notes)return null;var e=this.cursor+1,t=this.notes.get(e);return null==t?null:t.pop()}},{key:"clearNote",value:function(){if(null!=this.notes){var e=this.cursor+1,t=this.notes.get(e);null!=t&&(this.notes.remove(e),t.clear())}}},{key:"restoreNote",value:function(e){if(null!=this.notes){this.board.erase(!0,!1);var t=this.notes.get(e);if(null!=t)for(var i=t.records,r=0;r<i.length;++r)this.board._replayRecord(i[r])}}},{key:"exportPage",value:function(e){var t=this;if(0==e||e-1>=t.file.urls.length)return null;var i=null;null!=t.notes&&(i=t.notes.get(e));var r={page:e,url:t.file.urls[e-1]};if(null!=i){r.notes=[];for(var n=0;n<i.records.length;++n){var o=i.records[n],a={sn:o.sn,type:o.type,raw:o.raw,time:o.time};r.notes.push(a)}}return r}},{key:"onDraw",value:function(e){var i=this,r=i.board.getExEntity(t.Name);null!=r&&r.dispose(),i.changedCallback=i.board.onSlideChanged,i.board.showMask(),i._loadImage(e,i.file.urls[i.cursor],function(e,t,r){if(i._presentImage(e,t,r),!i.obscure){var n={whiteboardId:i.board.name,from:i.board.sessionName,command:{name:"slide",param:i.file,attr:{cursor:i.cursor,page:"*"}}};i.isFirstSharing&&(n.command.upload=!0,i.isFirstSharing=!1),i.board.triggerChange(n)}i.changedCallback.call(i.board,i,"*"),i.board.hideMask()},function(e){i.board.delegate.onWhiteboardFailed(i.board,CubeErrorCode.LoadFileFailed),i.board.hideMask()}),i.file.urls.length>1&&i.cursor+1<i.file.urls.length&&i._loadImage(e,i.file.urls[i.cursor+1],function(e,t,r){i._backupImage(e,t,r),i.nextImage=e,i.nextWidth=t,i.nextHeight=r})}},{key:"onResize",value:function(e,t){this._adjustImagePos(this.presentedImage,this.presentedWidth,this.presentedHeight,e,t),this._adjustImagePos(this.prevImage,this.prevWidth,this.prevHeight,e,t),this._adjustImagePos(this.nextImage,this.nextWidth,this.nextHeight,e,t)}},{key:"onClick",value:function(e){}},{key:"onKeyPress",value:function(e){if(!this.obscure){var t=e.which||e.keyCode;39==t||93==t?this.nextPage():37!=t&&91!=t||this.prevPage()}}},{key:"_presentImage",value:function(e,t,i){var r=this;r.presentedImage=e,r.presentedWidth=t,r.presentedHeight=i,null==e.node?setTimeout(function(){r._adjustImagePos(e,t,i,r.board.width,r.board.height)},40):r._adjustImagePos(e,t,i,r.board.width,r.board.height),e.attr("opacity",1),e.toBack(),null!=r.prevImage&&r.prevImage.toBack(),null!=r.nextImage&&r.nextImage.toBack()}},{key:"_backupImage",value:function(e,t,i){var r=this;null==e.node?setTimeout(function(){r._adjustImagePos(e,t,i,r.board.width,r.board.height)},40):r._adjustImagePos(e,t,i,r.board.width,r.board.height),e.attr("opacity",0),e.toBack()}},{key:"_preparePrev",value:function(){var e=this;if(!e.obscure){var t={whiteboardId:e.board.name,from:e.board.sessionName,command:{name:"slide",param:e.file,attr:{cursor:e.cursor,page:"<"}}};this.board.triggerChange(t)}if(null!=this.nextImage&&this.nextImage.remove(),this.nextImage=this.presentedImage,this.presentedImage=this.prevImage,0==this.cursor)return this.prevImage=null,void(null!=this.changedCallback&&this.changedCallback.call(this.board,this,"<"));e._loadImage(e.board.paper,e.file.urls[e.cursor-1],function(t,i,r){e._backupImage(t,i,r),e.prevImage=t,e.prevWidth=i,e.prevHeight=r,null!=e.changedCallback&&e.changedCallback.call(e.board,e,"<")})}},{key:"_prepareNext",value:function(){var e=this;if(!e.obscure){var t={whiteboardId:e.board.name,from:e.board.sessionName,command:{name:"slide",param:e.file,attr:{cursor:e.cursor,page:">"}}};this.board.triggerChange(t)}if(null!=this.prevImage&&this.prevImage.remove(),this.prevImage=this.presentedImage,this.presentedImage=this.nextImage,this.cursor+1>=this.file.urls.length-1)return this.nextImage=null,void(null!=this.changedCallback&&this.changedCallback.call(this.board,this,">"));e._loadImage(e.board.paper,e.file.urls[e.cursor+1],function(t,i,r){e._backupImage(t,i,r),e.nextImage=t,e.nextWidth=i,e.nextHeight=r,null!=e.changedCallback&&e.changedCallback.call(e.board,e,">")})}},{key:"_page",value:function(e,t){null!=this.presentedImage&&(this.presentedImage.animate({opacity:0},300,"linear"),e.animate({opacity:1},300,"linear",function(){t.call(null)}))}},{key:"_loadImage",value:function(e,t,i,r){var n=this.loadedImageList.indexOf(t);if(n>=0){var o=this.loadedImageSizes[n],a=e.image(t,0,0,o.width,o.height);a.node.setAttribute("unselectable","on"),a.node.onmousedown=function(){return!1};var s=a.node.style;return s.userSelect="none",s.webkitUserSelect="none",s.MozUserSelect="-moz-none",void i.call(null,a,o.width,o.height)}var u=this,l=new Image;l.onload=function(r){var n=l.width,o=l.height;u.loadedImageList.push(t.toString()),u.loadedImageSizes.push({width:n,height:o});var a=e.image(t,0,0,n,o);a.node.setAttribute("unselectable","on"),a.node.onmousedown=function(){return!1};var s=a.node.style;s.userSelect="none",s.webkitUserSelect="none",s.MozUserSelect="-moz-none",i.call(null,a,n,o)},void 0!==r&&(l.onerror=function(e){r.call(null,t)}),l.src=t}},{key:"_adjustImagePos",value:function(e,t,i,r,n){if(null!=e&&null!=e.node){var o=.5*(this.board.paperWidth-t),a=.5*(this.board.paperHeight-i);e.node.setAttribute("x",parseInt(o)),e.node.setAttribute("y",parseInt(a))}}}]),t}(u.GraphicsEntity)},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardCoreListener=function(){function e(){r(this,e)}return n(e,[{key:"onSlideOpened",value:function(e){}},{key:"onSlideChanged",value:function(e){}},{key:"onCleanup",value:function(){}},{key:"onChange",value:function(e){}},{key:"onWhiteboardFailed",value:function(e){}}]),e}()},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteboardPlayer=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(2);t.WhiteboardPlayer=function(){function e(t){r(this,e),this.board=t,this.data=null,this.listener=null,this.tickTimer=0,this.timestamp=0,this.timeDelta=0,this.timeCursor=0,this.timeline=null}return n(e,[{key:"setListener",value:function(e){this.listener=e}},{key:"play",value:function(){if(this.isPlaying()||null==this.data)return!1;if(null!=this.board.recorder&&this.board.recorder.isRecording())return!1;if(this.board.cleanup(!0),void 0!==this.data.slideFile){var e=new o.SlideEntity(this.data.slideFile,!0,this.data.beginPage);this.board.selectEntity(e)}var t=this;this.tickTimer=setTimeout(function(){if(null!=t.listener&&t.listener.onStarted(t),void 0!==t.data.currents)for(var e=0;e<t.data.currents.length;++e)t.board._replayRecord(t.data.currents[e],!0);t._tick()},200),this.timestamp=Date.now(),this.timeCursor=0;for(var i=0;i<this.data.timeline.length;++i)this.timeline.push(this.data.timeline[i]);return!0}},{key:"stop",value:function(){this.tickTimer>0&&(clearTimeout(this.tickTimer),this.tickTimer=0),this._stop()}},{key:"pause",value:function(){null!=this.data&&0!=this.timeline.length&&(this.tickTimer>0&&(clearTimeout(this.tickTimer),this.tickTimer=0),this.timeDelta=Date.now()-this.timeCursor,null!=this.listener&&this.listener.onPaused(this))}},{key:"resume",value:function(){if(!(this.tickTimer>0||null==this.data||0==this.timeline.length)){this.timestamp=Date.now()+this.timeDelta;var e=this;setTimeout(function(){e._tick()},30),null!=this.listener&&this.listener.onResumed(this)}}},{key:"isPlaying",value:function(){return this.tickTimer>0}},{key:"importData",value:function(e){this.data=e,this.timeline=new Array}},{key:"_stop",value:function(){null!=this.listener&&this.listener.onStopped(this)}},{key:"_fetchAndPresent",value:function(){var e=Date.now(),t=this.timeline[0];if(t.time-this.data.start<=e-this.timestamp)if(this.timeline.shift(),"vg"==t.category)this.board._replayRecord(t,!0,{dur:400});else if("opt"==t.category)if("undo"==t.name)this.board.undo(!0);else if("redo"==t.name)this.board.redo(!0);else if("erase"==t.name)this.board.erase(!0);else if("slide"==t.name){var i=this.board.getSlide();null!=i&&i.currentPage()!=t.page&&i.gotoPage(t.page)}return this.timeCursor=e,0!=this.timeline.length}},{key:"_tick",value:function(){if(this.tickTimer>0&&(clearTimeout(this.tickTimer),this.tickTimer=0),!this._fetchAndPresent())return void this._stop();var e=this;this.tickTimer=setTimeout(function(){e._tick()},300)}}]),e}()},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardRecorder=function(){function e(t){r(this,e),this.board=t,this.timeline=[],this.recording=!1,this.listener=null,this.start=0,this.currents=null,this.slide=null,this.beginPage=-1,this.pauseRecorder=!1,this._pauseRecorder=null,this._resumeRecorder=null}return n(e,[{key:"setListener",value:function(e){this.listener=e}},{key:"startRecording",value:function(){var e=this;if(this.recording)return!1;if(null!=this.board.player&&this.board.player.isPlaying())return!1;if(this.recording=!0,this._pauseRecorder=function(){if(e.pauseRecorder)return!1;e.pauseRecorder=!0,e.recording=!1,null!=e.listener&&e.listener.onPaused(e)},this._resumeRecorder=function(){if(!e.pauseRecorder)return!1;e.recording=!0,e.pauseRecorder=!1,null!=e.listener&&e.listener.onResumed(e)},this.slide=this.board.getSlide(),null!=this.slide?this.beginPage=this.slide.currentPage():this.beginPage=-1,this.pauseRecorder)return!1;var t=this.board.pastRecords.length;if(t>0){this.currents=[];for(var i=0;i<t;++i)this._notifyRecord(this.board.pastRecords[i],this.currents)}else this.currents=null;return this.timeline.splice(0,this.timeline.length),this.start=Date.now(),null!=this.listener&&this.listener.onStarted(this),!0}},{key:"pauseRecording",value:function(){return void 0!==this._pauseRecorder&&"function"==typeof this._pauseRecorder&&this._pauseRecorder()}},{key:"resumeRecording",value:function(){return void 0!==this._resumeRecorder&&"function"==typeof this._resumeRecorder&&this._resumeRecorder()}},{key:"stopRecording",value:function(){return!!this.recording&&(this.recording=!1,this.pauseRecorder=!1,null!=this.listener&&this.listener.onStopped(this),!0)}},{key:"isRecording",value:function(){return this.recording}},{key:"exportData",value:function(e){if(this.recording||this.pauseRecorder)return null;var t=this,i=0;void 0!==e&&(i=e-t.start);var r={start:t.start,delta:i,timeline:t.timeline};return null!=this.currents&&(r.currents=this.currents),null!=this.slide&&(r.slideFile=this.slide.file,r.beginPage=this.beginPage),r}},{key:"_notifyOperation",value:function(e){this.recording&&!this.pauseRecorder&&(e.category="opt",this.timeline.push(e))}},{key:"_notifyRecord",value:function(e,t){if(this.recording&&!this.pauseRecorder){var i={category:"vg",sn:e.sn,type:e.type,raw:e.raw,time:e.time};void 0===t?this.timeline.push(i):t.push(i)}}}]),e}()},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.SlideNote=function(){function e(t){r(this,e),this.page=t,this.records=[]}return n(e,[{key:"append",value:function(e){this.records.push(e)}},{key:"pop",value:function(){return this.records.pop()}},{key:"clear",value:function(){0!==this.records.length&&this.records.splice(0,this.records.length)}}]),e}()},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ArrowEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(1);t.ArrowEntity=function(e){function t(e){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return i.weight=4,i.color="#FE0000",i.flag=!1,i.startPos=null,i.endPos=null,i.arrow=null,i.drawTimer=0,i.drawEl=null,i.exclusive=!0,void 0!==e&&(i.weight=(e.weight||2)+2,i.color=e.color||"#FE0000"),i}return a(t,e),s(t,null,[{key:"Name",get:function(){return"arrow"}}]),s(t,[{key:"setLineWeight",value:function(e){this.weight=e+2}},{key:"fireBegin",value:function(e){this.flag=!0,this.startPos=this.getCursorPos(e),this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0),this.arrow="url("+this.board._matcheArrow(this.color)+")"}},{key:"fireEnd",value:function(e){if(this.flag=!1,this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0),null!=this.drawEl&&this.drawEl.remove(),this.endPos=this.getCursorPos(e),this.drawEl=this.draw(this.startPos,this.endPos),null!=this.drawEl){var i=this.startPos.x,r=this.startPos.y,n=this.endPos.x,o=this.endPos.y,a=this,s={x1:l.Utils.fixNumber(i),y1:l.Utils.fixNumber(r),x2:l.Utils.fixNumber(n),y2:l.Utils.fixNumber(o)},u={stroke:a.color,strokeWidth:a.weight},h=a.board.record(t.Name,a.drawEl,{param:s,attr:u}),c={whiteboardId:a.board.name,command:{name:"arrow",sn:h,param:s,attr:u}},d=this.board.getSlide();null!=d&&(c.command.page=d.cursor+1),this.board.triggerChange(c),this.drawEl=null}}},{key:"fireMove",value:function(e){if(this.flag&&!(this.drawTimer>0)){var t=this;this.drawTimer=setTimeout(function(){clearTimeout(t.drawTimer),t.drawTimer=0,null!=t.drawEl&&t.drawEl.remove();var i=t.getCursorPos(e);t.drawEl=t.draw(t.startPos,i)},40)}}},{key:"dispose",value:function(){this.board.paperDom.style.cursor="auto",this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0),u.GraphicsEntity.prototype.dispose.call(this)}},{key:"draw",value:function(e,i){return t._Draw(this.board,e,i,this.color,this.weight,this.arrow)}},{key:"onMouseMove",value:function(e){this.fireMove(e)}},{key:"onMouseDown",value:function(e){this.fireBegin(e)}},{key:"onMouseUp",value:function(e){this.fireEnd(e)}},{key:"onTouchMove",value:function(e){this.fireMove(e)}},{key:"onTouchStart",value:function(e){this.fireBegin(e)}},{key:"onTouchEnd",value:function(e){this.fireEnd(e)}}],[{key:"_Draw",value:function(e,t,i,r,n,o){var a=t.x,s=t.y,u=i.x,h=i.y;if(Math.abs(u-a)<3&&Math.abs(h-s)<3)return null;var c=l.Utils;if(o.length>20){e.paper.setStart();var d=e.paper.path("M"+c.fixNumberToString(a)+","+c.fixNumberToString(s)+" L"+c.fixNumberToString(u)+","+c.fixNumberToString(h));d.attr("stroke",r),d.attr("stroke-width",n),d.attr("stroke-linecap","round");var f=Math.sqrt(Math.pow(Math.abs(u-a),2)+Math.pow(Math.abs(h-s),2)),p=Math.abs(h-s)/f,m=Math.asin(p),y=(Math.PI,n+3),v=y+6,g=f-v,b={x:u,y:h},k={x:u-y,y:h+v},w={x:u+y,y:h+v},_=Math.atan(y/g),E=Math.sqrt(y*y+g*g);if(h<=s&&u>=a){var C=m+_;k.x=a+E*Math.cos(C),k.y=s-E*Math.sin(C),C=m-_,w.x=a+E*Math.cos(C),w.y=s-E*Math.sin(C)}else if(h>s&&u>=a){var C=m+_;k.x=a+E*Math.cos(C),k.y=s+E*Math.sin(C),C=m-_,w.x=a+E*Math.cos(C),w.y=s+E*Math.sin(C)}else if(h>s&&u<a){var C=m+_;k.x=a-E*Math.cos(C),k.y=s+E*Math.sin(C),C=m-_,w.x=a-E*Math.cos(C),w.y=s+E*Math.sin(C)}else{var C=m+_;k.x=a-E*Math.cos(C),k.y=s-E*Math.sin(C),C=m-_,w.x=a-E*Math.cos(C),w.y=s-E*Math.sin(C)}var x=e.paper.path("M"+c.fixNumberToString(b.x)+","+c.fixNumberToString(b.y)+" L"+c.fixNumberToString(k.x)+","+c.fixNumberToString(k.y)+" L"+c.fixNumberToString(w.x)+","+c.fixNumberToString(w.y)+" z");return x.attr("stroke",r),x.attr("stroke-width",n),x.attr("stroke-linecap","butt"),x.attr("fill",r),e.paper.setFinish()}var d=e.paper.path("M"+c.fixNumberToString(a)+","+c.fixNumberToString(s)+" L"+c.fixNumberToString(u)+","+c.fixNumberToString(h));return d.attr("stroke",r),d.attr("stroke-width",n),d.attr("stroke-linecap","round"),d.node.setAttribute("marker-end",o),d}},{key:"draw",value:function(e,i,r){var n="url("+r._matcheArrow(i.attr.stroke)+")",o={x:i.param.x1,y:i.param.y1},a={x:i.param.x2,y:i.param.y2};return t._Draw(r,o,a,i.attr.stroke,i.attr.strokeWidth,n)}},{key:"restore",value:function(e,i,r,n){var o=void 0!==n,a=i.raw.param,s="url("+r._matcheArrow(i.raw.attr.stroke)+")",u={x:a.x1,y:a.y1},l={x:a.x2,y:a.y2},h=t._Draw(r,u,l,i.raw.attr.stroke,o?0:i.raw.attr.strokeWidth,s);i.set=h,o&&h.animate({"stroke-width":i.raw.attr.strokeWidth},n.dur,"linear")}}]),t}(u.GraphicsEntity)},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundImageEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0);t.BackgroundImageEntity=function(e){function t(e,i){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return r.source=null,r.obscure=!1,r.domImage=null,r.img=null,r.rawWidth=0,r.rawHeight=0,r.exclusive=!1,r.source=void 0===e?null:e,r.obscure=void 0!==i&&i,r}return a(t,e),s(t,null,[{key:"Name",get:function(){return"bgimage"}}]),s(t,[{key:"dispose",value:function(){var e=this;null!=e.board.bgImage&&(e.board.bgImage.remove(),e.board.bgImage=null),u.GraphicsEntity.prototype.dispose.call(this)}},{key:"onDraw",value:function(){var e=this;if(null==e.source)return void(null!=e.board.bgImage&&(e.board.bgImage.remove(),e.board.bgImage=null));var t=new Image;if(t.onload=function(i){var r=t.width,n=t.height;e.rawWidth=r,e.rawHeight=n,nucleus.getLogger().i("BackgroundImageEntity","Image size: "+r+"x"+n),null!=e.board.bgImage&&(e.board.bgImage.remove(),e.board.bgImage=null),e.img=e.board.paper.image(e.source,0,0,r,n),e.board.bgImage=e.img,null==e.img.node?setTimeout(function(){e.onResize(e.board.width,e.board.height)},60):e.onResize(e.board.width,e.board.height),e.img.toBack(),e.board.bgImage.node.setAttribute("unselectable","on"),e.board.bgImage.node.onmousedown=function(){return!1};var o=e.board.bgImage.node.style;o.userSelect="none",o.webkitUserSelect="none",o.MozUserSelect="-moz-none"},t.src=e.source,!this.obscure){var i={whiteboardId:e.board.name,command:{name:"bgimage",param:e.source}};this.board.triggerChange(i)}}},{key:"onResize",value:function(e,t){if(null!=this.img&&null!=this.img.node){var i=this.rawWidth,r=this.rawHeight,n=e/i,o=t/r;n<o?(this.img.node.setAttribute("width",parseInt(n*i)),this.img.node.setAttribute("height",parseInt(n*r))):(this.img.node.setAttribute("width",parseInt(o*i)),this.img.node.setAttribute("height",parseInt(o*r)));var a=.5*(e-parseInt(this.img.node.getAttribute("width"))),s=.5*(t-parseInt(this.img.node.getAttribute("height")));this.img.node.setAttribute("x",parseInt(a)),this.img.node.setAttribute("y",parseInt(s))}}},{key:"getSource",value:function(){return this.source}}]),t}(u.GraphicsEntity)},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(1);t.EllipseEntity=function(e){function t(e){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return i.borderWidth=2,i.borderColor="#FE0000",i.flag=!1,i.startPos=null,i.endPos=null,i.drawTimer=0,i.drawEl=null,i.exclusive=!0,void 0!=e&&(i.borderWidth=e.borderWidth||2,i.borderColor=e.borderColor||"#FE0000"),i}return a(t,e),s(t,null,[{key:"Name",get:function(){return"ellipse"}}]),s(t,[{key:"fireBegin",value:function(e){this.flag=!0,this.startPos=this.getCursorPos(e),this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0)}},{key:"fireEnd",value:function(e){this.flag=!1,this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0),null!=this.drawEl&&this.drawEl.remove(),this.endPos=this.getCursorPos(e),this.draw(this.startPos,this.endPos);var i=this,r={x:i.drawEl.attr("cx"),y:i.drawEl.attr("cy"),rx:i.drawEl.attr("rx"),ry:i.drawEl.attr("ry")},n={stroke:i.borderColor,strokeWidth:i.borderWidth},o=i.board.record(t.Name,i.drawEl,{param:r,attr:n}),a={whiteboardId:i.board.name,command:{name:"ellipse",sn:o,param:r,attr:n}},s=this.board.getSlide();null!=s&&(a.command.page=s.cursor+1),this.board.triggerChange(a),this.drawEl=null}},{key:"fireMove",value:function(e){if(this.flag&&!(this.drawTimer>0)){var t=this;this.drawTimer=setTimeout(function(){clearTimeout(t.drawTimer),t.drawTimer=0,null!=t.drawEl&&t.drawEl.remove();var i=t.getCursorPos(e);t.draw(t.startPos,i)},40)}}},{key:"draw",value:function(e,t){var i=parseInt(.5*(t.x-e.x)),r=parseInt(.5*(t.y-e.y)),n=e.x+i,o=e.y+r;i<0&&(i=Math.abs(i)),r<0&&(r=Math.abs(r));var a=l.Utils;this.drawEl=this.board.paper.ellipse(a.fixNumber(n),a.fixNumber(o),a.fixNumber(i),a.fixNumber(r)),this.drawEl.attr("stroke",this.borderColor),this.drawEl.attr("stroke-width",this.borderWidth),this.drawEl.attr("stroke-linecap","round")}},{key:"onMouseMove",value:function(e){this.fireMove(e)}},{key:"onMouseDown",value:function(e){this.fireBegin(e)}},{key:"onMouseUp",value:function(e){this.fireEnd(e)}},{key:"onTouchMove",value:function(e){this.fireMove(e)}},{key:"onTouchStart",value:function(e){this.fireBegin(e)}},{key:"onTouchEnd",value:function(e){this.fireEnd(e)}}],[{key:"draw",value:function(e,t){var i=e.ellipse(t.param.x,t.param.y,t.param.rx,t.param.ry);return i.attr("stroke",t.attr.stroke),i.attr("stroke-width",t.attr.strokeWidth),i.attr("stroke-linecap","round"),i}},{key:"restore",value:function(e,t,i){var r=void 0!==i,n=e.ellipse(t.raw.param.x,t.raw.param.y,r?0:t.raw.param.rx,r?0:t.raw.param.ry);n.attr("stroke",t.raw.attr.stroke),n.attr("stroke-width",t.raw.attr.strokeWidth),n.attr("stroke-linecap","round"),t.set=n,r&&n.animate({rx:t.raw.param.rx,ry:t.raw.param.ry},i.dur,"linear")}}]),t}(u.GraphicsEntity)},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PencilEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(1);t.PencilEntity=function(e){function t(e){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return i.weight=2,i.color="#FE0000",i.lastX=-1,i.lastY=-1,i.lineX=[],i.lineY=[],i.flag=0,i.beginTime=0,i.timer=0,i.queue=[],i.queueTimer=0,i.vgCmdArray=null,i.exclusive=!0,void 0!==e&&(i.weight=e.weight||2,i.color=e.color||"#FE0000"),i}return a(t,e),s(t,null,[{key:"Name",get:function(){return"path"}}]),s(t,[{key:"onDraw",value:function(){this.board.paperDom.style.cursor="url("+this.board.resourcePath+"/cursor_pencil.png), default"}},{key:"onMouseMove",value:function(e){this.fireMove(e)}},{key:"onMouseDown",value:function(e){this.fireStart(e)}},{key:"onMouseUp",value:function(e){this.fireEnd(e)}},{key:"onTouchMove",value:function(e){this.fireMove(e)}},{key:"onTouchStart",value:function(e){this.fireStart(e)}},{key:"onTouchEnd",value:function(e){this.fireEnd(e)}},{key:"fireMove",value:function(e){if(1==this.flag){var t=this.getCursorPos(e);this.lineX.push(t.x),this.lineY.push(t.y)}}},{key:"fireStart",value:function(e){var t=this;this.lineX.splice(0,this.lineX.length),this.lineX.length=0,this.lineY.splice(0,this.lineY.length),this.lineY.length=0;var i=this.getCursorPos(e);this.lineX.push(i.x),this.lineY.push(i.y),this.flag=1,this.beginTime=Date.now(),this.board.paper.setStart(),this.vgCmdArray=[],this.timer>0&&clearTimeout(this.timer),this.timer=setTimeout(function(){clearTimeout(t.timer),t.timer=0,t.draw()},60)}},{key:"fireEnd",value:function(e){if(this.flag=0,this.timer>0&&(clearTimeout(this.timer),this.timer=0),null!=this.vgCmdArray){var i=Date.now(),r=this.vgCmdArray.join(" "),n=this.board.paper.setFinish();n.attr("stroke",this.color),n.attr("stroke-width",this.weight),n.attr("stroke-linecap","round");var o=this.board.record(t.Name,n,{param:r,attr:{stroke:this.color,strokeWidth:this.weight,begin:this.beginTime,end:i}}),a={whiteboardId:this.board.name,command:{name:"path",sn:o,param:r,attr:{stroke:this.color,strokeWidth:this.weight}}},s=this.board.getSlide();null!=s&&(a.command.page=s.currentPage()),this.queue.push(a),this.tick(),this.vgCmdArray.length=0,this.vgCmdArray=null}}},{key:"dispose",value:function(){this.board.paperDom.style.cursor="auto",this.timer>0&&(clearTimeout(this.timer),this.timer=0),u.GraphicsEntity.prototype.dispose.call(this)}},{key:"draw",value:function(){var e=this;if(this.timer>0&&clearTimeout(this.timer),this.lineX.length<=1)return void(this.timer=setTimeout(function(){e.draw()},60));var t=[],i=l.Utils;this.lastX=this.lineX[0],this.lastY=this.lineY[0],t.push("M"+i.fixNumberToString(this.lastX)+","+i.fixNumberToString(this.lastY));for(var r=1;r<this.lineX.length;++r){var n=this.lineX[r],o=this.lineY[r];t.push("L"+i.fixNumberToString(n)+","+i.fixNumberToString(o))}var a=t.join(" ");if(t.length>1){var s=this.board.paper.path(a);s.attr("stroke",this.color),s.attr("stroke-width",this.weight),s.attr("stroke-linecap","round")}t.splice(0,t.length),t=null,this.lastX=this.lineX[this.lineX.length-1],this.lastY=this.lineY[this.lineY.length-1],this.lineX.splice(0,this.lineX.length-1),this.lineY.splice(0,this.lineY.length-1),null==this.vgCmdArray&&(this.vgCmdArray=[]),this.vgCmdArray.push(a),this.timer=setTimeout(function(){e.draw()},60)}},{key:"tick",value:function(){var e=this;if(!(this.queueTimer>0)){if(this.queue.length>0){var t=this.queue.shift();this.board.triggerChange(t)}this.queueTimer=setTimeout(function(){clearTimeout(e.queueTimer),e.queueTimer=0,0!==e.queue.length&&e.tick()},300)}}}],[{key:"draw",value:function(e,t){var i=e.path(t.param);return i.attr("stroke",t.attr.stroke),i.attr("stroke-width",t.attr.strokeWidth),i.attr("stroke-linecap","round"),i}},{key:"restore",value:function(e,t,i){var r=void 0!==i,n=e.path(t.raw.param);n.attr("stroke",t.raw.attr.stroke),n.attr("stroke-width",r?0:t.raw.attr.strokeWidth),n.attr("stroke-linecap","round"),t.set=n,r&&n.animate({"stroke-width":t.raw.attr.strokeWidth},i.dur,"linear")}}]),t}(u.GraphicsEntity)},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RectEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(1);t.RectEntity=function(e){function t(e){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return i.borderWidth=2,i.borderColor="#FE0000",i.flag=!1,i.startPos=null,i.endPos=null,i.beginTime=0,i.drawTimer=0,i.drawEl=null,i.exclusive=!0,void 0!==e&&(i.borderWidth=e.borderWidth||2,i.borderColor=e.borderColor||"#FE0000"),i}return a(t,e),s(t,null,[{key:"Name",get:function(){return"rect"}}]),s(t,[{key:"fireBegin",value:function(e){this.flag=!0,this.startPos=this.getCursorPos(e),this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0)}},{key:"fireEnd",value:function(e){this.flag=!1,this.drawTimer>0&&(clearTimeout(this.drawTimer),this.drawTimer=0),null!=this.drawEl&&this.drawEl.remove(),this.endPos=this.getCursorPos(e),this.draw(this.startPos,this.endPos);var i=this,r={x:i.drawEl.attr("x"),y:i.drawEl.attr("y"),width:i.drawEl.attr("width"),height:i.drawEl.attr("height")},n={stroke:i.borderColor,strokeWidth:i.borderWidth},o=i.board.record(t.Name,i.drawEl,{param:r,attr:n}),a={whiteboardId:i.board.name,command:{name:"rect",sn:o,param:r,attr:n}},s=this.board.getSlide();null!=s&&(a.command.page=s.cursor+1),this.board.triggerChange(a),this.drawEl=null}},{key:"fireMove",value:function(e){if(this.flag&&!(this.drawTimer>0)){var t=this;this.drawTimer=setTimeout(function(){clearTimeout(t.drawTimer),t.drawTimer=0,null!=t.drawEl&&t.drawEl.remove();var i=t.getCursorPos(e);t.draw(t.startPos,i)},40)}}},{key:"draw",value:function(e,t){var i=e.x,r=e.y,n=t.x-e.x,o=t.y-e.y;n<0&&(i=t.x,n=Math.abs(n)),o<0&&(r=t.y,o=Math.abs(o));var a=l.Utils;this.drawEl=this.board.paper.rect(a.fixNumber(i),a.fixNumber(r),a.fixNumber(n),a.fixNumber(o)),this.drawEl.attr("stroke",this.borderColor),this.drawEl.attr("stroke-width",this.borderWidth),this.drawEl.attr("stroke-linecap","round")}},{key:"onMouseMove",value:function(e){this.fireMove(e)}},{key:"onMouseDown",value:function(e){this.fireBegin(e)}},{key:"onMouseUp",value:function(e){this.fireEnd(e)}},{key:"onTouchMove",value:function(e){this.fireMove(e)}},{key:"onTouchStart",value:function(e){this.fireBegin(e)}},{key:"onTouchEnd",value:function(e){this.fireEnd(e)}}],[{key:"draw",value:function(e,t){var i=e.rect(t.param.x,t.param.y,t.param.width,t.param.height);return i.attr("stroke",t.attr.stroke),i.attr("stroke-width",t.attr.strokeWidth),i.attr("stroke-linecap","round"),i}},{key:"restore",value:function(e,t,i){var r=void 0!==i,n=e.rect(t.raw.param.x,t.raw.param.y,r?0:t.raw.param.width,r?0:t.raw.param.height);n.attr("stroke",t.raw.attr.stroke),n.attr("stroke-width",t.raw.attr.strokeWidth),n.attr("stroke-linecap","round"),t.set=n,r&&n.animate({width:t.raw.param.width,height:t.raw.param.height},i.dur,"linear")}}]),t}(u.GraphicsEntity)},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.TextEntity=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(0),l=i(1);t.TextEntity=function(e){function t(e){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.Name));return i.inputDom=null,i.input=!1,i.paperEl=null,i.textPos=null,i.text=null,i.color="#FE0000",i.fontFamily="微软雅黑, 黑体",i.fontSize="16",i.exclusive=!0,void 0!==e&&(i.color=e.color||"#FE0000",i.fontFamily=e.fontFamily||'"Microsoft YaHei"',i.fontSize=e.fontSize||"16"),i}return a(t,e),s(t,null,[{key:"Name",get:function(){return"text"}}]),s(t,[{key:"dispose",value:function(){null!=this.inputDom&&(this.inputDom.remove(),this.inputDom.value=""),null!=this.paperEl&&(this.paperEl=null),this.input=!1,this.textPos=null,u.GraphicsEntity.prototype.dispose.call(this)}},{key:"onClick",value:function(e){if(null==this.inputDom&&(this.inputDom=this._createInputDom()),e.target!=this.inputDom)if(this.input){var i=this.inputDom.value;if(i.length>0){var r=l.Utils.fixNumber(this.textPos.x),n=l.Utils.fixNumber(this.textPos.y),o=this.board.paper.text(r,n,i);o.attr("fill",this.color),o.attr("font-family",this.fontFamily),o.attr("font-size",this.fontSize),this.paperEl=o;var a=this,s={x:r,y:n,text:i.toString()},u=a.board.record(t.Name,o,{param:s,attr:{color:a.color,fontFamily:a.fontFamily,fontSize:a.fontSize}});this.board.viewport.manage(u,o);var h={whiteboardId:a.board.name,command:{name:"text",sn:u,param:s,attr:{color:a.color,fontFamily:a.fontFamily,fontSize:a.fontSize}}},c=this.board.getSlide();null!=c&&(h.command.page=c.cursor+1),this.board.triggerChange(h)}this.inputDom.value="",this.inputDom.remove(),this.input=!1}else{this.textPos=this.getCursorPos(e);var d=l.Utils.getDrawPosition(this.board.dom,e);this.inputDom.style.left=d.x-84+"px",this.inputDom.style.top=d.y-0+"px",this.board.dom.appendChild(this.inputDom),this.inputDom.focus(),this.input=!0}}},{key:"_createInputDom",value:function(){var e=document.createElement("input");return e.setAttribute("type","text"),e.setAttribute("maxlength","128"),e.style.color=this.color,e.style.fontSize=this.fontSize+"px",e.style.fontFamily=this.fontFamily,e.style.position="absolute",e.style.cssFloat="left",e.style.styleFloat="left",e.style.padding="0px",e.style.margin="0px",e.style.width="200px",e.style.textAlign="center",e}}],[{key:"draw",value:function(e,t){var i=e.text(t.param.x,t.param.y,t.param.text);return i.attr("fill",t.attr.color),i.attr("font-family",t.attr.fontFamily),i.attr("font-size",t.attr.fontSize),i}},{key:"restore",value:function(e,t,i){var r=void 0!==i,n=e.text(t.raw.param.x,t.raw.param.y,t.raw.param.text);n.attr("fill",t.raw.attr.color),n.attr("font-family",t.raw.attr.fontFamily),n.attr("font-size",r?0:t.raw.attr.fontSize),t.set=n,r&&n.animate({"font-size":t.raw.attr.fontSize},i.dur,"linear")}}]),t}(u.GraphicsEntity)},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardPlayerListener=function(){function e(){r(this,e)}return n(e,[{key:"onStarted",value:function(e){}},{key:"onStopped",value:function(e){}},{key:"onPaused",value:function(e){}},{key:"onResumed",value:function(e){}}]),e}()},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardRecorderListener=function(){function e(){r(this,e)}return n(e,[{key:"onStarted",value:function(){}},{key:"onStopped",value:function(){}},{key:"onPaused",value:function(){}},{key:"onResumed",value:function(){}}]),e}()},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteboardCoreServiceWorker=void 0;var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(17),l=i(19),h=i(20),c=i(7),d=i(8),f=i(9),p=i(10),m=i(11),y=i(2),v=i(12),g=i(1),b=i(5),k=i(4),w=i(3),_=i(18);t.WhiteboardCoreServiceWorker=function(e){function t(e,i,r){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.listener=new w.WhiteboardCoreListener,a.name=i,a.curEntity=null,a.exMap=new h.HashMap,a.domId=e,a.dom=document.getElementById(e),a.viewport=new l.Viewport(a),a.pastRecords=[],a.undoRecords=[],a.remoteRecordMap=new h.HashMap,a.remoteHistoryMap=new h.HashMap,a.paper=null,a.paperDom=null,a.maskDom=null,a.arrowMarkerColors=["","","","",""],a.arrowMatchTimestamps=[0,0,0,0,0],a.bgDom=null,a.bgImage=null,a.transparent=!1,a.defaultColor=null,a.defaultWeight=-1,a.defaultBorderColor=null,a.defaultBorderWidth=-1,a.cmdSnCursor=0,a.remoteSlide=null,a.width=0,a.height=0,a.paperWidth=2048,a.paperHeight=2048,a.remoteWidth=-1,a.remoteHeight=-1,a.sessionName=r,a.recorder=null,a.player=null,a.resourcePath="./resource/images",a}return a(t,e),s(t,[{key:"setListener",value:function(e){this.listener=e}},{key:"setResourcePath",value:function(e){this.resourcePath=e}},{key:"load",value:function(e,t){void 0===e&&(e=this.dom.offsetWidth),void 0===t&&(t=this.dom.offsetHeight),this.dom.style.textAlign="left",this.dom.style.overflow="hidden",this.paper=Raphael(this.domId,Math.max(this.paperWidth,e),Math.max(this.paperHeight,t)),this.paperDom=this.dom.getElementsByTagName("svg")[0],this.transparent||(this.paperDom.style.backgroundColor="#fefefe"),this.paperDom.style.left=parseInt(.5*(e-this.paperWidth))+"px",this.paperDom.style.top=parseInt(.5*(t-this.paperHeight))+"px",this.width=e,this.height=t,this._buildEvents(),this.maskDom=document.createElement("div"),this.maskDom.style.position="absolute",this.maskDom.style.styleFloat="left",this.maskDom.style.cssFloat="left",this.maskDom.style.left="0px",this.maskDom.style.top="0px",this.maskDom.style.backgroundImage="url('"+this.resourcePath+"/loading.gif')",this.maskDom.style.backgroundRepeat="no-repeat",this.maskDom.style.backgroundPosition="center center",this.maskDom.style.width=e+"px",this.maskDom.style.height=t+"px",this.maskDom.style.display="none",this.dom.appendChild(this.maskDom),this.bgDom=document.createElement("div"),this.bgDom.style.position="absolute",this.bgDom.style.styleFloat="left",this.bgDom.style.cssFloat="left",this.transparent||(this.bgDom.style.backgroundColor="#efefef"),this.dom.insertBefore(this.bgDom,this.paperDom),this._fix()}},{key:"unload",value:function(){this.cleanup(!0),this.unselect(),this.maskDom&&(this.maskDom.parentNode.removeChild(this.maskDom),this.maskDom=null),this.bgDom&&(this.bgDom.parentNode.removeChild(this.bgDom),this.bgDom=null),this.paper&&(this.paper.remove(),this.paper=null,this.paperDom=null),this._destroyEvents()}},{key:"_buildEvents",value:function(){var e=this;this._onClick=function(t){e.onClick(t)},this._onMouseMove=function(t){e.onMouseMove(t)},this._onMouseDown=function(t){e.onMouseDown(t)},this._onMouseUp=function(t){e.onMouseUp(t)},this._onTouchMove=function(t){e.onTouchMove(t)},this._onTouchStart=function(t){e.onTouchStart(t)},this._onTouchEnd=function(t){e.onTouchEnd(t)},this._onKeyPress=function(t){e.onKeyPress(t)},this.dom.addEventListener("click",this._onClick,!1),this.dom.addEventListener("mousemove",this._onMouseMove,!1),this.dom.addEventListener("mousedown",this._onMouseDown,!1),this.dom.addEventListener("mouseup",this._onMouseUp,!1),this.dom.addEventListener("touchmove",this._onTouchMove,!1),this.dom.addEventListener("touchstart",this._onTouchStart,!1),this.dom.addEventListener("touchend",this._onTouchEnd,!1),this.dom.addEventListener("keypress",this._onKeyPress,!1)}},{key:"_destroyEvents",value:function(){this.dom.removeEventListener("click",this._onClick,!1),this.dom.removeEventListener("mousemove",this._onMouseMove,!1),this.dom.removeEventListener("mousedown",this._onMouseDown,!1),this.dom.removeEventListener("mouseup",this._onMouseUp,!1),this.dom.removeEventListener("touchmove",this._onTouchMove,!1),this.dom.removeEventListener("touchstart",this._onTouchStart,!1),this.dom.removeEventListener("touchend",this._onTouchEnd,!1),this.dom.removeEventListener("keypress",this._onKeyPress,!1)}},{key:"_fix",value:function(){var e=this.paperDom,t=e.getElementsByTagName("desc");null!==t&&t.length>0&&(t=t[0],t.innerHTML="Cube Engine Whiteboard - www.getcube.cn");var i=e.getElementsByTagName("defs");null!==i&&i.length>0?i=i[0]:(i=document.createElement("defs"),e.appendChild(i));var r=['<marker id="_cube_arrow_0" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" viewBox="0 0 20 20"><path d="M2,2 L10,6 L2,10 L6,6 L2,2 z" fill="" /></marker>','<marker id="_cube_arrow_1" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" viewBox="0 0 20 20"><path d="M2,2 L10,6 L2,10 L6,6 L2,2 z" fill="" /></marker>','<marker id="_cube_arrow_2" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" viewBox="0 0 20 20"><path d="M2,2 L10,6 L2,10 L6,6 L2,2 z" fill="" /></marker>','<marker id="_cube_arrow_3" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" viewBox="0 0 20 20"><path d="M2,2 L10,6 L2,10 L6,6 L2,2 z" fill="" /></marker>','<marker id="_cube_arrow_4" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" viewBox="0 0 20 20"><path d="M2,2 L10,6 L2,10 L6,6 L2,2 z" fill="" /></marker>'];i.innerHTML=r.join(""),r=null}},{key:"_matcheArrow",value:function(e){for(var t=0;t<this.arrowMarkerColors.length;++t)if(this.arrowMarkerColors[t]==e)return this.arrowMatchTimestamps[t]=Date.now(),"#_cube_arrow_"+t;for(var i=0;i<this.arrowMarkerColors.length;++i)if(this.arrowMarkerColors[i].length<2){var r="_cube_arrow_"+i,n=this.paperDom.getElementById(r);return null===n?(this.arrowMarkerColors[i]="",this.arrowMatchTimestamps[i]=0,"#_cube_arrow_default"):(this.arrowMarkerColors[i]=e,this.arrowMatchTimestamps[i]=Date.now(),n=n.getElementsByTagName("path")[0],n.setAttribute("fill",e),"#"+r)}for(var o=-1,a=Number.MAX_VALUE,s=0;s<this.arrowMatchTimestamps.length;++s){var u=this.arrowMatchTimestamps[s];u<a&&(a=u,o=s)}if(o<0)return"#_cube_arrow_default";this.arrowMarkerColors[o]=e,this.arrowMatchTimestamps[o]=Date.now();var l="_cube_arrow_"+o,h=this.paperDom.getElementById(l);return null===h&&null===(h=document.getElementById(l))?"#_cube_arrow_default":(h=h.getElementsByTagName("path")[0],h.setAttribute("fill",e),"#"+l)}},{key:"_centerBgImage",value:function(e){var t=.5*(this.width-e.width),i=.5*(this.height-e.height);this.bgDom.style.paddingLeft=parseInt(t)+"px",this.bgDom.style.paddingTop=parseInt(i)+"px"}},{key:"_replayRecord",value:function(e,t,i){e.type===m.RectEntity.Name?(m.RectEntity.restore(this.paper,e,i,this),(void 0===t||t)&&this.record(e.type,e.set,e.raw,!1)):e.type===f.EllipseEntity.Name?(f.EllipseEntity.restore(this.paper,e,i,this),(void 0===t||t)&&this.record(e.type,e.set,e.raw,!1)):e.type===c.ArrowEntity.Name?(c.ArrowEntity.restore(this.paper,e,this,i),(void 0===t||t)&&this.record(e.type,e.set,e.raw,!1)):e.type===p.PencilEntity.Name?(p.PencilEntity.restore(this.paper,e,i,this),(void 0===t||t)&&this.record(e.type,e.set,e.raw,!1)):e.type===v.TextEntity.Name&&(v.TextEntity.restore(this.paper,e,i,this),(void 0===t||t)&&this.record(e.type,e.set,e.raw,!1))}},{key:"_replayVGCommand",value:function(e){var t=null,i=null;this.sessionName!==e.from&&(t=e.from),void 0!==e.group&&""!==e.group&&(i=e.group);var r=null;if("rect"===e.name)r=this.loadVGCommand(e,t),null===t&&this.record(e.name.toString(),r,{param:e.param,attr:e.attr});else if("ellipse"===e.name)r=this.loadVGCommand(e,t),null===t&&this.record(e.name.toString(),r,{param:e.param,attr:e.attr});else if("arrow"===e.name)r=this.loadVGCommand(e,t),null===t&&this.record(e.name.toString(),r,{param:e.param,attr:e.attr});else if("path"===e.name)r=this.loadVGCommand(e,t,i),null===t&&this.record(e.name.toString(),r,{param:e.param,attr:e.attr});else if("text"===e.name)r=this.loadVGCommand(e,t,i),null===t&&this.record(e.name.toString(),r,{param:e.param,attr:e.attr});else if("slide"===e.name)null===t?this.workAsSlide(e.param,!0):this.loadVGCommand(e,t,i);else if("undo"===e.name)null===t?this.undo(!0):this.loadVGCommand(e,t,i);else if("redo"===e.name)null===t?this.redo(!0):this.loadVGCommand(e,t,i);else if("bgimage"===e.name){var n=new d.BackgroundImageEntity(e.param,!0);this.selectEntity(n)}else nucleus.getLogger().w("CubeWhiteboard","Unknown replay VG command: "+e.name)}},{key:"onClick",value:function(e){if(null!==this.curEntity)this.curEntity.onClick(e);else{this.viewport.onClick(e);var t=this.getSlide();t&&t.onClick(e)}}},{key:"onMouseMove",value:function(e){g.Utils.isAndroid||g.Utils.isIPhone||(null!==this.curEntity?this.curEntity.onMouseMove(e):this.viewport.onMouseMove(e))}},{key:"onMouseDown",value:function(e){null!==this.curEntity?this.curEntity.onMouseDown(e):this.viewport.onMouseDown(e)}},{key:"onMouseUp",value:function(e){null!==this.curEntity?this.curEntity.onMouseUp(e):this.viewport.onMouseUp(e)}},{key:"onTouchMove",value:function(e){null!==this.curEntity?this.curEntity.onTouchMove(e):this.viewport.onTouchMove(e)}},{key:"onTouchStart",value:function(e){null!==this.curEntity?this.curEntity.onTouchStart(e):this.viewport.onTouchStart(e)}},{key:"onTouchEnd",value:function(e){null!==this.curEntity?this.curEntity.onTouchEnd(e):this.viewport.onTouchEnd(e)}},{key:"onKeyPress",value:function(e){null!==this.curEntity?this.curEntity.onKeyPress(e):this.viewport.onKeyPress(e);var t=this.getSlide();t&&t.onKeyPress(e)}},{key:"adjustSize",value:function(){var e=parseInt(this.dom.offsetWidth),t=parseInt(this.dom.offsetHeight);this.resize(e,t),this._syncSize(),this.viewport.adaptView()}},{key:"_syncSize",value:function(){var e={whiteboardId:this.name,boardSize:{width:this.width,height:this.height},paperSize:{width:this.paperWidth,height:this.paperHeight}};this.triggerChange(e)}},{key:"selectEntity",value:function(e){var t=this;if(e.exclusive){null!==this.curEntity&&(this.curEntity.dispose(),this.curEntity=null),e.board=this,this.curEntity=e,null!==this.defaultColor&&e.color&&(e.color=this.defaultColor),null!==this.defaultBorderColor&&e.borderColor&&(e.borderColor=this.defaultBorderColor),this.defaultWeight>0&&void 0!==e.weight&&(e.weight=this.defaultWeight),this.defaultBorderWidth>0&&void 0!==e.borderWidth&&(e.borderWidth=this.defaultBorderWidth);var i=setTimeout(function(){clearTimeout(i),null!==t.curEntity&&t.curEntity.onDraw(t.paper)},30)}else{e.board=this;var r=setTimeout(function(){clearTimeout(r),e.onDraw(t.paper),t.exMap.put(e.name,e)},30)}}},{key:"unselect",value:function(e){if(void 0!==e&&this.exMap.containsKey(e.name)){var t=this.exMap.get(e.name);return this.exMap.remove(e.name),void t.dispose()}null!==this.curEntity&&this.curEntity.exclusive&&(this.curEntity.dispose(),this.curEntity=null)}},{key:"undo",value:function(e){if(0===this.pastRecords.length)return!1;var t=this.pastRecords.pop();this.undoRecords.push(t),this.viewport.unmanage(t.set),void 0===t.set.forEach?(t.set._custom&&(t.set._custom.remove(),t.set._custom=null),t.set.remove()):t.set.forEach(function(e){e.remove()});var i=this.getSlide();if(i&&i.popNote(),null!=this.recorder&&this.recorder.isRecording()&&this.recorder._notifyOperation({name:"undo",time:Date.now()}),!e){var r={whiteboardId:this.name,command:{name:"undo",param:t.sn}};this.triggerChange(r)}return!0}},{key:"redo",value:function(e){if(0===this.undoRecords.length)return!1;var t=this.undoRecords.pop();this.pastRecords.push(t),t.type===m.RectEntity.Name?m.RectEntity.restore(this.paper,t):t.type===f.EllipseEntity.Name?f.EllipseEntity.restore(this.paper,t):t.type===c.ArrowEntity.Name?c.ArrowEntity.restore(this.paper,t,this):t.type===p.PencilEntity.Name?p.PencilEntity.restore(this.paper,t):t.type===v.TextEntity.Name?v.TextEntity.restore(this.paper,t):nucleus.getLogger().e("CubeWhiteboard#redo","Unknown command type: "+t.type);var i=this.getSlide();if(i&&i.appendNote(t),null!=this.recorder&&this.recorder.isRecording()&&this.recorder._notifyOperation({name:"redo",time:Date.now()}),!e){var r={whiteboardId:this.name,command:{name:"redo",param:t.sn}};null!==i&&(r.command.page=t.cursor+1),this.triggerChange(r)}return!0}},{key:"erase",value:function(e,t){if(this.pastRecords.length>0)for(var i=0;i<this.pastRecords.length;++i){var r=this.pastRecords[i];void 0===r.set.forEach?(r.set._custom&&(r.set._custom.remove(),r.set._custom=null),r.set.remove()):r.set.forEach(function(e){e.remove()})}if(this.remoteRecordMap.size()>0)for(var n=this.remoteRecordMap.values(),o=0;o<n.length;++o)for(var a=n[o],s=0;s<a.length;++s){var u=a[s];u.el.remove()}this.pastRecords.splice(0,this.pastRecords.length),this.undoRecords.splice(0,this.undoRecords.length),this.cmdSnCursor=0;for(var l=0;l<this.arrowMarkerColors.length;++l)this.arrowMarkerColors[l]="",this.arrowMatchTimestamps[l]=0;if(this.remoteRecordMap.clear(),this.remoteHistoryMap.clear(),void 0===t||t){t=!0;var h=this.getSlide();h&&h.clearNote()}else t=!1;if(null!=this.recorder&&this.recorder.isRecording()&&this.recorder._notifyOperation({name:"erase",time:Date.now()}),!e){var c={whiteboardId:this.name,command:{name:"erase",param:t}};this.triggerChange(c)}return!0}},{key:"cleanup",value:function(e){this.exMap.clear(),this.pastRecords.splice(0,this.pastRecords.length),this.undoRecords.splice(0,this.undoRecords.length),this.cmdSnCursor=0;for(var t=0;t<this.arrowMarkerColors.length;++t)this.arrowMarkerColors[t]="",this.arrowMatchTimestamps[t]=0;if(this.remoteRecordMap.clear(),this.remoteHistoryMap.clear(),null!==this.remoteSlide&&(this.remoteSlide.dispose(),this.remoteSlide=null),null!==this.bgImage&&(this.bgImage.remove(),this.bgImage=null),null!=this.paper&&this.paper.clear(),this.adjustSize(),this.viewport.reset(),this._fix(),this.hideMask(),this.listener.onCleanup(this),!e){var i={whiteboardId:this.name,command:{name:"cleanup",param:0}};this.triggerChange(i)}return!0}},{key:"zoom",value:function(e){g.Utils.getElementChildren(this.paperDom).length<=2||this.viewport.zoom(e)}},{key:"resetView",value:function(e){!this.getSlide()&&(this.remoteWidth<=0||e)?this.viewport.reset():this.viewport.adaptView()}},{key:"setRemoteSize",value:function(e,t){this.remoteWidth=e,this.remoteHeight=t}},{key:"syncBoardSize",value:function(e){e.width>this.remoteWidth&&this.setRemoteSize(e.width,e.height),this.viewport.adaptView()}},{key:"numPaperElements",value:function(){return g.Utils.getElementChildren(this.paperDom).length-2}},{key:"getExEntity",value:function(e){return this.exMap.get(e)}},{key:"showMask",value:function(){this.maskDom.style.display="block"}},{key:"hideMask",value:function(){this.maskDom.style.display="none"}},{key:"exportContent",value:function(e){var t=null,i=this.getSlide();if(i){t={slide:{origin:i.getDocName().toString(),alias:i.file.alias.toString(),size:i.file.size,pages:[]}};var r=null;void 0!==e&&(e instanceof Array?r=e:e instanceof Number&&(r=[e])),null===r&&(r=[i.currentPage()]);for(var n=0;n<r.length;++n){var o=r[n],a=i.exportPage(o);null!==a&&t.slide.pages.push(a)}}else{t={records:[]};for(var s=0;s<this.pastRecords.length;++s){var u=this.pastRecords[s],l={sn:u.sn,type:u.type,raw:u.raw,time:u.time};t.records.push(l)}}return t}},{key:"importContent",value:function(e){var t=this;if(this.numPaperElements()>0)return this.cleanup(!0),setTimeout(function(){t.importContent(e)},150),!0;if(void 0!==e.slide){for(var i={cubeId:e.slide.cubeId,origin:e.slide.name,alias:e.slide.alias,size:e.slide.size,urls:[]},r=e.slide.pages,n=0;n<r.length;++n){var o=r[n];i.urls.push(o.url)}this.workAsSlide(i,!0),setTimeout(function(){var e=r[0].notes;if(void 0!==e)for(var i=0;i<e.length;++i)t._replayRecord(e[i]);for(var n=t.getSlide(),o=0;o<r.length;++o){var a=r[o].notes;if(void 0!==a)for(var s=0;s<a.length;++s)n.appendNote(o+1,a[s])}},500)}else if(void 0!==e.records)for(var a=0;a<e.records.length;++a){var s=e.records[a];this._replayRecord(s)}else nucleus.getLogger().e("CubeWhiteboard#importContent","Data format error!");return!0}},{key:"record",value:function(e,t,i,r){var n=this.cmdSnCursor++,o=Date.now(),a={sn:n,type:e,set:t,raw:i,time:o};if(this.pastRecords.push(a),void 0===r||r){var s=this.getSlide();s&&s.appendNote(a)}return null!==this.recorder&&this.recorder._notifyRecord(a),n}},{key:"setTransparency",value:function(e){this.transparent!==e&&(this.transparent=e,e?(this.paperDom.style.backgroundColor="",this.bgDom.style.backgroundColor=""):(this.paperDom.style.backgroundColor="#fefefe",this.bgDom.style.backgroundColor="#efefef"))}},{key:"setBackgroundImage",value:function(e,t){var i=this,r=this.bgDom,n=r.getElementsByTagName("img")[0];if(void 0===n||null===n){var o=document.createElement("img");return r.appendChild(o),o.onload=function(e){t.call(null,o),i._centerBgImage(o)},o.src=e,o}return n.setAttribute("src",""),n.onload=function(e){t.call(null,n),i._centerBgImage(n)},n.setAttribute("src",e),n}},{key:"setBackgroundColor",value:function(e){this.paperDom.style.backgroundColor=e,this.bgDom.style.backgroundColor=e}},{key:"loadRecordData",value:function(e,t){void 0!==t&&t&&this.cleanup(!0);for(var i=e.commands,r=this,n=0;n<i.length;++n){var o=i[n];null==o.page?this._replayVGCommand(o):(1===o.page&&this._replayVGCommand(o),function(e){setTimeout(function(){var t=r.getSlide();if(t){var i={sn:e.sn,type:e.name,set:null,raw:{param:e.param,attr:e.attr},page:e.page};t.appendNote(i)}},60)}(o))}}},{key:"loadVGCommand",value:function(e,t,i){var r=void 0;if("slide"===e.name){if(null!==this.remoteSlide&&(this.remoteSlide.from=t,i&&(this.remoteSlide.group=i),this.remoteSlide.file.origin===e.param.origin)){var n=e.attr;return void((Math.abs(n.cursor-this.remoteSlide.cursor)>0||"="===n.page)&&this.remoteSlide.gotoPage(n.cursor+1))}if(this.exMap.containsKey(d.BackgroundImageEntity.Name)){var o=this.exMap.get(d.BackgroundImageEntity.Name);o.dispose(),this.exMap.remove(d.BackgroundImageEntity.Name),o=null}this.cleanup(!0),this.remoteSlide=new y.SlideEntity(e.param,!0),this.remoteSlide.from=t,i&&(this.remoteSlide.group=i),this.remoteSlide.cursor=e.attr.cursor,this.selectEntity(this.remoteSlide)}else if("undo"===e.name){var a=null;a=i?t+"_"+i:t;var s=this.remoteRecordMap.get(a);if(s){for(var u=parseInt(e.param),l=[],h=s.length-1;h>=0;--h){var g=s[h];if(!(g.sn>=u))break;l.push(g)}if(l.length>0){var b=this.remoteHistoryMap.get(a);b||(b=[],this.remoteHistoryMap.put(a,b));for(var k=0;k<l.length;++k){var w=l[k];b.push(w);var _=s.indexOf(w);_>=0&&s.splice(_,1),w.el.remove()}}}var E=this.getSlide();E&&E.popNote()}else if("redo"===e.name){var C=null;C=i?t+"_"+i:t;var x=this.remoteHistoryMap.get(C);if(x){for(var P=parseInt(e.param),T=[],S=x.length-1;S>=0;--S){var I=x[S];if(!(I.sn<=P))break;T.push(I)}if(T.length>0){var W=this.remoteRecordMap.get(C);W||(W=[],this.remoteRecordMap.put(C,W));for(var M=0;M<T.length;++M){var A=T[M];W.push(A);var O=x.indexOf(A);if(O>=0&&x.splice(O,1),e.page){var R=this.getSlide();R&&R.appendNote(A)}var F=A.type;F===m.RectEntity.Name?m.RectEntity.restore(this.paper,A):F===f.EllipseEntity.Name?f.EllipseEntity.restore(this.paper,A):F===c.ArrowEntity.Name?c.ArrowEntity.restore(this.paper,A,this):F===p.PencilEntity.Name?p.PencilEntity.restore(this.paper,A):F===v.TextEntity.Name?v.TextEntity.restore(this.paper,A):nucleus.getLogger().e("CubeWhiteboard#_processVGRedo","Unknown command type: "+F)}}}}else if("erase"===e.name)this.erase(!0);else if("cleanup"===e.name)this.cleanup(!0);else if("bgimage"===e.name){var j=new d.BackgroundImageEntity(e.param,!0);this.selectEntity(j)}else{var N=void 0;if("rect"===e.name?N=m.RectEntity:"ellipse"===e.name?N=f.EllipseEntity:"arrow"===e.name?N=c.ArrowEntity:"path"===e.name?N=p.PencilEntity:"text"===e.name&&(N=v.TextEntity),null!==N){if(r=N.draw(this.paper,e,this),null===t)return r;var L=null;if(L=void 0!==i&&null!=i?t+"_"+i:t,this.remoteRecordMap.containsKey(L)){var D=this.remoteRecordMap.get(L);D.push({sn:e.sn,type:N.Name,el:r,raw:{param:e.param,attr:e.attr}})}else{var z=[{sn:e.sn,type:N.Name,el:r,raw:{param:e.param,attr:e.attr}}];this.remoteRecordMap.put(L,z)}return r}nucleus.getLogger().w("CubeWhiteboard","Unknown VG command: "+e.name)}}},{key:"remove",value:function(e){if(0!==this.pastRecords.length){for(var t=null,i=-1,r=this.pastRecords.length-1;r>=0;--r){var n=this.pastRecords[r];if(n.sn===e){t=n,i=r;break}}null!==t&&(this.pastRecords.splice(i,1),this.undoRecords.push(t),this.viewport.unmanage(t.set),void 0===t.set.forEach?(t.set._custom&&(t.set._custom.remove(),t.set._custom=null),t.set.remove()):t.set.forEach(function(e){e.remove()}))}}},{key:"resize",value:function(e,t){if(null!==this.paper){if(this.paperWidth>0&&this.paperHeight>0){var i=e-this.paperWidth,r=t-this.paperHeight;this.paper.setSize(this.paperWidth,this.paperHeight),this.paperDom.style.left=parseInt(.5*i)+"px",this.paperDom.style.top=parseInt(.5*r)+"px"}else this.paper.setSize(e,t),this.paperDom.style.left="0px",this.paperDom.style.top="0px";this.width=e,this.height=t,null!==this.curEntity&&this.curEntity.onResize(e,t);var n=this.getSlide();n&&n.onResize(e,t),null!==this.remoteSlide&&this.remoteSlide.onResize(e,t),this.maskDom.style.width=e+"px",this.maskDom.style.height=t+"px",this.bgDom.style.width=e+"px",this.bgDom.style.height=t+"px";var o=this.bgDom.getElementsByTagName("img");null!==o&&void 0!==(o=o[0])&&null!==o&&this._centerBgImage(o)}}},{key:"workAsSlide",value:function(e,t){var i=!t||void 0;if(void 0===e.urls||void 0===e.name)return nucleus.getLogger().w("CubeWhiteboard","Invalid sharing file"),!1;if(this.getSlide()&&(null!==this.recorder&&this.recorder.isRecording()||null!==this.player&&this.player.isPlaying()))return this.listener.onWhiteboardFailed(_.StateCode.OpenSlideFailed),!1;if(this.exMap.containsKey(d.BackgroundImageEntity.Name)){var r=this.exMap.get(d.BackgroundImageEntity.Name);r.dispose(),this.exMap.remove(d.BackgroundImageEntity.Name),r=null}this.cleanup(!0);var n=new y.SlideEntity(e);return n.from=this.sessionName,i&&(n.isFirstSharing=!0),this.selectEntity(n),this.listener.onSlideOpened(n),!0}},{key:"getSlide",value:function(){return this.exMap.get(y.SlideEntity.Name)}},{key:"getZoomRatio",value:function(){return this.viewport.getRatio()}},{key:"getRecorder",value:function(){return null===this.recorder&&(this.recorder=new b.WhiteboardRecorder(this)),this.recorder}},{key:"getPlayer",value:function(){return null===this.player&&(this.player=new k.WhiteboardPlayer(this)),this.player}},{key:"onSlideChanged",value:function(e,t){this.viewport.adaptView(),this.listener.onSlideChanged(e),null!==this.recorder&&this.recorder.isRecording()&&this.recorder._notifyOperation({name:"slide",page:e.currentPage(),time:Date.now()})}},{key:"triggerChange",value:function(e){this.listener.onChange(e)}}]),t}(u.WhiteboardCoreService)},function(e,t,i){var r=i(3),n=i(15),o=i(14),a=i(5),s=i(13),u=i(4),l=i(0),h=i(6),c=i(7),d=i(8),f=i(9),p=i(10),m=i(11),y=i(2),v=i(12);!function(e){e.CubeWhiteboardCoreListener=r.WhiteboardCoreListener,e.CubeWhiteboardCoreServiceWorker=n.WhiteboardCoreServiceWorker,e.CubeWhiteboardRecorderListener=o.WhiteboardRecorderListener,e.CubeWhiteboardRecorder=a.WhiteboardRecorder,e.CubeWhiteboardPlayerListener=s.WhiteboardPlayerListener,e.CubeWhiteboardPlayer=u.WhiteboardPlayer,e.GraphicsEntity=l.GraphicsEntity,e.SlideNote=h.SlideNote,e.ArrowEntity=c.ArrowEntity,e.BackgroundImageEntity=d.BackgroundImageEntity,e.EllipseEntity=f.EllipseEntity,e.PencilEntity=p.PencilEntity,e.RectEntity=m.RectEntity,e.SlideEntity=y.SlideEntity,e.TextEntity=v.TextEntity}(window)},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardCoreService=function(){function e(){r(this,e)}return n(e,[{key:"setListener",value:function(e){}},{key:"load",value:function(e,t){}},{key:"adjustSize",value:function(){}},{key:"selectEntity",value:function(e){}},{key:"unselect",value:function(e){}},{key:"undo",value:function(e){}},{key:"redo",value:function(e){}},{key:"erase",value:function(e,t){}},{key:"cleanup",value:function(e){}},{key:"zoom",value:function(e){}},{key:"resetView",value:function(e){}},{key:"setRemoteSize",value:function(e,t){}},{key:"syncBoardSize",value:function(e){}},{key:"numPaperElements",value:function(){}},{key:"getExEntity",value:function(e){}},{key:"showMask",value:function(){}},{key:"hideMask",value:function(){}},{key:"exportContent",value:function(e){}},{key:"importContent",value:function(e){}},{key:"record",value:function(e,t,i,r){}},{key:"setTransparency",value:function(e){}},{key:"setBackgroundImage",value:function(e,t){}},{key:"setBackgroundColor",value:function(e){}},{key:"loadRecordData",value:function(e,t){}},{key:"loadVGCommand",value:function(e,t,i){}},{key:"remove",value:function(e){}},{key:"resize",value:function(e,t){}},{key:"workAsSlide",value:function(e,t){}},{key:"getSlide",value:function(){}},{key:"getZoomRatio",value:function(){}},{key:"getRecorder",value:function(){}},{key:"getPlayer",value:function(){}},{key:"unload",value:function(){}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StateCode={OpenSlideFailed:1600}},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(1);t.Viewport=function(){function e(t){r(this,e),this.wb=t,this.width=t.paperWidth,this.height=t.paperHeight,this.enabled=!0,this.down=!1,this.bboxPadding=4,this.zoomRatio=-1,this.posX=0,this.posY=0,this.tempX=0,this.tempY=0,this.elements=[]}return n(e,[{key:"manage",value:function(e,t){var i=this;o.Utils.unselectable(t.node),this.elements.indexOf(t)>=0||(t.sn=e,this.elements.push(t),t.click(function(e){if(null==t._custom||void 0===t._custom){var r=i.wb.paper,n=t.getBBox();t._custom={list:[],remove:function(){for(var e=0;e<this.list.length;++e)this.list[e].remove();this.list.splice(0,this.list.length)}};var o=r.rect(n.x-i.bboxPadding,n.y-i.bboxPadding,n.width+i.bboxPadding+i.bboxPadding,n.height+i.bboxPadding+i.bboxPadding);o.attr("stroke","#1AA0E6"),o.attr("stroke-dasharray","."),t._custom.list.push(o);var a=r.circle(n.x-i.bboxPadding,n.y,10),s=function e(r){t._custom.remove(),t._custom=null,i.wb.remove(t.sn),a.unclick(e)};a.click(s),a.attr("fill","#1AA0E6"),a.attr("stroke","#1AA0E6"),t._custom.list.push(a);var u=n.x-5-i.bboxPadding,l=n.y-5,h=n.x+5-i.bboxPadding,c=n.y+5,d=r.path("M"+u+","+l+" L"+h+","+c+" Z");d.attr("stroke","#FFF"),d.attr("stroke-width",2),t._custom.list.push(d),u=n.x+5-i.bboxPadding,l=n.y-5,h=n.x-5-i.bboxPadding,c=n.y+5,d=r.path("M"+u+","+l+" L"+h+","+c+" Z"),d.attr("stroke","#FFF"),d.attr("stroke-width",2),t._custom.list.push(d)}}))}},{key:"unmanage",value:function(e){var t=this.elements.indexOf(e);t<0||(this.elements.splice(t,1),void 0!==e._custom&&null!=e._custom&&(e._custom.remove(),e._custom=null))}},{key:"reset",value:function(){this.posX=0,this.posY=0,this.width=this.wb.paperWidth,this.height=this.wb.paperHeight,this.wb.paper.setViewBox(this.posX,this.posY,this.width,this.height,!0),this.zoomRatio=1,this.elements.splice(0,this.elements.length)}},{key:"adaptView",value:function(){var e=null,t=null,i=this.wb.getSlide(),r=this.wb.width,n=this.wb.height;if(0!=r&&0!=n){var o=!1;if(null==i){if(this.wb.remoteWidth<=0)return;this.wb.remoteWidth>r&&(o=!0)}if(o){var a=this.wb.remoteWidth,s=this.wb.remoteHeight,u=.5*(this.wb.paperWidth-a),l=.5*(this.wb.paperHeight-s),h=a,c=s;e={x:u,y:l},t={width:h,height:c}}else{if(null==i)return;if(null==(e=i.getPosition())){var d=this;return void setTimeout(function(){d.adaptView()},40)}if(t=i.getSize(),r>=t.width&&n>=t.height)return}var f=t.width/r,p=t.height/n;if(f>p){var m=f,y=parseInt(Math.round(m*this.wb.paperWidth))+1,v=.5*(r*m-this.wb.paperWidth*m)+e.x;this.posX=parseInt(v),this.posY=0,this.width=y,this.height=this.wb.paperHeight,this.zoomRatio=r/t.width}else{var m=p,g=parseInt(Math.round(m*this.wb.paperHeight))+1,b=.5*(n*m-this.wb.paperHeight*m)+e.y;this.posX=0,this.posY=parseInt(b),this.width=this.wb.paperWidth,this.height=g,this.zoomRatio=n/t.height}this.wb.paper.setViewBox(this.posX,this.posY,this.width,this.height,!0)}}},{key:"getRatio",value:function(){if(this.zoomRatio>0)return this.zoomRatio;var e=this.wb.paperWidth/this.width,t=this.wb.paperHeight/this.height;return Math.abs(e-1)<Math.abs(t-1)?(this.zoomRatio=t,t):(this.zoomRatio=e,e)}},{key:"zoom",value:function(e){if(!(e<=0)){var t=this.wb.paperWidth/e,i=this.wb.paperHeight/e;this.posX=parseInt(.5*(this.wb.paperWidth-t)),this.posY=parseInt(.5*(this.wb.paperHeight-i)),this.width=t,this.height=i,this.wb.paper.setViewBox(this.posX,this.posY,this.width,this.height,!0),this.zoomRatio=e}}},{key:"fireDown",value:function(e){if(this.enabled&&0!=this.wb.numPaperElements()){this.down=!0;var t=void 0===e.touches?o.Utils.getMousePos(e):o.Utils.getTouchPos(e);this.tempX=t.x,this.tempY=t.y}}},{key:"fireUp",value:function(e){this.enabled&&(this.down=!1)}},{key:"fireMove",value:function(e){if(this.enabled&&this.down){var t=void 0===e.touches?o.Utils.getMousePos(e):o.Utils.getTouchPos(e);if(!isNaN(parseInt(t.x))&&!isNaN(parseInt(t.y))){var i=this.tempX-t.x,r=this.tempY-t.y;this.posX+=parseInt(i),this.posY+=parseInt(r),this.wb.paper.setViewBox(this.posX,this.posY,this.width,this.height,!0),this.tempX=t.x,this.tempY=t.y}}}},{key:"onClick",value:function(e){if("svg"==e.target.tagName)for(var t=0;t<this.elements.length;++t){var i=this.elements[t];void 0!==i._custom&&null!=i._custom&&(i._custom.remove(),i._custom=null)}}},{key:"onMouseMove",value:function(e){this.fireMove(e)}},{key:"onMouseDown",value:function(e){this.fireDown(e)}},{key:"onMouseUp",value:function(e){this.fireUp(e)}},{key:"onTouchMove",value:function(e){this.fireMove(e)}},{key:"onTouchStart",value:function(e){this.fireDown(e)}},{key:"onTouchEnd",value:function(e){this.fireUp(e)}},{key:"onKeyPress",value:function(e){}},{key:"_detectCollision",value:function(e,t){}}]),e}()},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.HashMap=function(){function e(){r(this,e),this._stack={},this._size=0}return n(e,[{key:"put",value:function(e,t){this.containsKey(e)||this._size++,this._stack[e]=t}},{key:"get",value:function(e){return this._stack[e]}},{key:"containsKey",value:function(e){return this._stack.hasOwnProperty(e)}},{key:"containsValue",value:function(e){for(var t in this._stack)if(this._stack.hasOwnProperty(t)&&this._stack[t]===e)return!0;return!1}},{key:"remove",value:function(e){return!!this.containsKey(e)&&(this._size--,delete this._stack[e])}},{key:"keySet",value:function(){return Object.keys(this._stack)}},{key:"values",value:function(){return Object.values(this._stack)}},{key:"isEmpty",value:function(){return 0===this._size}},{key:"size",value:function(){return this._size}},{key:"clear",value:function(){this._size=0,this._stack={}}}]),e}()}])},103:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteboardServiceWorker=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=i(165),u=i(66),l=i(67),h=i(167),c=i(0),d=i(166),f=i(21);i(10),t.WhiteboardServiceWorker=function(e){function t(e,i){r(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.WhiteboardListener,CELLET.Whiteboard));return o.fileHttp=null,o.session=e.session,o.whiteboard=new l.Whiteboard,o.name=null,o.permission=CubePermission.WRITE,o.offline=!1,o.queryWBCallback=null,o.queryWBErrorCallback=null,o.querySharedCallback=null,o.querySharedErrorCallback=null,o.remoteSizeName=null,o.passiveList=[],o.currentWhiteboard=[],o.core=new CubeWhiteboardCoreServiceWorker(i,o.name,e.session.name),o.core.load(),o.core.setResourcePath(e.resourcePath),o.core.setListener({onSlideOpened:function(e){o.delegate.onFileShared(o.whiteboard,e.file)},onSlideChanged:function(e){o.delegate.onSlide(o.whiteboard,e)},onCleanup:function(){o.delegate.onCleanup(o.whiteboard)},onChange:function(e){if(!o.offline){var t=CubeConst.ActionRestrainWhiteboard;e.command&&(t=CubeConst.ActionVgCmdWhiteboard);var i=o.whiteboard,r={};r=e.command?{whiteboardId:i.whiteboardId,command:e.command,from:cube.session.name}:{whiteboardId:i.whiteboardId,boardSize:e.boardSize,paperSize:e.paperSize,from:cube.session.name};o.engine.connect.send(CELLET.Whiteboard,t,r)||o.delegate.onWhiteboardFailed(o.whiteboard,new c.CubeError(CubeStateCode.RequestTimeout,"request timeout"))}},onFailed:function(e){o.delegate.onWhiteboardFailed(o.whiteboard,new c.CubeError(e))}}),o}return o(t,e),a(t,[{key:"getSlide",value:function(){return this.core.getSlide()}},{key:"onRegisterStateChanged",value:function(){this.engine.registered&&(this.fileHttp=new f.FileHttp(this.engine))}},{key:"create",value:function(e){var t=new d.WhiteboardConfig;t.displayName=e.displayName,t.bindGroupId=e.bindGroupId,t.maxNumber=e.maxNumber;var i={whiteboard:t,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionCreateWhiteboard,i)}},{key:"destroy",value:function(e){var t={whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionDestroyWhiteboard,t)}},{key:"join",value:function(e){var t={whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionJoinWhiteboard,t)}},{key:"quit",value:function(e){var t={whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionQuitWhiteboard,t)}},{key:"rejectApply",value:function(e,t){var i={cubeId:t,whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionRejectApplyWhiteboard,i)}},{key:"acceptApply",value:function(e,t){var i={cubeId:t,whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionAcceptApplyWhiteboard,i)}},{key:"invite",value:function(e,t){var i={whiteboardId:e,members:t,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionInviteWhiteboard,i)}},{key:"rejectInvite",value:function(e,t){var i={cubeId:t,whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionRejectWhiteboardInvite,i)}},{key:"acceptInvite",value:function(e,t){var i={cubeId:t,whiteboardId:e,from:this.engine.session.name};this.engine.connect.send(CELLET.Whiteboard,CubeConst.ActionAcceptWhiteboardInvite,i)}},{key:"setLineWeight",value:function(e){this.core.setLineWeight(e)}},{key:"setLineColor",value:function(e){this.core.curEntity.borderColor=e}},{key:"selectPencil",value:function(){this._selectEntity(new PencilEntity)}},{key:"selectText",value:function(){this._selectEntity(new TextEntity)}},{key:"selectRect",value:function(){this._selectEntity(new RectEntity)}},{key:"selectEllipse",value:function(){this._selectEntity(new EllipseEntity)}},{key:"selectArrow",value:function(){this._selectEntity(new ArrowEntity)}},{key:"unSelect",value:function(e,t){this.core.unselect(t)}},{key:"_selectEntity",value:function(e){if(this.permission!=CubePermission.WRITE)return nucleus.getLogger().e("CubeWhiteboard#selectEntity","You don't have permission to write on the whiteboard!"),void this.delegate.onFailed(this,CubeStateCode.NotHavePermission);this.core.selectEntity(e)}},{key:"undo",value:function(){return this.permission!=CubePermission.WRITE?(nucleus.getLogger().e("CubeWhiteboard#undo","You don't have permission to write on the whiteboard!"),!1):(this.core.undo(),!0)}},{key:"redo",value:function(){return this.permission!=CubePermission.WRITE?(nucleus.getLogger().e("CubeWhiteboard#redo","You don't have permission to write on the whiteboard!"),!1):(this.core.redo(),!0)}},{key:"erase",value:function(){return this.permission!=CubePermission.WRITE?(nucleus.getLogger().e("CubeWhiteboard#erase","You don't have permission to write on the whiteboard!"),!1):(this.core.erase(),!0)}},{key:"cleanup",value:function(){return this.permission!=CubePermission.WRITE?(nucleus.getLogger().e("CubeWhiteboard#cleanup","You don't have permission to write on the whiteboard!"),!1):(this.core.cleanup(),!0)}},{key:"zoom",value:function(e){this.core.zoom(e)}},{key:"getZoomRatio",value:function(){return this.core.getZoomRatio()}},{key:"shareFile",value:function(e){var t=this;new Promise(function(i,r){t.fileHttp.createUpload(e,function(e,n){e&&(r(n),t.delegate.onWhiteboardFailed(t.whiteboard,e)),200==n.state.code?i(n):t.delegate.onWhiteboardFailed(t.whiteboard,"Error")})}).then(function(i){var r=i.data.fileInfo,n=new h.WhiteboardSlide(t.session.name,t.whiteboard.whiteboardId,r.md5,r.url,r.name);r.file=e.file,n.name=r.name,n.size=r.size,t.fileHttp.upload(r,function(e,i){if(!e&&200==i.state.code){t.delegate.onSlideUpdated(t.whiteboard,n),setTimeout(function(){t.fileHttp._progressTask(r.fileId,function(e,i){if(!e&&200==i.state.code){var r=i.data.fileInfo;t.delegate.onSlideUploading(t.whiteboard,n,r.progress,r.size)}})},200);var o=i.data.fileInfo;if(o.size==o.progress){n.url=o.url;var a=n.name.substr(n.name.length-4);if("pptx"==a||null!=a.match(".ppt")){var s=o.url+"?info";Ajax.newRequest(s).method("GET").send(function(e){var i=JSON.parse(e.data);if(console.log(i),200==i.state.code){var r=i.data.slideUrls;n.urls=r,t.delegate.onSlideUploadCompleted(t.whiteboard,n)}})}else{var u=[o.url];n.urls=u,t.delegate.onSlideUploadCompleted(t.whiteboard,n)}}}})}).catch(function(e){t.delegate.onWhiteboardFailed(t.whiteboard,e)})}},{key:"listFile",value:function(e,t){var i=this.utils.isSecure?"https":"http",r=i+"://"+_CUBE_DOMAIN+":"+_CUBE_PORT+"/v3/whiteboard",n=e.split(","),o={wbIds:JSON.stringify(n),token:this.engine.accToken};Ajax.newRequest(r).method("POST").content(o).send(function(e){var i=JSON.parse(e.data);200==i.state.code&&t(i)})}},{key:"syncAllWhiteboard",value:function(e,t,i){var r=this.utils.isSecure?"https":"http",n=r+"://"+_CUBE_DOMAIN+":"+_CUBE_PORT+"/v3/whiteboard/users/sync",o={offset:t,limit:i,cubeId:e,token:this.engine.accToken};Ajax.newRequest(n).method("POST").content(o).send(function(e){var t=JSON.parse(e.data);200==t.state.code&&callback(t)})}},{key:"nextPage",value:function(){null!=this.getSlide()&&this.getSlide().nextPage()}},{key:"prevPage",value:function(){null!=this.getSlide()&&this.getSlide().prevPage()}},{key:"gotoPage",value:function(e){null!=this.getSlide()&&this.getSlide().gotoPage(e)}},{key:"getView",value:function(){return document.getElementById(this.core.domId)}},{key:"exportWhiteboard",value:function(e,t){return this.core.exportContent(e)}},{key:"importWhiteboard",value:function(e,t){return this.core.importContent(e)}},{key:"setBackgroundColor",value:function(e){this.core.setBackgroundColor(e)}},{key:"workAsSlide",value:function(e,t){return void 0==e?(this.delegate.onFailed(whiteboard,CubeStateCode.CubeStateLoadFileFailed),void nucleus.getLogger().e("CubeWhiteboard#workAsSlide","File Info is undefined!")):this.core.workAsSlide(e,t)}},{key:"queryRecords",value:function(e,t,i){var r=this.utils.isSecure?"https":"http",n="string"==typeof e?e.split(","):e.whiteboardId,o=r+"://"+_CUBE_DOMAIN+":"+_CUBE_PORT+"/v3/whiteboard/action/list",a={whiteboardId:n,token:this.engine.accToken,startTime:t};Ajax.newRequest(o).method("POST").content(a).send(function(t){var r=JSON.parse(t.data);200==r.state.code&&i(r,e)})}},{key:"queryHistoryRecords",value:function(e,t,i){}},{key:"_processVGCommand",value:function(e){var t=e.from,i=null;void 0!==e.group&&""!=e.group&&(i=e.group,nucleus.getLogger().d("CubeWhiteboard","Group shared - group: "+e.group+" and from: "+e.from)),this.loadVGCommand(e.command,t,i)}},{key:"loadVGCommand",value:function(e,t,i){return this.core.loadVGCommand(e,t,i)}},{key:"loadRecordData",value:function(e,t,i){null!=this.session&&this.core.loadRecordData(t,i)}},{key:"onDialogue",value:function(e,t){var i=t.getParamAsString("state"),r=t.getParamAsString("data"),n=r.whiteboard,o=new CubeUser(r.from),a=new CubeUser(r.user?r.user:this.engine.accName);if(!i&&200!=i.code)return this.delegate.onWhiteboardFailed(this.whiteboard,new c.CubeError(i.code,i.desc)),!1;switch(n&&e.indexOf("ack")>-1&&(n.isSelf=!0),e){case CubeConst.ActionCreateWhiteboardAck:case CubeConst.ActionCreateWhiteboardNotify:this.delegate.onWhiteboardCreated(n,o);break;case CubeConst.ActionVgCmdWhiteboardNotify:this._processVgCmdWhiteboardNotify(r);break;case CubeConst.ActionDestroyWhiteboardAck:case CubeConst.ActionDestroyWhiteboardNotify:this.delegate.onWhiteboardDestroyed(n,o);break;case CubeConst.ActionApplyjoinWhiteboardNotify:this.delegate.onWhiteboardApplied(n,o);break;case CubeConst.ActionRejectApplyWhiteboardAck:case CubeConst.ActionRejectApplyWhiteboardNotify:this.delegate.onWhiteboardRejectApplied(n,o,a);break;case CubeConst.ActionAcceptApplyWhiteboardAck:case CubeConst.ActionAcceptApplyWhiteboardNotify:this.delegate.onWhiteboardApplyJoined(n,o,a);break;case CubeConst.ActionInviteWhiteboardAck:case CubeConst.ActionInviteWhiteboardNotify:this.delegate.onWhiteboardInvited(n,o,r.members);break;case CubeConst.ActionRejectWhiteboardInviteAck:case CubeConst.ActionRejectWhiteboardInviteNotify:this.delegate.onWhiteboardRejectInvited(n,o,a);break;case CubeConst.ActionAcceptWhiteboardInviteAck:case CubeConst.ActionAcceptWhiteboardInviteNotify:this.delegate.onWhiteboardInviteJoined(n,o,a);break;case CubeConst.ActionAcceptWhiteboardInviteSync:this.delegate.onWhiteboardJoinFromOthers(n,o,a);break;case CubeConst.ActionJoinWhiteboardAck:this._processJoinWhiteboardAck(r);break;case CubeConst.ActionJoinWhiteboardSync:this.delegate.onWhiteboardApplied(n);break;case CubeConst.ActionJoinWhiteboardNotify:this._processJoinWhiteboardAck(r);break;case CubeConst.ActionQuitWhiteboardAck:this._processQuitWhiteboardAck(r);break;case CubeConst.ActionQuitWhiteboardSync:this._processQuitWhiteboardSync(r);break;case CubeConst.ActionQuitWhiteboardNotify:this._processQuitWhiteboardAck(r)}}},{key:"_processQuitWhiteboardAck",value:function(e){e.from;this.whiteboard=null,this.delegate.onWhiteboardQuited(e)}},{key:"_processQuitWhiteboardSync",value:function(e){this.whiteboard=null,document.getElementsByClassName()}},{key:"_processVgCmdWhiteboardNotify",value:function(e){if(nucleus.getLogger().d("CubeWhiteboard","VG Command received."),!this.offline){var t={command:e.command,from:e.from,whiteboardId:e.whiteboardId};if(this._processVGCommand(t),null!=e.command.page){var i=this.getSlide();if(i){var r=e.command,n={sn:r.sn,type:r.name,set:null,raw:{param:r.param,attr:r.attr},page:r.page};i.appendNote(n)}}}}},{key:"_processJoinWhiteboardAck",value:function(e){var t=this,i=e.whiteboard;this.whiteboard=i,new Promise(function(e,t){e()}).then(function(e){}).then(function(){t.name=i.whiteboardId.toString(),t.whiteboard=l.Whiteboard.parse(i),t.currentWhiteboard.push(t.whiteboard),t.delegate.onWhiteboardJoined(e.whiteboard)})}}]),t}(s.WhiteboardService)},11:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileAction={Uploader:"/v3/file/upload",FileList:"/v3/file/list",Mkdir:"/v3/file/mkdir",DeleteFiles:"/v3/file/delete",CopyFile:"/v3/file/copy",MoveFile:"/v3/file/move",RenameFile:"/v3/file/rename",FileInfo:"/v3/file/info",searchFile:"/v3/file/search",CancelFile:"/v3/file/cancel",ResumeFile:"/v3/file/resume",PauseFile:"/v3/file/pause",CreateUploadFile:"/v3/file/createUpload",ProgressFile:"/v3/file/progress"}},164:function(e,t,i){"use strict";var r=i(66),n=i(103),o=i(102),a=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e}(o),i(67));!function(e){e.CubeWhiteboardListener=r.WhiteboardListener,e.CubeWhiteboardServiceWorker=n.WhiteboardServiceWorker,e.CubeWhiteboard=a.Whiteboard}(window)},165:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardService=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"create",value:function(e){}},{key:"destroy",value:function(e){}},{key:"applyJoin",value:function(e){}},{key:"quit",value:function(e){}},{key:"rejectApply",value:function(e,t){}},{key:"acceptApply",value:function(e,t){}},{key:"inviteMembers",value:function(e,t){}},{key:"rejectInvite",value:function(e,t){}},{key:"acceptInvite",value:function(e,t){}},{key:"setLineWeight",value:function(e){}},{key:"setLineColor",value:function(e){}},{key:"selectPencil",value:function(){}},{key:"selectText",value:function(){}},{key:"selectRect",value:function(){}},{key:"selectEllipse",value:function(){}},{key:"selectArrow",value:function(){}},{key:"unSelect",value:function(){}},{key:"undo",value:function(){}},{key:"redo",value:function(){}},{key:"erase",value:function(){}},{key:"cleanup",value:function(){}},{key:"zoom",value:function(e){}},{key:"getZoomRatio",value:function(){}},{key:"shareFile",value:function(e){}},{key:"listFile",value:function(e,t){}},{key:"nextPage",value:function(){}},{key:"prevPage",value:function(){}},{key:"gotoPage",value:function(e){}},{key:"getView",value:function(){}},{key:"exportWhiteboard",value:function(e){}},{key:"importWhiteboard",value:function(e,t){}},{key:"setBackgroundColor",value:function(e){}},{key:"queryRecords",value:function(e,t,i){}},{key:"queryHistoryRecords",value:function(e,t,i){}}]),t}(CubeService)},166:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.WhiteboardConfig=function(e){function t(e,i,o){r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return a.bindGroupId=o,a}return o(t,e),t}(CubeGroupConfig)},167:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.WhiteboardSlide=function e(t,i,n,o,a,s,u,l,h){r(this,e),this.cubeId=t,this.whiteboardId=i,this.alias=n,this.size=o,this.url=a,this.origin=s,this.urls=u,this.offset=l,this.page=h}},18:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileType={Folder:1,Pdf:2,Word:3,Excel:4,Ptt:5,Image:11,Office:12,Video:13,Audio:14,App:15,Zip:16,Whiteboard:20,File:99,Other:100}},21:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.FileHttp=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(11),a=i(0),s=i(34),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s);t.FileHttp=function(){function e(t){r(this,e),this.engine=t,this.queryHttp=t.utils.isSecure?_CUBE_HTTPS_FILE_SERVICE:_CUBE_HTTP_FILE_SERVICE,this.createHttp=t.utils.isSecure?_CUBE_HTTPS_STORAGE_SERVICE:_CUBE_HTTP_STORAGE_SERVICE,this.uploadProcessFiles=new HashMap,this.pendingFiles=[]}return n(e,[{key:"createUpload",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(null==e.md5)return void this.calculate(e,function(r){e.md5=r,t.createUpload(e,i)});var r=e.isOverride||!0,n={token:this.engine.accToken,name:e.name,parentId:e.parentId,permission:e.permission,md5:e.md5,isOverride:r,size:e.size};this._sendPostHttp(o.FileAction.CreateUploadFile,n,function(r,n){if(t.uploadProcessFiles.size()>=4)return t.pendingFiles.push({file:e,callback:i}),!1;if(!r&&200==n.state.code){var o=n.data.fileInfo;o.paused=!1,o.lastProgress=0,o.progressCounts=0,t.uploadProcessFiles.put(o.fileId,o)}i(r,n)},this.createHttp)}},{key:"calculate",value:function(e,t){function i(){var t=s*o,i=t+o>=e.size?e.size:t+o;r.readAsBinaryString(n.call(e,t,i))}var r=new FileReader,n=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o=2097152,a=Math.ceil(e.size/o),s=0,l=new u.default;r.onload=function(e){l.appendBinary(e.target.result),s++,s<a?i():t(l.end())},i()}},{key:"upload",value:function(e,t){var i=this,r=this.uploadProcessFiles.get(e.fileId);if(null==r)return!1;null==r.file&&null!=e.file&&(r.file=e.file),r.paused=!1;var n={token:this.engine.accToken,fileId:r.fileId},a=function(e){if(200!=e.state.code)i.uploadProcessFiles.remove(r.fileId);else{var n=e.data.fileInfo;n.size==n.progress?(i.uploadProcessFiles.remove(r.fileId),i.pendingFiles.length>0&&(i.createUpload(i.pendingFiles[0].file,i.pendingFiles[0].callback),i.pendingFiles=i.pendingFiles.slice(1))):r.progress=n.progress}t(!1,e)},s=function(e){i.uploadProcessFiles.remove(r.fileId),t(e)};if("function"==typeof e.customPostMethod)n.file=null,e.customPostMethod({data:n,action:this.createHttp+o.FileAction.Uploader},a,s);else{var u=r.secondUpload?new Blob:r.file.slice(r.progress,r.file.size);u.name=r.name;var l=this._sendFile(o.FileAction.Uploader,{name:"file",value:u},n,function(e,t){e?s(e):a(t)},this.createHttp);null!=l&&(r.xhr=l)}}},{key:"pause",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(null==this.uploadProcessFiles.get(e)||this.uploadProcessFiles.get(e).paused)return!1;var r={fileId:e,token:this.engine.accToken};this._sendPostHttp(o.FileAction.PauseFile,r,function(r,n){r||200!=n.state.code||(t.uploadProcessFiles.get(e).paused=!0),i(r,n)},this.createHttp)}},{key:"_progressTask",value:function(e,t){var i=this,r=this,n=function n(){var o=i.uploadProcessFiles.get(e);null==o||o.paused||(setTimeout(function(){n(e)},2e3),r.progress(e,t))};setTimeout(function(){n()},1e3)}},{key:"progress",value:function(e,t){var i=this,r=this.uploadProcessFiles.get(e);if(null==r)return!1;if(r.progressCounts>200)return t(!0,new a.CubeError(CubeStateCode.RequestTimeout,"Upload file timeout")),this.cancelUpload(e),!1;var n={token:this.engine.accToken,fileId:e};this._sendPostHttp(o.FileAction.ProgressFile,n,function(n,o){n||200!=o.state.code?i.uploadProcessFiles.remove(e):(r.lastProgress==o.data.fileInfo.progress&&r.progressCounts++,r.lastProgress=o.data.fileInfo.progress),t(n,o)},this.createHttp)}},{key:"cancelUpload",value:function(e){var t=this,i=this.uploadProcessFiles.get(e);null!=i&&null!=i.xhr&&i.xhr.abort();var r={fileId:e,token:this.engine.accToken};this._sendPostHttp(o.FileAction.CancelFile,r,function(e,r){if(e||200!=r.state.code)i.paused=!1;else{var n=r.data.fileInfo;t.uploadProcessFiles.remove(n.fileId),t.pendingFiles.length>0&&(t.createUpload(t.pendingFiles[0].file,t.pendingFiles[0].callback),t.pendingFiles=t.pendingFiles.slice(1))}},this.createHttp)}},{key:"_sendPostHttp",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.queryHttp,n={};for(var o in t)null!=t[o]&&(n[o]=t[o]);NucleusAjax.newRequest(r+e).method("POST").content(n).send(function(e){var t=e.getStatus();if(200===t){var r=void 0;try{r=JSON.parse(e.getData())}catch(t){r=e.getData()}i(!1,r)}else i({status:t})})}},{key:"_sendFile",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.queryHttp;if(window.FormData){var o=new FormData;for(var a in i)o.append(a,i[a]);if(t.value instanceof HTMLElement){var s=t.value.files[0];o.append(t.name,s,s.name)}else t.value instanceof Blob&&o.append(t.name,t.value,t.value.name);var u=new XMLHttpRequest;return u.open("post",n+e,!0),u.onload=function(){if(200===u.status){var e=void 0;try{e=JSON.parse(u.responseText)}catch(t){e=u.responseText}r(!1,e)}else r({status:u.status})},u.send(o),u}}}]),e}()},34:function(e,t,i){"use strict";var r,n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(a){if("object"===o(t))e.exports=a();else{r=a,void 0!==(n="function"==typeof r?r.call(t,i,t,e):r)&&(e.exports=n)}}(function(e){function t(e,t){var i=e[0],r=e[1],n=e[2],o=e[3];i+=(r&n|~r&o)+t[0]-680876936|0,i=(i<<7|i>>>25)+r|0,o+=(i&r|~i&n)+t[1]-389564586|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&r)+t[2]+606105819|0,n=(n<<17|n>>>15)+o|0,r+=(n&o|~n&i)+t[3]-1044525330|0,r=(r<<22|r>>>10)+n|0,i+=(r&n|~r&o)+t[4]-176418897|0,i=(i<<7|i>>>25)+r|0,o+=(i&r|~i&n)+t[5]+1200080426|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&r)+t[6]-1473231341|0,n=(n<<17|n>>>15)+o|0,r+=(n&o|~n&i)+t[7]-45705983|0,r=(r<<22|r>>>10)+n|0,i+=(r&n|~r&o)+t[8]+1770035416|0,i=(i<<7|i>>>25)+r|0,o+=(i&r|~i&n)+t[9]-1958414417|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&r)+t[10]-42063|0,n=(n<<17|n>>>15)+o|0,r+=(n&o|~n&i)+t[11]-1990404162|0,r=(r<<22|r>>>10)+n|0,i+=(r&n|~r&o)+t[12]+1804603682|0,i=(i<<7|i>>>25)+r|0,o+=(i&r|~i&n)+t[13]-40341101|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&r)+t[14]-1502002290|0,n=(n<<17|n>>>15)+o|0,r+=(n&o|~n&i)+t[15]+1236535329|0,r=(r<<22|r>>>10)+n|0,i+=(r&o|n&~o)+t[1]-165796510|0,i=(i<<5|i>>>27)+r|0,o+=(i&n|r&~n)+t[6]-1069501632|0,o=(o<<9|o>>>23)+i|0,n+=(o&r|i&~r)+t[11]+643717713|0,n=(n<<14|n>>>18)+o|0,r+=(n&i|o&~i)+t[0]-373897302|0,r=(r<<20|r>>>12)+n|0,i+=(r&o|n&~o)+t[5]-701558691|0,i=(i<<5|i>>>27)+r|0,o+=(i&n|r&~n)+t[10]+38016083|0,o=(o<<9|o>>>23)+i|0,n+=(o&r|i&~r)+t[15]-660478335|0,n=(n<<14|n>>>18)+o|0,r+=(n&i|o&~i)+t[4]-405537848|0,r=(r<<20|r>>>12)+n|0,i+=(r&o|n&~o)+t[9]+568446438|0,i=(i<<5|i>>>27)+r|0,o+=(i&n|r&~n)+t[14]-1019803690|0,o=(o<<9|o>>>23)+i|0,n+=(o&r|i&~r)+t[3]-187363961|0,n=(n<<14|n>>>18)+o|0,r+=(n&i|o&~i)+t[8]+1163531501|0,r=(r<<20|r>>>12)+n|0,i+=(r&o|n&~o)+t[13]-1444681467|0,i=(i<<5|i>>>27)+r|0,o+=(i&n|r&~n)+t[2]-51403784|0,o=(o<<9|o>>>23)+i|0,n+=(o&r|i&~r)+t[7]+1735328473|0,n=(n<<14|n>>>18)+o|0,r+=(n&i|o&~i)+t[12]-1926607734|0,r=(r<<20|r>>>12)+n|0,i+=(r^n^o)+t[5]-378558|0,i=(i<<4|i>>>28)+r|0,o+=(i^r^n)+t[8]-2022574463|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^r)+t[11]+1839030562|0,n=(n<<16|n>>>16)+o|0,r+=(n^o^i)+t[14]-35309556|0,r=(r<<23|r>>>9)+n|0,i+=(r^n^o)+t[1]-1530992060|0,i=(i<<4|i>>>28)+r|0,o+=(i^r^n)+t[4]+1272893353|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^r)+t[7]-155497632|0,n=(n<<16|n>>>16)+o|0,r+=(n^o^i)+t[10]-1094730640|0,r=(r<<23|r>>>9)+n|0,i+=(r^n^o)+t[13]+681279174|0,i=(i<<4|i>>>28)+r|0,o+=(i^r^n)+t[0]-358537222|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^r)+t[3]-722521979|0,n=(n<<16|n>>>16)+o|0,r+=(n^o^i)+t[6]+76029189|0,r=(r<<23|r>>>9)+n|0,i+=(r^n^o)+t[9]-640364487|0,i=(i<<4|i>>>28)+r|0,o+=(i^r^n)+t[12]-421815835|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^r)+t[15]+530742520|0,n=(n<<16|n>>>16)+o|0,r+=(n^o^i)+t[2]-995338651|0,r=(r<<23|r>>>9)+n|0,i+=(n^(r|~o))+t[0]-198630844|0,i=(i<<6|i>>>26)+r|0,o+=(r^(i|~n))+t[7]+1126891415|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~r))+t[14]-1416354905|0,n=(n<<15|n>>>17)+o|0,r+=(o^(n|~i))+t[5]-57434055|0,r=(r<<21|r>>>11)+n|0,i+=(n^(r|~o))+t[12]+1700485571|0,i=(i<<6|i>>>26)+r|0,o+=(r^(i|~n))+t[3]-1894986606|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~r))+t[10]-1051523|0,n=(n<<15|n>>>17)+o|0,r+=(o^(n|~i))+t[1]-2054922799|0,r=(r<<21|r>>>11)+n|0,i+=(n^(r|~o))+t[8]+1873313359|0,i=(i<<6|i>>>26)+r|0,o+=(r^(i|~n))+t[15]-30611744|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~r))+t[6]-1560198380|0,n=(n<<15|n>>>17)+o|0,r+=(o^(n|~i))+t[13]+1309151649|0,r=(r<<21|r>>>11)+n|0,i+=(n^(r|~o))+t[4]-145523070|0,i=(i<<6|i>>>26)+r|0,o+=(r^(i|~n))+t[11]-1120210379|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~r))+t[2]+718787259|0,n=(n<<15|n>>>17)+o|0,r+=(o^(n|~i))+t[9]-343485551|0,r=(r<<21|r>>>11)+n|0,e[0]=i+e[0]|0,e[1]=r+e[1]|0,e[2]=n+e[2]|0,e[3]=o+e[3]|0}function i(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function r(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function n(e){var r,n,o,a,s,u,l=e.length,h=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=l;r+=64)t(h,i(e.substring(r-64,r)));for(e=e.substring(r-64),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)o[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(h,o),r=0;r<16;r+=1)o[r]=0;return a=8*l,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(h,o),h}function o(e){var i,n,o,a,s,u,l=e.length,h=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=l;i+=64)t(h,r(e.subarray(i-64,i)));for(e=i-64<l?e.subarray(i-64):new Uint8Array(0),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<n;i+=1)o[i>>2]|=e[i]<<(i%4<<3);if(o[i>>2]|=128<<(i%4<<3),i>55)for(t(h,o),i=0;i<16;i+=1)o[i]=0;return a=8*l,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(h,o),h}function a(e){var t,i="";for(t=0;t<4;t+=1)i+=p[e>>8*t+4&15]+p[e>>8*t&15];return i}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function l(e,t){var i,r=e.length,n=new ArrayBuffer(r),o=new Uint8Array(n);for(i=0;i<r;i+=1)o[i]=e.charCodeAt(i);return t?o:n}function h(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function c(e,t,i){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),i?r:r.buffer}function d(e){var t,i=[],r=e.length;for(t=0;t<r-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function f(){this.reset()}var p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(n("hello"))&&function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return e=0|e||0,e<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(i,r){var n,o,a,s,u=this.byteLength,l=t(i,u),h=u;return r!==e&&(h=t(r,u)),l>h?new ArrayBuffer(0):(n=h-l,o=new ArrayBuffer(n),a=new Uint8Array(o),s=new Uint8Array(this,l,n),a.set(s),o)}}(),f.prototype.append=function(e){return this.appendBinary(u(e)),this},f.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var r,n=this._buff.length;for(r=64;r<=n;r+=64)t(this._hash,i(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},f.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=d(i)),this.reset(),i},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(e,i){var r,n,o,a=i;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=n,e[15]=o,t(this._hash,e)},f.hash=function(e,t){return f.hashBinary(u(e),t)},f.hashBinary=function(e,t){var i=n(e),r=s(i);return t?d(r):r},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(e){var i,n=c(this._buff.buffer,e,!0),o=n.length;for(this._length+=e.byteLength,i=64;i<=o;i+=64)t(this._hash,r(n.subarray(i-64,i)));return this._buff=i-64<o?new Uint8Array(n.buffer.slice(i-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=d(i)),this.reset(),i},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var e=f.prototype.getState.call(this);return e.buff=h(e.buff),e},f.ArrayBuffer.prototype.setState=function(e){return e.buff=l(e.buff,!0),f.prototype.setState.call(this,e)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(e,t){var i=o(new Uint8Array(e)),r=s(i);return t?d(r):r},f})},66:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.WhiteboardListener=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"onWhiteboardCreated",value:function(e,t){}},{key:"onWhiteboardDestroyed",value:function(e,t){}},{key:"onWhiteboardApplied",value:function(e,t){}},{key:"onWhiteboardRejectApplied",value:function(e,t,i){}},{key:"onWhiteboardApplyJoined",value:function(e,t,i){}},{key:"onWhiteboardInvited",value:function(e,t,i){}},{key:"onWhiteboardRejectInvited",value:function(e,t,i){}},{key:"onWhiteboardInviteJoined",value:function(e,t,i){}},{key:"onWhiteboardJoinFromOthers",value:function(e,t,i){}},{key:"onSlideUploading",value:function(e,t,i,r){}},{key:"onSlideUploadCompleted",value:function(e,t){}},{key:"onSlideUpdated",value:function(e,t){}},{key:"onWhiteboardFailed",value:function(e,t){}},{key:"onFileShared",value:function(e,t){}},{key:"onSlide",value:function(e,t){}},{key:"onCleanup",value:function(e){}},{key:"onWhiteboardJoined",value:function(e,t){}},{key:"onWhiteboardQuited",value:function(e,t){}}]),t}(CubeListener)},67:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.Whiteboard=function(e){function t(e,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];arguments[3];r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return a.whiteboardSlides=o,a.whiteboardId=a.groupId,a}return o(t,e),s(t,null,[{key:"parse",value:function(e){null!=e&&"object"==(void 0===e?"undefined":a(e))||nucleus.getLogger().e("CubeWhiteboard#parse","Error of parameters");var i=new t;for(var r in e)i.hasOwnProperty(r)&&(i[r]=e[r]);return i}}]),t}(CubeGroup)}});
//# sourceMappingURL=cube-whiteboard.js.map
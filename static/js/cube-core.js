!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=103)}([,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.CubeError=function e(t,n){i(this,e),this.code=t,this.message=n}},,function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var o;t.CELLET=(o={Responder:"CubeResponder",Instruction:"CubeInstruction",Whiteboard:"CubeWhiteboard",RemoteDesktop:"CubeRDServer",ShareDesktopService:"ShareDesktopService",Live:"CubeLive",User:"UserService",Setting:"SettingService",Group:"GroupService",Conference:"ConferenceService",License:"LicenseService",Messaging:"MessageService",Signaling:"SignalingService",ShareDesktop:"ShareDesktopService"},i(o,"Whiteboard","WhiteboardService"),i(o,"InstructionService","InstructionService"),i(o,"RecentSession","RecentSession"),o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CubeConst={ActionLicense:"license",ActionLicenseAck:"license-ack",ActionLicenseNotify:"license-notify",ActionLogin:"login",ActionLoginAck:"login-ack",ActionLoginSync:"login-sync",ActionLogout:"logout",ActionLogoutAck:"logout-ack",ActionQuery:"query",ActionQueryAck:"query-ack",ActionQueryDevice:"query-device",ActionQueryDeviceAck:"query-device-ack",ActionQueryByIdDevice:"query-device-by-id",ActionQueryByIdDeviceAck:"query-device-by-id-ack",ActionUpdate:"update",ActionUpdateAck:"update-ack",ActionUpdateSync:"update-sync",ActionUpdateNotifyConfig:"update-notify-config",ActionUpdateDisturbConfig:"update-disturb-config",ActionAddTop:"add-top",ActionRemoveTop:"remove-top",ActionAddMute:"add-mute",ActionRemoveMute:"remove-mute",ActionQuerySetting:"query-setting",ActionSyncSetting:"sync-setting",ActionUpdateDeviceToken:"update-device-token",ActionCreateGroup:"create-group",ActionCreateGroupAck:"create-group-ack",ActionCreateGroupSync:"create-group-sync",ActionCreateGroupNotify:"create-group-notify",ActionDestroyGroup:"destroy-group",ActionDestroyGroupAck:"destroy-group-ack",ActionDestroyGroupSync:"destroy-group-sync",ActionDestroyGroupNotify:"destroy-group-notify",ActionAddMember:"add-group-member",ActionAddMemberAck:"add-group-member-ack",ActionAddMemberSync:"add-group-member-sync",ActionAddMemberNotify:"add-group-member-notify",ActionRemoveMember:"remove-group-member",ActionRemoveGroupMemberAck:"remove-group-member-ack",ActionRemoveGroupMemberSync:"remove-group-member-sync",ActionRemoveGroupMemberNotify:"remove-group-member-notify",ActionQuitGroup:"quit-group",ActionQuitGroupAck:"quit-group-ack",ActionQuitGroupSync:"quit-group-sync",ActionQuitGroupNotify:"quit-group-notify",ActionQueryGroups:"query-groups",ActionQueryGroupsAck:"query-groups-ack",ActionQueryGroupsSync:"query-groups-sync",ActionQueryGroupsNotify:"query-groups-notify",ActionAddMaster:"add-group-master",ActionAddMasterAck:"add-group-master-ack",ActionAddMasterSync:"add-group-master-sync",ActionAddMasterNotify:"add-group-master-notify",ActionRemoveMaster:"remove-group-master",ActionRemoveMasterAck:"remove-group-master-ack",ActionRemoveMasterSync:"remove-group-master-sync",ActionRemoveMasterNotify:"remove-group-master-notify",ActionUpdateGroup:"update-group",ActionUpdateGroupAck:"update-group-ack",ActionUpdateGroupSync:"update-group-sync",ActionUpdateGroupNotify:"update-group-notify",ActionInviteGroupMember:"invite-group-member",ActionInviteGroupMemberAck:"invite-group-member-ack",ActionInviteGroupMemberSync:"invite-group-member-sync",ActionInviteGroupMemberNotify:"invite-group-member-notify",AcitonRejectGroupInvite:"reject-group-invite",AcitonRejectGroupInviteAck:"reject-group-invite-ack",AcitonRejectGroupInviteSync:"reject-group-invite-sync",AcitonRejectGroupInviteNotify:"reject-group-invite-notify",ActionAcceptGroupInvite:"accept-group-invite",ActionAcceptGroupInviteAck:"accept-group-invite-ack",ActionAcceptGroupInviteSync:"accept-group-invite-sync",ActionAcceptGroupInviteNotify:"accept-group-invite-notify",ActionApplyJoinGroup:"apply-join-group",ActionApplyJoinGroupAck:"apply-join-group-ack",ActionApplyJoinGroupSync:"apply-join-group-sync",ActionApplyJoinGroupNotify:"apply-join-group-notify",ActionAcceptApplyGroup:"accept-apply-group",ActionAcceptApplyGroupAck:"accept-apply-group-ack",ActionAcceptApplyGroupSync:"accept-apply-group-sync",ActionAcceptApplyGroupNotify:"accept-apply-group-notify",ActionRejectApplyGroup:"reject-apply-group",ActionRejectApplyGroupAck:"reject-apply-group-ack",ActionRejectApplyGroupSync:"reject-apply-group-sync",ActionRejectApplyGroupNotify:"reject-apply-group-notify",ActionPush:"push",ActionPushAck:"push-ack",ActionPushSync:"push-sync",ActionPushNotify:"push-notify",ActionPull:"pull",ActionPullAck:"pull-ack",ActionNotify:"notify",ActionRecall:"recall",ActionRecallAck:"recall-ack",ActionRecallSync:"recall-sync",ActionRecallNotify:"recall-notify",ActionReceipt:"receipt",ActionReceiptAck:"receipt-ack",ActionReceiptAll:"receipt-all",ActionReceiptAllAck:"receipt-all-ack",ActionReceiptOffline:"receipt-offline",ActionReceiptOfflineAck:"receipt-offline-ack",ActionForward:"forward",ActionForwardAck:"forward-ack",ActionHistory:"history",ActionHistoryAck:"history-ack",ActionSearchMsg:"search-msg",ActionSearchMsgAck:"search-msg-ack",ActionSearchMsgs:"search-msgs",ActionSearchMsgsAck:"search-msgs-ack",ActionSync:"sync",ActionSyncAck:"sync-ack",ActionUpdateTop:"update-top",ActionUpdateTopAck:"update-top-ack",ActionMsgSync:"message-sync",ActionMsgSyncAck:"message-sync-ack",ActionMsgPull:"message-pull",ActionMsgPullAck:"message-pull-ack",ActionMessageHistorySns:"message-history-sns",ActionMessageHistorySnsAck:"message-history-sns-ack",ActionInvite:"invite",ActionInviteAck:"invite-ack",ActionInviteSync:"invite-sync",ActionInviteNotify:"invite-notify",ActionAnswer:"answer",ActionAnswerAck:"answer-ack",ActionAnswerSync:"answer-sync",ActionAnswerNotify:"answer-notify",ActionCancel:"cancel",ActionCancelAck:"cancel-ack",ActionCancelSync:"cancel-sync",ActionCancelNotify:"cancel-notify",ActionBye:"bye",ActionByeAck:"bye-ack",ActionByeSync:"bye-sync",ActionByeNotify:"bye-notify",ActionCandidate:"candidate",ActionCandidateAck:"candidate-ack",ActionCandidateNotify:"candidate-notify",ActionConsult:"consult",ActionConsultAck:"consult-ack",ActionConsultNotify:"consult-notify",ActionReply:"reply",ActionReplyAck:"reply-ack",ActionTryReInvite:"try-reinvite",ActionTryReInviteAck:"try-reinvite-ack",ActionReverseCall:"reverse-call",ActionShare:"share",ActionShareAck:"share-ack",ActionRevoke:"revoke",ActionRevokeAck:"revoke-ack",ActionVGCmd:"vg-cmd",ActionVGCmdAck:"vg-cmd-ack",ActionRestrain:"restrain",ActionRestrainAck:"restrain-ack",ActionQueryWB:"query-wb",ActionQueryWBAck:"query-wb-ack",ActionQueryShared:"query-shared",ActionQuerySharedAck:"query-shared-ack",ActionRejectWE:"reject-wb",ActionRejectWEAck:"reject-wb-ack",ActionCreateWhiteboard:"create-whiteboard",ActionCreateWhiteboardAck:"create-whiteboard-ack",ActionCreateWhiteboardSync:"create-whiteboard-sync",ActionCreateWhiteboardNotify:"create-whiteboard-notify",ActionDestroyWhiteboard:"destroy-whiteboard",ActionDestroyWhiteboardAck:"destroy-whiteboard-ack",ActionDestroyWhiteboardSync:"destroy-whiteboard-sync",ActionDestroyWhiteboardNotify:"destroy-whiteboard-notify",ActionApplyjoinWhiteboard:"apply-join-whiteboard",ActionApplyjoinWhiteboardAck:"apply-join-whiteboard-ack",ActionApplyjoinWhiteboardSync:"apply-join-whiteboard-sync",ActionApplyjoinWhiteboardNotify:"apply-join-whiteboard-notify",ActionQuitWhiteboard:"quit-whiteboard",ActionQuitWhiteboardAck:"quit-whiteboard-ack",ActionQuitWhiteboardSync:"quit-whiteboard-sync",ActionQuitWhiteboardNotify:"quit-whiteboard-notify",ActionInviteWhiteboard:"invite-whiteboard",ActionInviteWhiteboardAck:"invite-whiteboard-ack",ActionInviteWhiteboardSync:"invite-whiteboard-sync",ActionInviteWhiteboardNotify:"invite-whiteboard-notify",ActionAcceptApplyWhiteboard:"accept-apply-whiteboard",ActionAcceptApplyWhiteboardAck:"accept-apply-whiteboard-ack",ActionAcceptApplyWhiteboardSync:"accept-apply-whiteboard-sync",ActionAcceptApplyWhiteboardNotify:"accept-apply-whiteboard-notify",ActionRejectApplyWhiteboard:"reject-apply-whiteboard",ActionRejectApplyWhiteboardAck:"reject-apply-whiteboard-ack",ActionRejectApplyWhiteboardSync:"reject-apply-whiteboard-sync",ActionRejectApplyWhiteboardNotify:"reject-apply-whiteboard-notify",ActionRejectWhiteboardInvite:"reject-whiteboard-invite",ActionRejectWhiteboardInviteAck:"reject-whiteboard-invite-ack",ActionRejectWhiteboardInviteSync:"reject-whiteboard-invite-sync",ActionRejectWhiteboardInviteNotify:"reject-whiteboard-invite-notify",ActionAcceptWhiteboardInvite:"accept-whiteboard-invite",ActionAcceptWhiteboardInviteAck:"accept-whiteboard-invite-ack",ActionAcceptWhiteboardInviteSync:"accept-whiteboard-invite-sync",ActionAcceptWhiteboardInviteNotify:"accept-whiteboard-invite-notify",ActionRestrainWhiteboard:"restrain-whiteboard",ActionRestrainWhiteboardAck:"restrain-whiteboard-ack",ActionRestrainWhiteboardSync:"restrain-whiteboard-sync",ActionRestrainWhiteboardNotify:"restrain-whiteboard-notify",ActionVgCmdWhiteboard:"vg-cmd-whiteboard",ActionVgCmdWhiteboardAck:"vg-cmd-whiteboard-ack",ActionVgCmdWhiteboardSync:"vg-cmd-whiteboard-sync",ActionVgCmdWhiteboardNotify:"vg-cmd-whiteboard-notify",ActionJoinWhiteboard:"join-whiteboard",ActionJoinWhiteboardAck:"join-whiteboard-ack",ActionJoinWhiteboardSync:"join-whiteboard-sync",ActionJoinWhiteboardNotify:"join-whiteboard-notify",ActionConference:"conference",ActionConferenceAck:"conference-ack",ActionQueryConference:"query-conference",ActionQueryConferenceAck:"query-conference-ack",ActionQueryAllConference:"query-all-conference",ActionQueryAllConferenceAck:"query-all-conference-ack",ActionApplyJoinConference:"apply-join-conference",ActionApplyJoinConferenceAck:"apply-join-conference-ack",ActionApplyJoinConferenceNotify:"apply-join-conference-notify",ActionApplyConference:"apply-conference",ActionApplyConferenceAck:"apply-conference-ack",ActionCloseConference:"close-conference",ActionCloseConferenceAck:"close-conference-ack",ActionRejectConference:"reject-conference",ActionRejectConferenceAck:"reject-conference-ack",ActionInviteConference:"invite-conference",ActionInviteConferenceAck:"invite-conference-ack",ActionTryReInviteConference:"try-reinvite-conference",ActionTryReInviteConferenceAck:"try-reinvite-conference-ack",ActionCreateConference:"create-conference",ActionCreateConferenceAck:"create-conference-ack",ActionCreateConferenceNotify:"create-conference-notify",ActionCreateConferenceSync:"create-conference-sync",ActionDestroyConference:"destroy-conference",ActionDestroyConferenceAck:"destroy-conference-ack",ActionDestroyConferenceNotify:"destroy-conference-notify",ActionDestroyConferenceSync:"destroy-conference-sync",ActionInviteConferenceMember:"invite-conference-member",ActionInviteConferenceMemberAck:"invite-conference-member-ack",ActionInviteConferenceMemberNotify:"invite-conference-member-notify",ActionInviteConferenceMemberSync:"invite-conference-member-sync",ActionRejectConferenceInvite:"reject-conference-invite",ActionRejectConferenceInviteAck:"reject-conference-invite-ack",ActionRejectConferenceInviteNotify:"reject-conference-invite-notify",ActionRejectConferenceInviteSync:"reject-conference-invite-sync",ActionAcceptConferenceInvite:"accept-conference-invite",ActionAcceptConferenceInviteAck:"accept-conference-invite-ack",ActionAcceptConferenceInviteNotify:"accept-conference-invite-notify",ActionAcceptConferenceInviteSync:"accept-conference-invite-sync",ActionConferenceControl:"control-conference",ActionConferenceControlAck:"control-conference-ack",ActionConferenceControlSync:"control-conference-sync",ActionConferenceControlNotify:"control-conference-notify",ActionQuitConference:"quit-conference",ActionQuitConferenceAck:"quit-conference-ack",ActionQuitConferenceNotify:"quit-conference-notify",ActionQuitConferenceSync:"quit-conference-sync",ActionReinviteConference:"reinvite-conference",ActionReinviteConferenceAck:"reinvite-conference-ack",ActionCallConference:"call-conference",ActionCallConferenceAck:"call-conference-ack",ActionRejectApplyConference:"reject-apply-conference",ActionRejectApplyConferenceAck:"reject-apply-conference-ack",ActionRejectApplyConferenceNotify:"reject-apply-conference-notify",ActionAcceptApplyConference:"accept-apply-conference",ActionAcceptApplyConferenceAck:"accept-apply-conference-ack",ActionAcceptApplyConferenceNotify:"accept-apply-conference-notify",ActionAcceptApplyConferenceSync:"accept-apply-conference-sync",ActionJoinConference:"join-conference",ActionJoinConferenceAck:"join-conference-ack",ActionJoinConferenceSync:"join-conference-sync",ActionJoinConferenceNotify:"join-conference-notify",ActionUpdateConference:"update-conference",ActionUpdateConferenceAck:"update-conference-ack",ActionUpdateConferenceSync:"update-conference-sync",ActionUpdateConferenceNotify:"update-conference-notify",ActionAccept:"accept",ActionAcceptAck:"accept-ack",ActionTime:"time",ActionTimeAck:"time-ack",ActionRespond:"respond",ActionRespondAck:"respond-ack",ActionQueryRespond:"query-respond",ActionQueryRespondAck:"query-respond-ack",ActionGo:"go",ActionGoAck:"go-ack",ActionGoNotify:"go-notify",ActionPrepare:"prepare",ActionPrepareAck:"prepare-ack",ActionFeedback:"feedback",ActionFeedbackAck:"feedback-ack",ActionFeedbackNotify:"feedback-notify",ActionLast:"last",ActionLastAck:"last-ack",Unknown:"unknown"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StateCode={Ok:200,Accepted:202,NoContent:204,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UnsupportedMediaType:415,ExpectationFailed:417,TooManyRequests:429,RequestSendFailed:477,TemporarilyUnavailable:480,BusyHere:486,RequestTerminated:487,ServerInternalError:500,GatewayTimeout:504,GetLicenseFail:500,BusyEverywhere:600,Declined:603,DoesNotExistAnywhere:604,ConnectionFailed:700,SignalingStartError:701,TransportError:702,ICEConnectionFailed:703,ParamError:704,CreateSessionDescriptionFailed:705,SetSessionDescriptionFailed:706,RTCInitializeFailed:707,DuplicationException:710,WorkerStateException:711,CallTimeout:712,NotFoundConference:713,UnexpectedCanceled:714,IncorrectState:801,NetworkNotReachable:809,ContentTooLong:810,BlockOversize:811,FormatError:812,ContentError:813,OutOfLimit:814,NoReceiver:815,RecallTimeout:816,NullMessage:817,MessageExpire:818,LostAssets:820,UploadFailed:823,ProcessFailed:825,LoadFileFailed:828,AnswerByOther:900,CancelByOther:901,Unknown:0,InitFailed:1001,LoadLicenseFailed:1002,LicenseOutDate:1003,UnRegister:1004,LicenseServerError:1005,LicenseUpdateError:1006,ReLoginTimeout:1007,RecallError:1100,ForwardError:1101,VoiceClipTooShort:1102,VideoClipTooShort:1103,MessageNotExist:1104,MessageTimeout:1105,ReceiptError:1106,QueryNOData:1107,DispatchFailed:1108,OutDateMessage:1109,FileMessageDownloadFailed:1110,FileMessageDownloadTimeout:1111,NotFoundReceiptMessage:1114,SetTopError:1117,SyncMessageTimeout:1118,FileProgressFailed:1119,FileNotExistOnServer:1200,FileUploadError:1201,FileDataFormatError:1202,RenamedFailed:1203,CubeStateLoadFileFailed:1204,DeleteFailed:1205,MkdirFailed:1206,FileUsedByOther:1207,GroupAddMasterFailed:1300,GroupRemoveMasterFailed:1301,GroupDestory:1302,GroupNotExist:1303,AlreadyInCalling:1400,CallerDoesNotExist:1401,ConferenceExist:1500,OverMaxNumber:1501,ConferenceRejectByOther:1502,ConferenceJoinFromOther:1503,ConferenceJoinFailed:1506,ConferenceRejectFailed:1507,ConferenceClosed:1508,ConferenceSipInviteFailed:1551,ConferenceTimeout:1552,ConferenceAccessDenied:1598,ConferenceNotStatus:1599,ExportWhiteboardFailed:1600,ImportWhiteboardFailed:1601,WhiteboardNotExist:1602,WhiteboardUploadFailed:1603,WhiteboardConvertFailed:1604,CameraOpenFailed:1700,ActiveAudioSessionFailed:1701,MicphoneOpenFailed:1702,VideoConvertFailed:1703,AudioRecorderInitialFailed:1704,AudioRecorderPrepareFailed:1705,AudioPlayDecodeFailed:1706,NotSupportUserMedia:1707,LiveStartFailed:1800,LiveNotExist:1801,NotHavePermission:1e4}},,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Listener=function(){function e(){i(this,e)}return o(e,[{key:"onFailed",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Service=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(14);t.Service=function(){function e(t,n,o){i(this,e),this.engine=t,this._cellet=o,this.utils=t.getUtils(),"function"==typeof n&&(this.delegate=new r.Delegate(n))}return o(e,[{key:"addListener",value:function(e){this.delegate.addListener(e)}},{key:"removeListener",value:function(e){this.delegate.removeListener(e)}},{key:"startup",value:function(){"string"==typeof this._cellet&&this.engine.addCelletMember(this._cellet,this),this.onStartup()}},{key:"shutdown",value:function(){"string"==typeof this._cellet&&this.engine.removeCelletMember(this._cellet,this),this.onShutdown()}},{key:"onStartup",value:function(){}},{key:"onShutdown",value:function(){}},{key:"onConfigure",value:function(e){}},{key:"onDialogue",value:function(e,t){}},{key:"onRegisterStateChanged",value:function(e){}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RegistrationState={None:"None",Progress:"Progress",Ok:"Ok",Cleared:"Cleared",Failed:"Failed"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.User=function(){function e(t){for(var n=arguments.length,r=Array(n>3?n-3:0),c=3;c<n;c++)r[c-3]=arguments[c];var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i(this,e),this.cubeId=t,this.displayName=a,this.avatar=s,this.name=t,"object"==o(arguments[0])&&this.set(arguments[0])}return r(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)?this[t]=e[t]:delete this[t]}}]),e}()},,,function(e,t,n){"use strict";var i,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(i=window)}e.exports=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Delegate=function(){function e(t){i(this,e),this.listeners=null,this.init(t)}return o(e,[{key:"init",value:function(e){var t=this;this.listeners=[];var n=Object.getOwnPropertyNames(e.prototype),i=!0,o=!1,r=void 0;try{for(var c,a=n[Symbol.iterator]();!(i=(c=a.next()).done);i=!0){(function(){var e=c.value;if("constructor"===e)return"continue";t[e]=function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];t.did(e,i)}})()}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){for(var t=0;t<this.listeners.length;++t){if(this.listeners[t]===e){this.listeners.splice(t,1);break}}}},{key:"did",value:function(e,t){for(var n=0;n<this.listeners.length;n++){var i=this.listeners[n];i&&"function"==typeof i[e]&&i[e].apply(i,t)}}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.GroupConfig=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];i(this,e),this.type=t,this.displayName=n,this.expired=0,this.maxNumber=0,this.bindGroupId="",this.isOpen=!0,this.masters=c,this.members=r,this.invites=[],"object"==o(arguments.length<=4?void 0:arguments[4])&&this.set(arguments.length<=4?void 0:arguments[4])}return r(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(this[t]=e[t])}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Member=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(10);n(17),t.Member=function(e){function t(e,n){for(var r=arguments.length,a=Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];i(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.cubeId=e,u.remarkName="",u.role=n,u.joinTime=0,u.inviteTime=0,"object"==c(arguments[0])&&u.set(arguments[0]),u}return r(t,e),t}(a.User)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MemberRole={OWNER:"owner",MASTER:"master",MEMBER:"member",GUEST:"guest"}},,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeConfig=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i(this,e),this.videoSize={width:320,height:240},this.autoSyncMsg=!0,this.debug=!1,this.appkey=n,this.appid=t,this.resourceDir="./assets",this.audioCodec="Opus",this.videoCodec="VP8",this.licenseServer="http://license.getcube.cn/auth/license/get",this.autoSyncMsg=!0,this.deviceName=null,this.frameRate={min:5,max:15},this.bandwidth={audio:70,video:512},this.socketEnabled=!0,this.showCallMask=!0,"object"==o(arguments.length<=2?void 0:arguments[2])&&this.set(arguments.length<=2?void 0:arguments[2])}return r(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(this[t]=e[t])}},{key:"setAppId",value:function(e){this.appid=e}},{key:"setAppKey",value:function(e){this.appkey=e}},{key:"setAutoSyncMsg",value:function(e){this.autoSyncMsg=e}},{key:"setResourceDir",value:function(e){this.resourceDir=e}},{key:"setDebug",value:function(e){this.debug=e}},{key:"setVideoSize",value:function(e,t){this.videoSize={width:e,height:t}}},{key:"setAudioCodec",value:function(e){this.audioCodec=e}},{key:"setVideoCodec",value:function(e){this.videoCodec=e}},{key:"setLicenseServer",value:function(e){this.licenseServer=e}},{key:"setFrameRate",value:function(e,t){this.frameRate={min:e,max:t}}},{key:"setBandwidth",value:function(e,t){this.bandwidth={audio:e,video:t}}},{key:"getLicenseServer",value:function(){return this.licenseServer}}]),e}()},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CodecType={VP8:"VP8",VP9:"VP9",H264:"H264"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CubeState={Start:"Start",Pause:"Pause",Ready:"Ready",Busy:"Busy",Stop:"Stop"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(9),c=n(3);t.Session=function(){function e(){i(this,e),this.name=null,this.displayName=null,this.regState=r.RegistrationState.None,this.callPeer=null,this.callDirection=null,this.callState=null,this.latency=-1,this.callTime=0}return o(e,[{key:"getName",value:function(){return this.name}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"hasRegistered",value:function(){return this.regState==r.RegistrationState.Ok}},{key:"getRegState",value:function(){return this.regState}},{key:"setCallPeer",value:function(e){this.callPeer=e}},{key:"getCallPeer",value:function(){return this.callPeer}},{key:"getCallDirection",value:function(){return this.callDirection}},{key:"isCalling",value:function(){return null!=cube.getCallService()&&(this.callState==CubeSignalingState.Invite||this.callState==CubeSignalingState.Incall||this.callState==CubeSignalingState.Progress||this.callState==CubeSignalingState.Ringing)}},{key:"isConferenceCall",value:function(){return null!=this.callPeer&&null!=this.callPeer.conference}},{key:"isSipConference",value:function(){if(this.isConferenceCall()){var e=this.callPeer.conference;return!e||!e.type.includes("sfu")}return!1}},{key:"getLatency",value:function(){return this.isCalling()?this.latency:this.getMainLatency()}},{key:"getMainLatency",value:function(){var e=-1;nucleus.talkService.isCalled(c.CELLET.Signaling)&&(e=nucleus.talkService.getPingPongTime(c.CELLET.Signaling));var t=-1;nucleus.talkService.isCalled(c.CELLET.Messaging)&&(t=nucleus.talkService.getPingPongTime(c.CELLET.Messaging));var n=-1;nucleus.talkService.isCalled(c.CELLET.Whiteboard)&&(n=nucleus.talkService.getPingPongTime(c.CELLET.Whiteboard));var i=0,o=0;return e>0&&(o+=e,++i),t>0&&(o+=t,++i),n>0&&(o+=n,++i),i>0?parseInt(Math.round(o/i)):-1}},{key:"getCallTime",value:function(){return this.callTime}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Group=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(38);t.Group=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.GroupType.normal,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];i(this,e),this.displayName=n,this.type=t,this.isOpen=!1,this.masters=r,this.members=a,this.avatar="",this.bindGroupId=null,this.groupId=null,this.founder=null,this.owner=null,this.created=0,this.expired=0,this.maxNumber=1e3,this.invites=[],this.guests=[],this.invitePeopleMap=new HashMap,"object"==o(arguments[0])?this.set(arguments[0]):"object"==o(arguments[1])&&this.set(arguments[1])}return r(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(this[t]=e[t])}},{key:"getName",value:function(){return this.groupId}},{key:"getId",value:function(){return this.groupId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"getFounder",value:function(){return this.founder}},{key:"getCreated",value:function(){return this.created}},{key:"getMembers",value:function(){return this.members}},{key:"getMasters",value:function(){return this.masters}},{key:"getGuests",value:function(){return void 0===this.data.guests?null:this.guests}},{key:"isOpenGroup",value:function(){return this.isOpen}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GroupType={normal:"normal",VOICE_CALL:"voice-call",VIDEO_CALL:"video-call",VOICE_CONFERENCE:"voice-conference",VIDEO_CONFERENCE:"video-conference",MUX_CONFERENCE:"mux-conference",VOICE_CISCO_CONFERENCE:"voice-cisco-conference",VIDEO_CISCO_CONFERENCE:"video-cisco-conference",SHARE_DESKTOP:"share_desktop",SHARE_WB:"share_wb",LIVE:"live"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.DisturbConfig=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,e),this.isNotDisturb=t,this.startTime=n.toString(),this.endTime=o.toString(),this.updateTime=0}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.NotifyConfig=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i(this,e),this.isAlerts=t,this.isDetails=n,this.isSound=o,this.isVibrate=r,this.updateTime=0}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeRequest=function(){function e(t){i(this,e),this.domain=t}return r(e,[{key:"send",value:function(e,t,n){for(var i in t)"object"===o(t[i])&&(t[i]=JSON.stringify(t[i]));NucleusAjax.newRequest(this.domain+e).method("POST").content(t).send(function(e){var t=e.getStatus();if(200===t){var i=void 0;try{i=JSON.parse(e.getData())}catch(t){i=e.getData()}n(!1,i)}else n({status:t})})}},{key:"sendFile",value:function(e,t,n,i){if(window.FormData){var o=new FormData;for(var r in n)o.append(r,n[r]);if(t.value instanceof HTMLElement){var c=t.value.files[0];o.append(t.name,c,c.name)}else t.value instanceof Blob&&o.append(t.name,t.value,t.value.name);var a=new XMLHttpRequest;a.open("post",this.domain+e,!0),a.send(o),a.onload=function(){if(200===a.status){var e=void 0;try{e=JSON.parse(a.responseText)}catch(t){e=a.responseText}i(!1,e)}else i({status:a.status})}}}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceListener=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7);t.DeviceListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"onDeviceOnline",value:function(e,t){}},{key:"onDeviceOffline",value:function(e,t){}}]),t}(a.Listener)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupListener=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7);t.GroupListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"onGroupCreated",value:function(e,t){}},{key:"onGroupDestroyed",value:function(e,t){}},{key:"onGroupUpdated",value:function(e,t){}},{key:"onMemberAdded",value:function(e,t,n){}},{key:"onMemberRemoved",value:function(e,t,n){}},{key:"onMasterAdded",value:function(e,t,n){}},{key:"onMasterRemoved",value:function(e,t,n){}},{key:"onGroupApplied",value:function(e,t){}},{key:"onGroupApplyJoined",value:function(e,t,n){}},{key:"onGroupQuited",value:function(e,t){}},{key:"onGroupInvited",value:function(e,t,n){}},{key:"onGroupInviteJoined",value:function(e,t,n){}},{key:"onGroupRejectInvited",value:function(e,t,n){}},{key:"onGroupRejectApplyed",value:function(e,t,n){}},{key:"onGroupFailed",value:function(e){}}]),t}(a.Listener)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.SettingListener=function(){function e(){i(this,e)}return o(e,[{key:"onNotifyConfigUpdated",value:function(e){}},{key:"onDisturbConfigUpdated",value:function(e){}},{key:"onDeviceTokenUpdated",value:function(e){}},{key:"onTopSessionAdded",value:function(e,t){}},{key:"onTopSessionRemoved",value:function(e,t){}},{key:"onMuteSessionAdded",value:function(e,t){}},{key:"onMuteSessionRemoved",value:function(e,t){}},{key:"onSettingSynced",value:function(e,t){}},{key:"onsettingFailed",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserListener=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7);t.UserListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"onLogined",value:function(e){}},{key:"onLogouted",value:function(e){}},{key:"onDeviceOnline",value:function(e,t){}},{key:"onDeviceOffline",value:function(e,t){}},{key:"onUserUpdated",value:function(e){}},{key:"onFailed",value:function(e){}}]),t}(a.Listener)},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(107),s=n(110),u=n(3),l=n(9),f=n(1),d=n(5);t.ConnectionServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.TAG="fldyconnection",n.speaks=new HashMap,n.MAX_TIMES=9,n.TRY_TIMES=0,n.SPACE_TIME=2e3,n.connectServerUseTime=0,n.startTime=0,n.block=!1,n.serverCallTask=null,n.host=null,n.port=null,n.services=[],n.talkService=null,n.nucleus=null,n.license=null,n.engine=e,n.isQuitted=!1,n.maxReconnectTime=18e4,n.reConnectTimer=null,n.reConnectTime=3e3,s.NetworkDetection.startup({connect:function(){if(n.engine.networkConnected=!0,"string"==typeof n.engine.accName&&"string"==typeof n.engine.accToken)if(n.isQuitted)n.engine.isReconnecting&&n.reConnect();else{var e=localStorage.getItem("CUBE_LICENSE_KEY_"+n.engine.config.appid);e?n.engine.getUserService()._updateLicense(JSON.parse(e),!0):n.engine.getUserService()._fireRegistrationState(l.RegistrationState.Ok)}},disconnect:function(){n.engine.networkConnected=!1,n.engine.triggerCubeEngineState(CubeState.Start),n.engine.registered&&n.engine.getAccountService()._fireRegistrationState(l.RegistrationState.Cleared)}}),n}return r(t,e),c(t,[{key:"updateLicense",value:function(e){this.license=e}},{key:"isInit",value:function(){return null!=nucleus&&null!=this.talkService}},{key:"init",value:function(){if(null==this.talkService)return this.config=new NucleusConfig,this.nucleus=nucleus.createNucleus(this.config),this.talkService=nucleus.getTalkService(),!0}},{key:"destroy",value:function(){null!=this.talkService&&(this.talkService.hangup(this.host,this.port,!0),this.talkService=null),null!=this.nucleus&&(this.nucleus.destroy(),this.nucleus=null)}},{key:"isConnected",value:function(){if(null!=this.talkService&&!this.speaks.isEmpty()){this.connect=!0;var e=!0,t=!1,n=void 0;try{for(var i,o=this.speaks.keySet()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;this.talkService.isCalled(r)||(this.connect=!1)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}return connect}return!1}},{key:"isConnected",value:function(e){if(null!=this.talkService&&!e.isEmpty()){this.connect=!0;var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var c=o.value;this.talkService.isCalled(c)||(this.connect=!1)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}return connect}return!1}},{key:"disConnected",value:function(e){if(null!=this.talkService&&!e.isEmpty()){this.connect=!0;var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var c=o.value;this.talkService.isCalled(c)||(this.connect=!1)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}}},{key:"connect",value:function(e,t,n,i){if(null!=this.talkService&&n){if(this.block=i,this.host=e,this.port=t,null!=this.services?this.services.push(n):this.services=n,this.talkService.addListener(this),window.wsServer)var o=new InetAddress(wsServer.host,wsServer.port);else var o=new InetAddress(_CUBE_DOMAIN,_CUBE_PORT);return nucleus.talkService.call(n,o,!0)}}},{key:"getServers",value:function(){return null}},{key:"send",value:function(e,t,n,i){if(null!=this.talkService){nucleus.getLogger().d("Connection","---- send : "+e+"\naction: "+t+"\n"+JSON.stringify(n,null,"\t")+"\n----------------------------------------------");var o=new ActionDialect;return o.setName(t),n&&o.addParam("param",n),this.talkService.talk(e,o)}}},{key:"onListened",value:function(e,t,n){if(n.isStuffList()){var i=new ActionDialect(t,n),o=null,r=null;i.getParamAsString("state")?(r=" code:"+i.getParamAsString("state").code,o=200==i.getParamAsString("state").code?"data: "+JSON.stringify(i.getParamAsString("data"),null,"\t"):"desc: "+JSON.stringify(i.getParamAsString("state").desc,null,"\t")):o=i.getParamAsString("desc")?" desc:"+i.getParamAsString("state").code:"data: "+JSON.stringify(i.getParamAsString("data"),null,"\t"),nucleus.getLogger().d("Connection","---- receive : "+t+"\naction: "+i.getName()+r+"\n"+o+"\n----------------------------------------------"),this.engine.onDialogue(t,i.getName(),i)}}},{key:"onSpoke",value:function(e,t,n){if(n.isStuffList()){var i=new ActionDialect(t,n);this.engine.onDialogue(t,i.getName(),i),nucleus.getLogger().i("*** onSpoke: "+t+"primitive JSON: "+JSON.stringify(i.getParamAsString("state"))),console.log("*** code: "+i.getParamAsString("state").code),console.log("*** data: "+JSON.stringify(i.getParamAsString("param")))}}},{key:"onSpeakAck",value:function(e,t,n){if(n.isStuffList()){new ActionDialect(t,n)}}},{key:"onSpeakTimeout",value:function(e,t,n){console.log("*** onSpeakTimeout: "+t+"primitive JSON: "+JSON.stringify(n))}},{key:"onContacted",value:function(e,t){if(nucleus.getLogger().d("CubeEngine","*** contacted: "+t),e.cellets[0]===u.CELLET.Responder)return void this.engine.responder.fireContacted();this.isQuitted=!1,this.engine.isReconnecting=!1,"string"!=typeof this.engine.accName||"string"!=typeof this.engine.accToken||this.engine.isBeingRegister||this.reLogin(0)}},{key:"quitted",value:function(e,t){if(nucleus.getLogger().d("CubeEngine","*** quitted: "+t),e.cellets[0]==u.CELLET.Responder)return void this.engine.responder.fireQuitted();this.isQuitted=!0,"LicenseService"==t&&this._reConnect()}},{key:"failed",value:function(e,t){nucleus.getLogger().d("CubeEngine","*** failed: "+e.tag+" - "+t.getDescription());var n=e.cellets;if(null!=n&&1==n.length&&n[0]==u.CELLET.Responder)return void this.engine.responder.fireFailed(t);this.isQuitted=!0,this._reConnect()}},{key:"reConnect",value:function(){var e=this;clearTimeout(this.reConnectTimer),this.engine.isReconnecting=!0,this.recallTimer>0&&(clearTimeout(this.recallTimer),this.recallTimer=0);var t=this.engine.getUserService();t.licenseService.checkLicenseUpdate(null,function(n,i,o){e.engine.isReconnecting&&!e.engine.registered&&(n?1002!=n.code?(e.engine.isLicenseLoaded=!1,e.engine.isReconnecting=!1,nucleus.talkService.hangUp(_VALID_CELLETS[0],!0),t._fireRegistrationState(l.RegistrationState.Failed,new f.CubeError(d.StateCode.GetLicenseFail,"GetLicense Failed"))):e.recallTimer=nucleus.talkService.tryRecall(e.reConnectTime):t._updateLicense(o,!0))},!0),this.reConnectTime<this.maxReconnectTime&&(this.reConnectTime+=1e3)}},{key:"reLogin",value:function(e){var t=this;e<5?(this.engine.getUserService().login(this.engine.accName,this.engine.accToken,this.engine.accDisplayName),setTimeout(function(){!t.engine.registered&&t.engine.isBeingRegister&&"string"==typeof t.engine.accName&&"string"==typeof t.engine.accToken&&t.reLogin(e++)},1e4)):this.engine.getUserService()._fireRegistrationState(l.RegistrationState.Failed,new f.CubeError(d.StateCode.ReLoginTimeout,"auto re login failed"))}},{key:"_reConnect",value:function(){this.engine.isShutdown||this.reConnect(),null!=this.engine.getCallService()&&this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),this.engine.registered&&this.engine.getUserService()._fireRegistrationState(l.RegistrationState.Cleared),null!=this.engine.sipService&&this.engine.sipService.unregister()}}]),t}(a.ConnectionService)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeServer=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67);t.CubeServer=function(){function e(){i(this,e),this.host=null,this.port=null,this.httpHost=null,this.httpPort=null,this.ssl="https:"===location.protocol}return o(e,[{key:"update",value:function(e){var t=e.CubeServer,n=e.CubeHttpServer,i=e.FileServer,o=e.StorageServer,c=e.Conference,a=r.Utils.isSecure?"https://":"http://";this.host=_CUBE_DOMAIN=t.Host,this.httpHost=n.Host,_CUBE_HTTP_SERVICE="http://"+n.Host+":"+n.HTTPPort,_CUBE_HTTPS_SERVICE="https://"+n.Host+":"+n.SSLPort,_CUBE_HTTP_FILE_SERVICE="http://"+i.Host+":"+i.HTTPPort,_CUBE_HTTPS_FILE_SERVICE="https://"+i.Host+":"+i.SSLPort,_CUBE_HTTP_STORAGE_SERVICE="http://"+o.Host+":"+o.HTTPPort,_CUBE_HTTPS_STORAGE_SERVICE="https://"+o.Host+":"+o.SSLPort,this.ssl?(this.port=_CUBE_PORT=t.TCPPort+10,this.httpPort=n.SSLPort,_CUBE_CONF_CAPTURE_SERVICE=c.SSLCapture,_CUBE_HTTP_SERVICES=a+t.Host+":"+(t.HTTPPort+10)):(this.port=_CUBE_PORT=t.TCPPort,this.httpPort=n.HTTPPort,_CUBE_CONF_CAPTURE_SERVICE=c.HTTPCapture,_CUBE_HTTP_SERVICES=a+t.Host+":"+t.HTTPPort),_CUBE_SERVICE=this.http}},{key:"socket",get:function(){return(this.ssl?"wss://":"ws://")+this.host+":"+this.port}},{key:"http",get:function(){return(this.ssl?"https://":"http://")+this.httpHost+":"+this.httpPort}}]),e}()},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),window.indexedDB||(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange),window.addEventListener("error",function(e){nucleus.getLogger().e&&nucleus.getLogger().e("Error",e.toString())},!1);var n=navigator.userAgent.toLowerCase(),i="ipad"==n.match(/ipad/i),o="iphone os"==n.match(/iphone os/i),r=(n.match(/midp/i),"android"==n.match(/android/i)),c=(n.match(/windows ce/i),n.match(/windows mobile/i),document.compatMode,n.indexOf("opera"),n.indexOf("chrome")>-1),a=n.indexOf("firefox")>-1,s=!c&&!r&&/webkit|khtml/.test(n),u="ActiveXObject"in window,l=(u&&window.XMLHttpRequest,u&&window.XMLHttpRequest&&document.documentMode,u&&!-[1]&&document.documentMode,"Microsoft Internet Explorer"==navigator.appName&&"9."==navigator.appVersion.match(/9./i)),f=(u&&/10\.0/.test(n),u&&n.indexOf("rv:11.0")>-1),d=!s&&!c&&n.indexOf("gecko")>-1,p=(d&&n.indexOf("rv:1.9"),-1!=n.indexOf("windows")||-1!=n.indexOf("win32")),y=-1!=n.indexOf("macintosh")||-1!=n.indexOf("mac os x"),h=(n.indexOf("adobeair"),-1!=n.indexOf("linux")),v=0===window.location.href.toLowerCase().indexOf("https"),g=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;t.Utils={isIPad:i,isIPhone:o,isAndroid:r,isPhone:o||r,isDesktop:!o&&!r&&!i,isWindows:p,isMac:y,isLinux:h,isChrome:c,isFirefox:a,isIE:u,isIE9:l,isIE11:f,isSafari:s,isSecure:v,randomNumber:function(e,t){return Math.floor(Math.random()*(t-e))+e},retrievalDomClass:function(t,n){var i=null;try{i=t.getAttribute("class")}catch(e){return null}if(null!=i&&i.indexOf(n)>=0)return t;var o=t.parentNode;return null!=o&&void 0!==o?e.utils.retrievalDomClass(o,n):null},formatDuration:function(e){var t=e/1e3,n=parseInt(t);if(n<60)return"00:"+(n<10?"0"+n:n);var i=t/60,o=parseInt(Math.floor(i)),r=parseInt(n%60);return(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)},getUrlParams:function(){for(var e=[],t=void 0,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<n.length;i++)t=n[i].split("="),e.push(t[0]),e[t[0]]=t[1];return e},getUrlParam:function(e){var t=this.getUrlParams()[e];return void 0===t?null:t},getCookieVal:function(e){var t=document.cookie.indexOf(";",e);return-1==t&&(t=document.cookie.length),unescape(document.cookie.substring(e,t))},getCookie:function(e){for(var t=e+"=",n=t.length,i=document.cookie.length,o=0;o<i;){var r=o+n;if(document.cookie.substring(o,r)==t)return this.getCookieVal(r);if(0==(o=document.cookie.indexOf(" ",o)+1))break}return null},setCookie:function(e,t,n,i,o,r){document.cookie=e+"="+escape(t)+(n?"; expires="+n:"")+(i?"; path="+i:"")+(o?"; domain="+o:"")+(r?"; secure":"")},deleteCookie:function(e,t,n){this.getCookie(e)&&(document.cookie=e+"="+(t?"; path="+t:"")+(n?"; domain="+n:"")+"; expires=Thu, 01-Jan-1970 00:00:01 GMT")},getElementChildren:function(e){if(e.children)return e.children;for(var t=[],n=e.childNodes,i=0;i<n.length;++i)1==n[i].nodeType&&t.push(n[i]);return t},getDrawPosition:function(e,t){var n=void 0===t.touches?this.getMousePos(t):this.getTouchPos(t),i=this.getX(e),o=this.getY(e);return{x:n.x-i,y:n.y-o}},getCursorPosition:function(e){if(void 0===e.touches){return{x:e.clientX||e.pageX,y:e.clientY||e.pageY}}if(e.touches.length>0){return{x:e.touches[0].pageX||e.touches[0].clientX||e.clientX,y:e.touches[0].pageY||e.touches[0].clientY||e.clientY}}return{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}},getMousePos:function(e){var t=e||window.event,n=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.pageX||t.clientX+n,y:t.pageY||t.clientY+i}},getTouchPos:function(e){var t=e||window.event,n=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.touches[0].pageX||t.clientX+n,y:t.touches[0].pageY||t.clientY+i}},getX:function(e){for(var t=e.offsetLeft,n=e;null!=(n=n.offsetParent);)t+=n.offsetLeft;return t},getY:function(e){for(var t=e.offsetTop,n=e;null!=(n=n.offsetParent);)t+=n.offsetTop;return t},fixNumber:function(e){var t=new Number(e);return Number(t.toFixed(2))},fixNumberToString:function(e){return new Number(e).toFixed(2)},unselectable:function(e){e.setAttribute("unselectable","on"),e.onmousedown=function(){return!1};var t=e.style;t.userSelect="none",t.webkitUserSelect="none",t.MozUserSelect="-moz-none"},verifyEmail:function(e){return g.test(e)},isSocketSupported:function(){return void 0!==window.WebSocket},isSVGSupported:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},isDBSupported:function(){return void 0!==window.indexedDB},isRecorderSupported:function(){return void 0!==(window.StereoRecorder||window.MediaStreamRecorder||window.WhammyRecorder||window.GifRecorder||window.CanvasRecorder)},isVideoSupported:function(){return!!document.createElement("video").canPlayType},isUserMediaSupported:function(){if(s&&null==navigator.getUserMedia)return!1;var e=navigator.userAgent.indexOf("Chrome/");if(e>0){var t=navigator.userAgent.substr(e+7),n=t.indexOf(".");if(n>0){t=t.substring(0,n);if(parseInt(t)<37)return!1}}return void 0!==navigator.getUserMedia||void 0!==window.getUserMedia},measureBandwidth:function(e,t,n,i){var o=e?1054738:10561396,r=0,c=0,a=0,s=new Image;s.onload=function(){clearTimeout(a),a=0,c=Date.now();var e=(c-r)/1e3,n=8*o,i=(n/e).toFixed(2),s=(i/1024).toFixed(2),u=(s/1024).toFixed(2);t.call(null,i,s,u)},s.onerror=function(e,t){n.call(null,e)},r=Date.now();var u="?t="+r,l="assets/bandwidth/"+(e?"bandwidth-1m.jpg":"bandwidth-10m.jpg")+u;void 0!==i&&(l="http://"+i+"/"+l),s.src=l,a=setTimeout(function(){clearTimeout(a),a=0,n.call(null)},3e4)},requestGet:function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&(200==i.status?t.call(null,JSON.parse(i.responseText)):n.call(null,i.status))},i.open("GET",e),i.send(null)},parseXml:function(e){var t=null;if(!window.DOMParser&&window.ActiveXObject)for(var n=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],i=0;i<n.length;i++)try{t=new ActiveXObject(n[i]),t.async=!1,t.loadXML(e);break}catch(e){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){}}return t},getUserMedia:function(e,t,n){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;var i={video:e,audio:t};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(i).then(function(e){n(!1,e)}).catch(function(e){n(e)}):navigator.getUserMedia?navigator.getUserMedia(i,function(e){n(!1,e)},function(e){n(e)}):n({code:CubeStateCode.NotSupportUserMedia})},getUserStream:function(e,t){var n=this;this.getUserMedia(e,!0,function(e,i){e?n.getUserMedia(!1,!0,function(e,n){t(e,n)}):t(e,i)})},stopStream:function(e){e.getTracks().forEach(function(e){e.stop()})},hasMedia:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){if(null!=t){var n=!1,i=!1;t.map(function(e){"videoinput"==e.kind&&(n=!0),"audioinput"==e.kind&&(i=!0)}),e([n,i])}})})},hasCamera:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){if(null!=t){var n=!1;t.map(function(e){"videoinput"==e.kind&&(n=!0)}),e(n)}})})},hasMicrophone:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){if(null!=t){var n=!1;t.map(function(e){"audioinput"==e.kind&&(n=!0)}),e(n)}})})},getLocalUUID:function(){var e=localStorage.getItem("CUBE_LOCAL_UUID_"+cube.accName);return null==e&&(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),localStorage.setItem("CUBE_LOCAL_UUID_"+cube.accName,e)),e},closeMediaStream:function(e){if("function"==typeof e.stop)e.stop();else for(var t=[e.getAudioTracks(),e.getVideoTracks()],n=0;n<t.length;n++){var i=t[n];if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=i[o];"function"==typeof r.stop&&r.stop()}}}};!function(e){var t=void 0,n=function(){},i=e.document,o={set:n,get:n,remove:n,clear:n,each:n,obj:n,length:0};!function(){if("localStorage"in e)try{return void(t=e.localStorage)}catch(e){}var n=i.getElementsByTagName("head")[0],o=e.location.hostname||"localStorage",r=new Date,c=void 0,a=void 0;if(n.addBehavior){try{a=new ActiveXObject("htmlfile"),a.open(),a.write('<script>document.w=window;<\/script><iframe src="/favicon.ico"></iframe>'),a.close(),c=a.w.frames[0].document,n=c.createElement("head"),c.appendChild(n)}catch(e){n=i.getElementsByTagName("head")[0]}try{r.setDate(r.getDate()+36500),n.addBehavior("#default#userData"),n.expires=r.toUTCString(),n.load(o),n.save(o)}catch(e){return}var s=void 0,u=void 0;try{s=n.XMLDocument.documentElement,u=s.attributes}catch(e){return}var l=new RegExp("^p__hack_"),f=new RegExp("m-_-c","g"),d=function(e){return encodeURIComponent("p__hack_"+e).replace(/%/g,"m-_-c")},p=function(e){return decodeURIComponent(e.replace(f,"%")).replace(l,"")};t={length:u.length,isVirtualObject:!0,getItem:function(e){return(u.getNamedItem(d(e))||{nodeValue:null}).nodeValue||s.getAttribute(d(e))},setItem:function(e,t){try{s.setAttribute(d(e),t),n.save(o),this.length=u.length}catch(e){}},removeItem:function(e){try{s.removeAttribute(d(e)),n.save(o),this.length=u.length}catch(e){}},clear:function(){for(;u.length;)this.removeItem(u[0].nodeName);this.length=0},key:function(e){return u[e]?p(u[e].nodeName):void 0}},"localStorage"in e||(e.localStorage=t)}else try{t=e.localStorage}catch(e){t=null}}(),e.LS=t?{set:function(e,n){void 0!==this.get(e)&&this.remove(e),t.setItem(e,n),this.length=t.length},get:function(e){var n=t.getItem(e);return null===n?void 0:n},remove:function(e){t.removeItem(e),this.length=t.length},clear:function(){t.clear(),this.length=0},each:function(e){var t=this.obj(),n=e||function(){},i=void 0;for(i in t)if(!1===n.call(this,i,this.get(i)))break},obj:function(){var e={},n=0,i=void 0,o=void 0;if(t.isVirtualObject)e=t.key(-1);else for(i=t.length;n<i;n++)o=t.key(n),e[o]=this.get(o);return e},length:t.length}:o,e.jQuery&&(e.jQuery.LS=e.LS)}(window)}).call(t,n(13))},,,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeEngine=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(36),c=n(22),a=n(67),s=n(120),u=n(118),l=n(117),f=n(1),d=n(5),p=n(3),y=n(106),h=n(14),v=n(111),g=n(35),b=n(66),m=n(34),C=n(65),S=n(119);t.CubeEngine=function(){function t(){i(this,t),this.version="3.0.6",this.utils=a.Utils,this.session=new r.Session,this.accName=null,this.accDisplayName=null,this.accPassword=null,this.accToken=null,this.hostAddress=null,this.config=new c.CubeConfig,this.services=new HashMap,this.sspMediaService=null,this.sipMediaService=null,this.sipService=null,this.isReconnecting=!1,this.isBeingRegister=!1,this.loadLicenseCounts=0,this.resourcePath="./assets",this.isShutdown=!1,this.responder=new y.Responder(this,this.session),this.registered=!1,this.appLicense=null,this.deviceInfo=null,this.isLicenseLoaded=!1;var n=_cube_timestamp+"";this._cube_token=n.substr(n.length-6,6),this.cubeState=g.CubeState.Stop,this.networkConnected=!0,this.delegate=new h.Delegate(v.CubeEngineListener),this.celletMembers=new HashMap,this.server=new b.CubeServer,this.connect=new C.ConnectionServiceWorker(this),this.nodeIntegration=void 0!==e&&e.exports}return o(t,[{key:"_adjust",value:function(e){void 0!==e.host&&(_CUBE_DOMAIN=e.host.toString()),void 0!==e.port&&(_CUBE_PORT=parseInt(e.port))}},{key:"setCubeConfig",value:function(e){for(var t in this.config)if(this.config.hasOwnProperty(t)&&e.hasOwnProperty(t)){if("frameRate"===t){var n=parseInt(e.frameRate.min),i=parseInt(e.frameRate.max);this.config.frameRate={min:n>10?10:n<2?2:n,max:i>30?30:i<6?6:i}}this.config[t]=e[t]}for(var o=this.services.values(),r=0;r<o.length;r++)o[r].onConfigure(this.config)}},{key:"startup",value:function(e){var t=this;nucleus.getLogger().i("CubeEngine","Cube Engine for HTML5/JavaScript v"+this.version),this.isShutdown=!1,this._cube_token=this.utils.randomNumber(1e5,999999)+"";var n=function(){return t.connect.init()?(t.loadLicense(),t.loadUser(),t.loadGroup(),e(!1),t.delegate.onStarted(),t.triggerCubeEngineState(g.CubeState.Start),!0):(e(new f.CubeError(d.StateCode.InitFailed,"Cube Engine initialization failed!")),!1)};return this.utils.isIE9?(window.WEB_SOCKET_FORCE_FLASH=!0,nucleus.activateWSPlugin(_CUBE_DOMAIN.indexOf("192")>=0?"libs/ws":"http://"+_CUBE_DOMAIN+"/libs/ws",function(){n()})):n(),!0}},{key:"shutdown",value:function(){this.isShutdown=!0,window.nucleus.shutdown();for(var e=this.services.values(),t=0;t<e.length;t++)e[t].shutdown();this.services.clear(),this.server=new b.CubeServer,this.delegate.onStopped(),this.triggerCubeEngineState(g.CubeState.Stop)}},{key:"getCubeEngineState",value:function(){return this.cubeState}},{key:"triggerCubeEngineState",value:function(e){this.cubeState=e,this.delegate.onStateChange(e)}},{key:"addListener",value:function(e){this.delegate.addListener(e)}},{key:"removeListener",value:function(e){this.delegate.addListener(e)}},{key:"getSession",value:function(){return this.session}},{key:"loadService",value:function(e,t){if("function"==typeof t){for(var n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if("Whiteboard"===e&&i.length>1&&"string"==typeof i[1]&&(e="Whiteboard"+i[1]),!this.services.containsKey(e)){var r=new(Function.prototype.bind.apply(t,[null].concat([this],i)));r.startup(),this.services.put(e,r)}return!0}return!1}},{key:"loadUser",value:function(){return this.loadService("User",s.UserServiceWorker)}},{key:"loadLicense",value:function(){return this.loadService("License",u.LicenseServiceWorker)}},{key:"loadSetting",value:function(){return this.loadService("Setting",S.SettingServiceWorker)}},{key:"loadGroup",value:function(){return this.loadService("Group",l.GroupServiceWorker)}},{key:"loadMessager",value:function(){return this.loadService("Message",window.CubeMessageServiceWorker)}},{key:"loadFileManager",value:function(){return this.loadService("Cloud",window.CubeFileManagerServiceWorker)}},{key:"loadInstruction",value:function(){return this.loadService("Instruction",window.CubeInstructionServiceWorker)}},{key:"loadSignaling",value:function(e,t,n){var i=this.loadService("Call",window.CubeCallServiceWorker,document.getElementById(e),document.getElementById(t),void 0!==n?document.getElementById(n):null);return i&&(nucleus.ts.isWebSocketSupported()||(nucleus.getLogger().i("CubeEngine","Adapter WebSocket"),nucleus.ts.resetHeartbeat(p.CELLET.Signaling,2e3))),i}},{key:"loadShareDesktop",value:function(e,t){return this.loadService("ShareDesktop",window.CubeShareDesktopServiceWorker,e,t)}},{key:"loadConference",value:function(e,t,n,i){var o=this.loadService("Conference",window.CubeConferenceServiceWorker);return o&&(this.sipService=new CubeSIPServiceWorker,this.erizoService=new CubeErizoServiceWorker(this),this.sipService.start(this,document.getElementById(e),document.getElementById(t),void 0!==n?document.getElementById(n):null),this.sipMediaService=new CubeMediaServiceWorker(this.sipService,i),this.erizoMediaService=new CubeMediaServiceWorker(this.erizoService,i)),o}},{key:"loadWhiteboard",value:function(e,t){return this.loadService("Whiteboard",window.CubeWhiteboardServiceWorker,e,t)}},{key:"loadLive",value:function(e,t){return this.loadService("Live",window.CubeLiveServiceWorker,e,t)}},{key:"loadRecentSession",value:function(){return this.loadService("RecentSession",window.CubeRecentSessionServiceWorker)}},{key:"getUserService",value:function(){return this.services.get("User")}},{key:"getSettingService",value:function(){return this.services.get("Setting")}},{key:"getGroupService",value:function(){return this.services.get("Group")}},{key:"getMessageService",value:function(){return this.services.get("Message")}},{key:"getCallService",value:function(){return this.services.get("Call")}},{key:"getMediaService",value:function(){return null!=this.session.callPeer&&this.session.isConferenceCall()?this.session.isSipConference()?this.sipMediaService:this.erizoMediaService:this.sspMediaService}},{key:"getWhiteboardService",value:function(e){return"string"==typeof e?this.services.get("Whiteboard"+e):this.services.get("Whiteboard")}},{key:"getConferenceService",value:function(){return this.services.get("Conference")}},{key:"getFileManagerService",value:function(){return this.services.get("Cloud")}},{key:"getInstructionService",value:function(){return this.services.get("Instruction")}},{key:"getShareDesktopService",value:function(){return this.services.get("ShareDesktop")}},{key:"getLiveService",value:function(){return this.services.get("Live")}},{key:"getRecentSessionService",value:function(){return this.services.get("RecentSession")}},{key:"getDeviceInfo",value:function(){if(null!=this.accName){var e=null!=this.config&&this.config.deviceName?this.config.deviceName:navigator.appName;return this.deviceInfo={name:e,version:navigator.appVersion,platform:navigator.platform,deviceId:this.utils.getLocalUUID()},this.deviceInfo}return!1}},{key:"getUtils",value:function(){return this.utils}},{key:"_parseICEServers",value:function(e){for(var t=[],n=[],i=e,o=0;o<i.length;o++){var r=i[o];null!=r.Username&&null!=r.Password&&n.push({urls:"turn:"+r.Host+":"+r.Port,username:r.Username,credential:r.Password}),t.push("stun:"+r.Host+":"+r.Port)}return t.length>0&&n.push({urls:t}),n}},{key:"setResourcePath",value:function(e){if(this.resourcePath=e,"function"==typeof window.CubeWhiteboardServiceWorker)for(var t=this.services.values(),n=0;n<t.length;n++){var i=t[n];i instanceof CubeWhiteboardServiceWorker&&i.core.updateResourcePath()}}},{key:"addCelletMember",value:function(e,t){var n=this.celletMembers.get(e);n instanceof Array?n.push(t):(n=[t],_VALID_CELLETS.push(e)),this.celletMembers.put(e,n)}},{key:"removeCelletMember",value:function(e,t){var n=this.celletMembers.get(e);if(n instanceof Array){for(var i=0;i<n.length;i++)n[i]===t&&n.splice(i,1);this.celletMembers.put(e,n)}}},{key:"onDialogue",value:function(e,t,n){if(e===p.CELLET.Responder)this.responder.fireDialogue(t,n);else{var i=this.celletMembers.get(e);if(i instanceof Array)for(var o=0;o<i.length;o++)i[o].onDialogue(t,n)}}},{key:"_setCodec",value:function(e){switch(this.config.videoCodec){case m.CodecType.H264:e=this.utils.isFirefox?e.replace(/SAVPF 96/g,"SAVPF 126"):e.replace(/SAVPF 96 97 98 99 100/g,"SAVPF 100 96 97 98 99"),e=this.utils.isFirefox?e.replace(/SAVPF 96/g,"SAVPF 126"):e.replace(/SAVPF  96 98 100 102/g,"SAVPF 100 96 98 102");break;case m.CodecType.VP9:e=e.replace(/SAVPF 96 97 98/g,"SAVPF 98 96 97"),e=e.replace(/SAVPF 96 98/g,"SAVPF 98 96")}return e}},{key:"warmUp",value:function(e,t){var n=this;if(null==this.getCallService())return void(void 0!==t&&t());var i=navigator.getUserMedia||window.getUserMedia;if(void 0===i||null==i)return void(void 0!==t&&t());var o=document.body.style.overflow,r=window.innerWidth,c=window.innerHeight;document.body.style.overflow="hidden";var a=parseInt(.5*(r-480)),s=parseInt(.5*(c-480))-40,u=parseInt(.5*(r-200-200-40)),l=parseInt(s+480+10),f=['<div style="position:absolute;float:left;left:0px;top:0px;opacity:0.7;-moz-opacity:0.7;-webkit-opacity:0.7;background:#000;',"width:",r,"px;height:",c,'px"></div>','<video id="_cube_warmup_video" width="480" height="480" style="position:absolute;float:left;left:',a,"px;top:",s,'px;background:#101010;" autoplay></video>','<button id="_cube_warmup_yes" style="width:200px;height:30px;position:absolute;float:left;left:',u,"px;top:",l,'px;"></button>','<button id="_cube_warmup_no" style="width:200px;height:30px;position:absolute;float:left;left:',u+240,"px;top:",l,'px;"></button>'],d=document.createElement("div");d.style.position="absolute",d.style.styleFloat="left",d.style.cssFloat="left",d.style.left="0px",d.style.top="0px",d.style.width=r+"px",d.style.height=c+"px",d.style.zIndex=9998,d.innerHTML=f.join(""),document.body.appendChild(d);var p=document.getElementById("_cube_warmup_video"),y=null;(this.utils.isIE||this.utils.isSafari)&&(navigator.getUserMedia=window.getUserMedia),navigator.getUserMedia({audio:!0,video:!0},function(e){if(y=e,n.utils.isIE||n.utils.isSafari)return window.attachMediaStream(p,e),p=document.getElementById("_cube_warmup_video"),p.style.position="absolute",p.style.styleFloat="left",p.style.cssFloat="left",p.style.left=a+"px",p.style.top=s+"px",void(p.style.zIndex=9999);window.URL?p.src=window.URL.createObjectURL(y):p.src=y,p.onloadedmetadata=function(e){p.play()}},function(e){document.body.removeChild(d),document.body.style.overflow=o,void 0!==t&&t()});var h=function(){n.utils.isIE||n.utils.isSafari?window.attachMediaStream(document.getElementById("_cube_warmup_video"),null):p.src="",null!=y&&(y.stop(),y=null),document.body.removeChild(d),document.body.style.overflow=o},v=document.getElementById("_cube_warmup_yes");v.addEventListener("click",function(t){h(),void 0!==e&&e.call(null)},!1),v=document.getElementById("_cube_warmup_no"),v.addEventListener("click",function(e){h(),void 0!==t&&t()},!1)}}]),t}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.DBEntity=function(){function e(t,n){i(this,e),this.id=t,this.tableName=n}return o(e,[{key:"toJSON",value:function(){var e={};for(var t in this)"function"!=typeof this[t]&&"baseprototype"!=t&&"tableName"!=t&&(e[t]=this[t]);return e}},{key:"onChange",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e){var t=new o.CubeDBCore,n=[];this.isConnect=!1,this.loadEntity=function(e){var n=new e,i=[];for(var o in n.toJSON())"id"!=o&&i.push(o);t.loadTable(n.tableName,i)},this.connect=function(i){var o=this;t.open(e,function(){if(o.isConnect=!0,null!=i&&i(),n.length>0)for(var e=0;e<n.length;e++)o[n[e].action].apply(o,n[e].args);n=null})},this.setEntity=function(e,i){this.isConnect?t.setItem(e.tableName,e.toJSON(),i):n[n.length]={action:"setEntity",args:arguments}},this.getEntity=function(e,i){this.isConnect?t.getItem(e.tableName,e.id,i):n[n.length]={action:"getEntity",args:arguments}},this.getEntityByColumn=function(e,i,o,r){this.isConnect?t.getItemByColumn(e.tableName,i,o,r):n[n.length]={action:"getEntityByColumn",args:arguments}},this.getEntityByColumnGT=function(e,i,o,r,c){this.isConnect?t.getItemByColumnGT(e.tableName,i,o,r,c):n[n.length]={action:"getEntityByColumnGT",args:arguments}},this.getEntitysByColumn=function(e,i,o,r){this.isConnect?t.getItemsByColumn(e.tableName,i,o,r):n[n.length]={action:"getEntitysByColumn",args:arguments}},this.getEntitysByColumns=function(e,i,o,r){this.isConnect?t.getItemsByColumns(e.tableName,i,o,r):n[n.length]={action:"getEntitysByColumns",args:arguments}},this.getEntitysByManyColumn=function(e,i,o,r){this.isConnect?t.getItemsByManyColumn(e.tableName,i,o,r):n[n.length]={action:"getEntitysByManyColumn",args:arguments}},this.getEntitysByColumnAndPage=function(e,i,o,r,c,a,s){this.isConnect?t.getItemsByColumnAndPage(e.tableName,i,o,r,c,a,s):n[n.length]={action:"getEntitysByColumnAndPage",args:arguments}},this.getAllEntity=function(e,i){this.isConnect?t.getAllItem(e.tableName,i):n[n.length]={action:"getAllEntity",args:arguments}},this.delEntityById=function(e,i,o){this.isConnect?t.delItemById(e.tableName,i,o):n[n.length]={action:"delEntityById",args:arguments}},this.delEntitysByColumn=function(e,i,o,r){this.isConnect?t.delItemsByColumn(e.tableName,i,o,r):n[n.length]={action:"delEntitysByColumn",args:arguments}},this.clearEntity=function(e,i){this.isConnect?t.clearTable(e.tableName,i):n[n.length]={action:"clearEntity",args:arguments}},this.disconnect=function(e){t.close(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.DBManager=i;var o=n(104)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Peer=function(){function e(t,n){i(this,e),this.name=t,this.displayName=null,this.latency=-1,this.conference=n||null}return o(e,[{key:"getName",value:function(){return this.name}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"getLatency",value:function(){return this.latency}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Permission={READ:"read",WRITE:"write"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Setting=void 0;var o=n(40),r=n(39);t.Setting=function e(){i(this,e),this.topMap=new HashMap,this.muteMap=new HashMap,this.notify=new o.NotifyConfig,this.disturb=new r.DisturbConfig,this.deviceToken="",this.updateTime=0}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.GroupContext=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"getName",value:function(){return this.data.name}},{key:"getId",value:function(){return this.data.name}},{key:"getDisplayName",value:function(){return this.data.displayName}},{key:"getFounder",value:function(){return this.data.founder}},{key:"getCreated",value:function(){return this.data.created}},{key:"getMembers",value:function(){return this.data.members}},{key:"getMasters",value:function(){return this.data.masters}},{key:"getGuests",value:function(){return void 0===this.data.guests?null:this.data.guests}},{key:"isOpen",value:function(){return this.data.open}},{key:"getConference",value:function(){if(this.data.attachment){if(void 0!==this.data.attachment.conference)return this.data.attachment.conference}else if(void 0!==this.data.conference)return this.data.conference;return null}}]),e}()},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(73),o=n(8),r=n(7),c=n(74),a=n(75),s=n(4),u=n(41),l=n(1),f=n(3),d=n(5),p=n(14),y=n(76),h=n(36),v=n(45),g=n(79),b=n(9),m=n(77),C=n(43),S=n(42),k=n(35),A=n(22),w=n(34),E=n(37),_=n(38),T=n(16),L=n(17),R=n(10),P=n(15),O=n(44),I=n(40),M=n(39),j=n(78);!function(e){e._CUBE_DOMAIN=null,e._CUBE_CONF_CAPTURE_SERVICE=null,e._CUBE_PORT=null,e._CUBE_HTTP_SERVICE=null,e._CUBE_HTTPS_SERVICE=null,e._CUBE_HTTP_SERVICES=null,e._CUBE_SERVICE=null,e._CUBE_HTTP_FILE_SERVICE=null,e._CUBE_HTTPS_FILE_SERVICE=null,e._CUBE_HTTP_STORAGE_SERVICE=null,e._CUBE_HTTPS_STORAGE_SERVICE=null,e._CUBE_STUN_SERVERS=null,e._CUBE_ICE_SERVERS=null,e._VALID_CELLETS=[],e._MSTR_TOKEN="CubeTeam@2015",e._cube_timestamp=Date.now(),e.cube=new i.CubeEngine,e.CubeService=o.Service,e.CubeListener=r.Listener,e.CubeDBEntity=c.DBEntity,e.CubeDBManager=a.DBManager,e.CubeConst=s.CubeConst,e.CubeRequest=u.CubeRequest,e.CubeError=l.CubeError,e.CELLET=f.CELLET,e.CubeStateCode=d.StateCode,e.CubeDelegate=p.Delegate,e.CubePeer=y.Peer,e.CubeSession=h.Session,e.CubeUserListener=v.UserListener,e.CubeSettingListener=O.SettingListener,e.CubeGroupContext=g.GroupContext,e.CubeRegistrationState=b.RegistrationState,e.CubePermission=m.Permission,e.CubeGroupListener=C.GroupListener,e.CubeDeviceListener=S.DeviceListener,e.CubeState=k.CubeState,e.CubeConfig=A.CubeConfig,e.CubeCodecType=w.CodecType,e.CubeGroup=E.Group,e.CubeGroupType=_.GroupType,e.CubeGroupConfig=P.GroupConfig,e.CubeGroupMember=T.Member,e.CubeMemberRole=L.MemberRole,e.CubeUser=R.User,e.CubeDisturbConfig=M.DisturbConfig,e.CubeNotifyConfig=I.NotifyConfig,e.CubeSetting=j.Setting,void 0===e._cube_cross&&(e._cube_cross={host:"http://"+_CUBE_DOMAIN,callbackMap:{},addCallback:function(e,t,n){this.callbackMap[e]=t}}),e._cube_cross.queryRecordArchives=function(t,n){var i=document.getElementById(t),o=i.getAttribute("name");e._cube_cross.callbackMap[t].call(null,o,n),document.body.removeChild(i),i=null,delete e._cube_cross.callbackMap[t]}}(window)},function(e,t,n){"use strict";function i(){var e=this,t=[],n=void 0;window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),window.openDatabase=window.openDatabase||window.mozOpenDatabase||window.webkitOpenDatabase||window.msOpenDatabase,window.indexedDB?(this.open=function(e,i){var o=window.indexedDB.open(e,"4");o.onsuccess=function(e){n=o.result,i()},o.onupgradeneeded=function(e){for(var n=0;n<t.length;n++){var i=t[n];e.currentTarget.result.objectStoreNames.contains(i.name)&&e.currentTarget.result.deleteObjectStore(i.name);for(var o=e.currentTarget.result.createObjectStore(i.name,{keyPath:"id"}),r=0;r<i.columns.length;r++)o.createIndex(i.columns[r],i.columns[r],{unique:!1})}},o.onerror=function(e){throw new Error("Open database error: "+e.target.errorCode)}},this.close=function(e){null!=n&&(n.close(),null!=e&&setTimeout(e,500))},this.deleteDB=function(e,t){var n=window.indexedDB.deleteDatabase(e);n.onerror=function(e){t(e.target)},n.success=function(e){t(!1)}},this.setItem=function(e,t,i){var o=n.transaction(e,"readwrite"),r=o.objectStore(e),c=r.put(t);c.onsuccess=function(){o=null,i(!1)},c.onerror=function(e){o=null,i(e)}},this.getItem=function(e,t,i){n.transaction(e,"readwrite").objectStore(e).get(t).onsuccess=function(e){i(!1,e.target.result)}},this.getItemByColumn=function(e,t,i,o){var r=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var c=IDBKeyRange.only(i);r.index(t).get(c).onsuccess=function(e){o(!1,e.target.result)}},this.getItemByColumnGT=function(e,t,i,o,r){var c=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var a=IDBKeyRange.lowerBound(i,!o),s=c.index(t),u=[];s.openCursor(a).onsuccess=function(e){var t=e.target.result;t?(u.push(t.value),t.continue()):r(!1,u)}},this.getItemsByColumn=function(e,t,i,o){var r=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var c=IDBKeyRange.only(i),a=r.index(t),s=[],u=a.openCursor(c);u.onsuccess=function(e){var t=e.target.result;t?(s[s.length]=t.value,t.continue()):o(!1,s)},u.onerror=function(e){o(e)}},this.getItemsByColumns=function(e,t,i,o){if(1==i.length)"id"==t?this.getItem(e,i[0],function(e,t){e?o(e):o(!1,[t])}):this.getItemsByColumn(e,t,i[0],o);else{var r=n.transaction(e).objectStore(e),c=[];r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){for(var r=0;r<i.length;r++)if(n.value[t]==i[r]){c.push(n.value);break}n.continue()}else o(!1,c)}}},this.getItemsByManyColumn=function(e,t,i,o){if(t.length>0&&t.length==i.length)if(1==t.length)this.getItemsByColumn(e,t[0],i[0],o);else{var r=n.transaction(e).objectStore(e);"boolean"==typeof i[0]&&(i[0]=i[0]?1:0);var c=IDBKeyRange.only(i[0]),a=r.index(t[0]),s=[];a.openCursor(c).onsuccess=function(e){var n=e.target.result;if(n){for(var r=1;r<t.length&&n.value[t[r]]==i[r];r++)r==t.length-1&&s.push(n.value);n.continue()}else o(!1,s)}}else o(new Error("columnNames and columnValues are inconsistent in length"))},this.getItemsByColumnAndPage=function(e,t,i,o,r,c,a){var s=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var u=IDBKeyRange.only(i),l=s.index(t),f=[],d=!0,p="next";c&&(p="prev"),l.openCursor(u,p).onsuccess=function(e){var t=e.target.result;if(t){if(d&&o>0)return d=!1,void t.advance(o);f[f.length]=t.value,f.length<r?t.continue():a(!1,f)}else a(!1,f)}},this.getAllItem=function(e,t){var i=n.transaction(e).objectStore(e),o=[];i.openCursor().onsuccess=function(e){var n=e.target.result;n?(o[o.length]=n.value,n.continue()):t(!1,o)}},this.delItemById=function(e,t,i){n.transaction(e,"readwrite").objectStore(e).delete(t).onsuccess=function(e){i(!1)}},this.delItemsByColumn=function(t,n,i,o){var r=e;"id"==n?e.delItemById(t,i,o):e.getItemsByColumn(t,n,i,function(e,n){if(e)o(e);else if(null!=n&&n.length>0)for(var i=0;i<n.length;i++)!function(e){r.delItemById(t,n[e].id,function(){e==n.length-1&&o(!1)})}(i);else o(!1)})},this.clearTable=function(e,t){n.transaction(e,"readwrite").objectStore(e).clear().onsuccess=function(){t(!1)}}):window.openDatabase&&(this.open=function(e,i){n=window.openDatabase(e,"","",104857600),""==n.version?n.changeVersion(n.version,"4",function(){},function(e){throw e},function(){n.transaction(function(e){for(var n=0;n<t.length;n++){var o=t[n];e.executeSql("CREATE TABLE "+o.name+" (id unique,"+o.columns.toString()+")")}i()})}):"4"==n.version?i():n.changeVersion(n.version,"4",function(){},function(e){throw e},function(){})},this.close=function(){n=null},this.deleteDB=function(e,t){n.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master where type = ?",["table"],function(e,n){for(var i=0,o=n.rows.length;i<o;i++){var r=n.rows.item(i).name;0!=r.indexOf("__")&&e.executeSql("DROP TABLE "+r,null)}t(!1)},function(e,n){t(n)})})},this.setItem=function(e,t,i){n.transaction(function(n){var o=[],r=[],c=[];for(var a in t)o.push(a),r.push("?"),c.push(t[a]);n.executeSql("REPLACE INTO "+e+" ("+o.toString()+") VALUES ("+r.toString()+")",c,function(){i(!1)},function(e,t){i(t)})})},this.getItem=function(e,t,i){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE id = ?",[t],function(e,t){i(!1,t.rows.length>0?t.rows.item(0):null)},function(e,t){i(t)})})},this.getItemByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" = ?",[i],function(e,t){o(!1,t.rows.length>0?t.rows.item(0):null)},function(e,t){o(t)})})},this.getItemByColumnGT=function(e,t,i,o,r){n.transaction(function(n){var c=o?" >= ":" > ";n.executeSql("SELECT * FROM "+e+" WHERE "+t+c+"?",[i],function(e,t){r(!1,t.rows.length>0?t.rows.item(0):null)},function(e,t){r(t)})})},this.getItemsByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" = ?",[i],function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})})},this.getItemsByColumns=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" in (?"+new Array(i.length).join(",?")+")",i,function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})})},this.getItemsByManyColumn=function(e,t,i,o){t.length>0&&t.length==i.length?n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t.join("=? and ")+"=?",i,function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})}):o(new Error("columnNames and columnValues are inconsistent in length"))},this.getItemsByColumnAndPage=function(e,t,i,o,r,c,a){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+"=?"+(c?" ORDER BY id DESC":"")+" LIMIT ?,?",[i,o,r],function(e,t){for(var n=[],i=0,o=t.rows.length;i<o;i++)n.push(t.rows.item(i));a(!1,n)},function(e,t){a(t)})})},this.getAllItem=function(e,t){n.transaction(function(n){n.executeSql("SELECT * FROM "+e,null,function(e,n){for(var i=[],o=0,r=n.rows.length;o<r;o++)i.push(n.rows.item(o));t(!1,i)},function(e,n){t(n)})})},this.delItemById=function(e,t,i){n.transaction(function(n){n.executeSql("DELETE FROM "+e+" WHERE id=?",[t],function(){i(!1)},function(e,t){i(t)})})},this.delItemsByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("DELETE FROM "+e+" WHERE "+t+"=?",[i],function(){o(!1)},function(e,t){o(t)})})},this.clearTable=function(e,t){n.transaction(function(n){n.executeSql("DELETE FROM "+e,null,function(){t(!1)},function(e,n){t(n)})})}),this.loadTable=function(e,n){t.push({name:e,columns:n})}}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeDBCore=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ActionType={Ack:"ack",Sync:"sync",Notify:"notify"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Responder=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(4),c=n(5),a=n(3);t.Responder=function(){function e(t,n){i(this,e),this.engine=t,this.session=n,this.timer=0,this.lastTimestamp=null,this.query=!1}return o(e,[{key:"start",value:function(e,t,n){this.query=void 0!==t&&t,void 0===n&&(n=!0);var i=new InetAddress(e,4005);if(nucleus.talkService.call([a.CELLET.Responder],i,n)){var o=this;return this.timer=setTimeout(function(){o._timerHandler()},1e4),!0}return!1}},{key:"stop",value:function(){this.timer>0&&(clearTimeout(this.timer),this.timer=0),this.session.latency=-1,null!=this.session.callPeer&&(this.session.callPeer.latency=-1),nucleus.talkService.hangUp(a.CELLET.Responder)}},{key:"_timerHandler",value:function(){if(clearTimeout(this.timer),this.timer=0,nucleus.talkService.isCalled(a.CELLET.Responder)){var e={timestamp:{originate:Date.now()}};this.engine.connect.send(a.CELLET.Responder,r.CubeConst.ActionTime,e)}var t=this;this.timer=setTimeout(function(){t._timerHandler()},6e4)}},{key:"fireDialogue",value:function(e,t){if(e==r.CubeConst.ActionTimeAck){var n=t.getParamAsString("state");if(n.code==c.StateCode.Ok){this.lastTimestamp=t.getParamAsString("timestamp"),this.lastTimestamp.arrive=Date.now();var i={name:this.session.name.toString(),timestamp:this.lastTimestamp},o=this.lastTimestamp.arrive-this.lastTimestamp.originate-(this.lastTimestamp.transmit-this.lastTimestamp.receive);this.session.latency=o,this.engine.connect.send(a.CELLET.Responder,r.CubeConst.ActionRespond,i)}else nucleus.getLogger().e("CubeResponder","Error '"+e+"' : "+n.code+" : "+n.desc)}else if(e==r.CubeConst.ActionRespondAck){var s=t.getParamAsString("state");if(s.code==c.StateCode.Ok){if(this.query){var u=this.session.callPeer.name;if(null!=u){var l={name:u.toString()};this.engine.connect.send(a.CELLET.Responder,r.CubeConst.ActionQueryRespond,l)}}}else nucleus.getLogger().e("CubeResponder","Error '"+e+"' : "+s.code+" : "+s.desc)}else if(e==r.CubeConst.ActionQueryRespondAck){var f=t.getParamAsString("state");if(f.code==c.StateCode.Ok){var d=t.getParamAsString("data");if(d.name==this.session.callPeer.name){var p=d.timestamp,y=p.arrive-p.originate-(p.transmit-p.receive);this.session.callPeer.latency=y}}}}},{key:"fireContacted",value:function(){}},{key:"fireQuitted",value:function(){}},{key:"fireFailed",value:function(e){this.timer>0&&(clearTimeout(this.timer),this.timer=0)}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(65);t.ConnectionService=function(){function e(){i(this,e),this.TAG="fldyconnection",this.instance=null}return o(e,[{key:"updateLicense",value:function(e){}},{key:"isInit",value:function(){}},{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"isConnected",value:function(){}},{key:"isConnected",value:function(e){}},{key:"isConnected",value:function(e){}},{key:"disConnected",value:function(e){}},{key:"disConnected",value:function(){}},{key:"connect",value:function(e,t,n){}},{key:"connect",value:function(e,t,n,i){}},{key:"getServers",value:function(){}},{key:"send",value:function(e,t,n,i){}},{key:"sleep",value:function(){}},{key:"wakeup",value:function(){}}],[{key:"getInstance",value:function(){return null==this.instance&&(nucleus.getLogger().i(TAG,"ConnectionService:new"),e.instance=new r.ConnectionServiceWorker),e.instance}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeHttpServer=function(){function e(){i(this,e),this.host=null,this.port=null,this.sslPort=null,this.httpPort=null,this.ssl="https:"===location.protocol}return o(e,[{key:"update",value:function(e){this.host=_CUBE_DOMAIN=e.CubeServer.Host,this.httpHost=e.CubeHttpServer.Host,_CUBE_HTTP_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.HTTPPort,_CUBE_HTTPS_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.SSLPort,this.ssl?(this.port=_CUBE_PORT=e.CubeServer.HTTPPort+10,this.httpPort=e.CubeHttpServer.SSLPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.SSLCapture):(this.port=_CUBE_PORT=e.CubeServer.HTTPPort,this.httpPort=e.CubeHttpServer.HTTPPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.HTTPCapture),_CUBE_SERVICE=this.http}},{key:"http",get:function(){return(this.ssl?"https://":"http://")+this.httpHost+":"+this.httpPort}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.ICEServer=function(){function e(t,n,o,r,c){i(this,e),this.ip=t,this.host=n,this.port=o,this.username=r,this.password=c}return o(e,[{key:"update",value:function(e){this.host=_CUBE_DOMAIN=e.CubeServer.Host,this.httpHost=e.CubeHttpServer.Host,_CUBE_HTTP_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.HTTPPort,_CUBE_HTTPS_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.SSLPort,this.ssl?(this.port=_CUBE_PORT=e.CubeServer.HTTPPort+10,this.httpPort=e.CubeHttpServer.SSLPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.SSLCapture):(this.port=_CUBE_PORT=e.CubeServer.HTTPPort,this.httpPort=e.CubeHttpServer.HTTPPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.HTTPCapture),_CUBE_SERVICE=this.http}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.NetworkDetection=function(){function e(t){var n=this;i(this,e),this.options=t,this.online=function(){null!=n.options&&n.options.connect()},this.offline=function(){null!=n.options&&n.options.disconnect()}}return o(e,[{key:"startup",value:function(){window.addEventListener("online",this.online,!1),window.addEventListener("offline",this.offline,!1)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.online,!1),window.removeEventListener("offline",this.offline,!1)}}],[{key:"startup",value:function(t){null!=this.detection&&this.detection.shutdown(),this.detection=new e(t),this.detection.startup()}},{key:"shutdown",value:function(){null!=this.detection&&(this.detection.shutdown(),this.detection=null)}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeEngineListener=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7);t.CubeEngineListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"onStarted",value:function(){}},{key:"onStateChange",value:function(e){}},{key:"onStopped",value:function(){}},{key:"onFailed",value:function(e){}}]),t}(a.Listener)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupService=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(8);t.GroupService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"create",value:function(e){}},{key:"destroy",value:function(e){}},{key:"addMembers",value:function(e,t){}},{key:"removeMembers",value:function(e,t){}},{key:"inviteMembers",value:function(e,t){}},{key:"rejectInvite",value:function(e,t){}},{key:"acceptInvite",value:function(e,t){}},{key:"applyJoin",value:function(e){}},{key:"rejectApply",value:function(e,t){}},{key:"acceptApply",value:function(e,t){}},{key:"queryGroups",value:function(e,t){}},{key:"addMaster",value:function(e,t){}},{key:"removeMaster",value:function(e,t){}},{key:"update",value:function(e){}},{key:"createGuest",value:function(e,t){}}]),t}(a.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.LicenseListener=function(){function e(){i(this,e)}return o(e,[{key:"onLicenseUpdated",value:function(e){}},{key:"onLicenseFailed",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseService=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(8);t.LicenseService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"isInit",value:function(){}},{key:"updateCubeConfig",value:function(e){}},{key:"saveLicense",value:function(e,t){}},{key:"init",value:function(e,t){}},{key:"checkLicenseUpdate",value:function(e,t){}},{key:"updateLicense",value:function(e,t){}},{key:"isLicenseOutDate",value:function(e,t){}},{key:"needUpdateLicense",value:function(e,t){}}]),t}(a.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingService=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(8);t.SettingService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"updateNotifyConfig",value:function(e){}},{key:"updateDisturbConfig",value:function(e){}},{key:"updateDeviceToken",value:function(e){}},{key:"addTopSession",value:function(e){}},{key:"removeTopSession",value:function(e){}},{key:"addMuteSession",value:function(e){}},{key:"removeMuteSession",value:function(e){}},{key:"syncSetting",value:function(){}},{key:"getSetting",value:function(){}}]),t}(a.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(8);t.UserService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"login",value:function(e,t,n,i){}},{key:"logout",value:function(){}},{key:"queryAccounts",value:function(e,t){}},{key:"queryOnlineDevice",value:function(e,t){}},{key:"queryOnlineDeviceById",value:function(e,t){}}]),t}(a.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(112),s=n(43),u=n(4),l=n(3),f=n(37),d=n(16);t.GroupServiceWorker=function(e){function t(e){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.GroupListener,l.CELLET.Group))}return r(t,e),c(t,[{key:"create",value:function(e){if(void 0==e||null==e)return!1;var t={token:this.engine.accToken,group:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionCreateGroup,t)}},{key:"destroy",value:function(e){var t={token:this.engine.accToken,groupId:e.toString()};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionDestroyGroup,t)}},{key:"queryGroups",value:function(e,t,n,i){var o={token:this.engine.accToken,cubeId:this.engine.accName,offset:e,limit:t};new CubeRequest("").send(this._getHttpUrl("/v3/users/groups/sync"),o,function(e,t){if(!e)if(200==t.state.code){if("function"==typeof n){var o=t.data.groups;n(o)}}else"function"==typeof i&&i(t.state.code,t.state.desc)})}},{key:"queryGroupDetails",value:function(e,t,n){var i=this._getHttpUrl("/v3/groups"),o={token:this.engine.accToken,groupIds:e};NucleusAjax.newRequest(i).method("POST").content(o).send(function(e){var i=JSON.parse(e.data);if(200==i.state.code){var o=i.data.groups;"function"==typeof t&&t(o)}else"function"==typeof n&&n(i.state.code,i.state.desc)})}},{key:"update",value:function(e){var t={token:this.engine.accToken,group:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionUpdateGroup,t)}},{key:"addMembers",value:function(e,t){var n={token:this.engine.accToken,groupId:e,members:t};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionAddMember,n)}},{key:"quit",value:function(e){var t={token:this.engine.accToken,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionQuitGroup,t)}},{key:"removeMembers",value:function(e,t){var n={token:this.engine.accToken,groupId:e,members:t};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionRemoveMember,n)}},{key:"inviteMembers",value:function(e,t){var n={token:this.engine.accToken,members:t,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionInviteGroupMember,n)}},{key:"rejectInvite",value:function(e,t){var n={token:this.engine.accToken,groupId:e,cubeId:t};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.AcitonRejectGroupInvite,n)}},{key:"acceptInvite",value:function(e,t){var n={token:this.engine.accToken,groupId:e.toString(),cubeId:t};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionAcceptGroupInvite,n)}},{key:"applyJoin",value:function(e){var t={token:this.engine.accToken,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionApplyJoinGroup,t)}},{key:"rejectApply",value:function(e,t){var n={token:this.engine.accToken,cubeId:t,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionRejectApplyGroup,n)}},{key:"acceptApply",value:function(e,t){var n={token:this.engine.accToken,cubeId:t,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionAcceptApplyGroup,n)}},{key:"addMaster",value:function(e,t){var n={token:this.engine.accToken,masters:t,groupId:e};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionAddMaster,n)}},{key:"removeMaster",value:function(e,t){var n={groupId:e,masters:t,token:this.engine.accToken};return this.engine.connect.send(l.CELLET.Group,u.CubeConst.ActionRemoveMaster,n)}},{key:"onDialogue",value:function(e,t){var n=t.getParamAsString("state");if(n.code&&200!=n.code)return void this.delegate.onGroupFailed(n.code);var i=t.getParamAsString("data"),o=new d.Member(this.engine.accName),r=i&&i.group?new f.Group(i.group):"";null!=this.delegate&&(e==u.CubeConst.ActionCreateGroupAck?this.delegate.onGroupCreated(r,o):e==u.CubeConst.ActionCreateGroupSync?this.delegate.onGroupCreated(r,o):e==u.CubeConst.ActionCreateGroupNotify?this.delegate.onGroupCreated(r,i.user):e==u.CubeConst.ActionDestroyGroupAck?this.delegate.onGroupDestroyed(r,o):e==u.CubeConst.ActionDestroyGroupSync?this.delegate.onGroupDestroyed(r,o):e==u.CubeConst.ActionDestroyGroupNotify?this.delegate.onGroupDestroyed(r,i.user):e==u.CubeConst.ActionUpdateGroupAck?this.delegate.onGroupUpdated(r,o):e==u.CubeConst.ActionUpdateGroupSync?this.delegate.onGroupUpdated(r,o):e==u.CubeConst.ActionUpdateGroupNotify?this.delegate.onGroupUpdated(r,i.user):e==u.CubeConst.ActionAddMemberAck?this.delegate.onMemberAdded(r,i.members,o):e==u.CubeConst.ActionAddMemberSync?this.delegate.onMemberAdded(r,i.members,o):e==u.CubeConst.ActionAddMemberNotify?this.delegate.onMemberAdded(r,i.members,i.user):e==u.CubeConst.ActionRemoveGroupMemberAck?this.delegate.onMemberRemoved(r,i.members,o):e==u.CubeConst.ActionRemoveGroupMemberSync?this.delegate.onMemberRemoved(r,i.members,o):e==u.CubeConst.ActionRemoveGroupMemberNotify?this.delegate.onMemberRemoved(r,r.members,i.user):e==u.CubeConst.ActionAddMasterAck?this.delegate.onMasterAdded(r,i.masters,o):e==u.CubeConst.ActionAddMasterSync?this.delegate.onMasterAdded(r,i.masters,o):e==u.CubeConst.ActionAddMasterNotify?this.delegate.onMasterAdded(r,i.masters,i.user):e==u.CubeConst.ActionRemoveMasterAck?this.delegate.onMasterRemoved(r,i.masters,o):e==u.CubeConst.ActionRemoveMasterSync?this.delegate.onMasterRemoved(r,i.masters,o):e==u.CubeConst.ActionRemoveMasterNotify?this.delegate.onMasterRemoved(r,i.masters,i.user):e==u.CubeConst.ActionAcceptGroupInviteAck?this.delegate.onGroupInviteJoined(r,o):e==u.CubeConst.ActionAcceptGroupInviteSync?this.delegate.onGroupInviteJoined(r,o):e==u.CubeConst.ActionAcceptGroupInviteNotify?this.delegate.onGroupInviteJoined(r,i.user,i.from):e==u.CubeConst.ActionInviteGroupMemberAck?this.delegate.onGroupInvited(r,i.members,o):e==u.CubeConst.ActionInviteGroupMemberSync?this.delegate.onGroupInviteJoined(r,i.members,o):e==u.CubeConst.ActionInviteGroupMemberNotify?this.delegate.onGroupInvited(r,i.members,i.user):e==u.CubeConst.AcitonRejectGroupInviteAck?this.delegate.onGroupRejectInvited(r,o):e==u.CubeConst.AcitonRejectGroupInviteSync?this.delegate.onGroupRejectInvited(r,o):e==u.CubeConst.AcitonRejectGroupInviteNotify?this.delegate.onGroupInviteJoined(r,i.user):e==u.CubeConst.ActionRejectApplyGroupAck?this.delegate.onGroupRejectApplyed(r,i.user,o):e==u.CubeConst.ActionRejectApplyGroupSync?this.delegate.onGroupRejectApplyed(r,i.user,o):e==u.CubeConst.ActionRejectApplyGroupNotify?this.delegate.onGroupRejectApplyed(r,i.from,i.user):e==u.CubeConst.ActionApplyJoinGroupAck?this.delegate.onGroupApplyed(r,o):e==u.CubeConst.ActionApplyJoinGroupSync?this.delegate.onGroupApplyed(r,o):e==u.CubeConst.ActionApplyJoinGroupNotify?this.delegate.onGroupApplyed(r,i.user):e==u.CubeConst.ActionAcceptApplyGroupAck?this.delegate.onGroupApplyJoined(r,i.user,o):e==u.CubeConst.ActionAcceptApplyGroupSync?this.delegate.onGroupApplyJoined(r,i.user,o):e==u.CubeConst.ActionQuitGroupAck?this.delegate.onGroupQuited(r,i.from):e==u.CubeConst.ActionQuitGroupSync?this.delegate.onGroupQuited(r,i.from):e==u.CubeConst.ActionQuitGroupNotify&&this.delegate.onGroupQuited(r,i.from))}},{key:"_getHttpUrl",value:function(e){return _CUBE_HTTP_SERVICES+e}}]),t}(a.GroupService)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(4),s=n(3),u=n(114),l=n(108),f=n(66),d=n(109),p=n(113),y=n(22);n(9),t.LicenseServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.LicenseListener,s.CELLET.License));n.engine=e,n.tag="fldylicense",n.name="cube.license",n.context=null,n.cubeCofing=new y.CubeConfig,n.INTERVAL_TIME=36e4,n.isInit=!1,n.licenseVersion="3.0.1",n.host="http://125.208.1.67:9000/",n.address=n.engine.config.getLicenseServer(),n.appid=null,n.appKey=null,n.token=null,n.beginDate=0,n.endDate=0,n.cubeServer=new f.CubeServer,n.cubeHttpServer=new l.CubeHttpServer,n.conference={httpCapture:null,sslCapture:null},n.iceServers=new d.ICEServer,n.permissions=new HashMap,n.createTime=0,n.updateTime=0,n.licenseJSON=null,n.storageKey=null,n.Company={name:null,website:null},n.createTime=0,n.updateTime=0,n.nodeId=0;var r=localStorage.getItem(n.storageKey);return n.appLicense=r?JSON.parse(r):null,n}return r(t,e),c(t,[{key:"isInit",value:function(){return this.isInit}},{key:"init",value:function(e,t){this.isInit=!1,this.context=e,this.cubeCofing=t}},{key:"isInit",value:function(){}},{key:"updateCubeConfig",value:function(e){}},{key:"saveLicense",value:function(e,t){}},{key:"checkLicenseUpdate",value:function(e,t,n,i){var o=this,r=new CubeRequest("");"function"!=typeof t?(this.appid=n,this.token=t,this.storageKey="CUBE_LICENSE_KEY_"+this.appid):i=t;var c={token:this.token,appid:this.appid,version:this.licenseVersion,type:"json"};this.appLicense&&(c.lastUpdateTime=this.appLicense.UpdateTime),r.send(e||this.engine.config.getLicenseServer(),c,function(e,t){if(e)return void i(new CubeError(CubeStateCode.LoadLicenseFailed,"Network error."));if(200===t.state){var n=t.data.license,r=parseFloat(n.Version);if(r<1.8||r>3)return void i(new CubeError(StateCode.LoadLicenseFailed,"License version version is too old!"));if(Date.now()>n.EndDate)return void i(new CubeError(StateCode.LoadLicenseFailed,"License has expired!"));localStorage.setItem(o.storageKey,JSON.stringify(n)),o.engine.server.update(n),i(!1,!0,n)}else 201===t.state?i(!1,!1,o.appLicense):i(new CubeError(t.state,"Incorrect access."))})}},{key:"updateLicense",value:function(e,t){}},{key:"isLicenseOutDate",value:function(e,t){}},{key:"needUpdateLicense",value:function(e,t){}},{key:"onDialogue",value:function(e,t){t.getParamAsString("state");if(e==a.CubeConst.ActionLicenseNotify){this._processLicenseNotify(t);t.getParamAsString("data")}}},{key:"_processLicenseNotify",value:function(e){var t=this,n=e.getParamAsString("data");if(n)if(n.license&&n.crypUrl){var i=new CubeRequest(""),o={license:encodeURIComponent(n.license),num:n.num};i.send(n.crypUrl,o,function(e,n){if((e||200!==n.code)&&nucleus.getLogger().w("CubeEngine"," license Failed! "+e),200===n.code){var i=n.data;t.engine.server.update(i),t._updateLicense(i,!0)}})}else setTimeout(function(){t.checkLicenseUpdate(n.server,function(e,n,i){if(e)return void nucleus.getLogger().w("CubeEngine","Update license Failed! "+e.message);t.engine.server.update(i),t._updateLicense(i,n)})},5e3)}},{key:"_updateLicense",value:function(e,t){t&&(this.engine._appLicense=e,this.engine.hostAddress=new InetAddress(_CUBE_DOMAIN,_CUBE_PORT),this.engine.isLicenseLoaded=!0,this.engine.getUserService()._handUp(),nucleus.talkService.call(_VALID_CELLETS,this.engine.hostAddress,this.engine.config.socketEnabled),"string"!=typeof this.engine.accName||this.engine.isBeingRegister||this.engine.getUserService().login(this.engine.accName,this.engine.accToken,this.engine.accDisplayName))}}]),t}(u.LicenseService)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(115),s=n(44),u=n(4),l=n(3),f=n(105);t.SettingServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.SettingListener,l.CELLET.Setting));return n.updateTime=0,n.settingCallback=new Map,n}return r(t,e),c(t,[{key:"updateNotifyConfig",value:function(e){return void 0!=e&&null!=e&&this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionUpdateNotifyConfig,e)}},{key:"updateDisturbConfig",value:function(e){return void 0!=e&&null!=e&&this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionUpdateDisturbConfig,e)}},{key:"updateDeviceToken",value:function(e){var t={deviceToken:e};return this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionUpdateDeviceToken,t)}},{key:"addTopSession",value:function(e){var t={top:e};return this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionAddTop,t)}},{key:"removeTopSession",value:function(e){var t={top:e};return this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionRemoveTop,t)}},{key:"addMuteSession",value:function(e){var t={mute:e};return this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionAddMute,t)}},{key:"removeMuteSession",value:function(e){var t={mute:e};return this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionRemoveMute,t)}},{key:"syncSetting",value:function(){var e={updateTime:Date.now()};return this.updateTime=e.updateTime,this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionSyncSetting,e)}},{key:"getSetting",value:function(e){var t={updateTime:Date.now()};return this.updateTime=t.updateTime,this.settingCallback.set("getSettingCallback",e),this.engine.connect.send(l.CELLET.Setting,u.CubeConst.ActionQuerySetting,t)}},{key:"onDialogue",value:function(e,t){var n=t.getParamAsString("state");if(n.code&&200!=n.code)return void this.delegate.onsettingFailed(n.code);if(null!=this.delegate)for(var i in u.CubeConst)for(var o in f.ActionType){var r=u.CubeConst[i]+"-"+f.ActionType[o];if(r==e){var c=u.CubeConst[i].replace("Action","_process");this[c](e,t);break}}}},{key:"_processUpdateNotifyConfig",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onNotifyConfigUpdated(n)}},{key:"_processUpdateDisturbConfig",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onDisturbConfigUpdated(n)}},{key:"_processAddTop",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onTopSessionAdded(n.topMap,n.top)}},{key:"_processRemoveTop",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onTopSessionRemoved(n.topMap,n.top)}},{key:"_processAddMute",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onMuteSessionAdded(n.muteMap,n.mute)}},{key:"_processRemoveMute",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onMuteSessionRemoved(n.muteMap,n.mute)}},{key:"_processQuerySetting",value:function(e,t){var n=t.getParamAsString("data");n&&this.settingCallback.get.getSettingCallback(n)}},{key:"_processUpdateDeviceToken",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onDeviceTokenUpdated(n)}},{key:"_processSyncSetting",value:function(e,t){var n=t.getParamAsString("data");n&&this.delegate.onSettingSynced(n.setting,n.updateTime)}}]),t}(a.SettingService)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(116),s=n(45),u=n(3),l=n(9),f=n(4),d=n(41),p=n(1),y=n(5),h=n(42),v=n(14),g=n(10);t.UserServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.UserListener,u.CELLET.User));return n.deviceListener=new v.Delegate(h.DeviceListener),n.queryCallback=null,n.queryDeviceCallback=null,n.licenseService=e.services.get("License"),n.queryDeviceByIdCallback=null,n}return r(t,e),c(t,[{key:"login",value:function(e,t,n){var i=this;return console.log("[Cube#UserService] login to "+e+", "+t+", "+n),"string"==typeof e&&(this.engine.accName=e,this.engine.accDisplayName="string"!=typeof n?e:n,this.engine.accToken=t,_MSTR_TOKEN=t,this.engine.session.name=e,this.engine.session.displayName=this.engine.accDisplayName,this.engine.isLicenseLoaded?this._handleRegister(e,n,t,0):this.loadLicense(t,function(n,o){n?500==n.code?(i.engine.isLicenseLoaded=!1,i._fireRegistrationState(l.RegistrationState.Failed,new p.CubeError(y.StateCode.GetLicenseFail,"GetLicense Failed")),i._handUp()):i._fireRegistrationState(l.RegistrationState.Failed,new p.CubeError(y.StateCode.BadRequest,"Request Failed")):i._handleRegister(e,i.engine.accDisplayName,t,0)}),!0)}},{key:"logout",value:function(){if(console.log("[Cube#UserService] logout current account"),"string"!=typeof this.engine.accName)return!1;if(this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),null!=this.engine.getConferenceService()&&this.engine.getConferenceService().terminateCall(),null!=this.engine.sipService&&this.engine.sipService.unregister(),nucleus.talkService.isCalled(u.CELLET.User)){var e=null!=this.engine.config&&void 0!==this.engine.config.deviceName?this.engine.config.deviceName:navigator.appName,t={cubeId:this.engine.accName,version:this.engine.version,device:{name:e,version:navigator.appVersion,platform:navigator.platform,userAgent:navigator.userAgent}};null!=this.engine.accToken&&(t.token=this.engine.accToken),this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionLogout,t)}return this.engine.accName=null,this.engine.accDisplayName=null,this.engine.session.name=null,this.engine.session.displayName=null,!0}},{key:"queryAccounts",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryCallback=t;var n={list:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionQuery,n),!0}return!1}},{key:"update",value:function(e){if(!e)return!1;var t={user:new g.User(e),token:this.engine.accToken};this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionUpdate,t)}},{key:"uploadAvatar",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments[1];if(CubeFileMessage){var i=new CubeFileMessage;i.accept="image/*",i.chooseFile(function(i,o){var r={token:e.engine.accToken,isOverride:!0,md5:o};new d.CubeRequest("").sendFile("https://dev.upload.shixincube.cn/v3/file/uploadAvatar",{name:"file",value:i},r,function(i,o){if("function"==typeof t)if(n){var r=new g.User(e.engine.accName,e.engine.accDisplayName,o.data.url);e.update(r)}else t(i,o);if(i)throw i})})}}},{key:"addDeviceListener",value:function(e){this.deviceListener.addListener(e)}},{key:"removeDeviceListener",value:function(e){this.deviceListener.removeListener(e)}},{key:"queryOnlineDevice",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryDeviceCallback=t;var n={name:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionQueryDevice,n),!0}return!1}},{key:"queryOnlineDeviceById",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryDeviceByIdCallback=t;var n={deviceId:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionQueryByIdDevice,n)}return!1}},{key:"_handleRegister",value:function(e,t,n,i){var o=this;if(this.engine.isLicenseLoaded){this.engine.isBeingRegister=!0,nucleus.talkService.clearTalkList(),this._fireRegistrationState(l.RegistrationState.Progress);var r=this.engine.getDeviceInfo();r.userAgent=navigator.userAgent;var c={cubeId:e,token:"cubeTeam",displayName:this.engine.accDisplayName,version:this.engine.version,nettype:"",device:r};null!=this.engine.accToken&&(c.token=this.engine.accToken),this.engine.isReconnecting||this.engine.connect.send(u.CELLET.User,f.CubeConst.ActionLogin,c),setTimeout(function(){!o.engine.isBeingRegister||o.engine.registered||o.engine.isReconnecting?o.engine.isBeingRegister=!1:o._handleRegister(e,t,t,n,i++)},5e3)}}},{key:"loadLicense",value:function(e,t){var n=this;this.licenseService.checkLicenseUpdate(null,e,this.engine.config.appid,function(e,i,o){e?t(e):(n.engine._appLicense=o,n.engine.isLicenseLoaded=!0,n.engine.server.update(o),n.engine.connect.connect(_CUBE_DOMAIN,_CUBE_PORT,_VALID_CELLETS),t(!1,o))})}},{key:"_fireRegistrationState",value:function(e,t){if(e!==this.engine.session.regState){this.engine.session.regState=e;var n=void 0;e===l.RegistrationState.Progress?this.engine.registered=!1:e===l.RegistrationState.Ok?(this.engine.registered=!0,n="onLogined"):e===l.RegistrationState.Cleared?(this.engine.registered=!1,n="onLogouted",this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),null!=this.engine.sipService&&this.engine.sipService.unregister()):e===l.RegistrationState.Failed&&(this.engine.registered=!1,n="onFailed");for(var i=this.engine.services.values(),o=0;o<i.length;o++){var r=i[o];if("function"==typeof r.onRegisterStateChanged)try{r.onRegisterStateChanged(this.engine.session)}catch(e){nucleus.getLogger().w("UserService#RegistrationState",e.message)}}"string"==typeof n&&("onFailed"===n?(t||(t=new p.CubeError(y.StateCode.BadRequest,"Handle Failed")),this.delegate[n](t,this.engine.session)):this.delegate[n](this.engine.session))}}},{key:"_processLogin",value:function(e){var t=e.getParamAsString("device");null!=t&&this.deviceListener.onDeviceOnline(t.fromDevice,t.onlineDevices)}},{key:"_processLogout",value:function(e){var t=e.getParamAsString("device");null!=t&&this.deviceListener.onDeviceOffline(t.fromDevice,t.onlineDevices)}},{key:"_processLoginAck",value:function(e){this.engine.isBeingRegister=!1;var t=e.getParamAsString("data");if(200===e.getParamAsString("state").code){var n=t.msgToken;null!=n&&void 0!==n&&(this.engine._cube_token=n.toString());var i=e.getParamAsString("ICEServers");null!=i&&(_CUBE_ICE_SERVERS=i,_CUBE_STUN_SERVERS=this.engine._parseICEServers(i));var o=t.user;null!=o&&(this.engine.accDisplayName=o.displayName,this.engine.accAvatar=o.avatar),this._fireRegistrationState(l.RegistrationState.Ok),this.engine.triggerCubeEngineState(CubeState.Ready)}else nucleus.getLogger().w("CubeEngine","login failed"),this._fireRegistrationState(l.RegistrationState.Failed),this.engine.triggerCubeEngineState(CubeState.Start)}},{key:"_processLogoutAck",value:function(e){var t=e.getParamAsString("state");this.engine.triggerCubeEngineState(CubeState.Start),200===t.code?this._fireRegistrationState(l.RegistrationState.Cleared):(nucleus.getLogger().w("CubeEngine","logout failed"),this._fireRegistrationState(l.RegistrationState.Failed))}},{key:"_processUpdate",value:function(e){var t=e.getParamAsString("state"),n=e.getParamAsString("data");200===t.code?this.delegate.onUserUpdated(n):nucleus.getLogger().w("CubeEngine","update user failed")}},{key:"_processQueryAck",value:function(e){if(null!=this.queryCallback){var t=e.getParamAsString("data");null!=t&&this.queryCallback(t.list),this.queryCallback=null}}},{key:"_processQueryDeviceAck",value:function(e){if(null!=this.queryDeviceCallback){var t=e.getParamAsString("device");null!=t&&this.queryDeviceCallback(t.onlineDevices),this.queryDeviceCallback=null}}},{key:"_processQueryDeviceByIdAck",value:function(e){if(null!=this.queryDeviceByIdCallback){var t=e.getParamAsString("data");null!=t&&this.queryDeviceByIdCallback(t),this.queryDeviceByIdCallback=null}}},{key:"_processLicense",value:function(e){var t=this,n=e.getParamAsString("data");if(n)if(n.license&&n.crypUrl){var i=new d.CubeRequest(""),o={license:n.license,number:n.num};i.send(n.crypUrl,o,function(e,n){if((e||200!==n.state)&&nucleus.getLogger().w("CubeEngine"," license Failed! "+e),200===n.state){var i=n.data;t.engine.server.update(i),t._updateLicense(i,!0)}})}else setTimeout(function(){t.licenseService.checkLicenseUpdate(n.server,null,t.engine.config.appid,function(e,n,i){if(e)return void nucleus.getLogger().w("CubeEngine","Update license Failed! "+e.message);t.engine.server.update(i),t._updateLicense(i,n)})},5e3)}},{key:"_updateLicense",value:function(e,t){t&&(this.engine._appLicense=e,this.engine.hostAddress=new InetAddress(_CUBE_DOMAIN,_CUBE_PORT),this.engine.isLicenseLoaded=!0,this._handUp(),nucleus.talkService.call(_VALID_CELLETS,this.engine.hostAddress,this.engine.config.socketEnabled),"string"!=typeof this.engine.accName||this.engine.isBeingRegister||this.login(this.engine.accName,this.engine.accToken,this.engine.accDisplayName))}},{key:"_handUp",value:function(){nucleus.talkService.hangUp(_VALID_CELLETS[0],!0),this.engine.responder.fireQuitted(),this.engine.getCallService()&&this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),this.engine.registered&&this._fireRegistrationState(l.RegistrationState.Cleared),this.engine.sipService&&this.engine.sipService.unregister()}},{key:"onDialogue",value:function(e,t){e===f.CubeConst.ActionLogin?this._processLogin(t):e===f.CubeConst.ActionLogout?this._processLogout(t):e===f.CubeConst.ActionLoginAck?this._processLoginAck(t):e===f.CubeConst.ActionLoginSync?this._processLogout(t):e===f.CubeConst.ActionLogoutAck?this._processLogoutAck(t):e===f.CubeConst.ActionQueryAck?this._processQueryAck(t):e===f.CubeConst.ActionQueryDeviceAck?this._processQueryDeviceAck(t):e===f.CubeConst.ActionQueryByIdDeviceAck?this._processQueryDeviceByIdAck(t):e===f.CubeConst.ActionLicense?this._processLicense(t):e===f.CubeConst.ActionUpdate?this._processUpdate(t):e===f.CubeConst.ActionUpdateAck?this._processUpdate(t):e===f.CubeConst.ActionUpdateSync&&this._processUpdate(t)}}]),t}(a.UserService)}]);
//# sourceMappingURL=cube-core.js.map
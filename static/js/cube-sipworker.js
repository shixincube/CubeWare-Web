!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=156)}({100:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SIPServiceWorker=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(163),s=n(164),a=n(161),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a);t.SIPServiceWorker=function(){function e(){r(this,e),this.engine=null,this.domain=null,this.host=null,this.wsPort=5066,this.wssPort=7443,this.localVideo=null,this.remoteVideo=null,this.bellAudio=null,this.localStream=null,this.remoteStream=null,this.regListener=null,this.callListener=null,this.direction=null,this.videoEnabled=!0,this.sip=null,this.rtcSession=null,this.maxVideoSize=null,this.maxFrameRate=15,this.minFrameRate=5,this.localVideoReady=null,this.remoteVideoReady=null,this.videoCloseHandler=null,this._checkTerminateTimer=0,this.reconnection=0,this.utils=cube.getUtils()}return i(e,[{key:"setAddress",value:function(e,t,n,r){this.domain=e,this.host=t,this.wsPort=void 0!==n?n:5066,this.wssPort=void 0!==r?r:7443}},{key:"start",value:function(e,t,n,r){this.engine=e,this.localVideo=t,this.remoteVideo=n,this.bellAudio=r;var i=this;if(i.localVideo.addEventListener("loadeddata",function(e){null!=i.localVideoReady&&i.localVideoReady.call(null,i.localVideo,i)},!1),i.remoteVideo.addEventListener("loadeddata",function(e){null!=i.remoteVideoReady&&i.remoteVideoReady.call(null,i.remoteVideo,i)},!1),i.utils.isIE||i.utils.isSafari){navigator.getUserMedia=window.getUserMedia;var o={};o.plugin={isRequired:function(){return void 0!==window.getUserMedia},isInstalled:function(){return void 0!==window.getUserMedia}},o.plugin.interface=window,c.rtcninja(o)}}},{key:"stop",value:function(){this.unregister()}},{key:"registerWith",value:function(e,t,n,r){if(nucleus.getLogger().d("SIPServiceWorker","registerWith"),null!=this.sip&&this.sip.isRegistered())return!0;nucleus.getLogger().d("registerWith","sip:"+e+","+t);var i=this,a=null;a=window.location.protocol.toLowerCase().indexOf("https")>=0?"wss://"+i.domain+":"+i.wssPort:"ws://"+i.domain+":"+i.wsPort;var l={ws_servers:a,uri:"sip:"+e+"@"+i.domain,password:t,display_name:n,register_expires:6100,register:!0};this.sip=new c.UA(l),null==this.regListener&&(this.regListener=new s.SipRegistrationListener(this.engine)),null==this.callListener&&(this.callListener=new o.SipCallListener(this.engine)),this.sip.on("connected",function(e){i.regListener.onRegistrationProgress(i.engine.session),void 0!==r&&r.onRegistrationProgress(i.engine.session)}),this.sip.on("disconnected",function(e){i.unregister()}),this.sip.on("registered",function(e){i.regListener.onRegistrationOk(i.engine.session),void 0!==r&&r.onRegistrationOk(i.engine.session)}),this.sip.on("unregistered",function(e){i.unregister(),i.regListener.onRegistrationCleared(i.engine.session),void 0!==r&&r.onRegistrationCleared(i.engine.session)}),this.sip.on("registrationFailed",function(e){i.regListener.onRegistrationFailed(i.engine.session),void 0!==r&&r.onRegistrationFailed(i.engine.session)}),this.sip.on("newRTCSession",function(e){i.onNewSession(e)}),this.sip.start()}},{key:"unregister",value:function(e){return null!=this.sip&&(this.sip.unregister({all:!0}),this.sip.stop(),this.sip=null,e&&e()),this.clear(),!0}},{key:"invite",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(nucleus.getLogger().d("SIPServiceWorker","invite"),null==this.sip||this.engine.session.callState!==CubeSignalingState.None&&this.engine.session.callState!==CubeSignalingState.End&&this.engine.session.callState!==CubeSignalingState.Progress)return!1;nucleus.getLogger().d("SIPServiceWorker","invite.Outgoing"),this.direction=CubeCallDirection.Outgoing,this.videoEnabled=!1!==t;var i={audio:!0,video:!1},o=t||r?1:0,s=function(){var t={mediaConstraints:i,pcConfig:{iceServers:_CUBE_STUN_SERVERS,gatheringTimeout:2e3},rtcConstraints:{optional:[{DtlsSrtpKeyAgreement:!0}]},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:o}};n.sip.call("sip:"+e+"@"+n.host,t)};if(this.videoEnabled){var a=CubeVideoSize.VGA.width,c=CubeVideoSize.VGA.height;if(this.utils.isFirefox){var l=navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1];parseInt(l)<43?i.video={width:{min:160,max:a},height:{min:120,max:c},frameRate:{min:this.minFrameRate,max:this.maxFrameRate},require:["width","height","frameRate"]}:i.video={width:a,height:c,frameRate:this.minFrameRate}}r?getScreenId(function(e,t){i.video={mandatory:{chromeMediaSourceId:t,chromeMediaSource:"desktop",maxWidth:1920,maxHeight:1080,maxFrameRate:20}},i.audio=!1,o=0,s()},["screen","audio"]):(i.video={mandatory:{maxWidth:a,maxHeight:c,minWidth:CubeVideoSize.VGA.width,minHeight:CubeVideoSize.VGA.height,maxFrameRate:this.maxFrameRate,minFrameRate:this.minFrameRate}},s()),"string"==typeof t&&(i.video.mandatory.chromeMediaSourceId=t)}else s();return!0}},{key:"answer",value:function(){if(null==this.rtcSession)return!1;var e=this.videoEnabled,t={mediaConstraints:{audio:!0,video:e},pcConfig:{iceServers:_CUBE_STUN_SERVERS,gatheringTimeout:2e3},rtcConstraints:{optional:[{DtlsSrtpKeyAgreement:!0}]},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:e?1:0}};return this.rtcSession.answer(t),!0}},{key:"hangup",value:function(){if(null==this.rtcSession)return!1;try{this.rtcSession.terminate()}catch(e){}return!0}},{key:"consult",value:function(){}},{key:"clear",value:function(){null!=this.videoCloseHandler&&this.videoCloseHandler.call(null,this);try{this.utils.isIE||this.utils.isSafari?(this.localVideo=document.getElementById(this.localVideo.id),window.attachMediaStream(this.localVideo,null)):this.localVideo.src=""}catch(e){nucleus.getLogger().w("SIPWorker#clear",e.message)}try{this.utils.isIE||this.utils.isSafari?(this.remoteVideo=document.getElementById(this.remoteVideo.id),window.attachMediaStream(this.remoteVideo,null)):this.remoteVideo.src=""}catch(e){nucleus.getLogger().w("SIPWorker#clear",e.message)}if(null!=this.localStream&&(void 0!=this.localStream.stop&&this.localStream.stop(),this.localStream=null),null!=this.localAudioStream&&(void 0!=this.localAudioStream.stop&&this.localAudioStream.stop(),this.localAudioStream=null),null!=this.remoteStream){try{this.remoteStream.getAudioTracks()[0].stop(),this.remoteStream.getVideoTracks()[0]&&this.remoteStream.getVideoTracks()[0].stop()}catch(e){nucleus.getLogger().w("SIPWorker#clear",e.message)}this.remoteStream=null}this.rtcSession=null}},{key:"attachMediaStream",value:function(e,t){if((this.utils.isIE||this.utils.isSafari)&&window.attachMediaStream)return void window.attachMediaStream(e,t);e.onloadedmetadata=function(t){e.play()},window.URL?e.srcObject=t:e.src=t}},{key:"conferenceCallListener",value:function(e){var t=this.engine.getConferenceService();t&&(e||(t.delegate.onConferenceCallDisConnected(t.curConference),this.engine.getConferenceService().curConference&&t.quit(t.curConference.conferenceId)))}},{key:"sipReconnection",value:function(){var e=this;nucleus.getLogger().d("SIPWorker","sip reconnection");var t=this.engine.getConferenceService(),n=t.curConference;this.hangup(),this.unregister(),this.reconnection++,t.confStatus=0,t.flagTerminated=!1;var r=n.status[this.engine.accName];this.reconnection<5?setTimeout(function(){t.curConference&&r?t.join(n.conferenceId,r.videoEnabled,!0):e.reconnection=0},2e3*this.reconnection):(this.reconnection=0,n&&r&&t.delegate.onConferenceFailed(n,new CubeError(CubeStateCode.ConferenceTimeout,"ConferenceTimeout!")))}},{key:"_checkTerminate",value:function(){if(null!=this.engine.getConferenceService()&&(nucleus.getLogger().d("如果已经被标记为终止，则加入终止操作",this.engine.getConferenceService().flagTerminated),this.engine.getConferenceService().flagTerminated)){if(this._checkTerminateTimer>0)return;var e=this;this._checkTerminateTimer=setTimeout(function(){clearTimeout(e._checkTerminateTimer),e._checkTerminateTimer=0,e.hangup()},500)}}},{key:"onNewSession",value:function(e){this._checkTerminate();var t=(e.request,e.session);t.remote_identity.uri.toString();if(this.rtcSession=t,null==this.engine.session.callPeer){var n=new CubePeer(t.remote_identity.uri.user);this.engine.session.setCallPeer(n)}this.engine.session.callPeer.name=t.remote_identity.uri.user,this.engine.session.callPeer.displayName=t.remote_identity.display_name||t.remote_identity.uri.user,"incoming"===t.direction?this.direction=CubeCallDirection.Incoming:this.direction=CubeCallDirection.Outgoing;var r=this;t.on("connecting",function(e){r._checkTerminate();var n=t.connection.getLocalStreams().length;n>0&&(1==n?r.localStream=t.connection.getLocalStreams()[0]:2==n&&(r.localAudioStream=t.connection.getLocalStreams()[0],r.localStream=t.connection.getLocalStreams()[1]),r.attachMediaStream(r.localVideo,r.localStream),r.localVideo.volume=0),r.direction==CubeCallDirection.Outgoing&&r.callListener.onCall(r.direction,r.engine.session,r.videoEnabled)}),t.on("progress",function(e){e.originator}),t.on("confirmed",function(e){nucleus.getLogger().d("SIPServiceWorker","confirmed"),r._checkTerminate(),r.conferenceCallListener(!0),"local"===e.originator?r.engine.getConferenceService().onInCall(function(){r.callListener.onCallConnected(r.engine.session)}):r.callListener.onCallConnected(r.engine.session)}),t.on("accepted",function(e){r._checkTerminate(),nucleus.getLogger().d("SIPServiceWorker","accepted"),t.connection.getLocalStreams().length>0&&null==r.localStream&&(r.localStream=t.connection.getLocalStreams()[0],r.attachMediaStream(r.localVideo,r.localStream),(r.utils.isIE||r.utils.isSafari)&&"video"==r.localVideo.tagName.toLowerCase()&&(r.localVideo=document.getElementById(r.localVideo.id)),r.localVideo.volume=0),"remote"===e.originator&&("false"===e.response.getHeader("X-Can-Renegotiate")?t.data.remoteCanRenegotiateRTC=!1:t.data.remoteCanRenegotiateRTC=!0),r.direction==CubeCallDirection.Outgoing&&r.callListener.onCallRinging(r.engine.session)}),t.on("addstream",function(e){r.remoteStream=e.stream,r.attachMediaStream(r.remoteVideo,r.remoteStream),r.reconnection=0,nucleus.getLogger().d("SIPServiceWorker","addstream"),(r.utils.isIE||r.utils.isSafari)&&"video"==r.remoteVideo.tagName.toLowerCase()&&(r.remoteVideo=document.getElementById(r.remoteVideo.id)),r.remoteVideo.volume=1}),t.on("failed",function(e){var t=e.cause;e.response;if("remote"===e.originator&&t.match("SIP;cause=200","i")&&(t="answered_elsewhere"),nucleus.getLogger().d("SIPWorker","Failed: "+t),t==c.C.causes.BYE||t==c.C.causes.CANCELED)return void r.sipReconnection();r.conferenceCallListener(!1),t==c.C.causes.CONNECTION_ERROR?r.callListener.onCallFailed(r.engine.session,CubeStateCode.ConnectionFailed):t==c.C.causes.REQUEST_TIMEOUT?r.callListener.onCallFailed(r.engine.session,CubeStateCode.RequestTimeout):t==c.C.causes.INTERNAL_ERROR?r.callListener.onCallFailed(r.engine.session,CubeStateCode.WorkerStateException):r.callListener.onCallFailed(r.engine.session,CubeStateCode.Unknown),r.clear()}),t.on("newDTMF",function(e){e.originator}),t.on("ended",function(e){e.cause;r.clear(),r.callListener.onCallEnded(r.engine.session)}),r.direction==CubeCallDirection.Incoming&&r.callListener.onCall(r.direction,r.engine.session,r.videoEnabled)}}]),e}()},13:function(e,t,n){"use strict";var r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":i(window))&&(r=window)}e.exports=r},156:function(e,t,n){"use strict";var r=n(100),i=n(99),o=n(61),s=n(62),a=n(98),c=n(97);!function(e){e.CubeSIPServiceWorker=r.SIPServiceWorker,e.CubeErizoServiceWorker=i.ErizoServiceWorker,e.CubeConferenceServiceWorker=a.ConferenceServiceWorker,e.CubeConferenceListener=o.ConferenceListener,e.CubeConferenceType=s.ConferenceType,e.CubeConferenceConfig=c.ConferenceConfig}(window)},157:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.ConferenceService=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"create",value:function(e){}},{key:"destory",value:function(e){}},{key:"applyJoin",value:function(e){}},{key:"quit",value:function(e){}},{key:"rejectApply",value:function(e,t){}},{key:"acceptApply",value:function(e,t){}},{key:"inviteMembers",value:function(e,t){}},{key:"rejectInvite",value:function(e,t){}},{key:"acceptInvite",value:function(e,t){}},{key:"setAudioEnabled",value:function(e,t){}},{key:"setVideoEnabled",value:function(e,t){}},{key:"addPresenter",value:function(e,t){}},{key:"removePresenter",value:function(e,t){}},{key:"changeSpeaker",value:function(e,t,n){}},{key:"setMemberDeaf",value:function(e,t,n,r){}},{key:"setMemberMute",value:function(e,t,n,r){}},{key:"setMemberWatch",value:function(e,t,n,r){}},{key:"kickMember",value:function(e,t,n){}},{key:"isConference",value:function(e){}},{key:"parse",value:function(e,t){}},{key:"getCapturedCameraImages",value:function(e,t,n){}},{key:"getLocalView",value:function(){}},{key:"getRemoteView",value:function(){}},{key:"queryConferences",value:function(e,t,n){}},{key:"queryAllConference",value:function(e){}}]),t}(CubeService)},158:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.Conference=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.host=null,o.port=null,o.sslPort=null,o.number=null,o.status=[],o.actions=[],o}return o(t,e),t}(CubeGroup)},159:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlAction={HEAR:"deaf",VMUTE:"vmute",MUTE:"mute",VOICE:"voice",VIDEO:"video",KICK:"kick",SPEAKER:"floor",PRESENTER:"presenter",MEDIA:"media",UNKNOWN:"unknown"}},160:function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();window.Erizo=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=25)}([function(e,t,n){var r=function(){var e="",t=void 0,n=function(e){var t=e;e>r.NONE?t=r.NONE:e<r.DEBUG&&(t=r.DEBUG),r.logLevel=t};return t=function(e){var t;(t=console).log.apply(t,s(e))},{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:n,setOutputFunction:function(e){t=e},setLogPrefix:function(t){e=t},log:function(n){for(var i=arguments.length,o=Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];var a=e;if(!(n<r.logLevel)){n===r.DEBUG?a+="DEBUG":n===r.TRACE?a+="TRACE":n===r.INFO?a+="INFO":n===r.WARNING?a+="WARNING":n===r.ERROR&&(a+="ERROR"),a+=": ";var c=[a].concat(o);if(void 0!==r.panel){for(var l="",u=0;u<c.length;u+=1)l+=c[u];r.panel.value=r.panel.value+"\n"+l}else t.apply(r,[c])}},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.log.apply(r,[r.DEBUG].concat(t))},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.log.apply(r,[r.TRACE].concat(t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.log.apply(r,[r.INFO].concat(t))},warning:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.log.apply(r,[r.WARNING].concat(t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.log.apply(r,[r.ERROR].concat(t))}}}();t.a=r},function(e,t,n){n.d(t,"b",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return u}),n.d(t,"f",function(){return d}),n.d(t,"a",function(){return l});var r=n(0),i=function(){var e={},t={eventListeners:{}};return e.addEventListener=function(e,n){void 0===t.eventListeners[e]&&(t.eventListeners[e]=[]),t.eventListeners[e].push(n)},e.removeEventListener=function(e,n){if(t.eventListeners[e]){var r=t.eventListeners[e].indexOf(n);-1!==r&&t.eventListeners[e].splice(r,1)}},e.removeAllListeners=function(){t.eventListeners={}},e.dispatchEvent=function(e){if(!e||!e.type)throw new Error("Undefined event");r.a.debug("Event: "+e.type);for(var n=t.eventListeners[e.type]||[],i=0;i<n.length;i+=1)n[i](e)},e.on=e.addEventListener,e.off=e.removeEventListener,e.emit=e.dispatchEvent,e},s=function(){function e(){o(this,e),this.emitter=i()}return c(e,[{key:"addEventListener",value:function(e,t){this.emitter.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.emitter.removeEventListener(e,t)}},{key:"dispatchEvent",value:function(e){this.emitter.dispatchEvent(e)}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"emit",value:function(e){this.dispatchEvent(e)}}]),e}(),a=function(e){var t={};return t.type=e.type,t},l=function(e){var t=a(e);return t.stream=e.stream,t.state=e.state,t},u=function(e){var t=a(e);return t.streams=e.streams,t.message=e.message,t},d=function(e){var t=a(e);return t.stream=e.stream,t.msg=e.msg,t.bandwidth=e.bandwidth,t.attrs=e.attrs,t}},function(e,t,n){var r=n(5),i=r("SEND","RECV");i.byValue=function(e){return i[e.toUpperCase()]},i.toString=function(e){switch(e){case i.SEND:return"send";case i.RECV:return"recv";default:return"unknown"}},i.reverse=function(e){switch(e){case i.SEND:return i.RECV;case i.RECV:default:return i.SEND}},e.exports=i},function(e,t,n){var r=n(1),i=function(){var e=Object(r.b)({});return e.url="",e};t.a=i},function(e,t,n){var r=n(5),i=r("ACTIVE","PASSIVE","ACTPASS","INACTIVE");i.byValue=function(e){return i[e.toUpperCase()]},i.toString=function(e){switch(e){case i.ACTIVE:return"active";case i.PASSIVE:return"passive";case i.ACTPASS:return"actpass";case i.INACTIVE:return"inactive";default:return null}},i.reverse=function(e){switch(e){case i.ACTIVE:return i.PASSIVE;case i.PASSIVE:return i.ACTIVE;case i.ACTPASS:return i.PASSIVE;case i.INACTIVE:return i.INACTIVE;default:return i.ACTIVE}},e.exports=i},function(e,t){function n(){for(var e=this,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];if(!(this instanceof n))return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.call(r))));Array.from(r).forEach(function(t){e[t]=Symbol.for("LICODE_SEMANTIC_SDP_"+t)})}e.exports=n},function(e,t,n){var r=n(5),i=r("SENDRECV","SENDONLY","RECVONLY","INACTIVE");i.byValue=function(e){return i[e.toUpperCase()]},i.toString=function(e){switch(e){case i.SENDRECV:return"sendrecv";case i.SENDONLY:return"sendonly";case i.RECVONLY:return"recvonly";case i.INACTIVE:return"inactive";default:return"unknown"}},i.reverse=function(e){switch(e){case i.SENDRECV:return i.SENDRECV;case i.SENDONLY:return i.RECVONLY;case i.RECVONLY:return i.SENDONLY;case i.INACTIVE:return i.INACTIVE;default:return i.SENDRECV}},e.exports=i},function(e,t,n){var r=function(){var e={},t={};return e.add=function(e,n){t[e]=n},e.get=function(e){return t[e]},e.has=function(e){return void 0!==t[e]},e.size=function(){return Object.keys(t).length},e.forEach=function(e){for(var n=Object.keys(t),r=0;r<n.length;r+=1){var i=n[r];e(t[i],i)}},e.keys=function(){return Object.keys(t)},e.remove=function(e){delete t[e]},e.clear=function(){t={}},e};t.a=r},function(e,t,n){(function(e){var r=n(0),i=function(){var t="none";return void 0!==e&&e.exports?t="fake":null!==window.navigator.userAgent.match("Firefox")?t="mozilla":null!==window.navigator.userAgent.match("Chrome")?(t="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(t="electron")):null!==window.navigator.userAgent.match("Safari")?t="safari":null!==window.navigator.userAgent.match("AppleWebKit")&&(t="safari"),t},o=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=void 0,a=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t).catch(n)};t.screen?function(){switch(r.a.debug("Screen access requested"),i()){case"electron":r.a.debug("Screen sharing in Electron"),s={},s.video=t.video||{},s.video.mandatory=t.video.mandatory||{},s.video.mandatory.chromeMediaSource="desktop",s.video.mandatory.chromeMediaSourceId=t.desktopStreamId,a(s,n,o);break;case"mozilla":r.a.debug("Screen sharing in Firefox"),s={},void 0!==t.video?(s.video=t.video,s.video.mediaSource||(s.video.mediaSource="window")):s={audio:t.audio,video:{mediaSource:"window"}},a(s,n,o);break;case"chrome-stable":if(r.a.debug("Screen sharing in Chrome"),s={},t.desktopStreamId)s.video=t.video||{mandatory:{}},s.video.mandatory=s.video.mandatory||{},s.video.mandatory.chromeMediaSource="desktop",s.video.mandatory.chromeMediaSourceId=t.desktopStreamId,a(s,n,o);else{var e="okeephmleflklcdebijnponpabbmmgeo";t.extensionId&&(r.a.debug("extensionId supplied, using "+t.extensionId),e=t.extensionId),r.a.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(e,{getStream:!0},function(e){if(void 0===e){r.a.error("Access to screen denied");return void o({code:"Access to screen denied"})}var i=e.streamId;void 0!==t.video.mandatory?(s.video=t.video||{mandatory:{}},s.video.mandatory.chromeMediaSource="desktop",s.video.mandatory.chromeMediaSourceId=i):s={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i}}},a(s,n,o)})}catch(e){r.a.debug("Screensharing plugin is not accessible ");var c={code:"no_plugin_present"};o(c)}}break;default:r.a.error("This browser does not support ScreenSharing")}}():void 0!==e&&e.exports?r.a.error("Video/audio streams not supported in erizofc yet"):(r.a.debug("Calling getUserMedia with config",t),a(t,n,o))},s={GetUserMedia:o,getBrowser:i};t.a=s}).call(t,n(39)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":a(window))&&(n=window)}e.exports=n},function(e,t,n){var r=n(29),i=n.n(r),o=n(22),s=n(0),c=function(e){var t={},n=e,r=[],c=void 0,l=void 0,u=void 0,d=void 0,f=void 0,h=!1,p=-1;s.a.info("Starting Base stack",n),t.pcConfig={iceServers:[],sdpSemantics:"plan-b"},t.con={},void 0!==n.iceServers&&(t.pcConfig.iceServers=n.iceServers),!0===n.forceTurn&&(t.pcConfig.iceTransportPolicy="relay"),t.audio=n.audio,t.video=n.video,void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),n.remoteCandidates=[],n.localCandidates=[],n.remoteDescriptionSet=!1,t.mediaConstraints={offerToReceiveVideo:void 0!==t.video&&!1!==t.video,offerToReceiveAudio:void 0!==t.audio&&!1!==t.audio},t.peerConnection=new RTCPeerConnection(t.pcConfig,t.con);var m=function(e,t,n){s.a.error("message:",n,"in baseStack at",e),void 0!==t&&t("error")},g=function(e){s.a.info("Success in BaseStack",e)},v=function(e){var t={},r=e.candidate;r?(t={sdpMLineIndex:r.sdpMLineIndex,sdpMid:r.sdpMid,candidate:r.candidate},t.candidate.match(/a=/)||(t.candidate="a="+t.candidate)):(s.a.info("Gathered all candidates. Sending END candidate"),t={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"}),n.remoteDescriptionSet?n.callback({type:"candidate",candidate:t}):(n.localCandidates.push(t),s.a.info("Storing candidate: ",n.localCandidates.length,t))},y=function(){if(!h&&r.length>0){var e=r.pop();"local"===e[0]?t.createOffer(e[1],e[2],e[3]):f(e[1])}},C=function(e,r,s){c=s,e||(c.sdp=t.enableSimulcast(c.sdp)),u=i.a.SDPInfo.processString(c.sdp),o.a.setMaxBW(u,n),c.sdp=u.toString(),t.localSdp=u,n.callback({type:c.type,sdp:c.sdp,config:{maxVideoBW:n.maxVideoBW}},r)},b=function(e){c=e,u=i.a.SDPInfo.processString(c.sdp),o.a.setMaxBW(u,n),c.sdp=u.toString(),t.localSdp=u,n.callback({type:c.type,sdp:c.sdp,config:{maxVideoBW:n.maxVideoBW}}),s.a.info("Setting local description",c),t.peerConnection.setLocalDescription(c).then(function(){h=!1,y(),g()}).catch(m)};f=function(e){var s=e;if(h)return void r.push(["remote",e]);h=!0,d=i.a.SDPInfo.processString(s.sdp),o.a.setMaxBW(d,n),s.sdp=d.toString(),t.remoteSdp=d,t.peerConnection.setRemoteDescription(s).then(function(){t.peerConnection.createAnswer(t.mediaConstraints).then(b).catch(m.bind(null,"createAnswer",void 0)),n.remoteDescriptionSet=!0}).catch(m.bind(null,"process Offer",void 0))};var S=function(e){var r=e;d=i.a.SDPInfo.processString(r.sdp);var a=d&&d.origin&&d.origin.sessionVersion;p>=a||(s.a.info("Set remote and local description"),p=a,o.a.setMaxBW(d,n),t.setStartVideoBW(d),t.setHardMinVideoBW(d),r.sdp=d.toString(),s.a.debug("Remote Description",r.sdp),s.a.debug("Local Description",c.sdp),t.remoteSdp=d,l=r,t.peerConnection.setLocalDescription(c).then(function(){t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).then(function(){for(n.remoteDescriptionSet=!0,s.a.info("Candidates to be added: ",n.remoteCandidates.length,n.remoteCandidates);n.remoteCandidates.length>0;)t.peerConnection.addIceCandidate(n.remoteCandidates.shift());for(s.a.info("Local candidates to send:",n.localCandidates.length);n.localCandidates.length>0;)n.callback({type:"candidate",candidate:n.localCandidates.shift()});h=!1,y()}).catch(m.bind(null,"processAnswer",void 0))}).catch(m.bind(null,"processAnswer",void 0)))},T=function(e){var r=e;try{var i=void 0;if(i="object"===a(r.candidate)?r.candidate:JSON.parse(r.candidate),"end"===i.candidate)return;i.candidate=i.candidate.replace(/a=/g,""),i.sdpMLineIndex=parseInt(i.sdpMLineIndex,10);var o=new RTCIceCandidate(i);n.remoteDescriptionSet?t.peerConnection.addIceCandidate(o):n.remoteCandidates.push(o)}catch(e){s.a.error("Error parsing candidate",r.candidate)}};return t.peerConnection.onicecandidate=v,t.setStartVideoBW=function(e){return s.a.error("startVideoBW not implemented for this browser"),e},t.setHardMinVideoBW=function(e){return s.a.error("hardMinVideoBw not implemented for this browser"),e},t.enableSimulcast=function(e){return s.a.error("Simulcast not implemented"),e},t.close=function(){t.state="closed",t.peerConnection.close()},t.setSimulcast=function(e){t.simulcast=e},t.setVideo=function(e){t.video=e},t.setAudio=function(e){t.audio=e},t.updateSpec=function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},f=e,h=n.p2p&&f.maxVideoBW,p=!n.p2p&&f.maxVideoBW;(h||f.maxAudioBW)&&(f.maxVideoBW&&(s.a.debug("Maxvideo Requested:",f.maxVideoBW,"limit:",n.limitMaxVideoBW),f.maxVideoBW>n.limitMaxVideoBW&&(f.maxVideoBW=n.limitMaxVideoBW),n.maxVideoBW=f.maxVideoBW,s.a.debug("Result",n.maxVideoBW)),f.maxAudioBW&&(f.maxAudioBW>n.limitMaxAudioBW&&(f.maxAudioBW=n.limitMaxAudioBW),n.maxAudioBW=f.maxAudioBW),u=i.a.SDPInfo.processString(c.sdp),o.a.setMaxBW(u,n),c.sdp=u.toString(),t.localSdp=u,f.Sdp||f.maxAudioBW?(s.a.debug("Updating with SDP renegotiation",n.maxVideoBW,n.maxAudioBW),t.peerConnection.setLocalDescription(c).then(function(){return d=i.a.SDPInfo.processString(l.sdp),o.a.setMaxBW(d,n),l.sdp=d.toString(),t.remoteSdp=d,t.peerConnection.setRemoteDescription(new RTCSessionDescription(l))}).then(function(){n.remoteDescriptionSet=!0,n.callback({type:"updatestream",sdp:c.sdp},r)}).catch(m.bind(null,"updateSpec",a))):(s.a.debug("Updating without SDP renegotiation, newVideoBW:",n.maxVideoBW,"newAudioBW:",n.maxAudioBW),n.callback({type:"updatestream",sdp:c.sdp},r))),(p||f.minVideoBW||void 0!==f.slideShowMode||void 0!==f.muteStream||void 0!==f.qualityLayer||void 0!==f.slideShowBelowLayer||void 0!==f.video)&&(s.a.debug("MaxVideoBW Changed to ",f.maxVideoBW),s.a.debug("MinVideo Changed to ",f.minVideoBW),s.a.debug("SlideShowMode Changed to ",f.slideShowMode),s.a.debug("muteStream changed to ",f.muteStream),s.a.debug("Video Constraints",f.video),s.a.debug("Will activate slideshow when below layer",f.slideShowBelowLayer),n.callback({type:"updatestream",config:f},r))},t.createOffer=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e||n||(t.mediaConstraints={offerToReceiveVideo:!1,offerToReceiveAudio:!1}),h)return void r.push(["local",e,n,i]);h=!0,s.a.debug("Creating offer",t.mediaConstraints,i),t.peerConnection.createOffer(t.mediaConstraints).then(C.bind(null,e,i)).catch(m.bind(null,"Create Offer",void 0))},t.addStream=function(e){t.peerConnection.addStream(e)},t.removeStream=function(e){t.peerConnection.removeStream(e)},t.processSignalingMessage=function(e){"offer"===e.type?f(e):"answer"===e.type?S(e):"candidate"===e.type&&T(e)},t};t.a=c},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t){var n=function(){function e(t,n,r,i,s,a,c,l,u,d){o(this,e),this.foundation=t,this.componentId=n,this.transport=r,this.priority=i,this.address=s,this.port=a,this.type=c,this.generation=l,this.relAddr=u,this.relPort=d}return c(e,[{key:"clone",value:function(){return new e(this.foundation,this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.generation,this.relAddr,this.relPort)}},{key:"plain",value:function(){var e={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type,generation:this.generation};return this.relAddr&&(e.relAddr=this.relAddr),this.relPort&&(e.relPort=this.relPort),e}},{key:"getFoundation",value:function(){return this.foundation}},{key:"getComponentId",value:function(){return this.componentId}},{key:"getTransport",value:function(){return this.transport}},{key:"getPriority",value:function(){return this.priority}},{key:"getAddress",value:function(){return this.address}},{key:"getPort",value:function(){return this.port}},{key:"getType",value:function(){return this.type}},{key:"getGeneration",value:function(){return this.generation}},{key:"getRelAddr",value:function(){return this.relAddr}},{key:"getRelPort",value:function(){return this.relPort}}]),e}();e.exports=n},function(e,t){var n=function(){function e(t,n,r,i,s,a){o(this,e),this.codec=t,this.type=n,this.rate=r,this.encoding=i,this.params=s||{},this.feedback=a||[]}return c(e,[{key:"clone",value:function(){var t=new e(this.codec,this.type,this.rate,this.encoding,this.params,this.feedback);return this.rtx&&t.setRTX(this.rtx),t}},{key:"plain",value:function(){return{codec:this.codec,type:this.type,rate:this.rate,encoding:this.encoding,params:this.params,feedback:this.feedback}}},{key:"setRTX",value:function(e){this.rtx=e}},{key:"getType",value:function(){return this.type}},{key:"setType",value:function(e){this.type=e}},{key:"getCodec",value:function(){return this.codec}},{key:"getParams",value:function(){return this.params}},{key:"setParam",value:function(e,t){this.params[e]=t}},{key:"hasRTX",value:function(){return this.rtx}},{key:"getRTX",value:function(){return this.rtx}},{key:"getRate",value:function(){return this.rate}},{key:"getEncoding",value:function(){return this.encoding}},{key:"getFeedback",value:function(){return this.feedback}}]),e}();n.mapFromNames=function(e,t){var r=new Map,i=96;return e.forEach(function(e){var o=void 0,s=e.toLowerCase();"pcmu"===s?o=0:"pcma"===s?o=8:(i+=1,o=i);var a=new n(s,o);t&&"ulpfec"!==s&&"flexfec-03"!==s&&"red"!==s&&(i+=1,a.setRTX(i)),r.set(a.getCodec().toLowerCase(),a)}),r},e.exports=n},function(e,t,n){var r=n(4),i=function(){function e(t,n,r){o(this,e),this.setup=t,this.hash=n,this.fingerprint=r}return c(e,[{key:"clone",value:function(){return new e(this.setup,this.hash,this.fingerprint)}},{key:"plain",value:function(){return{setup:r.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}}},{key:"getFingerprint",value:function(){return this.fingerprint}},{key:"getHash",value:function(){return this.hash}},{key:"getSetup",value:function(){return this.setup}},{key:"setSetup",value:function(e){this.setup=e}}]),e}();e.exports=i},function(e,t){function n(e,t){var n=t-e+1,r=Math.random()*n;return Math.floor(r+e)}function r(e){for(var t=new Uint8Array(e),r=0;r<t.length;r+=1)t[r]=n(0,255);return t}function i(e){return Array.prototype.map.call(new Uint8Array(e),function(e){return("00"+e.toString(16)).slice(-2)}).join("")}var s=function(){function e(t,n,r){o(this,e),this.ufrag=t,this.pwd=n,this.opts=r,this.lite=!1,this.endOfCandidates=!1}return c(e,[{key:"clone",value:function(){var t=new e(this.ufrag,this.pwd,this.opts);return t.setLite(this.lite),t.setEndOfCandidates(this.endOfCandidates),t}},{key:"plain",value:function(){var e={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(e.lite=this.lite),this.endOfCandidates&&(e.endOfCandidates=this.endOfCandidates),e}},{key:"getUfrag",value:function(){return this.ufrag}},{key:"getPwd",value:function(){return this.pwd}},{key:"isLite",value:function(){return this.lite}},{key:"getOpts",value:function(){return this.opts}},{key:"setLite",value:function(e){this.lite=e}},{key:"isEndOfCandidates",value:function(){return this.endOfCandidates}},{key:"setEndOfCandidates",value:function(e){this.endOfCandidates=e}}]),e}();s.generate=function(){var e=new s,t=r(8),n=r(24);return e.ufrag=i(t),e.pwd=i(n),e},e.exports=s},function(e,t,n){var r=n(17),i=n(6),s=n(2),a=function(){function e(t,n,r){o(this,e),this.id=t,this.type=r,this.port=n,this.direction=i.SENDRECV,this.extensions=new Map,this.codecs=new Map,this.rids=new Map,this.simulcast=null,this.simulcast_03=null,this.bitrate=0,this.ice=null,this.dtls=null,this.connection=null,this.candidates=[]}return c(e,[{key:"clone",value:function(){var t=new e(this.id,this.port,this.type);return t.setDirection(this.direction),t.setBitrate(this.bitrate),t.setConnection(this.connection),this.codecs.forEach(function(e){t.addCodec(e.clone())}),this.extensions.forEach(function(e,n){t.addExtension(n,e)}),this.rids.forEach(function(e,n){t.addRID(n,e.clone())}),this.simulcast&&t.setSimulcast(this.simulcast.clone()),this.xGoogleFlag&&t.setXGoogleFlag(this.xGoogleFlag),this.ice&&t.setICE(this.ice.clone()),this.dtls&&t.setDTLS(this.dtls.clone()),this.candidates.forEach(function(e){t.addCandidate(e.clone())}),this.setup&&t.setSetup(this.setup),t}},{key:"plain",value:function(){var e={id:this.id,port:this.port,type:this.type,connection:this.connection,direction:i.toString(this.direction),xGoogleFlag:this.xGoogleFlag,extensions:{},rids:[],codecs:[],candidates:[]};return this.bitrate&&(e.bitrate=this.bitrate),this.codecs.forEach(function(t){e.codecs.push(t.plain())}),this.extensions.forEach(function(t){e.extensions.push(t.plain())}),this.rids.forEach(function(t){e.rids.push(t.plain())}),this.simulcast&&(e.simulcast=this.simulcast.plain()),this.candidates.forEach(function(t){e.candidates.push(t.plain())}),e.ice=this.ice&&this.ice.plain(),e.dtls=this.dtls&&this.dtls.plain(),e}},{key:"getType",value:function(){return this.type}},{key:"getPort",value:function(){return this.port}},{key:"getId",value:function(){return this.id}},{key:"addExtension",value:function(e,t){this.extensions.set(e,t)}},{key:"addRID",value:function(e){this.rids.set(e.getId(),e)}},{key:"addCodec",value:function(e){this.codecs.set(e.getType(),e)}},{key:"getCodecForType",value:function(e){return this.codecs.get(e)}},{key:"getCodec",value:function(e){var t=void 0;return this.codecs.forEach(function(n){n.getCodec().toLowerCase()===e.toLowerCase()&&(t=n)}),t}},{key:"hasCodec",value:function(e){return null!==this.getCodec(e)}},{key:"getCodecs",value:function(){return this.codecs}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getRIDs",value:function(){return this.rids}},{key:"getRID",value:function(e){return this.rids.get(e)}},{key:"getBitrate",value:function(){return this.bitrate}},{key:"setBitrate",value:function(e){this.bitrate=e}},{key:"getDirection",value:function(){return this.direction}},{key:"setDirection",value:function(e){this.direction=e}},{key:"getDTLS",value:function(){return this.dtls}},{key:"setDTLS",value:function(e){this.dtls=e}},{key:"getICE",value:function(){return this.ice}},{key:"setICE",value:function(e){this.ice=e}},{key:"addCandidate",value:function(e){this.candidates.push(e)}},{key:"addCandidates",value:function(e){var t=this;e.forEach(function(e){t.addCandidate(e)})}},{key:"getCandidates",value:function(){return this.candidates}},{key:"setXGoogleFlag",value:function(e){this.xGoogleFlag=e}},{key:"getXGoogleFlag",value:function(){return this.xGoogleFlag}},{key:"getConnection",value:function(){return this.connection}},{key:"setConnection",value:function(e){this.connection=e}},{key:"answer",value:function(t){var n=new e(this.id,this.port,this.type);if(n.setDirection(i.reverse(this.direction)),t.codecs&&this.codecs.forEach(function(e){if(t.codecs.has(e.getCodec().toLowerCase())){var r=t.codecs.get(e.getCodec().toLowerCase()).clone();r.setType(e.getType()),r.hasRTX()&&r.setRTX(e.getRTX()),n.addCodec(r)}}),this.extensions.forEach(function(e,r){t.extensions.has(r)&&n.addExtension(r,e)}),t.simulcast&&this.simulcast){var o=new r,a=this.simulcast.getSimulcastStreams(s.SEND);a&&a.forEach(function(e){var t=[];e.forEach(function(e){t.push(e.clone())}),o.addSimulcastAlternativeStreams(s.RECV,t)});var c=this.simulcast.getSimulcastStreams(s.RECV);c&&c.forEach(function(e){var t=[];e.forEach(function(e){t.push(e.clone())}),o.addSimulcastAlternativeStreams(s.SEND,t)}),this.rids.forEach(function(e){var t=e.clone();t.setDirection(s.reverse(e.getDirection())),n.addRID(t)}),n.setSimulcast(o)}return n}},{key:"getSimulcast",value:function(){return this.simulcast}},{key:"setSimulcast",value:function(e){this.simulcast=e}},{key:"getSimulcast03",value:function(){return this.simulcast_03}},{key:"setSimulcast03",value:function(e){this.simulcast_03=e}},{key:"getSetup",value:function(){return this.setup}},{key:"setSetup",value:function(e){this.setup=e}}]),e}();e.exports=a},function(e,t,n){var r=n(2),i=function(){function e(){o(this,e),this.send=[],this.recv=[],this.plainString=null}return c(e,[{key:"clone",value:function(){var t=new e;return this.send.forEach(function(e){var n=[];e.forEach(function(e){n.push(e.clone())}),t.addSimulcastAlternativeStreams(n)}),this.recv.forEach(function(e){var n=[];e.forEach(function(e){n.push(e.clone())}),t.addSimulcastAlternativeStreams(n)}),t}},{key:"plain",value:function(){var e={send:[],recv:[]};return this.send.forEach(function(t){var n=[];t.forEach(function(e){n.push(e.plain())}),e.send.push(n)}),this.recv.forEach(function(t){var n=[];t.forEach(function(e){n.push(e.plain())}),e.recv.push(n)}),e}},{key:"addSimulcastAlternativeStreams",value:function(e,t){return e===r.SEND?this.send.push(t):this.recv.push(t)}},{key:"addSimulcastStream",value:function(e,t){return e===r.SEND?this.send.push([t]):this.recv.push([t])}},{key:"getSimulcastStreams",value:function(e){return e===r.SEND?this.send:this.recv}},{key:"setSimulcastPlainString",value:function(e){this.plainString=e}},{key:"getSimulcastPlainString",value:function(){return this.plainString}}]),e}();e.exports=i},function(e,t){var n=function(){function e(t,n){var r=this;o(this,e),this.semantics=t,this.ssrcs=[],n.forEach(function(e){r.ssrcs.push(parseInt(e,10))})}return c(e,[{key:"clone",value:function(){return new e(this.semantics,this.ssrcs)}},{key:"plain",value:function(){var e={semantics:this.semantics,ssrcs:[]};return e.ssrcs=this.ssrcs,e}},{key:"getSemantics",value:function(){return this.semantics}},{key:"getSSRCs",value:function(){return this.ssrcs}}]),e}();e.exports=n},function(e,t){var n=function(){function e(t){o(this,e),this.ssrc=t}return c(e,[{key:"clone",value:function(){var t=new e(this.ssrc);t.setCName(this.cname),t.setStreamId(this.streamId),this.setTrackId(this.trackId)}},{key:"plain",value:function(){var e={ssrc:this.ssrc};return this.cname&&(e.cname=this.cname),this.label&&(e.label=this.label),this.mslabel&&(e.mslabel=this.mslabel),this.streamId&&(e.streamId=this.streamId),this.trackId&&(e.trackid=this.trackId),e}},{key:"getCName",value:function(){return this.cname}},{key:"setCName",value:function(e){this.cname=e}},{key:"getStreamId",value:function(){return this.streamId}},{key:"setStreamId",value:function(e){this.streamId=e}},{key:"getTrackId",value:function(){return this.trackId}},{key:"setTrackId",value:function(e){this.trackId=e}},{key:"getMSLabel",value:function(){return this.mslabel}},{key:"setMSLabel",value:function(e){this.mslabel=e}},{key:"getLabel",value:function(){return this.label}},{key:"setLabel",value:function(e){this.label=e}},{key:"getSSRC",value:function(){return this.ssrc}}]),e}();e.exports=n},function(e,t){var n=function(){function e(t){o(this,e),this.id=t,this.tracks=new Map}return c(e,[{key:"clone",value:function(){var t=new e(this.id);return this.tracks.forEach(function(e){t.addTrack(e.clone())}),t}},{key:"plain",value:function(){var e={id:this.id,tracks:[]};return this.tracks.forEach(function(t){e.tracks.push(t.plain())}),e}},{key:"getId",value:function(){return this.id}},{key:"addTrack",value:function(e){this.tracks.set(e.getId(),e)}},{key:"getFirstTrack",value:function(e){var t=void 0;return this.tracks.forEach(function(n){n.getMedia().toLowerCase()===e.toLowerCase()&&(t=n)}),t}},{key:"getTracks",value:function(){return this.tracks}},{key:"removeAllTracks",value:function(){this.tracks.clear()}},{key:"getTrack",value:function(e){return this.tracks.get(e)}}]),e}();e.exports=n},function(e,t){var n=function(){function e(t,n){o(this,e),this.media=t,this.id=n,this.ssrcs=[],this.groups=[],this.encodings=[]}return c(e,[{key:"clone",value:function(){var t=new e(this.media,this.id);return this.mediaId&&t.setMediaId(this.mediaId),this.ssrcs.forEach(function(e){t.addSSRC(e)}),this.groups.forEach(function(e){t.addSourceGroup(e.clone())}),this.encodings.forEach(function(e){var n=[];e.forEach(function(e){n.push(e.cloned())}),t.addAlternativeEncoding(n)}),t}},{key:"plain",value:function(){var e={media:this.media,id:this.id,ssrcs:[],groups:[],encodings:[]};return this.mediaId&&(e.mediaId=this.mediaId),this.ssrcs.forEach(function(t){e.ssrcs.push(t)}),this.groups.forEach(function(t){e.groups.push(t.plain())}),this.encodings.forEach(function(t){var n=[];t.forEach(function(e){n.push(e.plain())}),e.encodings.push(n)}),e}},{key:"getMedia",value:function(){return this.media}},{key:"setMediaId",value:function(e){this.mediaId=e}},{key:"getMediaId",value:function(){return this.mediaId}},{key:"getId",value:function(){return this.id}},{key:"addSSRC",value:function(e){this.ssrcs.push(e)}},{key:"getSSRCs",value:function(){return this.ssrcs}},{key:"addSourceGroup",value:function(e){this.groups.push(e)}},{key:"getSourceGroup",value:function(e){var t=void 0;return this.groups.forEach(function(n){n.getSemantics().toLowerCase()===e.toLowerCase()&&(t=n)}),t}},{key:"getSourceGroups",value:function(){return this.groups}},{key:"hasSourceGroup",value:function(e){var t=!1;return this.groups.forEach(function(n){n.getSemantics().toLowerCase()===e.toLowerCase()&&(t=!0)}),t}},{key:"getEncodings",value:function(){return this.encodings}},{key:"addAlternaticeEncodings",value:function(e){this.encodings.push(e)}},{key:"setEncodings",value:function(e){this.encodings=e}}]),e}();e.exports=n},function(e,t,n){var r={};r.addSim=function(e){var t="a=ssrc-group:SIM";return e.forEach(function(e){t+=" "+e}),t+"\r\n"},r.addGroup=function(e,t){return"a=ssrc-group:FID "+e+" "+t+"\r\n"},r.addSpatialLayer=function(e,t,n,r,i,o){return"a=ssrc:"+i+" cname:"+e+"\r\na=ssrc:"+i+" msid:"+t+"\r\na=ssrc:"+i+" mslabel:"+n+"\r\na=ssrc:"+i+" label:"+r+"\r\na=ssrc:"+o+" cname:"+e+"\r\na=ssrc:"+o+" msid:"+t+"\r\na=ssrc:"+o+" mslabel:"+n+"\r\na=ssrc:"+o+" label:"+r+"\r\n"},r.setMaxBW=function(e,t){if(t.p2p){if(t.video&&t.maxVideoBW){var n=e.getMedia("video");n&&n.setBitrate(t.maxVideoBW)}if(t.audio&&t.maxAudioBW){var r=e.getMedia("audio");r&&r.setBitrate(t.maxAudioBW)}}},r.enableOpusNacks=function(e){var t=e,n=t.match(/a=rtpmap:(.*)opus.*\r\n/);if(null!==n){var r=n[0]+"a=rtcp-fb:"+n[1]+"nack\r\n";t=t.replace(n[0],r)}return t},r.setParamForCodecs=function(e,t,n,r){e.medias.forEach(function(e){e.id===t&&e.codecs.forEach(function(e){e.setParam(n,r)})})},t.a=r},function(e,t,n){var r=this,i=n(1),o=n(8),s=n(7),c=n(46),l=n(48),u=n(0),d=function(e,t){var n=t,d=Object(i.b)(n);d.stream=n.stream,d.url=n.url,d.recording=n.recording,d.room=void 0,d.showing=!1,d.local=!1,d.video=n.video,d.audio=n.audio,d.screen=n.screen,d.videoSize=n.videoSize,d.videoFrameRate=n.videoFrameRate,d.extensionId=n.extensionId,d.desktopStreamId=n.desktopStreamId,d.audioMuted=!1,d.videoMuted=!1,d.p2p=!1,d.ConnectionHelpers=void 0===e?o.a:e;var f=function(e){e.stream.id===d.getLabel()&&d.emit(Object(i.f)({type:"added",stream:e.stream}))},h=function(e){e.stream.id===d.getLabel()&&d.emit(Object(i.f)({type:"removed",stream:d}))},p=function(e){d.emit(Object(i.f)({type:"icestatechanged",msg:e}))};if(!(void 0===d.videoSize||d.videoSize instanceof Array&&4===d.videoSize.length))throw Error("Invalid Video Size");void 0!==n.local&&!0!==n.local||(d.local=!0),d.getID=function(){return d.local&&!n.streamID?"local":n.streamID},d.getLabel=function(){return d.stream&&d.stream.id?d.stream.id:n.label},d.getAttributes=function(){return n.attributes},d.setAttributes=function(e){if(d.local)return void d.emit(Object(i.f)({type:"internal-set-attributes",stream:d,attrs:e}));u.a.error("Failed to set attributes data. This Stream object has not been published.")},d.updateLocalAttributes=function(e){n.attributes=e},d.hasAudio=function(){return!1!==n.audio&&void 0!==n.audio},d.hasVideo=function(){return!1!==n.video&&void 0!==n.video},d.hasData=function(){return!1!==n.data&&void 0!==n.data},d.hasScreen=function(){return n.screen},d.hasMedia=function(){return n.audio||n.video||n.screen},d.isExternal=function(){return void 0!==d.url||void 0!==d.recording},d.addPC=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t)return d.p2p=!0,void 0===d.pc&&(d.pc=Object(s.a)()),d.pc.add(t,e),void e.on("ice-state-change",p);d.pc&&(d.pc.off("add-stream",f),d.pc.off("remove-stream",h),d.pc.off("ice-state-change",p)),d.pc=e,d.pc.on("add-stream",f),d.pc.on("remove-stream",h),d.pc.on("ice-state-change",p)},d.sendData=function(e){if(d.local&&d.hasData())return void d.emit(Object(i.f)({type:"internal-send-data",stream:d,msg:e}));u.a.error("Failed to send data. This Stream object has not been published.")},d.init=function(){try{if((n.audio||n.video||n.screen)&&void 0===n.url){u.a.info("Requested access to local media");var e=n.video;!0===e||!0===n.screen?(e=!0===e||null===e?{}:e,void 0!==d.videoSize&&(e.width={min:d.videoSize[0],max:d.videoSize[2]},e.height={min:d.videoSize[1],max:d.videoSize[3]}),void 0!==d.videoFrameRate&&(e.frameRate={min:d.videoFrameRate[0],max:d.videoFrameRate[1]})):!0===n.screen&&void 0===e&&(e=!0);var t={video:e,audio:n.audio,fake:n.fake,screen:n.screen,extensionId:d.extensionId,desktopStreamId:d.desktopStreamId};d.ConnectionHelpers.GetUserMedia(t,function(e){u.a.info("User has granted access to local media."),d.stream=e,d.dispatchEvent(Object(i.f)({type:"access-accepted"})),d.stream.getTracks().forEach(function(e){u.a.info("getTracks",e);var t=e;t.onended=function(){d.stream.getTracks().forEach(function(e){e.onended=null});var e=Object(i.f)({type:"stream-ended",stream:d,msg:t.kind});d.dispatchEvent(e)}})},function(e){u.a.error("Failed to get access to local media. Error code was "+e.code+".");var t=Object(i.f)({type:"access-denied",msg:e});d.dispatchEvent(t)})}else{var r=Object(i.f)({type:"access-accepted"});d.dispatchEvent(r)}}catch(e){u.a.error("Failed to get access to local media. Error was "+e+".");var o=Object(i.f)({type:"access-denied",msg:e});d.dispatchEvent(o)}},d.close=function(){d.local&&(void 0!==d.room&&d.room.unpublish(d),d.hide(),void 0!==d.stream&&d.stream.getTracks().forEach(function(e){var t=e;t.onended=null,t.stop()}),d.stream=void 0),d.pc&&!d.p2p?(d.pc.off("add-stream",f),d.pc.off("remove-stream",h),d.pc.off("ice-state-change",p)):d.pc&&d.p2p&&d.pc.forEach(function(e){e.off("add-stream",f),e.off("remove-stream",h),e.off("ice-state-change",p)}),d.removeAllListeners()},d.play=function(e,t){var n=t||{};d.elementID=e;var r=void 0;d.hasVideo()||d.hasScreen()?void 0!==e&&(r=Object(c.a)({id:d.getID(),stream:d,elementID:e,options:n}),d.player=r,d.showing=!0):d.hasAudio()&&(r=Object(l.a)({id:d.getID(),stream:d,elementID:e,options:n}),d.player=r,d.showing=!0)},d.stop=function(){d.showing&&void 0!==d.player&&(d.player.destroy(),d.showing=!1)},d.show=d.play,d.hide=d.stop;var m=function(){if(void 0!==d.player&&void 0!==d.stream){var e=d.player.video,t=document.defaultView.getComputedStyle(e),n=parseInt(t.getPropertyValue("width"),10),r=parseInt(t.getPropertyValue("height"),10),i=parseInt(t.getPropertyValue("left"),10),o=parseInt(t.getPropertyValue("top"),10),s=void 0;s="object"===a(d.elementID)&&"function"==typeof d.elementID.appendChild?d.elementID:document.getElementById(d.elementID);var c=document.defaultView.getComputedStyle(s),l=parseInt(c.getPropertyValue("width"),10),u=parseInt(c.getPropertyValue("height"),10),f=document.createElement("canvas");f.id="testing",f.width=l,f.height=u,f.setAttribute("style","display: none");return f.getContext("2d").drawImage(e,i,o,n,r),f}return null};d.getVideoFrameURL=function(e){var t=m();return null!==t?e?t.toDataURL(e):t.toDataURL():null},d.getVideoFrame=function(){var e=m();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},d.checkOptions=function(e,t){var n=e;!0===t?(n.audio||n.screen)&&(u.a.warning("Cannot update type of subscription"),n.audio=void 0,n.screen=void 0):!1===d.local&&(!0===n.video&&!1===d.hasVideo()&&(u.a.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),n.video=!1),!0===n.audio&&!1===d.hasAudio()&&(u.a.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),n.audio=!1)),!1===d.local&&(d.hasVideo()||!0!==n.slideShowMode||(u.a.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),n.slideShowMode=!1))};var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(d.room&&d.room.p2p)return u.a.warning("muteAudio/muteVideo are not implemented in p2p streams"),void e("error");if(d.stream)for(var t=0;t<d.stream.getVideoTracks().length;t+=1){var n=d.stream.getVideoTracks()[t];n.enabled=!d.videoMuted}var r={muteStream:{audio:d.audioMuted,video:d.videoMuted}};d.checkOptions(r,!0),d.pc&&d.pc.updateSpec(r,d.getID(),e)};d.muteAudio=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};d.audioMuted=e,g(t)},d.muteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};d.videoMuted=e,g(t)},d._setStaticQualityLayer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(d.room&&d.room.p2p)return u.a.warning("setStaticQualityLayer is not implemented in p2p streams"),void n("error");var r={qualityLayer:{spatialLayer:e,temporalLayer:t}};d.checkOptions(r,!0),d.pc.updateSpec(r,d.getID(),n)},d._setDynamicQualityLayer=function(e){if(d.room&&d.room.p2p)return u.a.warning("setDynamicQualityLayer is not implemented in p2p streams"),void e("error");var t={qualityLayer:{spatialLayer:-1,temporalLayer:-1}};d.checkOptions(t,!0),d.pc.updateSpec(t,d.getID(),e)},d._enableSlideShowBelowSpatialLayer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(d.room&&d.room.p2p)return u.a.warning("enableSlideShowBelowSpatialLayer is not implemented in p2p streams"),void n("error");var r={slideShowBelowLayer:{enabled:e,spatialLayer:t}};d.checkOptions(r,!0),u.a.debug("Calling updateSpec with config",r),d.pc.updateSpec(r,d.getID(),n)},d._setMinSpatialLayer=d._enableSlideShowBelowSpatialLayer.bind(r,!0);var v=function(e,t,n){var r=t,i=e;!0!==r&&(r=!1),i="string"==typeof i?[i]:i,i=i instanceof Array?i:[],i.length>0&&d.room.sendControlMessage(d,"control",{name:"controlhandlers",enable:n,publisherSide:r,handlers:i})};return d.disableHandlers=function(e,t){v(e,t,!1)},d.enableHandlers=function(e,t){v(e,t,!0)},d.updateConfiguration=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(void 0!==e)if(d.pc)if(d.checkOptions(e,!0),d.local)if(d.room.p2p)for(var n=0;n<d.pc.length;n+=1)d.pc[n].updateSpec(e,d.getID(),t);else d.pc.updateSpec(e,d.getID(),t);else d.pc.updateSpec(e,d.getID(),t);else t("This stream has no peerConnection attached, ignoring")},d};t.a=d},function(e,t,n){var r=n(3),i=n(47),o=function(e){var t=Object(r.a)({}),n=void 0;t.elementID=e.elementID,t.id=e.id,t.div=document.createElement("div"),t.div.setAttribute("id","bar_"+t.id),t.div.setAttribute("class","licode_bar"),t.bar=document.createElement("div"),t.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),t.bar.setAttribute("id","subbar_"+t.id),t.bar.setAttribute("class","licode_subbar"),t.link=document.createElement("a"),t.link.setAttribute("href","http://www.lynckia.com/"),t.link.setAttribute("class","licode_link"),t.link.setAttribute("target","_blank"),t.logo=document.createElement("img"),t.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;"),t.logo.setAttribute("class","licode_logo"),t.logo.setAttribute("alt","Lynckia"),t.logo.setAttribute("src",t.url+"/assets/star.svg");var o=function(e){var r=e;"block"!==e?r="none":clearTimeout(n),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display: "+r)};return t.display=function(){o("block")},t.hide=function(){n=setTimeout(o,1e3)},document.getElementById(t.elementID).appendChild(t.div),t.div.appendChild(t.bar),t.bar.appendChild(t.link),t.link.appendChild(t.logo),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(t.speaker=Object(i.a)({elementID:"subbar_"+t.id,id:t.id,stream:e.stream,media:e.media})),t.display(),t.hide(),t};t.a=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),i=n(1),o=n(23),s=n(0);n(50),n(52);var a={Room:r.a.bind(null,void 0,void 0,void 0),LicodeEvent:i.d,RoomEvent:i.e,StreamEvent:i.f,Stream:o.a.bind(null,void 0),Logger:s.a};t.default=a},function(e,t,n){var r=n(27),i=n(8),o=n(1),a=n(40),c=n(23),l=n(7),u=n(49),d=n(0),f=function(e,t,n,f){var h=f,p=Object(o.b)(f);p.remoteStreams=Object(l.a)(),p.localStreams=Object(l.a)(),p.roomID="",p.state=0,p.p2p=!1,p.ConnectionHelpers=void 0===t?i.a:t,p.erizoConnectionManager=void 0===n?new r.a:new n.ErizoConnectionManager;var m=Object(a.a)(e);p.socket=m;var g=p.remoteStreams,v=p.localStreams,y=function(e){var t=e;t.removeAllListeners(),t.pc&&!p.p2p&&t.pc.removeStream(t),d.a.debug("Removed stream"),t.stream&&(t.hide(),t.stop(),t.close(),delete t.stream),t.pc&&(t.local&&p.p2p?t.pc.forEach(function(e,n){e.close(),t.pc.remove(n)}):(p.erizoConnectionManager.maybeCloseConnection(t.pc),delete t.pc))},C=function(e,t){var n=e;if(0!==p.state&&n&&!n.failed){n.failed=!0;var r=Object(o.f)({type:"stream-failed",msg:t||"Stream failed after connection",stream:n});p.dispatchEvent(r),n.local?p.unpublish(n):p.unsubscribe(n)}},b=function(e,t){var n=e;d.a.info("Stream subscribed"),n.stream=t.stream,p.p2p||n.pc.addStream(n);var r=Object(o.f)({type:"stream-subscribed",stream:n});p.dispatchEvent(r)},S=function(e){var t=e;d.a.info("Stream unsubscribed");var n=Object(o.f)({type:"stream-unsubscribed",stream:t});p.dispatchEvent(n)},T=function(e,t){return{callback:function(n){m.sendSDP("signaling_message",{streamId:e.getID(),peerSocket:t,msg:n})},audio:e.hasAudio(),video:e.hasVideo(),iceServers:p.iceServers,maxAudioBW:e.maxAudioBW,maxVideoBW:e.maxVideoBW,limitMaxAudioBW:h.maxAudioBW,limitMaxVideoBW:h.maxVideoBW,forceTurn:e.forceTurn,p2p:!0}},A=function(e,t){var n=e;n.addPC(p.erizoConnectionManager.getOrBuildErizoConnection(T(n,t))),n.on("added",b.bind(null,n)),n.on("icestatechanged",function(e){d.a.info(n.getID()+" - iceConnectionState: "+e.msg.state),"failed"===e.msg.state&&C(n)})},E=function(e,t){var n=e,r=p.erizoConnectionManager.getOrBuildErizoConnection(T(n,t));n.addPC(r,t),n.on("icestatechanged",function(e){d.a.info(n.getID()+" - iceConnectionState: "+e.msg.state),"failed"===e.msg.state&&(n.pc.get(t).close(),n.pc.remove(t))}),r.addStream(n),r.createOffer()},_=function(e,t){var n=e;if(void 0!==n.pc&&n.pc.has(t)){n.pc.get(t).close(),n.pc.remove(t)}},w=function(e){p.remoteStreams.forEach(function(t){t.local||t.getLabel()!==e||S(t)})},R=function(e,t,n){var r={callback:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getID();d.a.info("Sending message",t,e.getID(),n),m.sendSDP("signaling_message",{streamId:n,msg:t,browser:e.pc&&e.pc.browser},void 0,function(){})},nop2p:!0,audio:t.audio&&e.hasAudio(),video:t.video&&e.hasVideo(),maxAudioBW:t.maxAudioBW,maxVideoBW:t.maxVideoBW,limitMaxAudioBW:h.maxAudioBW,limitMaxVideoBW:h.maxVideoBW,label:e.getLabel(),iceServers:p.iceServers,forceTurn:e.forceTurn,p2p:!1,streamRemovedListener:w};return n||(r.simulcast=t.simulcast,r.startVideoBW=t.startVideoBW,r.hardMinVideoBW=t.hardMinVideoBW),r},k=function(e,t,n){var r=e;r.addPC(p.erizoConnectionManager.getOrBuildErizoConnection(R(r,n,!0),t,h.singlePC)),r.on("added",b.bind(null,r)),r.on("icestatechanged",function(e){d.a.info(r.getID()+" - iceConnectionState: "+e.msg.state),"failed"===e.msg.state&&C(r)}),r.pc.createOffer(!0,!1,r.getID())},I=function(e,t,n){var r=e;r.addPC(p.erizoConnectionManager.getOrBuildErizoConnection(R(r,n),t,h.singlePC)),r.on("icestatechanged",function(e){d.a.info(r.getID()+" - iceConnectionState: "+e.msg.state),"failed"===e.msg.state&&C(r)}),r.pc.addStream(r),n.createOffer||r.pc.createOffer(!1,h.singlePC,r.getID())},x=function(e){if(!g.has(e.id)){var t=Object(c.a)(p.Connection,{streamID:e.id,local:v.has(e.id),audio:e.audio,video:e.video,data:e.data,label:e.label,screen:e.screen,attributes:e.attributes});t.room=p,g.add(e.id,t);var n=Object(o.f)({type:"stream-added",stream:t});p.dispatchEvent(n)}},P=function(e){var t=void 0;(t=e.peerId?g.get(e.peerId):v.get(e.streamId))&&t.pc&&!t.failed&&t.pc.processSignalingMessage(e.mess)},O=function(e){var t=v.get(e.streamId);t&&!t.failed?t.pc.get(e.peerSocket).processSignalingMessage(e.msg):(t=g.get(e.streamId),t.pc||A(t,e.peerSocket),t.pc.processSignalingMessage(e.msg))},D=function(e){var t=v.get(e.streamId);E(t,e.peerSocket)},N=function(e){var t=v.get(e.streamId);t&&_(t,e.peerSocket)},L=function(e){if(d.a.info("Bandwidth Alert on",e.streamID,"message",e.message,"BW:",e.bandwidth),e.streamID){var t=g.get(e.streamID);if(t&&!t.failed){var n=Object(o.f)({type:"bandwidth-alert",stream:t,msg:e.message,bandwidth:e.bandwidth});t.dispatchEvent(n)}}},M=function(e){var t=g.get(e.id),n=Object(o.f)({type:"stream-data",msg:e.msg,stream:t});t.dispatchEvent(n)},U=function(e){var t=g.get(e.id),n=Object(o.f)({type:"stream-attributes-update",attrs:e.attrs,stream:t});t.updateLocalAttributes(e.attrs),t.dispatchEvent(n)},j=function(e){var t=v.get(e.id);if(t)return void C(t);if(t=g.get(e.id)){y(t),g.remove(e.id);var n=Object(o.f)({type:"stream-removed",stream:t});p.dispatchEvent(n)}},B=function(){if(d.a.info("Socket disconnected, lost connection to ErizoController"),0!==p.state){d.a.error("Unexpected disconnection from ErizoController");var e=Object(o.e)({type:"room-disconnected",message:"unexpected-disconnection"});p.dispatchEvent(e)}},q=function(e){var t=void 0;if(e.streamId){var n="ICE Connection Failed on "+e.type+" "+e.streamId+" "+p.state;d.a.error(n),t="publish"===e.type?v.get(e.streamId):g.get(e.streamId),C(t,n)}},F=function(e){d.a.error("Cannot connect to erizo Controller");var t=Object(o.e)({type:"room-error",message:e});p.dispatchEvent(t)},V=function(e){var t=e.stream,n=e.msg;t.local?m.sendMessage("sendDataStream",{id:t.getID(),msg:n}):d.a.error("You can not send data through a remote stream")},H=function(e){var t=e.stream,n=e.attrs;t.local?(t.updateLocalAttributes(n),m.sendMessage("updateStreamAttributes",{id:t.getID(),attrs:n})):d.a.error("You can not update attributes in a remote stream")},W=function(e,t){t.args?e.apply(void 0,s(t.args)):e()},G=function(e,t,n){return{state:e,data:t.hasData(),audio:t.hasAudio(),video:t.hasVideo(),label:t.getLabel(),screen:t.hasScreen(),attributes:t.getAttributes(),metadata:n.metadata,createOffer:n.createOffer,muteStream:n.muteStream}},z=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=t;if(null===e)return d.a.error("Error when publishing the stream",n),void r(void 0,n);d.a.info("Stream published"),i.getID=function(){return e},i.on("internal-send-data",V),i.on("internal-set-attributes",H),v.add(e,i),i.room=p,r(e)},J=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e,i=void 0,o=void 0;r.url?(i="url",o=r.url):(i="recording",o=r.recording),d.a.info("Checking publish options for",r.getID()),r.checkOptions(t),m.sendSDP("publish",G(i,r,t),o,function(e,t){z(e,r,t,n)})},Y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e;r.maxAudioBW=t.maxAudioBW,r.maxVideoBW=t.maxVideoBW,m.sendSDP("publish",G("p2p",r,t),void 0,function(e,t){z(e,r,t,n)})},K=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e;m.sendSDP("publish",G("data",r,t),void 0,function(e,t){z(e,r,t,n)})},X=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e;d.a.info("Publishing to Erizo Normally, is createOffer",t.createOffer);var i=G("erizo",r,t);i.minVideoBW=t.minVideoBW,i.maxVideoBW=t.maxVideoBW,i.scheme=t.scheme,m.sendSDP("publish",i,void 0,function(e,i,o){if(null===e)return d.a.error("Error publishing stream",o),void n(void 0,o);z(e,r,o,void 0),I(r,i,t),n(e)})},Q=function(e,t){var n=t&&e.hasVideo(),r=t&&t.width,i=t&&t.height,o=t&&t.frameRate;return r||i||o?{width:r,height:i,frameRate:o}:n},$=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e,i=t;i.maxVideoBW=i.maxVideoBW||h.defaultVideoBW,i.maxVideoBW>h.maxVideoBW&&(i.maxVideoBW=h.maxVideoBW),i.audio=void 0===i.audio||i.audio,i.video=void 0===i.video||i.video,i.data=void 0===i.data||i.data,r.checkOptions(i);var o={streamId:r.getID(),audio:i.audio&&r.hasAudio(),video:Q(r,i.video),maxVideoBW:i.maxVideoBW,data:i.data&&r.hasData(),browser:p.ConnectionHelpers.getBrowser(),createOffer:i.createOffer,metadata:i.metadata,muteStream:i.muteStream,slideShowMode:i.slideShowMode};m.sendSDP("subscribe",o,void 0,function(e,t,o){if(null===e)return d.a.error("Error subscribing to stream ",o),void n(void 0,o);d.a.info("Subscriber added"),k(r,t,i),n(!0)})},Z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e;m.sendSDP("subscribe",{streamId:r.getID(),data:t.data,metadata:t.metadata},void 0,function(e,t){if(null===e)return d.a.error("Error subscribing to stream ",t),void n(void 0,t);d.a.info("Stream subscribed");var i=Object(o.f)({type:"stream-subscribed",stream:r});p.dispatchEvent(i),n(!0)})},ee=function(){p.state=0,m.state=m.DISCONNECTED,g.forEach(function(e,t){if(y(e),g.remove(t),e&&!e.failed){var n=Object(o.f)({type:"stream-removed",stream:e});p.dispatchEvent(n)}}),g=Object(l.a)(),v.forEach(function(e,t){y(e),v.remove(t)}),v=Object(l.a)();try{m.disconnect()}catch(e){d.a.debug("Socket already disconnected")}m=void 0};return p.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=u.a.decodeBase64(h.token);0!==p.state&&d.a.warning("Room already connected"),p.state=1,m.connect(JSON.parse(t),e,function(e){var t=void 0,n=[],r=e.streams||[],i=e.id;p.p2p=e.p2p,p.iceServers=e.iceServers,p.state=2,h.singlePC=e.singlePC,h.defaultVideoBW=e.defaultVideoBW,h.maxVideoBW=e.maxVideoBW;for(var s=Object.keys(r),a=0;a<s.length;a+=1){var l=r[s[a]];t=Object(c.a)(p.ConnectionHelpers,{streamID:l.id,local:!1,audio:l.audio,video:l.video,data:l.data,label:l.label,screen:l.screen,attributes:l.attributes}),t.room=p,n.push(t),g.add(l.id,t)}p.roomID=i,d.a.info("Connected to room "+p.roomID);var u=Object(o.e)({type:"room-connected",streams:n});p.dispatchEvent(u)},function(e){d.a.error("Not Connected! Error: "+e);var t=Object(o.e)({type:"room-error",message:e});p.dispatchEvent(t)})},p.disconnect=function(){d.a.debug("Disconnection requested");var e=Object(o.e)({type:"room-disconnected",message:"expected-disconnection"});p.dispatchEvent(e)},p.publish=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e,i=t;i.maxVideoBW=i.maxVideoBW||h.defaultVideoBW,i.maxVideoBW>h.maxVideoBW&&(i.maxVideoBW=h.maxVideoBW),void 0===i.minVideoBW&&(i.minVideoBW=0),i.minVideoBW>h.defaultVideoBW&&(i.minVideoBW=h.defaultVideoBW),r.forceTurn=i.forceTurn,i.simulcast=i.simulcast||!1,i.muteStream={audio:r.audioMuted,video:r.videoMuted},r&&r.local&&!r.failed&&!v.has(r.getID())?r.hasMedia()?r.isExternal()?J(r,i,n):p.p2p?Y(r,i,n):X(r,i,n):r.hasData()&&K(r,i,n):(d.a.error("Trying to publish invalid stream"),n(void 0,"Invalid Stream"))},p.startRecording=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(void 0===e)return d.a.error("Trying to start recording on an invalid stream",e),void t(void 0,"Invalid Stream");d.a.debug("Start Recording stream: "+e.getID()),m.sendMessage("startRecorder",{to:e.getID()},function(e,n){if(null===e)return d.a.error("Error on start recording",n),void t(void 0,n);d.a.info("Start recording",e),t(e)})},p.stopRecording=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};m.sendMessage("stopRecorder",{id:e},function(n,r){if(null===n)return d.a.error("Error on stop recording",r),void t(void 0,r);d.a.info("Stop recording",e),t(!0)})},p.unpublish=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e;if(n&&n.local){if(m.sendMessage("unpublish",n.getID(),function(e,r){if(null===e)return d.a.error("Error unpublishing stream",r),void t(void 0,r);delete n.failed,t(!0)}),d.a.info("Stream unpublished"),n.room=void 0,n.hasMedia()&&!n.isExternal()){var r=v.has(n.getID())?v.get(n.getID()):n;y(r)}v.remove(n.getID()),n.getID=function(){},n.off("internal-send-data",V),n.off("internal-set-attributes",H)}else{var i="Cannot unpublish, stream does not exist or is not local";d.a.error(i),t(void 0,i)}},p.sendControlMessage=function(e,t,n){if(e&&e.getID()){var r={type:"control",action:n};m.sendSDP("signaling_message",{streamId:e.getID(),msg:r})}},p.subscribe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e,i=t;if(!r||r.local||r.failed){var o="Error on subscribe";r?r.local?(d.a.warning("Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),o="Local copy of stream"):r.failed&&(d.a.warning("Cannot subscribe to failed stream."),o="Failed stream"):(d.a.warning("Cannot subscribe to invalid stream"),o="Invalid or undefined stream"),n(void 0,o)}else{if(r.hasMedia())if(r.hasVideo()||r.hasScreen()||(i.video=!1),r.hasAudio()||(i.audio=!1),i.muteStream={audio:r.audioMuted,video:r.videoMuted},r.forceTurn=i.forceTurn,p.p2p){var s=g.get(r.getID());s.maxAudioBW=i.maxAudioBW,s.maxVideoBW=i.maxVideoBW,m.sendSDP("subscribe",{streamId:r.getID(),metadata:i.metadata}),n(!0)}else $(r,i,n);else{if(!r.hasData()||!1===i.data)return d.a.warning("There's nothing to subscribe to"),void n(void 0,"Nothing to subscribe to");Z(r,i,n)}d.a.info("Subscribing to: "+r.getID())}},p.unsubscribe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e;void 0!==m&&(n&&!n.local?m.sendMessage("unsubscribe",n.getID(),function(e,r){if(null===e)return void t(void 0,r);y(n),delete n.failed,t(!0)},function(){d.a.error("Error calling unsubscribe.")}):t(void 0,"Error unsubscribing, stream does not exist or is not local"))},p.getStreamStats=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return m?e?void m.sendMessage("getStreamStats",e.getID(),function(e){e&&t(e)}):"Error getting stats - no stream":"Error getting stats - no socket"},p.getStreamsByAttribute=function(e,t){var n=[];return g.forEach(function(r){void 0!==r.getAttributes()&&r.getAttributes()[e]===t&&n.push(r)}),n},p.on("room-disconnected",ee),m.on("onAddStream",W.bind(null,x)),m.on("signaling_message_erizo",W.bind(null,P)),m.on("signaling_message_peer",W.bind(null,O)),m.on("publish_me",W.bind(null,D)),m.on("unpublish_me",W.bind(null,N)),m.on("onBandwidthAlert",W.bind(null,L)),m.on("onDataStream",W.bind(null,M)),m.on("onUpdateAttributeStream",W.bind(null,U)),m.on("onRemoveStream",W.bind(null,j)),m.on("disconnect",W.bind(null,B)),m.on("connection_failed",W.bind(null,q)),m.on("error",W.bind(null,F)),p};t.a=f},function(e,t,n){var s=n(28),a=n(37),l=n(38),u=n(0),d=n(1),f=n(7),h=n(8),p=d.c,m=103,g=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));u.a.debug("Building a new Connection"),i.stack={},i.erizoId=n,i.streamsMap=Object(f.a)();var c=e;if(m+=1,c.sessionId=m,i.sessionId=m,c.streamRemovedListener||(c.streamRemovedListener=function(){}),i.streamRemovedListener=c.streamRemovedListener,i.browser=h.a.getBrowser(),"fake"===i.browser)u.a.warning("Publish/subscribe video/audio streams not supported in erizofc yet"),i.stack=Object(l.a)(c);else if("mozilla"===i.browser)u.a.debug("Firefox Stack"),i.stack=Object(a.a)(c);else if("safari"===i.browser)u.a.debug("Safari using Chrome Stable Stack"),i.stack=Object(s.a)(c);else{if("chrome-stable"!==i.browser&&"electron"!==i.browser)throw u.a.error("No stack available for this browser"),new Error("WebRTC stack not available");u.a.debug("Chrome Stable Stack"),i.stack=Object(s.a)(c)}return i.stack.updateSpec||(i.stack.updateSpec=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};u.a.error("Update Configuration not implemented in this browser"),t("unimplemented")}),i.stack.setSignallingCallback||(i.stack.setSignallingCallback=function(){u.a.error("setSignallingCallback is not implemented in this stack")}),i.stack.peerConnection&&(i.peerConnection=i.stack.peerConnection,i.stack.peerConnection.onaddstream=function(e){i.emit(Object(d.a)({type:"add-stream",stream:e.stream}))},i.stack.peerConnection.onremovestream=function(e){i.emit(Object(d.a)({type:"remove-stream",stream:e.stream})),i.streamRemovedListener(e.stream.id)},i.stack.peerConnection.oniceconnectionstatechange=function(){var e=i.stack.peerConnection.iceConnectionState;i.emit(Object(d.a)({type:"ice-state-change",state:e}))}),i}return i(t,e),c(t,[{key:"close",value:function(){u.a.debug("Closing ErizoConnection"),this.streamsMap.clear(),this.stack.close()}},{key:"createOffer",value:function(e,t,n){this.stack.createOffer(e,t,n)}},{key:"addStream",value:function(e){u.a.debug("message: Adding stream to Connection, streamId: "+e.getID()),this.streamsMap.add(e.getID(),e),e.local&&this.stack.addStream(e.stream)}},{key:"removeStream",value:function(e){var t=e.getID();if(!this.streamsMap.has(t))return void u.a.warning("message: Cannot remove stream not in map, streamId: "+t);e.local?this.stack.removeStream(e.stream):1===this.streamsMap.size()&&this.streamRemovedListener(e.getLabel()),this.streamsMap.remove(t)}},{key:"processSignalingMessage",value:function(e){this.stack.processSignalingMessage(e)}},{key:"sendSignalingMessage",value:function(e){this.stack.sendSignalingMessage(e)}},{key:"setSimulcast",value:function(e){this.stack.setSimulcast(e)}},{key:"setVideo",value:function(e){this.stack.setVideo(e)}},{key:"setAudio",value:function(e){this.stack.setAudio(e)}},{key:"updateSpec",value:function(e,t,n){this.stack.updateSpec(e,t,n)}}]),t}(p),v=function(){function e(){o(this,e),this.ErizoConnectionsMap=new Map}return c(e,[{key:"getOrBuildErizoConnection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.a.debug("message: getOrBuildErizoConnection, erizoId: "+t);var r={};if(void 0===t)return new g(e);if(n){var i=void 0;this.ErizoConnectionsMap.has(t)?i=this.ErizoConnectionsMap.get(t):(i={},this.ErizoConnectionsMap.set(t,i)),i["single-pc"]||(i["single-pc"]=new g(e,t)),r=i["single-pc"]}else if(r=new g(e,t),this.ErizoConnectionsMap.has(t))this.ErizoConnectionsMap.get(t)[r.sessionId]=r;else{var o={};o[r.sessionId]=r,this.ErizoConnectionsMap.set(t,o)}return e.simulcast&&r.setSimulcast(e.simulcast),e.video&&r.setVideo(e.video),e.audio&&r.setVideo(e.audio),r}},{key:"maybeCloseConnection",value:function(e){u.a.debug("Trying to remove connection "+e.sessionId+"\n       with erizoId "+e.erizoId),0===e.streamsMap.size()&&(e.close(),void 0!==this.ErizoConnectionsMap.get(e.erizoId)&&(delete this.ErizoConnectionsMap.get(e.erizoId)["single-pc"],delete this.ErizoConnectionsMap.get(e.erizoId)[e.sessionId]))}}]),e}();t.a=v},function(e,t,n){var r=n(10),i=n(22),o=n(0),s=function(e){o.a.info("Starting Chrome stable stack",e);var t=e,n=Object(r.a)(e);return n.mediaConstraints={offerToReceiveVideo:!0,offerToReceiveAudio:!0},n.enableSimulcast=function(e){var t=void 0,r=e;if(!n.simulcast)return r;var o=r.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!o||o.length<=0)return r;var s=n.simulcast.numSpatialLayers||2,a=parseInt(o[1],10),c=parseInt(o[2],10),l=r.match(new RegExp("a=ssrc:"+o[1]+" cname:(.*)\r?\n"))[1],u=r.match(new RegExp("a=ssrc:"+o[1]+" msid:(.*)\r?\n"))[1],d=r.match(new RegExp("a=ssrc:"+o[1]+" mslabel:(.*)\r?\n"))[1],f=r.match(new RegExp("a=ssrc:"+o[1]+" label:(.*)\r?\n"))[1];r.match(new RegExp("a=ssrc:"+o[1]+".*\r?\n","g")).forEach(function(e){r=r.replace(e,"")}),r.match(new RegExp("a=ssrc:"+o[2]+".*\r?\n","g")).forEach(function(e){r=r.replace(e,"")});for(var h=[a],p=[c],m=1;m<s;m+=1)h.push(a+1e3*m),p.push(c+1e3*m);t=i.a.addSim(h);for(var g=void 0,v=void 0,y=0;y<h.length;y+=1)g=h[y],v=p[y],t+=i.a.addGroup(g,v);for(var C=0;C<h.length;C+=1)g=h[C],v=p[C],t+=i.a.addSpatialLayer(l,u,d,f,g,v);return t+="a=x-google-flag:conference\r\n",r.replace(o[0],t)},n.setStartVideoBW=function(e){n.video&&t.startVideoBW&&(o.a.debug("startVideoBW requested: "+t.startVideoBW),i.a.setParamForCodecs(e,"video","x-google-start-bitrate",t.startVideoBW))},n.setHardMinVideoBW=function(e){n.video&&t.hardMinVideoBW&&(o.a.debug("hardMinVideoBW requested: "+t.hardMinVideoBW),i.a.setParamForCodecs(e,"video","x-google-min-bitrate",t.hardMinVideoBW))},n};t.a=s},function(e,t,n){var r=n(30),i=n(12),o=n(13),s=n(14),a=n(15),c=n(16),l=n(4),u=n(18),d=n(19),f=n(20),h=n(21),p=n(6);e.exports={SDPInfo:r,CandidateInfo:i,CodecInfo:o,DTLSInfo:s,ICEInfo:a,MediaInfo:c,Setup:l,SourceGroupInfo:u,SourceInfo:d,StreamInfo:f,TrackInfo:h,Direction:p}},function(e,t,n){function r(e,t){var n=new Map;t.rtp.forEach(function(r){var i=r.payload,o=r.codec,s=r.rate,a=r.encoding,c={},l=[];t.fmtp.forEach(function(e){if(e.payload===i){e.config.split(";").forEach(function(e){var t=e.split("=");c[t[0].trim()]=(t[1]||"").trim()})}}),t.rtcpFb&&t.rtcpFb.forEach(function(e){e.payload===i&&l.push({type:e.type,subtype:e.subtype})}),"RTX"===o.toUpperCase()?n.set(parseInt(c.apt,10),i):e.addCodec(new h(o,i,s,a,c,l))}),n.forEach(function(t,n){var r=e.getCodecForType(n);r&&r.setRTX(t)})}function i(e,t){var n=t.rids;n&&n.forEach(function(t){var n=new R(t.id,C.byValue(t.direction)),r=[],i=new Map;if(t.params){var o=d.parseParams(t.params);Object.keys(o).forEach(function(e){"pt"===e?r=o[e].split(","):i.set(e,o[e])}),n.setFormats(r),n.setParams(i)}e.addRID(n)})}function s(e,t,n){var r=t.simulcast["dir"+e],i=t.simulcast["list"+e];if(r){var o=C.byValue(r);d.parseSimulcastStreamList(i).forEach(function(e){var t=[];e.forEach(function(e){t.push(new w(e.scid,e.paused))}),n.addSimulcastAlternativeStreams(o,t)})}}function a(e,t){t.setSimulcastPlainString(e.simulcast_03.value)}function l(e,t){var n=[];if(t.simulcast){var r=new _;s("1",t,r),s("2",t,r),r.getSimulcastStreams(C.SEND).forEach(function(t){var r=[];t.forEach(function(t){var n=new E(t.getId(),t.isPaused()),i=e.getRID(n.getId());if(i){i.getFormats().forEach(function(t){var r=e.getCodecForType(t);r&&n.addCodec(r)}),n.setParams(i.getParams()),r.push(n)}}),r.length&&n.push(r)}),e.setSimulcast(r)}if(t.simulcast_03){var i=new _;a(t,i),e.setSimulcast03(i)}return n}function u(e,t,n){var r=new Map,i=n.type;if(n.ssrcs){var o=void 0,s=void 0,a=void 0;n.ssrcs.forEach(function(n){var c=n.id,l=n.attribute,u=n.value;if(a=r.get(c),a||(a=new S(c),r.set(a.getSSRC(),a)),"cname"===l.toLowerCase())a.setCName(u);else if("mslabel"===l.toLowerCase())a.setMSLabel(u);else if("label"===l.toLowerCase())a.setLabel(u);else if("msid"===l.toLowerCase()){var d=u.split(" "),f=d[0],h=d[1];a.setStreamId(f),a.setTrackId(h),s=t.getStream(f),s||(s=new T(f),t.addStream(s)),o=s.getTrack(h),o||(o=new A(i,h),o.setEncodings(e),s.addTrack(o)),o.addSSRC(a)}})}if(n.msid){var c=n.msid.split(" "),l=c[0],u=c[1],d=t.getStream(l);d||(d=new T(l),t.addStream(d));var f=d.getTrack(u);f||(f=new A(i,u),f.setMediaId(n.mid),f.setEncodings(e),d.addTrack(f)),r.forEach(function(e,t){var n=r.get(t);n.getStreamId()||(n.setStreamId(l),n.setTrackId(u),f.addSSRC(n))})}n.ssrcGroups&&n.ssrcGroups.forEach(function(e){var n=e.ssrcs.split(" "),i=new b(e.semantics,n),o=r.get(parseInt(n[0],10));t.getStream(o.getStreamId()).getTrack(o.getTrackId()).addSourceGroup(i)})}var d=n(31),f=n(12),h=n(13),p=n(14),m=n(15),g=n(16),v=n(4),y=n(6),C=n(2),b=n(18),S=n(19),T=n(20),A=n(21),E=n(34),_=n(17),w=n(35),R=n(36),k=function(){function e(t){o(this,e),this.version=t||1,this.name="sdp-semantic",this.streams=new Map,this.medias=[],this.candidates=[],this.connection=null,this.ice=null,this.dtls=null}return c(e,[{key:"clone",value:function(){var t=new e(this.version);return t.name=this.name,t.setConnection(this.connection),this.medias.forEach(function(e){t.addMedia(e.clone())}),this.streams.forEach(function(e){t.addStream(e.clone())}),this.candidates.forEach(function(e){t.addCandidate(e.clone())}),t.setICE(this.ice.clone()),t.setDTLS(this.dtls.clone()),t}},{key:"plain",value:function(){var e={version:this.version,name:this.name,streams:[],medias:[],candidates:[],connection:this.connection};return this.medias.forEach(function(t){e.medias.push(t.plain())}),this.streams.forEach(function(t){e.streams.push(t.plain())}),this.candidates.forEach(function(t){e.candidates.push(t.plain())}),e.ice=this.ice&&this.ice.plain(),e.dtls=this.dtls&&this.dtls.plain(),e}},{key:"setVersion",value:function(e){this.version=e}},{key:"setOrigin",value:function(e){this.origin=e}},{key:"setName",value:function(e){this.name=e}},{key:"getConnection",value:function(){return this.connection}},{key:"setConnection",value:function(e){this.connection=e}},{key:"setTiming",value:function(e){this.timing=e}},{key:"addMedia",value:function(e){this.medias.push(e)}},{key:"getMedia",value:function(e){var t=void 0;return this.medias.forEach(function(n){n.getType().toLowerCase()===e.toLowerCase()&&(t=n)}),t}},{key:"getMedias",value:function(e){if(!e)return this.medias;var t=[];return this.medias.forEach(function(n){n.getType().toLowerCase()===e.toLowerCase()&&t.push(n)}),t}},{key:"getMediaById",value:function(e){var t=void 0;return this.medias.forEach(function(n){n.getId().toLowerCase()===e.toLowerCase()&&(t=n)}),t}},{key:"getVersion",value:function(){return this.version}},{key:"getDTLS",value:function(){return this.dtls}},{key:"setDTLS",value:function(e){this.dtls=e}},{key:"getICE",value:function(){return this.ice}},{key:"setICE",value:function(e){this.ice=e}},{key:"addCandidate",value:function(e){this.candidates.push(e)}},{key:"addCandidates",value:function(e){var t=this;e.forEach(function(e){t.addCandidate(e)})}},{key:"getCandidates",value:function(){return this.candidates}},{key:"getStream",value:function(e){return this.streams.get(e)}},{key:"getStreams",value:function(){return this.streams}},{key:"getFirstStream",value:function(){return this.streams.values().length>0?this.streams.values()[0]:null}},{key:"addStream",value:function(e){this.streams.set(e.getId(),e)}},{key:"removeStream",value:function(e){this.streams.delete(e.getId())}},{key:"toJSON",value:function(){var e={version:0,media:[]};e.version=this.version||0,e.origin=this.origin||{username:"-",sessionId:(new Date).getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"},e.name=this.name||"semantic-sdp",e.connection=this.getConnection(),e.timing=this.timing||{start:0,stop:0};var t=this.getICE();t&&(t.isLite()&&(e.icelite="ice-lite"),e.iceOptions=t.getOpts(),e.iceUfrag=t.getUfrag(),e.icePwd=t.getPwd()),e.msidSemantic=this.msidSemantic||{semantic:"WMS",token:"*"},e.groups=[];var n={type:"BUNDLE",mids:[]},r=this.getDTLS();r&&(e.fingerprint={type:r.getHash(),hash:r.getFingerprint()},e.setup=v.toString(r.getSetup())),this.medias.forEach(function(i){var o={type:i.getType(),port:i.getPort(),protocol:"UDP/TLS/RTP/SAVPF",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};o.direction=y.toString(i.getDirection()),o.rtcpMux="rtcp-mux",o.connection=i.getConnection(),o.xGoogleFlag=i.getXGoogleFlag(),o.mid=i.getId(),n.mids.push(i.getId()),o.rtcp=i.rtcp,i.getBitrate()>0&&o.bandwidth.push({type:"AS",limit:i.getBitrate()}),i.getCandidates().forEach(function(e){o.candidates.push({foundation:e.getFoundation(),component:e.getComponentId(),transport:e.getTransport(),priority:e.getPriority(),ip:e.getAddress(),port:e.getPort(),type:e.getType(),relAddr:e.getRelAddr(),relPort:e.getRelPort(),generation:e.getGeneration()})}),t=i.getICE(),t&&(t.isLite()&&(o.icelite="ice-lite"),o.iceOptions=t.getOpts(),o.iceUfrag=t.getUfrag(),o.icePwd=t.getPwd(),t.isEndOfCandidates()&&(o.endOfCandidates=t.isEndOfCandidates())),r=i.getDTLS(),r&&(o.fingerprint={type:r.getHash(),hash:r.getFingerprint()},o.setup=v.toString(r.getSetup())),i.setup&&(o.setup=v.toString(i.setup)),i.getCodecs().forEach(function(e){o.rtp.push({payload:e.getType(),codec:e.getCodec(),rate:e.getRate(),encoding:e.getEncoding()});var t=e.getParams();Object.keys(t).length>0&&o.fmtp.push({payload:e.getType(),config:Object.keys(t).map(function(e){return e+(t[e]?"="+t[e]:"")}).join(";")}),e.getFeedback().forEach(function(t){o.rtcpFb.push({payload:e.getType(),type:t.type,subtype:t.subtype})}),e.hasRTX()&&(o.rtp.push({payload:e.getRTX(),codec:"rtx",rate:e.getRate(),encoding:e.getEncoding()}),o.fmtp.push({payload:e.getRTX(),config:"apt="+e.getType()}))});var s=[];o.rtp.forEach(function(e){s.push(e.payload)}),o.payloads=s.join(" "),i.getExtensions().forEach(function(e,t){o.ext.push({value:t,uri:e})}),i.getRIDs().forEach(function(e){var t={id:e.getId(),direction:C.toString(e.getDirection()),params:""};e.getFormats().length&&(t.params="pt="+e.getFormats().join(",")),e.getParams().forEach(function(e,n){var r=t.params.length?";":"";t.params+=""+r+n+"="+e}),o.rids.push(t)});var a=i.getSimulcast(),c=i.getSimulcast03();if(a){var l=1;o.simulcast={};var u=a.getSimulcastStreams(C.SEND),d=a.getSimulcastStreams(C.RECV);if(u&&u.length){var f="";u.forEach(function(e){var t="";e.forEach(function(e){t+=(t.length?",":"")+(e.isPaused()?"~":"")+e.getId()}),f+=(f.length?";":"")+t}),o.simulcast["dir"+l]="send",o.simulcast["list"+l]=f,l+=1}if(d&&d.length){var h=[];d.forEach(function(e){var t="";e.forEach(function(e){t+=(t.length?",":"")+(e.isPaused()?"~":"")+e.getId()}),h+=(h.length?";":"")+t}),o.simulcast["dir"+l]="recv",o.simulcast["list"+l]=h,l+=1}}c&&(o.simulcast_03={value:c.getSimulcastPlainString()}),e.media.push(o)}),n.mids.sort(),e.media.sort(function(e,t){return e.mid<t.mid?-1:e.mid>t.mid?1:0});var i=!0,o=!1,s=void 0;try{for(var a,c=this.streams.values()[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var l=a.value,u=!0,d=!1,f=void 0;try{for(var h,p=l.getTracks().values()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var m=h.value,g=!0,b=!1,S=void 0;try{for(var T,A=e.media[Symbol.iterator]();!(g=(T=A.next()).done);g=!0){if("break"===function(){var e=T.value;if(m.getMediaId()){if(m.getMediaId()===e.mid)return m.getSourceGroups().forEach(function(t){e.ssrcGroups.push({semantics:t.getSemantics(),ssrcs:t.getSSRCs().join(" ")})}),m.getSSRCs().forEach(function(t){e.ssrcs.push({id:t.ssrc,attribute:"cname",value:t.getCName()})}),l.getId()&&m.getId()&&(e.msid=l.getId()+" "+m.getId()),"break"}else if(e.type.toLowerCase()===m.getMedia().toLowerCase())return m.getSourceGroups().forEach(function(t){e.ssrcGroups.push({semantics:t.getSemantics(),ssrcs:t.getSSRCs().join(" ")})}),m.getSSRCs().forEach(function(t){e.ssrcs.push({id:t.ssrc,attribute:"cname",value:t.getCName()}),t.getStreamId()&&t.getTrackId()&&e.ssrcs.push({id:t.ssrc,attribute:"msid",value:t.getStreamId()+" "+t.getTrackId()}),t.getMSLabel()&&e.ssrcs.push({id:t.ssrc,attribute:"mslabel",value:t.getMSLabel()}),t.getLabel()&&e.ssrcs.push({id:t.ssrc,attribute:"label",value:t.getLabel()})}),"break"}())break}}catch(e){b=!0,S=e}finally{try{!g&&A.return&&A.return()}finally{if(b)throw S}}}}catch(e){d=!0,f=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw f}}}}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}return n.mids=n.mids.join(" "),e.groups.push(n),e}},{key:"toString",value:function(){var e=this.toJSON();return d.write(e)}}]),e}();k.processString=function(e){var t=d.parse(e);return k.process(t)},k.process=function(e){var t=new k;t.setVersion(e.version),t.setTiming(e.timing),t.setConnection(e.connection),t.setOrigin(e.origin),t.msidSemantic=e.msidSemantic,t.name=e.name;var n=e.iceUfrag,o=e.icePwd,s=e.iceOptions;(n||o||s)&&t.setICE(new m(n,o,s));var a=e.fingerprint;if(a){var c=a.type,d=a.hash,h=null;e.setup&&(h=v.byValue(e.setup)),t.setDTLS(new p(h,c,d))}return e.media.forEach(function(e){var c=e.type,d=e.mid,h=e.port,C=new g(d,h,c);if(C.setXGoogleFlag(e.xGoogleFlag),C.rtcp=e.rtcp,C.setConnection(e.connection),e.bandwidth&&e.bandwidth.length>0&&e.bandwidth.forEach(function(e){"AS"===e.type&&C.setBitrate(e.limit)}),n=e.iceUfrag,o=e.icePwd,s=e.iceOptions,n||o||s){var b=new m(n,o,s);e.endOfCandidates&&b.setEndOfCandidates("end-of-candidates"),C.setICE(b)}if(a=e.fingerprint){var S=a.type,T=a.hash,A=v.ACTPASS;e.setup&&(A=v.byValue(e.setup)),C.setDTLS(new p(A,S,T))}e.setup&&C.setSetup(v.byValue(e.setup));var E=y.SENDRECV;e.direction&&(E=y.byValue(e.direction.toUpperCase())),C.setDirection(E);var _=e.candidates;_&&_.forEach(function(e){C.addCandidate(new f(e.foundation,e.component,e.transport,e.priority,e.ip,e.port,e.type,e.generation,e.relAddr,e.relPort))}),r(C,e);var w=e.ext;w&&w.forEach(function(e){C.addExtension(e.value,e.uri)}),i(C,e),u(l(C,e),t,e),t.addMedia(C)}),t},e.exports=k},function(e,t,n){var r=n(32),i=n(33);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))},o=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},s=n(11),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(i))return o(c,r,i)}}),t.media=n,t};var c=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(11),i=function(e){var t=1,n=arguments,r=n.length;return e.replace(/%[sdv%]/g,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},o=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,o=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?o.push(n[t.name][a]):o.push(n[t.names[s]])}else o.push(n[t.name]);return i.apply(null,o)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,i=t.innerOrder||a,c=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t){var n=function(){function e(t,n){o(this,e),this.id=t,this.paused=n,this.codecs=new Map,this.params=new Map}return c(e,[{key:"clone",value:function(){var t=new e(this.id,this.paused);return this.codecs.forEach(function(e){t.addCodec(e.cloned())}),t.setParams(this.params),t}},{key:"plain",value:function(){var e=this,t={id:this.id,paused:this.paused,codecs:{},params:{}};return this.codecs.keys().forEach(function(n){t.codecs[n]=e.codecs.get(n).plain()}),this.params.keys().forEach(function(n){t.params[n]=e.params.get(n).param}),t}},{key:"getId",value:function(){return this.id}},{key:"getCodecs",value:function(){return this.codecs}},{key:"addCodec",value:function(e){this.codecs.set(e.getType(),e)}},{key:"getParams",value:function(){return this.params}},{key:"setParams",value:function(e){this.params=new Map(e)}},{key:"isPaused",value:function(){return this.paused}}]),e}();e.exports=n},function(e,t){var n=function(){function e(t,n){o(this,e),this.paused=n,this.id=t}return c(e,[{key:"clone",value:function(){return new e(this.id,this.paused)}},{key:"plain",value:function(){return{id:this.id,paused:this.paused}}},{key:"isPaused",value:function(){return this.paused}},{key:"getId",value:function(){return this.id}}]),e}();e.exports=n},function(e,t,n){var r=n(2),i=function(){function e(t,n){o(this,e),this.id=t,this.direction=n,this.formats=[],this.params=new Map}return c(e,[{key:"clone",value:function(){var t=new e(this.id,this.direction);return t.setFormats(this.formats),t.setParams(this.params),t}},{key:"plain",value:function(){var e={id:this.id,direction:r.toString(this.direction),formats:this.formats,params:{}};return this.params.forEach(function(t,n){e.params[n]=t}),e}},{key:"getId",value:function(){return this.id}},{key:"getDirection",value:function(){return this.direction}},{key:"setDirection",value:function(e){this.direction=e}},{key:"getFormats",value:function(){return this.formats}},{key:"setFormats",value:function(e){var t=this;this.formats=[],e.forEach(function(e){t.formats.push(parseInt(e,10))})}},{key:"getParams",value:function(){return this.params}},{key:"setParams",value:function(e){this.params=new Map(e)}}]),e}();e.exports=i},function(e,t,n){var r=n(0),i=n(10),o=function(e){r.a.info("Starting Firefox stack");var t=Object(i.a)(e),n=[{rid:"low",scaleResolutionDownBy:3},{rid:"med",scaleResolutionDownBy:2},{rid:"high"}],o=function(e){var r=t.simulcast.numSpatialLayers||2,i=n.length;r=r<i?r:i;var o=e.getParameters()||{};o.encodings=[];for(var s=i-1;s>=i-r;s-=1)o.encodings.push(n[s]);return e.setParameters(o)},s=function(){if(!t.simulcast)return[];var e=[];return t.peerConnection.getSenders().forEach(function(t){"video"===t.track.kind&&e.push(o(t))}),e};t.enableSimulcast=function(e){return e};var a=t.createOffer;return t.createOffer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=[];!0!==e&&(r=s()),Promise.all(r).then(function(){a(e,t,n)})},t};t.a=o},function(e,t,n){var r=n(0),i=function(e){var t={};return t.pcConfig={},t.peerConnection={},t.desc={},t.signalCallback=void 0,t.close=function(){r.a.info("Close FcStack")},t.createOffer=function(){r.a.debug("FCSTACK: CreateOffer")},t.addStream=function(e){r.a.debug("FCSTACK: addStream",e)},t.processSignalingMessage=function(e){r.a.debug("FCSTACK: processSignaling",e),void 0!==t.signalCallback&&t.signalCallback(e)},t.sendSignalingMessage=function(t){r.a.debug("FCSTACK: Sending signaling Message",t),e.callback(t)},t.setSignalingCallback=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.a.debug("FCSTACK: Setting signalling callback"),t.signalCallback=e},t};t.a=i},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){n.d(t,"a",function(){return l});var r=n(41),i=n.n(r),o=n(0),a=n(1),c=function(e,t){var n=Object(a.d)({type:e});return n.args=t.args,n},l=function(e){var t=Object(a.b)(),n=function(){},r=[];t.CONNECTED=Symbol("connected"),t.RECONNECTING=Symbol("reconnecting"),t.DISCONNECTED=Symbol("disconnected");t.state=t.DISCONNECTED,t.IO=void 0===e?i.a:e;var l=void 0,u=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit(c(e,{args:r}))},d=function(e,t,n,i){r.push([e,t,n,i])},f=function(){t.state===t.CONNECTED&&r.forEach(function(e){t.sendMessage.apply(t,s(e))})};return t.connect=function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,a={reconnection:!0,reconnectionAttempts:3,secure:e.secure,forceNew:!0,transports:["websocket"],rejectUnauthorized:!1},c=e.secure?"wss://":"ws://",d=e.host;l=t.IO.connect(c+d,a);var h=1e3,p=l.io.engine.transport.ws.onclose;l.io.engine.transport.ws.onclose=function(e){o.a.warning("WebSocket closed, code:",e.code),h=e.code,p(e)},t.socket=l,l.on("onAddStream",u.bind(t,"onAddStream")),l.on("signaling_message_erizo",u.bind(t,"signaling_message_erizo")),l.on("signaling_message_peer",u.bind(t,"signaling_message_peer")),l.on("publish_me",u.bind(t,"publish_me")),l.on("unpublish_me",u.bind(t,"unpublish_me")),l.on("onBandwidthAlert",u.bind(t,"onBandwidthAlert")),l.on("onDataStream",u.bind(t,"onDataStream")),l.on("onUpdateAttributeStream",u.bind(t,"onUpdateAttributeStream")),l.on("onRemoveStream",u.bind(t,"onRemoveStream")),l.on("disconnect",function(e){if(o.a.debug("disconnect",t.id,e),1e3!==h)return void(t.state=t.RECONNECTING);u("disconnect",e),l.close()}),l.on("connection_failed",function(e){o.a.error("connection failed, id:",t.id),u("connection_failed",e)}),l.on("error",function(e){o.a.warning("socket error, id:",t.id,", error:",e.message),u("error")}),l.on("connect_error",function(e){o.a.warning("connect error, id:",t.id,", error:",e.message)}),l.on("connect_timeout",function(e){o.a.warning("connect timeout, id:",t.id,", error:",e.message)}),l.on("reconnecting",function(e){o.a.debug("reconnecting, id:",t.id,", attempet:",e)}),l.on("reconnect",function(e){o.a.debug("reconnected, id:",t.id,", attempet:",e),t.state=t.CONNECTED,l.emit("reconnected",t.id),f()}),l.on("reconnect_attempt",function(e){o.a.debug("reconnect attempt, id:",t.id,", attempet:",e)}),l.on("reconnect_error",function(e){o.a.debug("error reconnecting, id:",t.id,", error:",e.message)}),l.on("reconnect_failed",function(){o.a.warning("reconnect failed, id:",t.id),t.state=t.DISCONNECTED,u("disconnect","reconnect failed")});var m=r;m.token=e,t.sendMessage("token",m,function(e){t.state=t.CONNECTED,t.id=e.clientId,i(e)},s)},t.disconnect=function(){t.state=t.DISCONNECTED,l.disconnect()},t.sendMessage=function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return t.state===t.DISCONNECTED&&"token"!==e?void o.a.error("Trying to send a message over a disconnected Socket"):t.state===t.RECONNECTING?void d(e,r,i,s):void l.emit(e,r,function(e,t){"success"===e?i(t):"error"===e?s(t):i(e,t)})},t.sendSDP=function(e,r,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(t.state===t.DISCONNECTED)return void o.a.error("Trying to send a message over a disconnected Socket");l.emit(e,r,i,function(){s.apply(void 0,arguments)})},t}},function(e,t,n){(function(t){/*!
 * Socket.IO v2.2.0
 * (c) 2014-2018 Guillermo Rauch
 * Released under the MIT License.
 */
!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e,t){"object"===(void 0===e?"undefined":i(e))&&(t=e,e=void 0),t=t||{};var n,r=o(e),s=r.source,a=r.id,d=r.path,f=u[a]&&d in u[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||f?(l("ignoring socket cache for %s",s),n=c(s,t)):(u[a]||(l("new io instance for %s",s),u[a]=c(s,t)),n=u[a]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}var i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},o=n(1),s=n(7),c=n(12),l=n(3)("socket.io-client");e.exports=t=r;var u=t.managers={};t.protocol=s.protocol,t.connect=r,t.Manager=n(12),t.Socket=n(36)},function(e,t,n){function r(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),o("parse %s",e),n=i(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var r=-1!==n.host.indexOf(":"),s=r?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}var i=n(2),o=n(3)("socket.io-client:url");e.exports=r},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,n){(function(r){function i(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)}}function s(){return"object"==("undefined"==typeof console?"undefined":a(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function c(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function l(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}t=e.exports=n(5),t.log=s,t.formatArgs=o,t.save=c,t.load=l,t.useColors=i,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(l())}).call(t,n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){m&&h&&(m=!1,h.length?p=h.concat(p):g=-1,p.length&&a())}function a(){if(!m){var e=i(s);m=!0;for(var t=p.length;t;){for(h=p,p=[];++g<t;)h&&h[g].run();g=-1,t=p.length}h=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var u,d,f=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var h,p=[],m=!1,g=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new c(e,t)),1!==p.length||m||i(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){function r(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}function i(e){function n(){if(n.enabled){var e=n,r=+new Date,o=r-(i||r);e.diff=o,e.prev=i,e.curr=r,i=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(e,o),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s);(n.log||t.log||console.log.bind(console)).apply(e,s)}}var i;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=r(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function s(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&(e=r[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}}function a(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i.debug=i.default=i,t.coerce=l,t.disable=a,t.enable=s,t.enabled=c,t.humanize=n(6),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*l;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(e){return e>=u?Math.round(e/u)+"d":e>=l?Math.round(e/l)+"h":e>=c?Math.round(e/c)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function i(e){return o(e,u,"day")||o(e,l,"hour")||o(e,c,"minute")||o(e,s,"second")||e+" ms"}function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,c=60*s,l=60*c,u=24*l,d=365.25*u;e.exports=function(e,t){t=t||{};var o=void 0===e?"undefined":a(e);if("string"===o&&e.length>0)return n(e);if("number"===o&&!1===isNaN(e))return t.long?i(e):r(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function r(){}function i(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var r=o(e.data);if(!1===r)return v;n+=r}return f("encoded %j as %s",e,n),n}function o(e){try{return JSON.stringify(e)}catch(e){return!1}}function s(e,t){function n(e){var n=p.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}p.removeBlobs(e,n)}function a(){this.reconstructor=null}function c(e){var n=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return d("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(n+1))for(r.nsp="";++n;){var o=e.charAt(n);if(","===o)break;if(r.nsp+=o,n===e.length)break}else r.nsp="/";var s=e.charAt(n+1);if(""!==s&&Number(s)==s){for(r.id="";++n;){var o=e.charAt(n);if(null==o||Number(o)!=o){--n;break}if(r.id+=e.charAt(n),n===e.length)break}r.id=Number(r.id)}if(e.charAt(++n)){var a=l(e.substr(n));if(!(!1!==a&&(r.type===t.ERROR||m(a))))return d("invalid payload");r.data=a}return f("decoded %s as %j",e,r),r}function l(e){try{return JSON.parse(e)}catch(e){return!1}}function u(e){this.reconPack=e,this.buffers=[]}function d(e){return{type:t.ERROR,data:"parser error: "+e}}var f=n(3)("socket.io-parser"),h=n(8),p=n(9),m=n(10),g=n(11);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a;var v=t.ERROR+'"encode error"';r.prototype.encode=function(e,n){if(f("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)s(e,n);else{n([i(e)])}},h(a.prototype),a.prototype.add=function(e){var n;if("string"==typeof e)n=c(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new u(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!g(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){function r(e,t){if(!e)return e;if(s(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(o(e)){for(var i=new Array(e.length),c=0;c<e.length;c++)i[c]=r(e[c],t);return i}if("object"==(void 0===e?"undefined":a(e))&&!(e instanceof Date)){var i={};for(var l in e)i[l]=r(e[l],t);return i}return e}function i(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(o(e))for(var n=0;n<e.length;n++)e[n]=i(e[n],t);else if("object"==(void 0===e?"undefined":a(e)))for(var r in e)e[r]=i(e[r],t);return e}var o=n(10),s=n(11),c=Object.prototype.toString,l="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===c.call(Blob),u="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===c.call(File);t.deconstructPacket=function(e){var t=[],n=e.data,i=e;return i.data=r(n,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function n(e,c,d){if(!e)return e;if(l&&e instanceof Blob||u&&e instanceof File){r++;var f=new FileReader;f.onload=function(){d?d[c]=this.result:i=this.result,--r||t(i)},f.readAsArrayBuffer(e)}else if(o(e))for(var h=0;h<e.length;h++)n(e[h],h,e);else if("object"==(void 0===e?"undefined":a(e))&&!s(e))for(var p in e)n(e[p],p,e)}var r=0,i=e;n(i),r||t(i)}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,n){function r(e){return i&&t.isBuffer(e)||o&&(e instanceof ArrayBuffer||s(e))}e.exports=r;var i="function"==typeof t&&"function"==typeof t.isBuffer,o="function"==typeof ArrayBuffer,s=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}},function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);e&&"object"===(void 0===e?"undefined":i(e))&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||l;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},o=n(13),s=n(36),c=n(8),l=n(7),u=n(38),d=n(39),f=n(3)("socket.io-client:manager"),h=n(35),p=n(40),m=Object.prototype.hasOwnProperty;e.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)m.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)m.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},r.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},c(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e,t){if(f("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=u(n,"open",function(){r.onopen(),e&&e()}),s=u(n,"error",function(t){if(f("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;f("connect attempt will timeout after %d",a);var c=setTimeout(function(){f("connect attempt timed out after %d",a),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(s),this},r.prototype.onopen=function(){f("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",d(this,"ondata"))),this.subs.push(u(e,"ping",d(this,"onping"))),this.subs.push(u(e,"pong",d(this,"onpong"))),this.subs.push(u(e,"error",d(this,"onerror"))),this.subs.push(u(e,"close",d(this,"onclose"))),this.subs.push(u(this.decoder,"decoded",d(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){f("error",e),this.emitAll("error",e)},r.prototype.socket=function(e,t){function n(){~h(i.connecting,r)||i.connecting.push(r)}var r=this.nsps[e];if(!r){r=new s(this,e,t),this.nsps[e]=r;var i=this;r.on("connecting",n),r.on("connect",function(){r.id=i.generateId(e)}),this.autoConnect&&n()}return r},r.prototype.destroy=function(e){var t=h(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},r.prototype.packet=function(e){f("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){f("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){f("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){f("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();f("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(f("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(f("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(f("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){e.exports=n(14),e.exports.parser=n(21)},function(e,t,n){function r(e,t){return this instanceof r?(t=t||{},e&&"object"==(void 0===e?"undefined":a(e))&&(t=e,e=null),e?(e=d(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=d(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=f.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new r(e,t)}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var o=n(15),s=n(8),c=n(3)("engine.io-client:socket"),l=n(35),u=n(21),d=n(2),f=n(29);e.exports=r,r.priorWebsocketSuccess=!1,s(r.prototype),r.protocol=u.protocol,r.Socket=r,r.Transport=n(20),r.transports=n(15),r.parser=n(21),r.prototype.createTransport=function(e){c('creating transport "%s"',e);var t=i(this.query);t.EIO=u.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new o[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){c("setting transport %s",e.name);var t=this;this.transport&&(c("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(f.onlyBinaryUpgrades){var t=!this.supportsBinary&&f.transport.supportsBinary;d=d||t}d||(c('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(t){if(!d)if("pong"===t.type&&"probe"===t.data){if(c('probe transport "%s" pong',e),f.upgrading=!0,f.emit("upgrading",u),!u)return;r.priorWebsocketSuccess="websocket"===u.name,c('pausing current transport "%s"',f.transport.name),f.transport.pause(function(){d||"closed"!==f.readyState&&(c("changing transport and sending upgrade packet"),l(),f.setTransport(u),u.send([{type:"upgrade"}]),f.emit("upgrade",u),u=null,f.upgrading=!1,f.flush())})}else{c('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=u.name,f.emit("upgradeError",n)}}))}function n(){d||(d=!0,l(),u.close(),u=null)}function i(t){var r=new Error("probe error: "+t);r.transport=u.name,n(),c('probe transport "%s" failed because of error: %s',e,t),f.emit("upgradeError",r)}function o(){i("transport closed")}function s(){i("socket closed")}function a(e){u&&e.name!==u.name&&(c('"%s" works - aborting "%s"',e.name,u.name),n())}function l(){u.removeListener("open",t),u.removeListener("error",i),u.removeListener("close",o),f.removeListener("close",s),f.removeListener("upgrading",a)}c('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),d=!1,f=this;r.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",i),u.once("close",o),this.once("close",s),this.once("upgrading",a),u.open()},r.prototype.onOpen=function(){if(c("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){c("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(c('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else c('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){c("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(c("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},r.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),c("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){c("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){c('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~l(this.transports,e[n])&&t.push(e[n]);return t}},function(e,t,n){function r(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,n=e.secure!==a}if(e.xdomain=t,e.xscheme=n,"open"in new i(e)&&!e.forceJSONP)return new o(e);if(!r)throw new Error("JSONP disabled");return new s(e)}var i=n(16),o=n(18),s=n(32),a=n(33);t.polling=r,t.websocket=a},function(e,t,n){var r=n(17);e.exports=function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){function r(){}function i(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function s(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var a=n(16),c=n(19),l=n(8),u=n(30),d=n(3)("engine.io-client:polling-xhr");if(e.exports=i,e.exports.Request=o,u(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},i.prototype.doPoll=function(){d("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},l(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),n=this;try{d("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},d("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var f="onpagehide"in self?"pagehide":"unload";addEventListener(f,s,!1)}},function(e,t,n){function r(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=n(20),o=n(29),s=n(21),a=n(30),c=n(31),l=n(3)("engine.io-client:polling");e.exports=r;var u=function(){return null!=new(n(16))({xdomain:!1}).responseType}();a(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){l("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(l("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){l("pre-pause polling complete"),--r||t()})),this.writable||(l("we are currently writing - waiting to pause"),r++,this.once("drain",function(){l("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;l("polling got data %s",e);var n=function(e,n,r){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){l("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var i=n(21),o=n(8);e.exports=r,o(r.prototype),r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){function r(e,n){return n("b"+t.packets[e.type]+e.data.data)}function i(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=y[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return r(s.buffer)}function o(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(e.data)}function s(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(v)return o(e,n,r);var i=new Uint8Array(1);return i[0]=y[e.type],r(new S([i.buffer,e.data]))}function a(e){try{e=p.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,n){for(var r=new Array(e.length),i=h(e.length,n),o=0;o<e.length;o++)!function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})}(o,e[o],i)}var l,u=n(22),d=n(23),f=n(24),h=n(25),p=n(26);"undefined"!=typeof ArrayBuffer&&(l=n(27));var m="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),g="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),v=m||g;t.protocol=3;var y=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},C=u(y),b={type:"error",data:"parser error"},S=n(28);t.encodePacket=function(e,t,n,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof n&&(o=n,n=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return i(e,t,o);if(void 0!==S&&a instanceof S)return s(e,t,o);if(a&&a.base64)return r(e,o);var c=y[e.type];return void 0!==e.data&&(c+=n?p.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r="b"+t.packets[e.type];if(void 0!==S&&e.data instanceof S){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(r+e)},i.readAsDataURL(e.data)}var o;try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];o=String.fromCharCode.apply(null,a)}return r+=btoa(o),n(r)},t.decodePacket=function(e,n,r){if(void 0===e)return b;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=a(e)))return b;var i=e.charAt(0);return Number(i)==i&&C[i]?e.length>1?{type:C[i],data:e.substring(1)}:{type:C[i]}:b}var o=new Uint8Array(e),i=o[0],s=f(e,1);return S&&"blob"===n&&(s=new S([s])),{type:C[i],data:s}},t.decodeBase64Packet=function(e,t){var n=C[e.charAt(0)];if(!l)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=l.decode(e.substr(1));return"blob"===t&&S&&(r=new S([r])),{type:n,data:r}},t.encodePayload=function(e,n,r){function i(e){return e.length+":"+e}function o(e,r){t.encodePacket(e,!!s&&n,!1,function(e){r(null,i(e))})}"function"==typeof n&&(r=n,n=null);var s=d(e);return n&&s?S&&!v?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void c(e,o,function(e,t){return r(t.join(""))}):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);"function"==typeof n&&(r=n,n=null);var i;if(""===e)return r(b,0,1);for(var o,s,a="",c=0,l=e.length;c<l;c++){var u=e.charAt(c);if(":"===u){if(""===a||a!=(o=Number(a)))return r(b,0,1);if(s=e.substr(c+1,o),a!=s.length)return r(b,0,1);if(s.length){if(i=t.decodePacket(s,n,!1),b.type===i.type&&b.data===i.data)return r(b,0,1);if(!1===r(i,c+o,l))return}c+=o,a=""}else a+=u}return""!==a?r(b,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})}return e.length?void c(e,r,function(e,t){var r=t.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}i[o++]=t?0:1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(var r=new Uint8Array(n),s=0;s<r.length;s++)i[o++]=r[s]}),n(i.buffer)}):n(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}for(var o=e instanceof ArrayBuffer?e.byteLength:e.size,s=o.toString(),a=new Uint8Array(s.length+1),i=0;i<s.length;i++)a[i]=parseInt(s[i]);if(a[s.length]=255,S){var c=new S([t.buffer,a.buffer,e]);n(null,c)}})}c(e,r,function(e,t){return n(new S(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),a=0===s[0],c="",l=1;255!==s[l];l++){if(c.length>310)return r(b,0,1);c+=s[l]}i=f(i,2+c.length),c=parseInt(c);var u=f(i,0,c);if(a)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var d=new Uint8Array(u);u="";for(var l=0;l<d.length;l++)u+=String.fromCharCode(d[l])}o.push(u),i=f(i,c)}var h=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,h)})}},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,n,r){function i(e){if(!e||"object"!=(void 0===e?"undefined":a(e)))return!1;if(o(e)){for(var n=0,r=e.length;n<r;n++)if(i(e[n]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||c&&e instanceof Blob||l&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return i(e.toJSON(),!0);for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&i(e[s]))return!0;return!1}var o=r(10),s=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),l="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);e.exports=i},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)o[a]=i[s];return o.buffer}},function(e,t){function n(e,t,n){function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}var o=!1;return n=n||r,i.count=e,0===e?t():i}function r(){}e.exports=n},function(e,t){function n(e){for(var t,n,r=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function r(e){for(var t,n=e.length,r=-1,i="";++r<n;)t=e[r],t>65535&&(t-=65536,i+=p(t>>>10&1023|55296),t=56320|1023&t),i+=p(t);return i}function i(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function o(e,t){return p(e>>t&63|128)}function s(e,t){if(0==(4294967168&e))return p(e);var n="";return 0==(4294965248&e)?n=p(e>>6&31|192):0==(4294901760&e)?(i(e,t)||(e=65533),n=p(e>>12&15|224),n+=o(e,6)):0==(4292870144&e)&&(n=p(e>>18&7|240),n+=o(e,12),n+=o(e,6)),n+=p(63&e|128)}function a(e,t){t=t||{};for(var r,i=!1!==t.strict,o=n(e),a=o.length,c=-1,l="";++c<a;)r=o[c],l+=s(r,i);return l}function c(){if(h>=f)throw Error("Invalid byte index");var e=255&d[h];if(h++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function l(e){var t,n,r,o,s;if(h>f)throw Error("Invalid byte index");if(h==f)return!1;if(t=255&d[h],h++,0==(128&t))return t;if(192==(224&t)){if(n=c(),(s=(31&t)<<6|n)>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&t)){if(n=c(),r=c(),(s=(15&t)<<12|n<<6|r)>=2048)return i(s,e)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=c(),r=c(),o=c(),(s=(7&t)<<18|n<<12|r<<6|o)>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}function u(e,t){t=t||{};var i=!1!==t.strict;d=n(e),f=d.length,h=0;for(var o,s=[];!1!==(o=l(i));)s.push(o);return r(s)}/*! https://mths.be/utf8js v2.1.2 by @mathias */var d,f,h,p=String.fromCharCode;e.exports={version:"2.1.2",encode:a,decode:u}},function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,s,a=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),d=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],d[l++]=r<<2|i>>4,d[l++]=(15&i)<<4|o>>2,d[l++]=(3&o)<<6|63&s;return u}}()},function(e,t){function n(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function r(e,t){t=t||{};var r=new o;return n(e).forEach(function(e){r.append(e)}),t.type?r.getBlob(t.type):r.getBlob()}function i(e,t){return new Blob(n(e),t||{})}var o=void 0!==o?o:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;"undefined"!=typeof Blob&&(r.prototype=Blob.prototype,i.prototype=Blob.prototype),e.exports=function(){return s?a?Blob:i:c?r:void 0}()},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(e){var t="";do{t=s[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function r(e){var t=0;for(u=0;u<e.length;u++)t=t*a+c[e.charAt(u)];return t}function i(){var e=n(+new Date);return e!==o?(l=0,o=e):e+"."+n(l++)}for(var o,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},l=0,u=0;u<a;u++)c[s[u]]=u;i.encode=n,i.decode=r,e.exports=i},function(e,t,n){(function(t){function r(){}function i(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function o(e){if(s.call(this,e),this.query=this.query||{},!c){var t=i();c=t.___eio=t.___eio||[]}this.index=c.length;var n=this;c.push(function(e){n.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var s=n(19),a=n(30);e.exports=o;var c;a(o,s),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe"),o.name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),e=e.replace(/\\n/g,"\\\n"),this.area.value=e.replace(/\n/g,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,function(){return this}())},function(e,n,r){function i(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(h=s),a.call(this,e)}var o,s,a=r(20),c=r(21),l=r(29),u=r(30),d=r(31),f=r(3)("engine.io-client:websocket");if("undefined"==typeof self)try{s=r(34)}catch(e){}else o=self.WebSocket||self.MozWebSocket;var h=o||s;e.exports=i,u(i,a),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new h(e,t):new h(e):new h(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},i.prototype.write=function(e){function n(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var i=e.length,o=0,s=i;o<s;o++)!function(e){c.encodePacket(e,r.supportsBinary,function(o){if(!r.usingBrowserWebSocket){var s={};if(e.options&&(s.compress=e.options.compress),r.perMessageDeflate){("string"==typeof o?t.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(s.compress=!1)}}try{r.usingBrowserWebSocket?r.ws.send(o):r.ws.send(o,s)}catch(e){f("websocket closed before onclose event")}--i||n()})}(e[o])},i.prototype.onClose=function(){a.prototype.onClose.call(this)},i.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=d()),this.supportsBinary||(e.b64=1),e=l.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},i.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===i.prototype.name)}},function(e,t){},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,n){function r(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},o=n(7),s=n(8),c=n(37),l=n(38),u=n(39),d=n(3)("socket.io-client:socket"),f=n(29),h=n(23);e.exports=r;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},m=s.prototype.emit;s(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[l(e,"open",u(this,"onopen")),l(e,"packet",u(this,"onpacket")),l(e,"close",u(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var e=c(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(p.hasOwnProperty(e))return m.apply(this,arguments),this;var t=c(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:h(t))?o.BINARY_EVENT:o.EVENT,data:t};return n.options={},n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===i(this.query)?f.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},r.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===o.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?m.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=c(arguments);d("sending ack %j",r),t.packet({type:h(r)?o.BINARY_ACK:o.ACK,id:e,data:r})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)m.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags.compress=e,this},r.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){function n(e,t){var n=[];t=t||0;for(var r=t||0;r<e.length;r++)n[r-t]=e[r];return n}e.exports=n},function(e,t){function n(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}e.exports=n},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])})}).call(t,n(42).Buffer)},function(e,t,n){(function(e){function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return s(this,e,t,n)}function s(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,n,r):"string"==typeof t?u(e,t,n):h(e,t)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,n,r){return a(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}function l(e,t){if(a(t),e=i(e,t<0?0:0|p(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,n);e=i(e,r);var s=e.write(t,n);return s!==r&&(e=e.slice(0,s)),e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=d(e,t),e}function h(e,t){if(o.isBuffer(t)){var n=0|p(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||K(t.length)?i(e,0):d(e,t);if("Buffer"===t.type&&$(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),o.alloc(+e)}function g(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(r)return W(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return x(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function C(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}var l;if(i){var u=-1;for(l=n;l<a;l++)if(o(e,l)===o(t,-1===u?0:l-u)){if(-1===u&&(u=l),l-u+1===c)return u*s}else-1!==u&&(l-=l-u),u=-1}else for(n+c>a&&(n=a-c),l=n;l>=0;l--){for(var d=!0,f=0;f<c;f++)if(o(e,l+f)!==o(t,f)){d=!1;break}if(d)return l}return-1}function S(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function T(e,t,n,r){return Y(W(t,e.length-n),e,n,r)}function A(e,t,n,r){return Y(G(t),e,n,r)}function E(e,t,n,r){return A(e,t,n,r)}function _(e,t,n,r){return Y(J(t),e,n,r)}function w(e,t,n,r){return Y(z(t,e.length-n),e,n,r)}function R(e,t,n){return 0===t&&n===e.length?X.fromByteArray(e):X.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var c,l,u,d;switch(a){case 1:o<128&&(s=o);break;case 2:c=e[i+1],128==(192&c)&&(d=(31&o)<<6|63&c)>127&&(s=d);break;case 3:c=e[i+1],l=e[i+2],128==(192&c)&&128==(192&l)&&(d=(15&o)<<12|(63&c)<<6|63&l)>2047&&(d<55296||d>57343)&&(s=d);break;case 4:c=e[i+1],l=e[i+2],u=e[i+3],128==(192&c)&&128==(192&l)&&128==(192&u)&&(d=(15&o)<<18|(63&c)<<12|(63&l)<<6|63&u)>65535&&d<1114112&&(s=d)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return I(r)}function I(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return n}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function O(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=H(e[o]);return i}function D(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,r,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,i){return i||j(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,i){return i||j(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(e,t,n,r,52,8),n+8}function F(e){if(e=V(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function V(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function z(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function J(e){return X.toByteArray(F(e))}function Y(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function K(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var X=n(43),Q=n(44),$=n(45);t.Buffer=o,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return s(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return c(null,e,t,n)},o.allocUnsafe=function(e){return l(null,e)},o.allocUnsafeSlow=function(e){return l(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!$(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=g,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,c=Math.min(s,a),l=this.slice(r,i),u=e.slice(t,n),d=0;d<c;++d)if(l[d]!==u[d]){s=l[d],a=u[d];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return C(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return C(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=o.prototype;else{var i=t-e;r=new o(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),Q.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),Q.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),Q.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),Q.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){L(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){L(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=o.isBuffer(e)?e:W(new o(e,r).toString()),c=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%c]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,n(9))},function(e,t,n){function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function i(e){var t=r(e),n=t[0],i=t[1];return 3*(n+i)/4-i}function o(e,t,n){return 3*(t+n)/4-n}function s(e){for(var t,n=r(e),i=n[0],s=n[1],a=new f(o(e,i,s)),c=0,l=s>0?i-4:i,u=0;u<l;u+=4)t=d[e.charCodeAt(u)]<<18|d[e.charCodeAt(u+1)]<<12|d[e.charCodeAt(u+2)]<<6|d[e.charCodeAt(u+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;return 2===s&&(t=d[e.charCodeAt(u)]<<2|d[e.charCodeAt(u+1)]>>4,a[c++]=255&t),1===s&&(t=d[e.charCodeAt(u)]<<10|d[e.charCodeAt(u+1)]<<4|d[e.charCodeAt(u+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t),a}function a(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function c(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(a(r));return i.join("")}function l(e){for(var t,n=e.length,r=n%3,i=[],o=0,s=n-r;o<s;o+=16383)i.push(c(e,o,o+16383>s?s:o+16383));return 1===r?(t=e[n-1],i.push(u[t>>2]+u[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(u[t>>10]+u[t>>4&63]+u[t<<2&63]+"=")),i.join("")}t.byteLength=i,t.toByteArray=s,t.fromByteArray=l;for(var u=[],d=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,m=h.length;p<m;++p)u[p]=h[p],d[h.charCodeAt(p)]=p;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-u)-1,h>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=f,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+d],d+=f,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=l}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,d=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),t+=s+d>=1?f/c:f*Math.pow(2,1-d),t*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=p,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;e[n+h]=255&s,h+=p,s/=256,l-=8);e[n+h-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var r=n(3),i=n(24),o=function(e){var t=Object(r.a)({});t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID;var n=function(){t.bar.display()},o=function(){t.bar.hide()},s=function(e,n,r,i){(i?n*(1/e)>r:n*(1/e)<r)?(t.video.style.width=n+"px",t.video.style.height=1/e*n+"px",t.video.style.top=-(1/e*n/2-r/2)+"px",t.video.style.left="0px"):(t.video.style.height=r+"px",t.video.style.width=e*r+"px",t.video.style.left=-(e*r/2-n/2)+"px",t.video.style.top="0px")};return t.destroy=function(){t.video.pause(),delete t.resizer,t.parentNode.removeChild(t.div)},t.resize=function(){var n=t.container.offsetWidth,r=t.container.offsetHeight;e.stream.screen||!1===e.options.crop?s(16/9,n,r,!1):n===t.containerWidth&&r===t.containerHeight||s(4/3,n,r,!0),t.containerWidth=n,t.containerHeight=r},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("class","licode_player"),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),!1!==e.options.loader&&(t.loader=document.createElement("img"),t.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.loader.setAttribute("id","back_"+t.id),t.loader.setAttribute("class","licode_loader"),t.loader.setAttribute("src",t.url+"/assets/loader.gif")),t.video=document.createElement("video"),t.video.setAttribute("id","stream"+t.id),t.video.setAttribute("class","licode_stream"),t.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.video.setAttribute("autoplay","autoplay"),t.video.setAttribute("playsinline","playsinline"),e.stream.local&&(t.video.volume=0),void 0!==t.elementID?"object"===a(t.elementID)&&"function"==typeof t.elementID.appendChild?t.container=t.elementID:t.container=document.getElementById(t.elementID):t.container=document.body,t.container.appendChild(t.div),t.parentNode=t.div.parentNode,t.loader&&t.div.appendChild(t.loader),t.div.appendChild(t.video),t.containerWidth=0,t.containerHeight=0,!1!==e.options.resizer&&(t.resizer=L.ResizeSensor(t.container,t.resize),t.resize()),!1!==e.options.bar?(t.bar=Object(i.a)({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.video,options:e.options}),t.div.onmouseover=n,t.div.onmouseout=o):t.media=t.video,t.video.srcObject=t.stream,t};t.a=o},function(e,t,n){var r=n(3),i=function(e){var t=Object(r.a)({}),n=50,i=function(){t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png"),t.stream.local?t.stream.stream.getAudioTracks()[0].enabled=!1:(n=t.picker.value,t.picker.value=0,t.media.volume=0)},o=function(){t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.stream.local?t.stream.stream.getAudioTracks()[0].enabled=!0:(t.picker.value=n,t.media.volume=t.picker.value/100)};if(t.elementID=e.elementID,t.media=e.media,t.id=e.id,t.stream=e.stream,t.div=document.createElement("div"),t.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_"+t.id),t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.icon.onclick=function(){t.media.muted?o():i()},!t.stream.local){t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_"+t.id),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=n,t.picker.setAttribute("orient","vertical"),t.div.appendChild(t.picker),t.media.volume=t.picker.value/100,t.media.muted=!1,t.picker.oninput=function(){t.picker.value>0?(t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png")):(t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png")),t.media.volume=t.picker.value/100};var s=function(e){t.picker.setAttribute("style","background: transparent; width: 32px;\n                                         height: 100px; position: absolute; bottom: 90%;\n                                         z-index: 1; right: 0px; -webkit-appearance: slider-vertical;\n                                         bottom: "+t.div.offsetHeight+"px; display: "+e)};t.div.onmouseover=function(){s("block")},t.div.onmouseout=function(){s("none")},s("none")}return document.getElementById(t.elementID).appendChild(t.div),t};t.a=i},function(e,t,n){var r=n(3),i=n(24),o=function(e){var t=Object(r.a)({}),n=void 0,o=void 0;return t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID,t.audio=document.createElement("audio"),t.audio.setAttribute("id","stream"+t.id),t.audio.setAttribute("class","licode_stream"),t.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.audio.setAttribute("autoplay","autoplay"),e.stream.local&&(t.audio.volume=0),void 0!==t.elementID?(t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.div)},n=function(){t.bar.display()},o=function(){t.bar.hide()},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("class","licode_player"),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),"object"===a(t.elementID)&&"function"==typeof t.elementID.appendChild?t.container=t.elementID:t.container=document.getElementById(t.elementID),t.container.appendChild(t.div),t.parentNode=t.div.parentNode,t.div.appendChild(t.audio),!1!==e.options.bar?(t.bar=Object(i.a)({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.audio,options:e.options}),t.div.onmouseover=n,t.div.onmouseout=o):t.media=t.audio):(t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.audio)},document.body.appendChild(t.audio),t.parentNode=document.body),t.audio.srcObject=t.stream,t};t.a=o},function(e,t,n){var r=function(){for(var e=void 0,t=void 0,n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],r=[],i=0;i<n.length;i+=1)r[n[i]]=i;var o=function(n){e=n,t=0},s=function(){if(!e)return-1;if(t>=e.length)return-1;var n=255&e.charCodeAt(t);return t+=1,n},a=function(e){var t=void 0,r=void 0,i=void 0;o(e),t="";var a=new Array(3);for(r=0,i=!1;!i&&-1!==(a[0]=s());)a[1]=s(),a[2]=s(),t+=n[a[0]>>2],-1!==a[1]?(t+=n[a[0]<<4&48|a[1]>>4],-1!==a[2]?(t+=n[a[1]<<2&60|a[2]>>6],t+=n[63&a[2]]):(t+=n[a[1]<<2&60],t+="=",i=!0)):(t+=n[a[0]<<4&48],t+="=",t+="=",i=!0),(r+=4)>=76&&(t+="\n",r=0);return t},c=function(){if(!e)return-1;for(;;){if(t>=e.length)return-1;var n=e.charAt(t);if(t+=1,r[n])return r[n];if("A"===n)return 0}},l=function(e){var t=e.toString(16);return 1===t.length&&(t="0"+t),t="%"+t,unescape(t)};return{encodeBase64:a,decodeBase64:function(e){var t=void 0,n=void 0;o(e),t="";var r=new Array(4);for(n=!1;!n&&-1!==(r[0]=c())&&-1!==(r[1]=c());)r[2]=c(),r[3]=c(),t+=l(r[0]<<2&255|r[1]>>4),-1!==r[2]?(t+=l(r[1]<<4&255|r[2]>>2),-1!==r[3]?t+=l(r[2]<<6&255|r[3]):n=!0):n=!0;return t}}}();t.a=r},function(e,t,n){(function(t){e.exports=t.adapter=n(51)}).call(t,n(9))},function(e,t,n){(function(t){var n,n;!function(t){e.exports=t()}(function(){return function e(t,r,i){function o(a,c){if(!r[a]){if(!t[a]){var l="function"==typeof n&&n;if(!c&&l)return n(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n||e)},d,d.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){function r(e,t,n,r,i){var o=c.writeRtpDescription(e.kind,t);if(o+=c.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=c.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),o}function i(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}return!1})}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),s=r(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&s.parameters.apt&&!i(r,s,e.codecs,t.codecs))continue;s=JSON.parse(JSON.stringify(s)),s.numChannels=Math.min(r.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function a(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}var c=e("sdp");t.exports=function(e,t){var n=function(n){var r=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=o[e].bind(o)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy){var s=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw s.name="NotSupportedError",s}switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=i(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers=new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy});else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0};return n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},n.prototype.addTrack=function(t,n){for(var r,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},n.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},n.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].candidates&&r.transceivers[t].candidates.push(e.candidate)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},n.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].candidates;this.transceivers[n].candidates=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,a=!s||0===Object.keys(s).length;a?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),s.component=1,o.candidate.candidate=c.writeCandidate(s));var l=c.splitSections(r.localDescription.sdp);l[o.candidate.sdpMLineIndex+1]+=a?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r.localDescription.sdp=l.join("");var u=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),a||(r.dispatchEvent(o),"function"==typeof r.onicecandidate&&r.onicecandidate(o)),u&&(r.dispatchEvent(new Event("icecandidate")),"function"==typeof r.onicecandidate&&r.onicecandidate(new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,i.onlocalcandidate(t)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,n,r){var i=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:c.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},n.prototype.setLocalDescription=function(e){var t=this,n=arguments;if(!s("setLocalDescription",e.type,this.signalingState))return new Promise(function(r,i){var o=new Error("Can not set local "+e.type+" in state "+t.signalingState);o.name="InvalidStateError",n.length>2&&"function"==typeof n[2]&&n[2].apply(null,[o]),i(o)});var r,i;if("offer"===e.type)r=c.splitSections(e.sdp),i=r.shift(),r.forEach(function(e,n){var r=c.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),this.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){r=c.splitSections(t.remoteDescription.sdp),i=r.shift();var a=c.matchPrefix(i,"a=ice-lite").length>0;r.forEach(function(e,n){var r=t.transceivers[n],s=r.iceGatherer,l=r.iceTransport,u=r.dtlsTransport,d=r.localCapabilities,f=r.remoteCapabilities;if(!(c.isRejected(e)&&1===!c.matchPrefix(e,"a=bundle-only").length||r.isDatachannel)){var h=c.getIceParameters(e,i),p=c.getDtlsParameters(e,i);a&&(p.role="server"),t.usingBundle&&0!==n||(t._gather(r.mid,n),"new"===l.state&&l.start(s,h,a?"controlling":"controlled"),"new"===u.state&&u.start(p));var m=o(d,f);t._transceive(r,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var l=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){l&&l.apply(null),e()})},n.prototype.setRemoteDescription=function(n){var r=this,i=arguments;if(!s("setRemoteDescription",n.type,this.signalingState))return new Promise(function(e,t){var o=new Error("Can not set remote "+n.type+" in state "+r.signalingState);o.name="InvalidStateError",i.length>2&&"function"==typeof i[2]&&i[2].apply(null,[o]),t(o)});var o={};this.remoteStreams.forEach(function(e){o[e.id]=e});var l=[],u=c.splitSections(n.sdp),d=u.shift(),f=c.matchPrefix(d,"a=ice-lite").length>0,h=c.matchPrefix(d,"a=group:BUNDLE ").length>0;this.usingBundle=h;var p=c.matchPrefix(d,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(i,s){var u=c.splitLines(i),p=c.getKind(i),m=c.isRejected(i)&&1===!c.matchPrefix(i,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],v=c.getDirection(i,d),y=c.parseMsid(i),C=c.getMid(i)||c.generateIdentifier();if("application"===p&&"DTLS/SCTP"===g)return void(r.transceivers[s]={mid:C,isDatachannel:!0});var b,S,T,A,E,_,w,R,k,I,x,P=c.parseRtpParameters(i);m||(I=c.getIceParameters(i,d),x=c.getDtlsParameters(i,d),x.role="client"),w=c.parseRtpEncodingParameters(i);var O=c.parseRtcpParameters(i),D=c.matchPrefix(i,"a=end-of-candidates",d).length>0,N=c.matchPrefix(i,"a=candidate:").map(function(e){return c.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!m&&h&&s>0&&r.transceivers[s]&&(r._disposeIceAndDtlsTransports(s),r.transceivers[s].iceGatherer=r.transceivers[0].iceGatherer,r.transceivers[s].iceTransport=r.transceivers[0].iceTransport,r.transceivers[s].dtlsTransport=r.transceivers[0].dtlsTransport,r.transceivers[s].rtpSender&&r.transceivers[s].rtpSender.setTransport(r.transceivers[0].dtlsTransport),r.transceivers[s].rtpReceiver&&r.transceivers[s].rtpReceiver.setTransport(r.transceivers[0].dtlsTransport)),"offer"!==n.type||m)"answer"!==n.type||m||(b=r.transceivers[s],S=b.iceGatherer,T=b.iceTransport,A=b.dtlsTransport,E=b.rtpReceiver,_=b.sendEncodingParameters,R=b.localCapabilities,r.transceivers[s].recvEncodingParameters=w,r.transceivers[s].remoteCapabilities=P,r.transceivers[s].rtcpParameters=O,N.length&&"new"===T.state&&(!f&&!D||h&&0!==s?N.forEach(function(e){a(b.iceTransport,e)}):T.setRemoteCandidates(N)),h&&0!==s||("new"===T.state&&T.start(S,I,"controlling"),"new"===A.state&&A.start(x)),r._transceive(b,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!E||"sendrecv"!==v&&"sendonly"!==v?delete b.rtpReceiver:(k=E.track,y?(o[y.stream]||(o[y.stream]=new e.MediaStream),o[y.stream].addTrack(k),l.push([k,E,o[y.stream]])):(o.default||(o.default=new e.MediaStream),o.default.addTrack(k),l.push([k,E,o.default]))));else{b=r.transceivers[s]||r._createTransceiver(p),b.mid=C,b.iceGatherer||(b.iceGatherer=r._createIceGatherer(s,h)),N.length&&"new"===b.iceTransport.state&&(!D||h&&0!==s?N.forEach(function(e){a(b.iceTransport,e)}):b.iceTransport.setRemoteCandidates(N)),R=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(R.codecs=R.codecs.filter(function(e){return"rtx"!==e.name})),_=b.sendEncodingParameters||[{ssrc:1001*(2*s+2)}];var L=!1;if(("sendrecv"===v||"sendonly"===v)&&(L=!b.rtpReceiver,E=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,p),L)){var M;k=E.track,y?(o[y.stream]||(o[y.stream]=new e.MediaStream,Object.defineProperty(o[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(k,"id",{get:function(){return y.track}}),M=o[y.stream]):(o.default||(o.default=new e.MediaStream),M=o.default),M.addTrack(k),l.push([k,E,M])}b.localCapabilities=R,b.remoteCapabilities=P,b.rtpReceiver=E,b.rtcpParameters=O,b.sendEncodingParameters=_,b.recvEncodingParameters=w,r._transceive(r.transceivers[s],!1,L)}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===n.type?"active":"passive"),this.remoteDescription={type:n.type,sdp:n.sdp},n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}return Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(-1===r.remoteStreams.indexOf(n)){r.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){r.dispatchEvent(i),"function"==typeof r.onaddstream&&r.onaddstream(i)})}l.forEach(function(t){var i=t[0],o=t[1];if(n.id===t[2].id){var s=new Event("track");s.track=i,s.receiver=o,s.transceiver={receiver:o},s.streams=[n],e.setTimeout(function(){r.dispatchEvent(s),"function"==typeof r.ontrack&&r.ontrack(s)})}})}}),e.setTimeout(function(){r&&r.transceivers&&r.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){i.length>1&&"function"==typeof i[1]&&i[1].apply(null),e()})},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},n.prototype.createOffer=function(){var n,i=this,o=arguments;1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var s=this.transceivers.filter(function(e){return"audio"===e.kind}).length,a=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(s=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(a=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--s<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});s>0||a>0;)s>0&&(this._createTransceiver("audio"),s--),a>0&&(this._createTransceiver("video"),a--);var l=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(n,r){var o=n.track,s=n.kind,a=c.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(r,i.usingBundle));var l=e.RTCRtpSender.getCapabilities(s);t<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=n.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=l,n.sendEncodingParameters=u}),"max-compat"!==this._config.bundlePolicy&&(l+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){l+=r(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,l+="a="+c.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:l});return new Promise(function(e){if(o.length>0&&"function"==typeof o[0])return o[0].apply(null,[u]),void e();e(u)})},n.prototype.createAnswer=function(){var n=this,i=arguments,s=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(s+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=c.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,i){if(!(i+1>a)){if(e.isDatachannel)return void(s+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var l=o(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=r(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var l=new e.RTCSessionDescription({type:"answer",sdp:s});return new Promise(function(e){if(i.length>0&&"function"==typeof i[0])return i[0].apply(null,[l]),void e();e(l)})},n.prototype.addIceCandidate=function(e){var t,n;if(e&&""!==e.candidate){if(void 0===e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var r=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){r=i;break}var o=this.transceivers[r];if(o){if(o.isDatachannel)return Promise.resolve();var s=Object.keys(e.candidate).length>0?c.parseCandidate(e.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return Promise.resolve();if(s.component&&1!==s.component)return Promise.resolve();if((0===r||r>0&&o.iceTransport!==this.transceivers[0].iceTransport)&&(a(o.iceTransport,s)||(t=new Error("Can not add ICE candidate"),t.name="OperationError")),!t){var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),n=c.splitSections(this.remoteDescription.sdp),n[r+1]+="a="+(s.type?l:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=n.join("")}}else t=new Error("Can not add ICE candidate"),t.name="OperationError"}else t=new Error("Can not add ICE candidate without a remote description"),t.name="InvalidStateError"}else for(var u=0;u<this.transceivers.length&&(this.transceivers[u].isDatachannel||(this.transceivers[u].iceTransport.addRemoteCandidate({}),n=c.splitSections(this.remoteDescription.sdp),n[u+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=n.join(""),!this.usingBundle));u++);var d=arguments;return new Promise(function(e,n){t?(d.length>2&&"function"==typeof d[2]&&d[2].apply(null,[t]),n(t)):(d.length>1&&"function"==typeof d[1]&&d[1].apply(null),e())})},n.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]),i.set(t,e[t])})}),t&&t.apply(null,i),r(i)})})},n}},{sdp:2}],2:[function(e,t,n){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var c=r.parseRtpMap(a),l=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=l.length?r.parseFmtp(l[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=u})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].split(" ");return{kind:n[0].substr(2),port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},"object"===(void 0===t?"undefined":a(t))&&(t.exports=r)},{}],3:[function(e,n,r){(function(t){var r=e("./adapter_factory.js");n.exports=r({window:t.window})}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,n){var r=e("./utils");t.exports=function(t,n){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);var a=r.log,c=r.detectBrowser(i),l={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},u=e("./chrome/chrome_shim")||null,d=e("./edge/edge_shim")||null,f=e("./firefox/firefox_shim")||null,h=e("./safari/safari_shim")||null,p=e("./common_shim")||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),l;a("adapter.js shimming chrome."),l.browserShim=u,p.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimMediaStream(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i),p.shimRTCIceCandidate(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),l;a("adapter.js shimming firefox."),l.browserShim=f,p.shimCreateObjectURL(i),f.shimGetUserMedia(i),f.shimSourceObject(i),f.shimPeerConnection(i),f.shimOnTrack(i),p.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return a("MS edge shim is not included in this adapter release."),l;a("adapter.js shimming edge."),l.browserShim=d,p.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i);break;case"safari":if(!h||!o.shimSafari)return a("Safari shim is not included in this adapter release."),l;a("adapter.js shimming safari."),l.browserShim=h,p.shimCreateObjectURL(i),h.shimRTCIceServerUrls(i),h.shimCallbacksAPI(i),h.shimLocalStreamsAPI(i),h.shimRemoteStreamsAPI(i),h.shimTrackEventTransceiver(i),h.shimGetUserMedia(i),h.shimCreateOfferLegacy(i),p.shimRTCIceCandidate(i);break;default:a("Unsupported browser!")}return l}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(e,t,n){var r=e("../utils.js"),i=r.log,o={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this,o=n.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":a(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var i=r.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&i.version>=63)){var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}s.apply(n,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},a.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);r._streams[n.id]=s,r._reverseStreams[s.id]=n,r.addStream(s)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=l.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,i.push(s)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var s=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](a(s(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(r,[function(t){e(a(s(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===a(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimAddTrackRemoveTrack:o.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":13,"./getusermedia":6}],6:[function(e,t,n){var r=e("../utils.js"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!==(void 0===e?"undefined":a(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===a(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,r){if((e=JSON.parse(JSON.stringify(e)))&&"object"===a(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===a(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":a(c))?c:{ideal:c});var l=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var u;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return u.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==u.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)})}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},c=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},l=function(e,t,r){s(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(c(e))})})};n.getUserMedia=l;var u=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:u,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return s(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}else n.mediaDevices.getUserMedia=function(e){return u(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(e,t,n){function r(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i=e("sdp"),o=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"===(void 0===e?"undefined":a(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var n=new t(e),r=i.parseCandidate(e.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},r(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":a(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),i=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),i.delete(e)};var c=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return c.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,c.set.apply(this,[e])}});var l=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),l.apply(this,arguments)}}}}},{"./utils":13,sdp:2}],8:[function(e,t,n){var r=e("../utils"),i=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(e,t,n){t.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},{}],10:[function(e,t,n){var r=e("../utils"),i={shimOnTrack:function(e){"object"!==(void 0===e?"undefined":a(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"===(void 0===e?"undefined":a(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":a(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"===(void 0===e?"undefined":a(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var s=n.iceServers[o];if(s.hasOwnProperty("urls"))for(var a=0;a<s.urls.length;a++){var c={url:s.urls[a]};0===s.urls[a].indexOf("turn")&&(c.username=s.username,c.credential=s.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":13,"./getusermedia":11}],11:[function(e,t,n){var r=e("../utils"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,r,o){var c=function(e){if("object"!==(void 0===e?"undefined":a(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"===a(e[n])?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=c(e.audio)),e.video&&(e.video=c(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(s(e))})},l=function(e){return new Promise(function(t,n){c(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:l,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var u=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return u().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(s(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var f=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},h=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":a(e))&&"object"===a(e.audio)&&(e=JSON.parse(JSON.stringify(e)),f(e.audio,"autoGainControl","mozAutoGainControl"),f(e.audio,"noiseSuppression","mozNoiseSuppression")),h(e)},o&&o.prototype.getSettings){var p=o.prototype.getSettings;o.prototype.getSettings=function(){var e=p.apply(this,arguments);return f(e,"mozAutoGainControl","autoGainControl"),f(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var m=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":a(e))&&(e=JSON.parse(JSON.stringify(e)),f(e,"autoGainControl","mozAutoGainControl"),f(e,"noiseSuppression","mozNoiseSuppression")),m.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return c(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":13}],12:[function(e,t,n){var r=e("../utils"),i={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}};t.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},{"../utils":13}],13:[function(e,t,n){var r=!0,i=!0,o={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":a(e))+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":a(e))+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":a(window))){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}};t.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},{}]},{},[3])(3)})}).call(t,n(9))},function(e,t,n){n(53)(n(54))},function(e,t){e.exports=function(e){function t(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&function(){return"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener}()?execScript(e):"undefined"!=typeof eval?eval.call(null,e):t("EvalError: No eval function available")}catch(e){t(e)}}},function(e,t){e.exports="/* globals $$, jQuery, Elements, document, window, L */\r\n\r\n/**\r\n* Copyright 2013 Marc J. Schmidt. See the LICENSE file at the top-level\r\n* directory of this distribution and at\r\n* https://github.com/marcj/css-element-queries/blob/master/LICENSE.\r\n*/\r\nthis.L = this.L || {};\r\n\r\n/**\r\n * @param {HTMLElement} element\r\n * @param {String}      prop\r\n * @returns {String|Number}\r\n */\r\nL.GetComputedStyle = (computedElement, prop) => {\r\n  if (computedElement.currentStyle) {\r\n    return computedElement.currentStyle[prop];\r\n  } else if (window.getComputedStyle) {\r\n    return window.getComputedStyle(computedElement, null).getPropertyValue(prop);\r\n  }\r\n  return computedElement.style[prop];\r\n};\r\n\r\n  /**\r\n   *\r\n   * @type {Function}\r\n   * @constructor\r\n   */\r\nL.ElementQueries = function ElementQueries() {\r\n      /**\r\n       *\r\n       * @param element\r\n       * @returns {Number}\r\n       */\r\n  function getEmSize(element = document.documentElement) {\r\n    const fontSize = L.GetComputedStyle(element, 'fontSize');\r\n    return parseFloat(fontSize) || 16;\r\n  }\r\n\r\n      /**\r\n       *\r\n       * @copyright https://github.com/Mr0grog/element-query/blob/master/LICENSE\r\n       *\r\n       * @param element\r\n       * @param value\r\n       * @param units\r\n       * @returns {*}\r\n       */\r\n  function convertToPx(element, originalValue) {\r\n    let vh;\r\n    let vw;\r\n    let chooser;\r\n    const units = originalValue.replace(/[0-9]*/, '');\r\n    const value = parseFloat(originalValue);\r\n    switch (units) {\r\n      case 'px':\r\n        return value;\r\n      case 'em':\r\n        return value * getEmSize(element);\r\n      case 'rem':\r\n        return value * getEmSize();\r\n              // Viewport units!\r\n              // According to http://quirksmode.org/mobile/tableViewport.html\r\n              // documentElement.clientWidth/Height gets us the most reliable info\r\n      case 'vw':\r\n        return (value * document.documentElement.clientWidth) / 100;\r\n      case 'vh':\r\n        return (value * document.documentElement.clientHeight) / 100;\r\n      case 'vmin':\r\n      case 'vmax':\r\n        vw = document.documentElement.clientWidth / 100;\r\n        vh = document.documentElement.clientHeight / 100;\r\n        chooser = Math[units === 'vmin' ? 'min' : 'max'];\r\n        return value * chooser(vw, vh);\r\n      default:\r\n        return value;\r\n              // for now, not supporting physical units (since they are just a set number of px)\r\n              // or ex/ch (getting accurate measurements is hard)\r\n    }\r\n  }\r\n\r\n      /**\r\n       *\r\n       * @param {HTMLElement} element\r\n       * @constructor\r\n       */\r\n  function SetupInformation(element) {\r\n    this.element = element;\r\n    this.options = [];\r\n    let i;\r\n    let j;\r\n    let option;\r\n    let width = 0;\r\n    let height = 0;\r\n    let value;\r\n    let actualValue;\r\n    let attrValues;\r\n    let attrValue;\r\n    let attrName;\r\n\r\n          /**\r\n           * @param option {mode: 'min|max', property: 'width|height', value: '123px'}\r\n           */\r\n    this.addOption = (newOption) => {\r\n      this.options.push(newOption);\r\n    };\r\n\r\n    const attributes = ['min-width', 'min-height', 'max-width', 'max-height'];\r\n\r\n          /**\r\n           * Extracts the computed width/height and sets to min/max- attribute.\r\n           */\r\n    this.call = () => {\r\n              // extract current dimensions\r\n      width = this.element.offsetWidth;\r\n      height = this.element.offsetHeight;\r\n\r\n      attrValues = {};\r\n\r\n      for (i = 0, j = this.options.length; i < j; i += 1) {\r\n        option = this.options[i];\r\n        value = convertToPx(this.element, option.value);\r\n\r\n        actualValue = option.property === 'width' ? width : height;\r\n        attrName = `${option.mode}-${option.property}`;\r\n        attrValue = '';\r\n\r\n        if (option.mode === 'min' && actualValue >= value) {\r\n          attrValue += option.value;\r\n        }\r\n\r\n        if (option.mode === 'max' && actualValue <= value) {\r\n          attrValue += option.value;\r\n        }\r\n\r\n        if (!attrValues[attrName]) attrValues[attrName] = '';\r\n        if (attrValue && (` ${attrValues[attrName]} `)\r\n                                            .indexOf(` ${attrValue} `) === -1) {\r\n          attrValues[attrName] += ` ${attrValue}`;\r\n        }\r\n      }\r\n\r\n      for (let k = 0; k < attributes.length; k += 1) {\r\n        if (attrValues[attributes[k]]) {\r\n          this.element.setAttribute(attributes[k],\r\n                                                attrValues[attributes[k]].substr(1));\r\n        } else {\r\n          this.element.removeAttribute(attributes[k]);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n      /**\r\n       * @param {HTMLElement} element\r\n       * @param {Object}      options\r\n       */\r\n  function setupElement(originalElement, options) {\r\n    const element = originalElement;\r\n    if (element.elementQueriesSetupInformation) {\r\n      element.elementQueriesSetupInformation.addOption(options);\r\n    } else {\r\n      element.elementQueriesSetupInformation = new SetupInformation(element);\r\n      element.elementQueriesSetupInformation.addOption(options);\r\n      element.sensor = new L.ResizeSensor(element, () => {\r\n        element.elementQueriesSetupInformation.call();\r\n      });\r\n    }\r\n    element.elementQueriesSetupInformation.call();\r\n    return element;\r\n  }\r\n\r\n      /**\r\n       * @param {String} selector\r\n       * @param {String} mode min|max\r\n       * @param {String} property width|height\r\n       * @param {String} value\r\n       */\r\n  function queueQuery(selector, mode, property, value) {\r\n    let query;\r\n    if (document.querySelectorAll) query = document.querySelectorAll.bind(document);\r\n    if (!query && typeof $$ !== 'undefined') query = $$;\r\n    if (!query && typeof jQuery !== 'undefined') query = jQuery;\r\n\r\n    if (!query) {\r\n      throw new Error('No document.querySelectorAll, jQuery or Mootools\\'s $$ found.');\r\n    }\r\n\r\n    const elements = query(selector) || [];\r\n    for (let i = 0, j = elements.length; i < j; i += 1) {\r\n      elements[i] = setupElement(elements[i], {\r\n        mode,\r\n        property,\r\n        value,\r\n      });\r\n    }\r\n  }\r\n\r\n  const regex = /,?([^,\\n]*)\\[[\\s\\t]*(min|max)-(width|height)[\\s\\t]*[~$^]?=[\\s\\t]*\"([^\"]*)\"[\\s\\t]*]([^\\n\\s{]*)/mgi;  // jshint ignore:line\r\n\r\n      /**\r\n       * @param {String} css\r\n       */\r\n  function extractQuery(originalCss) {\r\n    let match;\r\n    const css = originalCss.replace(/'/g, '\"');\r\n    while ((match = regex.exec(css)) !== null) {\r\n      if (match.length > 5) {\r\n        queueQuery(match[1] || match[5], match[2], match[3], match[4]);\r\n      }\r\n    }\r\n  }\r\n\r\n      /**\r\n       * @param {CssRule[]|String} rules\r\n       */\r\n  function readRules(originalRules) {\r\n    if (!originalRules) {\r\n      return;\r\n    }\r\n    let selector = '';\r\n    let rules = originalRules;\r\n    if (typeof originalRules === 'string') {\r\n      rules = originalRules.toLowerCase();\r\n      if (rules.indexOf('min-width') !== -1 || rules.indexOf('max-width') !== -1) {\r\n        extractQuery(rules);\r\n      }\r\n    } else {\r\n      for (let i = 0, j = rules.length; i < j; i += 1) {\r\n        if (rules[i].type === 1) {\r\n          selector = rules[i].selectorText || rules[i].cssText;\r\n          if (selector.indexOf('min-height') !== -1 ||\r\n                          selector.indexOf('max-height') !== -1) {\r\n            extractQuery(selector);\r\n          } else if (selector.indexOf('min-width') !== -1 ||\r\n                                 selector.indexOf('max-width') !== -1) {\r\n            extractQuery(selector);\r\n          }\r\n        } else if (rules[i].type === 4) {\r\n          readRules(rules[i].cssRules || rules[i].rules);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n      /**\r\n       * Searches all css rules and setups the event listener\r\n       * to all elements with element query rules..\r\n       */\r\n  this.init = () => {\r\n    const styleSheets = document.styleSheets || [];\r\n    for (let i = 0, j = styleSheets.length; i < j; i += 1) {\r\n      if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'cssText')) {\r\n        readRules(styleSheets[i].cssText);\r\n      } else if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'cssRules')) {\r\n        readRules(styleSheets[i].cssRules);\r\n      } else if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'rules')) {\r\n        readRules(styleSheets[i].rules);\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\nfunction init() {\r\n  (new L.ElementQueries()).init();\r\n}\r\n\r\nif (window.addEventListener) {\r\n  window.addEventListener('load', init, false);\r\n} else {\r\n  window.attachEvent('onload', init);\r\n}\r\n\r\n  /**\r\n   * Iterate over each of the provided element(s).\r\n   *\r\n   * @param {HTMLElement|HTMLElement[]} elements\r\n   * @param {Function}                  callback\r\n   */\r\nfunction forEachElement(elements, callback = () => {}) {\r\n  const elementsType = Object.prototype.toString.call(elements);\r\n  const isCollectionTyped = (elementsType === '[object Array]' ||\r\n          (elementsType === '[object NodeList]') ||\r\n          (elementsType === '[object HTMLCollection]') ||\r\n          (typeof jQuery !== 'undefined' && elements instanceof jQuery) || // jquery\r\n          (typeof Elements !== 'undefined' && elements instanceof Elements) // mootools\r\n      );\r\n  let i = 0;\r\n  const j = elements.length;\r\n  if (isCollectionTyped) {\r\n    for (; i < j; i += 1) {\r\n      callback(elements[i]);\r\n    }\r\n  } else {\r\n    callback(elements);\r\n  }\r\n}\r\n  /**\r\n   * Class for dimension change detection.\r\n   *\r\n   * @param {Element|Element[]|Elements|jQuery} element\r\n   * @param {Function} callback\r\n   *\r\n   * @constructor\r\n   */\r\nL.ResizeSensor = function ResizeSensor(element, callback = () => {}) {\r\n      /**\r\n       *\r\n       * @constructor\r\n       */\r\n  function EventQueue() {\r\n    let q = [];\r\n    this.add = (ev) => {\r\n      q.push(ev);\r\n    };\r\n\r\n    let i;\r\n    let j;\r\n    this.call = () => {\r\n      for (i = 0, j = q.length; i < j; i += 1) {\r\n        q[i].call();\r\n      }\r\n    };\r\n\r\n    this.remove = (ev) => {\r\n      const newQueue = [];\r\n      for (i = 0, j = q.length; i < j; i += 1) {\r\n        if (q[i] !== ev) newQueue.push(q[i]);\r\n      }\r\n      q = newQueue;\r\n    };\r\n\r\n    this.length = () => q.length;\r\n  }\r\n\r\n      /**\r\n       *\r\n       * @param {HTMLElement} element\r\n       * @param {Function}    resized\r\n       */\r\n  function attachResizeEvent(htmlElement, resized) {\r\n    // Only used for the dirty checking, so the event callback count is limted\r\n    //  to max 1 call per fps per sensor.\r\n    // In combination with the event based resize sensor this saves cpu time,\r\n    // because the sensor is too fast and\r\n    // would generate too many unnecessary events.\r\n    const customRequestAnimationFrame = window.requestAnimationFrame ||\r\n    window.mozRequestAnimationFrame ||\r\n    window.webkitRequestAnimationFrame ||\r\n    function delay(fn) {\r\n      return window.setTimeout(fn, 20);\r\n    };\r\n\r\n    const newElement = htmlElement;\r\n    if (!newElement.resizedAttached) {\r\n      newElement.resizedAttached = new EventQueue();\r\n      newElement.resizedAttached.add(resized);\r\n    } else if (newElement.resizedAttached) {\r\n      newElement.resizedAttached.add(resized);\r\n      return;\r\n    }\r\n\r\n    newElement.resizeSensor = document.createElement('div');\r\n    newElement.resizeSensor.className = 'resize-sensor';\r\n    const style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; ' +\r\n                      'overflow: hidden; z-index: -1; visibility: hidden;';\r\n    const styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\r\n\r\n    newElement.resizeSensor.style.cssText = style;\r\n    newElement.resizeSensor.innerHTML =\r\n              `<div class=\"resize-sensor-expand\" style=\"${style}\">` +\r\n                  `<div style=\"${styleChild}\"></div>` +\r\n              '</div>' +\r\n              `<div class=\"resize-sensor-shrink\" style=\"${style}\">` +\r\n                  `<div style=\"${styleChild} width: 200%; height: 200%\"></div>` +\r\n              '</div>';\r\n    newElement.appendChild(newElement.resizeSensor);\r\n\r\n    if (L.GetComputedStyle(newElement, 'position') === 'static') {\r\n      newElement.style.position = 'relative';\r\n    }\r\n\r\n    const expand = newElement.resizeSensor.childNodes[0];\r\n    const expandChild = expand.childNodes[0];\r\n    const shrink = newElement.resizeSensor.childNodes[1];\r\n\r\n    const reset = () => {\r\n      expandChild.style.width = `${100000}px`;\r\n      expandChild.style.height = `${100000}px`;\r\n\r\n      expand.scrollLeft = 100000;\r\n      expand.scrollTop = 100000;\r\n\r\n      shrink.scrollLeft = 100000;\r\n      shrink.scrollTop = 100000;\r\n    };\r\n\r\n    reset();\r\n    let dirty = false;\r\n\r\n    const dirtyChecking = () => {\r\n      if (!newElement.resizedAttached) return;\r\n\r\n      if (dirty) {\r\n        newElement.resizedAttached.call();\r\n        dirty = false;\r\n      }\r\n\r\n      customRequestAnimationFrame(dirtyChecking);\r\n    };\r\n\r\n    customRequestAnimationFrame(dirtyChecking);\r\n    let lastWidth;\r\n    let lastHeight;\r\n    let cachedWidth;\r\n    let cachedHeight; // useful to not query offsetWidth twice\r\n\r\n    const onScroll = () => {\r\n      if ((cachedWidth = newElement.offsetWidth) !== lastWidth ||\r\n                (cachedHeight = newElement.offsetHeight) !== lastHeight) {\r\n        dirty = true;\r\n\r\n        lastWidth = cachedWidth;\r\n        lastHeight = cachedHeight;\r\n      }\r\n      reset();\r\n    };\r\n\r\n    const addEvent = (el, name, cb) => {\r\n      if (el.attachEvent) {\r\n        el.attachEvent(`on${name}`, cb);\r\n      } else {\r\n        el.addEventListener(name, cb);\r\n      }\r\n    };\r\n\r\n    addEvent(expand, 'scroll', onScroll);\r\n    addEvent(shrink, 'scroll', onScroll);\r\n  }\r\n\r\n  forEachElement(element, (elem) => {\r\n    attachResizeEvent(elem, callback);\r\n  });\r\n\r\n  this.detach = (ev) => {\r\n    L.ResizeSensor.detach(element, ev);\r\n  };\r\n};\r\n\r\nL.ResizeSensor.detach = (element, ev) => {\r\n  forEachElement(element, (elem) => {\r\n    const elementItem = elem;\r\n    if (elementItem.resizedAttached && typeof ev === 'function') {\r\n      elementItem.resizedAttached.remove(ev);\r\n      if (elementItem.resizedAttached.length()) return;\r\n    }\r\n    if (elementItem.resizeSensor) {\r\n      if (elementItem.contains(elementItem.resizeSensor)) {\r\n        elementItem.removeChild(elementItem.resizeSensor);\r\n      }\r\n      delete elementItem.resizeSensor;\r\n      delete elementItem.resizedAttached;\r\n    }\r\n  });\r\n};\r\n"}]).default},161:function(e,t,n){"use strict";(function(n){var r,i,o,s,s,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){if("object"===a(t)&&void 0!==e)e.exports=n();else{i=[],r=n,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}}(function(){var e;return function e(t,n,r){function i(a,c){if(!n[a]){if(!t[a]){var l="function"==typeof s&&s;if(!c&&l)return s(a,!0);if(o)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return i(n||e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof s&&s,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=e("../package.json"),i={USER_AGENT:r.title+" "+r.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:180,MIN_SESSION_EXPIRES:60};t.exports=i},{"../package.json":40}],2:[function(e,t,n){function r(e,t,n,r){var a;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!t.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};r=t instanceof s.IncomingResponse?t.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:r||i.STATUS_CONFIRMED,a=t.parseHeader("contact"),"UAS"===n?(this.id={call_id:t.call_id,local_tag:t.to_tag,remote_tag:t.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=t.cseq,this.local_uri=t.parseHeader("to").uri,this.remote_uri=t.parseHeader("from").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route")):"UAC"===n&&(this.id={call_id:t.call_id,local_tag:t.from_tag,remote_tag:t.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.local_seqnum=t.cseq,this.local_uri=t.parseHeader("from").uri,this.remote_uri=t.parseHeader("to").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route").reverse()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,o("new "+n+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED"))}t.exports=r;var i={STATUS_EARLY:1,STATUS_CONFIRMED:2};r.C=i;var o=e("debug")("JsSIP:Dialog"),s=e("./SIPMessage"),a=e("./Constants"),c=e("./Transactions"),l=e("./Dialog/RequestSender");r.prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,o("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){o("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,t,n){var r,i;return t=t&&t.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=e===a.CANCEL||e===a.ACK?this.local_seqnum:this.local_seqnum+=1,i=new s.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},t,n),i.dialog=this,i},checkInDialogRequest:function(e){var t=this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==a.ACK&&e.reply(500),!1;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;if(e.method===a.INVITE||e.method===a.UPDATE&&e.body){if(!0===this.uac_pending_reply)e.reply(491);else{if(!0===this.uas_pending_reply){var n=1+(10*Math.random()|0);return e.reply(500,null,["Retry-After:"+n]),!1}this.uas_pending_reply=!0,e.server_transaction.on("stateChanged",function n(){this.state!==c.C.STATUS_ACCEPTED&&this.state!==c.C.STATUS_COMPLETED&&this.state!==c.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",n),t.uas_pending_reply=!1)})}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===c.C.STATUS_ACCEPTED&&(t.remote_target=e.parseHeader("contact").uri)})}else e.method===a.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===c.C.STATUS_COMPLETED&&(t.remote_target=e.parseHeader("contact").uri)});return!0},sendRequest:function(e,t,n){n=n||{};var r=n.extraHeaders&&n.extraHeaders.slice()||[],i=n.body||null,o=this.createRequest(t,r,i);return new l(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":18,"./Transactions":21,debug:33}],3:[function(e,t,n){function r(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}t.exports=r;var i=e("../Constants"),o=e("../Transactions"),s=e("../RTCSession"),a=e("../RequestSender");r.prototype={send:function(){var e=this,t=new a(this,this.dialog.owner.ua);t.send(),(this.request.method===i.INVITE||this.request.method===i.UPDATE&&this.request.body)&&t.clientTransaction.state!==o.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,t.clientTransaction.on("stateChanged",function n(){this.state!==o.C.STATUS_ACCEPTED&&this.state!==o.C.STATUS_COMPLETED&&this.state!==o.C.STATUS_TERMINATED||(t.clientTransaction.removeListener("stateChanged",n),e.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t=this;408===e.status_code||481===e.status_code?this.applicant.onDialogError(e):e.method===i.INVITE&&491===e.status_code?this.reattempt?this.applicant.receiveResponse(e):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){t.applicant.owner.status!==s.C.STATUS_TERMINATED&&(t.reattempt=!0,t.request_sender.send())},1e3)):this.applicant.receiveResponse(e)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":17,"../Transactions":21}],4:[function(e,t,n){function r(e){this.credentials=e,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.algorithm=null,this.realm=null,this.nonce=null,this.opaque=null,this.stale=null,this.qop=null,this.method=null,this.uri=null,this.ha1=null,this.response=null}t.exports=r;var i=e("debug")("JsSIP:DigestAuthentication"),o=e("debug")("JsSIP:ERROR:DigestAuthentication");o.log=console.warn.bind(console);var s=e("./Utils");r.prototype.get=function(e){switch(e){case"realm":return this.realm;case"ha1":return this.ha1;default:return void o('get() | cannot get "%s" parameter',e)}},r.prototype.authenticate=function(e,t){var n,r;if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return o('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.nonce)return o("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this.realm)return o("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this.credentials.password){if(!this.credentials.ha1)return o("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this.credentials.realm!==this.realm)return o('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this.credentials.realm,this.realm),!1}if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return o('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=e.method,this.uri=e.ruri,this.cnonce=s.createRandomToken(12),this.nc+=1,r=Number(this.nc).toString(16),this.ncHex="00000000".substr(0,8-r.length)+r,4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.credentials.password?this.ha1=s.calculateMD5(this.credentials.username+":"+this.realm+":"+this.credentials.password):this.ha1=this.credentials.ha1,"auth"===this.qop?(n=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=s.calculateMD5(this.method+":"+this.uri+":"+s.calculateMD5(this.body?this.body:"")),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+n)),i("authenticate() | response generated"),!0},r.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.credentials.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")}},{"./Utils":25,debug:33}],5:[function(e,t,n){var r={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),NotReadyError:function(){var e=function(e){this.code=4,this.name="NOT_READY_ERROR",this.message=e};return e.prototype=new Error,e}()};t.exports=r},{}],6:[function(e,t,n){t.exports=function(){function t(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,r){function i(e){gr<yr||(gr>yr&&(yr=gr,Cr=[]),Cr.push(e))}function o(){var e;return"\r\n"===n.substr(gr,2)?(e="\r\n",gr+=2):(e=null,0===vr&&i('"\\r\\n"')),e}function s(){var e;return/^[0-9]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[0-9]")),e}function a(){var e;return/^[a-zA-Z]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[a-zA-Z]")),e}function c(){var e;return/^[0-9a-fA-F]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[0-9a-fA-F]")),e}function l(){var e;return e=f(),null===e&&(e=h()),e}function u(){var e;return/^[\0-\xFF]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[\\0-\\xFF]")),e}function d(){var e;return/^["]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i('["]')),e}function f(){var e;return 32===n.charCodeAt(gr)?(e=" ",gr++):(e=null,0===vr&&i('" "')),e}function h(){var e;return 9===n.charCodeAt(gr)?(e="\t",gr++):(e=null,0===vr&&i('"\\t"')),e}function p(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[a-zA-Z0-9]")),e}function m(){var e;return 59===n.charCodeAt(gr)?(e=";",gr++):(e=null,0===vr&&i('";"')),null===e&&(47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"')),null===e&&(63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null===e&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(64===n.charCodeAt(gr)?(e="@",gr++):(e=null,0===vr&&i('"@"')),null===e&&(38===n.charCodeAt(gr)?(e="&",gr++):(e=null,0===vr&&i('"&"')),null===e&&(61===n.charCodeAt(gr)?(e="=",gr++):(e=null,0===vr&&i('"="')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')),null===e&&(44===n.charCodeAt(gr)?(e=",",gr++):(e=null,0===vr&&i('","'))))))))))),e}function g(){var e;return e=p(),null===e&&(e=v()),e}function v(){var e;return 45===n.charCodeAt(gr)?(e="-",gr++):(e=null,0===vr&&i('"-"')),null===e&&(95===n.charCodeAt(gr)?(e="_",gr++):(e=null,0===vr&&i('"_"')),null===e&&(46===n.charCodeAt(gr)?(e=".",gr++):(e=null,0===vr&&i('"."')),null===e&&(33===n.charCodeAt(gr)?(e="!",gr++):(e=null,0===vr&&i('"!"')),null===e&&(126===n.charCodeAt(gr)?(e="~",gr++):(e=null,0===vr&&i('"~"')),null===e&&(42===n.charCodeAt(gr)?(e="*",gr++):(e=null,0===vr&&i('"*"')),null===e&&(39===n.charCodeAt(gr)?(e="'",gr++):(e=null,0===vr&&i('"\'"')),null===e&&(40===n.charCodeAt(gr)?(e="(",gr++):(e=null,0===vr&&i('"("')),null===e&&(41===n.charCodeAt(gr)?(e=")",gr++):(e=null,0===vr&&i('")"')))))))))),e}function y(){var e,t,r,o,s;return o=gr,s=gr,37===n.charCodeAt(gr)?(e="%",gr++):(e=null,0===vr&&i('"%"')),null!==e?(t=c(),null!==t?(r=c(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){return t.join("")}(0,e)),null===e&&(gr=o),e}function C(){var e,t,n,r,i,s;for(r=gr,i=gr,s=gr,e=[],t=l();null!==t;)e.push(t),t=l();if(null!==e?(t=o(),null!==t?e=[e,t]:(e=null,gr=s)):(e=null,gr=s),null!==(e=null!==e?e:"")){if(null!==(n=l()))for(t=[];null!==n;)t.push(n),n=l();else t=null;null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return null!==e&&(e=" "),null===e&&(gr=r),e}function b(){var e;return e=C(),e=null!==e?e:""}function S(){var e,t,r,o,s;for(o=gr,s=gr,e=[],t=f(),null===t&&(t=h());null!==t;)e.push(t),null===(t=f())&&(t=h());return null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=":"),null===e&&(gr=o),e}function T(){var e,t,r,i,o,s,a;if(o=gr,s=gr,null!==(t=A()))for(e=[];null!==t;)e.push(t),t=A();else e=null;if(null!==e){for(t=[],a=gr,r=[],i=C();null!==i;)r.push(i),i=C();for(null!==r?(i=A(),null!==i?r=[r,i]:(r=null,gr=a)):(r=null,gr=a);null!==r;){for(t.push(r),a=gr,r=[],i=C();null!==i;)r.push(i),i=C();null!==r?(i=A(),null!==i?r=[r,i]:(r=null,gr=a)):(r=null,gr=a)}null!==t?e=[e,t]:(e=null,gr=s)}else e=null,gr=s;return null!==e&&(e=function(e){return n.substring(gr,e)}(o)),null===e&&(gr=o),e}function A(){var e;return/^[!-~]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[!-~]")),null===e&&(e=E()),e}function E(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[\\x80-\\uFFFF]")),e}function _(){var e;return/^[\x80-\xBF]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[\\x80-\\xBF]")),e}function w(){var e;return e=s(),null===e&&(/^[a-f]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[a-f]"))),e}function R(){var e,t,r;if(r=gr,t=p(),null===t&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=p())&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(gr,e)}(r)),null===e&&(gr=r),e}function k(){var e,t,r;if(r=gr,t=p(),null===t&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=p())&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(gr,e)}(r)),null===e&&(gr=r),e}function I(){var e;return 40===n.charCodeAt(gr)?(e="(",gr++):(e=null,0===vr&&i('"("')),null===e&&(41===n.charCodeAt(gr)?(e=")",gr++):(e=null,0===vr&&i('")"')),null===e&&(60===n.charCodeAt(gr)?(e="<",gr++):(e=null,0===vr&&i('"<"')),null===e&&(62===n.charCodeAt(gr)?(e=">",gr++):(e=null,0===vr&&i('">"')),null===e&&(64===n.charCodeAt(gr)?(e="@",gr++):(e=null,0===vr&&i('"@"')),null===e&&(44===n.charCodeAt(gr)?(e=",",gr++):(e=null,0===vr&&i('","')),null===e&&(59===n.charCodeAt(gr)?(e=";",gr++):(e=null,0===vr&&i('";"')),null===e&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(92===n.charCodeAt(gr)?(e="\\",gr++):(e=null,0===vr&&i('"\\\\"')),null===e&&null===(e=d())&&(47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"')),null===e&&(91===n.charCodeAt(gr)?(e="[",gr++):(e=null,0===vr&&i('"["')),null===e&&(93===n.charCodeAt(gr)?(e="]",gr++):(e=null,0===vr&&i('"]"')),null===e&&(63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null===e&&(61===n.charCodeAt(gr)?(e="=",gr++):(e=null,0===vr&&i('"="')),null===e&&(123===n.charCodeAt(gr)?(e="{",gr++):(e=null,0===vr&&i('"{"')),null===e&&(125===n.charCodeAt(gr)?(e="}",gr++):(e=null,0===vr&&i('"}"')),null===e&&null===(e=f())&&(e=h())))))))))))))))),e}function x(){var e,t,r;if(r=gr,t=p(),null===t&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"')),null===t&&(40===n.charCodeAt(gr)?(t="(",gr++):(t=null,0===vr&&i('"("')),null===t&&(41===n.charCodeAt(gr)?(t=")",gr++):(t=null,0===vr&&i('")"')),null===t&&(60===n.charCodeAt(gr)?(t="<",gr++):(t=null,0===vr&&i('"<"')),null===t&&(62===n.charCodeAt(gr)?(t=">",gr++):(t=null,0===vr&&i('">"')),null===t&&(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null===t&&(92===n.charCodeAt(gr)?(t="\\",gr++):(t=null,0===vr&&i('"\\\\"')),null===t&&null===(t=d())&&(47===n.charCodeAt(gr)?(t="/",gr++):(t=null,0===vr&&i('"/"')),null===t&&(91===n.charCodeAt(gr)?(t="[",gr++):(t=null,0===vr&&i('"["')),null===t&&(93===n.charCodeAt(gr)?(t="]",gr++):(t=null,0===vr&&i('"]"')),null===t&&(63===n.charCodeAt(gr)?(t="?",gr++):(t=null,0===vr&&i('"?"')),null===t&&(123===n.charCodeAt(gr)?(t="{",gr++):(t=null,0===vr&&i('"{"')),null===t&&(125===n.charCodeAt(gr)?(t="}",gr++):(t=null,0===vr&&i('"}"')))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=p())&&(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null===t&&(46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null===t&&(33===n.charCodeAt(gr)?(t="!",gr++):(t=null,0===vr&&i('"!"')),null===t&&(37===n.charCodeAt(gr)?(t="%",gr++):(t=null,0===vr&&i('"%"')),null===t&&(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null===t&&(95===n.charCodeAt(gr)?(t="_",gr++):(t=null,0===vr&&i('"_"')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(96===n.charCodeAt(gr)?(t="`",gr++):(t=null,0===vr&&i('"`"')),null===t&&(39===n.charCodeAt(gr)?(t="'",gr++):(t=null,0===vr&&i('"\'"')),null===t&&(126===n.charCodeAt(gr)?(t="~",gr++):(t=null,0===vr&&i('"~"')),null===t&&(40===n.charCodeAt(gr)?(t="(",gr++):(t=null,0===vr&&i('"("')),null===t&&(41===n.charCodeAt(gr)?(t=")",gr++):(t=null,0===vr&&i('")"')),null===t&&(60===n.charCodeAt(gr)?(t="<",gr++):(t=null,0===vr&&i('"<"')),null===t&&(62===n.charCodeAt(gr)?(t=">",gr++):(t=null,0===vr&&i('">"')),null===t&&(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null===t&&(92===n.charCodeAt(gr)?(t="\\",gr++):(t=null,0===vr&&i('"\\\\"')),null===t&&null===(t=d())&&(47===n.charCodeAt(gr)?(t="/",gr++):(t=null,0===vr&&i('"/"')),null===t&&(91===n.charCodeAt(gr)?(t="[",gr++):(t=null,0===vr&&i('"["')),null===t&&(93===n.charCodeAt(gr)?(t="]",gr++):(t=null,0===vr&&i('"]"')),null===t&&(63===n.charCodeAt(gr)?(t="?",gr++):(t=null,0===vr&&i('"?"')),null===t&&(123===n.charCodeAt(gr)?(t="{",gr++):(t=null,0===vr&&i('"{"')),null===t&&(125===n.charCodeAt(gr)?(t="}",gr++):(t=null,0===vr&&i('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(gr,e)}(r)),null===e&&(gr=r),e}function P(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(42===n.charCodeAt(gr)?(t="*",gr++):(t=null,0===vr&&i('"*"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e="*"),null===e&&(gr=o),e}function O(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(47===n.charCodeAt(gr)?(t="/",gr++):(t=null,0===vr&&i('"/"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e="/"),null===e&&(gr=o),e}function D(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e="="),null===e&&(gr=o),e}function N(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(40===n.charCodeAt(gr)?(t="(",gr++):(t=null,0===vr&&i('"("')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e="("),null===e&&(gr=o),e}function L(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(41===n.charCodeAt(gr)?(t=")",gr++):(t=null,0===vr&&i('")"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=")"),null===e&&(gr=o),e}function M(){var e,t,r,o;return r=gr,o=gr,62===n.charCodeAt(gr)?(e=">",gr++):(e=null,0===vr&&i('">"')),null!==e?(t=b(),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=">"),null===e&&(gr=r),e}function U(){var e,t,r,o;return r=gr,o=gr,e=b(),null!==e?(60===n.charCodeAt(gr)?(t="<",gr++):(t=null,0===vr&&i('"<"')),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e="<"),null===e&&(gr=r),e}function j(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(44===n.charCodeAt(gr)?(t=",",gr++):(t=null,0===vr&&i('","')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=","),null===e&&(gr=o),e}function B(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(59===n.charCodeAt(gr)?(t=";",gr++):(t=null,0===vr&&i('";"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=";"),null===e&&(gr=o),e}function q(){var e,t,r,o,s;return o=gr,s=gr,e=b(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=":"),null===e&&(gr=o),e}function F(){var e,t,n,r;return n=gr,r=gr,e=b(),null!==e?(t=d(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),null!==e&&(e='"'),null===e&&(gr=n),e}function V(){var e,t,n,r;return n=gr,r=gr,e=d(),null!==e?(t=b(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),null!==e&&(e='"'),null===e&&(gr=n),e}function H(){var e,t,n,r;if(r=gr,null!==(e=N())){for(t=[],n=W(),null===n&&null===(n=Y())&&(n=H());null!==n;)t.push(n),null===(n=W())&&null===(n=Y())&&(n=H());null!==t?(n=L(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)}else e=null,gr=r;return e}function W(){var e;return/^[!-']/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[!-']")),null===e&&(/^[*-[]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[*-[]")),null===e&&(/^[\]-~]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[\\]-~]")),null===e&&null===(e=E())&&(e=C()))),e}function G(){var e,t,r,i,o,s;if(o=gr,s=gr,null!==(e=b()))if(null!==(t=d())){for(r=[],i=J(),null===i&&(i=Y());null!==i;)r.push(i),null===(i=J())&&(i=Y());null!==r?(i=d(),null!==i?e=[e,t,r,i]:(e=null,gr=s)):(e=null,gr=s)}else e=null,gr=s;else e=null,gr=s;return null!==e&&(e=function(e){return n.substring(gr,e)}(o)),null===e&&(gr=o),e}function z(){var e,t,r,i,o,s;if(o=gr,s=gr,null!==(e=b()))if(null!==(t=d())){for(r=[],i=J(),null===i&&(i=Y());null!==i;)r.push(i),null===(i=J())&&(i=Y());null!==r?(i=d(),null!==i?e=[e,t,r,i]:(e=null,gr=s)):(e=null,gr=s)}else e=null,gr=s;else e=null,gr=s;return null!==e&&(e=function(e){return n.substring(gr-1,e+1)}(o)),null===e&&(gr=o),e}function J(){var e;return e=C(),null===e&&(33===n.charCodeAt(gr)?(e="!",gr++):(e=null,0===vr&&i('"!"')),null===e&&(/^[#-[]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[#-[]")),null===e&&(/^[\]-~]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[\\]-~]")),null===e&&(e=E())))),e}function Y(){var e,t,r;return r=gr,92===n.charCodeAt(gr)?(e="\\",gr++):(e=null,0===vr&&i('"\\\\"')),null!==e?(/^[\0-\t]/.test(n.charAt(gr))?(t=n.charAt(gr),gr++):(t=null,0===vr&&i("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(n.charAt(gr))?(t=n.charAt(gr),gr++):(t=null,0===vr&&i("[\\x0B-\\f]")),null===t&&(/^[\x0E-]/.test(n.charAt(gr))?(t=n.charAt(gr),gr++):(t=null,0===vr&&i("[\\x0E-]")))),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e}function K(){var e,t,r,o,s,a;return s=gr,a=gr,e=Q(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=ee(),r=null!==r?r:"",null!==r?(o=ie(),null!==o?e=[e,t,r,o]:(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a),null!==e&&(e=function(e){try{Tr.uri=new br(Tr.scheme,Tr.user,Tr.host,Tr.port),delete Tr.scheme,delete Tr.user,delete Tr.host,delete Tr.host_type,delete Tr.port}catch(e){Tr=-1}}()),null===e&&(gr=s),e}function X(){var e,t,o,s,a,c,l,u;return l=gr,u=gr,e=Q(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(o=ee(),o=null!==o?o:"",null!==o?(s=ie(),null!==s?(a=ge(),null!==a?(c=Ie(),c=null!==c?c:"",null!==c?e=[e,t,o,s,a,c]:(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u),null!==e&&(e=function(e){try{Tr.uri=new br(Tr.scheme,Tr.user,Tr.host,Tr.port,Tr.uri_params,Tr.uri_headers),delete Tr.scheme,delete Tr.user,delete Tr.host,delete Tr.host_type,delete Tr.port,delete Tr.uri_params,"SIP_URI"===r&&(Tr=Tr.uri)}catch(e){Tr=-1}}()),null===e&&(gr=l),e}function Q(){var e;return e=$(),null===e&&(e=Z()),e}function $(){var e,t;return t=gr,"sips"===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"sips"')),null!==e&&(e=function(e,t){Tr.scheme=t.toLowerCase()}(0,e)),null===e&&(gr=t),e}function Z(){var e,t;return t=gr,"sip"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"sip"')),null!==e&&(e=function(e,t){Tr.scheme=t.toLowerCase()}(0,e)),null===e&&(gr=t),e}function ee(){var e,t,r,o,s,a;return o=gr,s=gr,e=te(),null!==e?(a=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=re(),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a),t=null!==t?t:"",null!==t?(64===n.charCodeAt(gr)?(r="@",gr++):(r=null,0===vr&&i('"@"')),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){Tr.user=decodeURIComponent(n.substring(gr-1,e))}(o)),null===e&&(gr=o),e}function te(){var e,t;if(t=g(),null===t&&null===(t=y())&&(t=ne()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=g())&&null===(t=y())&&(t=ne());else e=null;return e}function ne(){var e;return 38===n.charCodeAt(gr)?(e="&",gr++):(e=null,0===vr&&i('"&"')),null===e&&(61===n.charCodeAt(gr)?(e="=",gr++):(e=null,0===vr&&i('"="')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')),null===e&&(44===n.charCodeAt(gr)?(e=",",gr++):(e=null,0===vr&&i('","')),null===e&&(59===n.charCodeAt(gr)?(e=";",gr++):(e=null,0===vr&&i('";"')),null===e&&(63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null===e&&(47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"'))))))))),e}function re(){var e,t,r;for(r=gr,e=[],t=g(),null===t&&null===(t=y())&&(38===n.charCodeAt(gr)?(t="&",gr++):(t=null,0===vr&&i('"&"')),null===t&&(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(36===n.charCodeAt(gr)?(t="$",gr++):(t=null,0===vr&&i('"$"')),null===t&&(44===n.charCodeAt(gr)?(t=",",gr++):(t=null,0===vr&&i('","')))))));null!==t;)e.push(t),null===(t=g())&&null===(t=y())&&(38===n.charCodeAt(gr)?(t="&",gr++):(t=null,0===vr&&i('"&"')),null===t&&(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')),null===t&&(36===n.charCodeAt(gr)?(t="$",gr++):(t=null,0===vr&&i('"$"')),null===t&&(44===n.charCodeAt(gr)?(t=",",gr++):(t=null,0===vr&&i('","')))))));return null!==e&&(e=function(e){Tr.password=n.substring(gr,e)}(r)),null===e&&(gr=r),e}function ie(){var e,t,r,o,s;return o=gr,e=oe(),null!==e?(s=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=me(),null!==r?t=[t,r]:(t=null,gr=s)):(t=null,gr=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),e}function oe(){var e,t;return t=gr,e=se(),null===e&&null===(e=he())&&(e=le()),null!==e&&(e=function(e){return Tr.host=n.substring(gr,e).toLowerCase(),Tr.host}(t)),null===e&&(gr=t),e}function se(){var e,t,r,o,s,a;for(o=gr,s=gr,e=[],a=gr,t=ae(),null!==t?(46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a);null!==t;)e.push(t),a=gr,t=ae(),null!==t?(46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a);return null!==e?(t=ce(),null!==t?(46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){return Tr.host_type="domain",n.substring(gr,e)}(o)),null===e&&(gr=o),e}function ae(){var e,t,r,o;if(o=gr,null!==(e=p())){for(t=[],r=p(),null===r&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(95===n.charCodeAt(gr)?(r="_",gr++):(r=null,0===vr&&i('"_"'))));null!==r;)t.push(r),null===(r=p())&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(95===n.charCodeAt(gr)?(r="_",gr++):(r=null,0===vr&&i('"_"'))));null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return e}function ce(){var e,t,r,o;if(o=gr,null!==(e=a())){for(t=[],r=p(),null===r&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(95===n.charCodeAt(gr)?(r="_",gr++):(r=null,0===vr&&i('"_"'))));null!==r;)t.push(r),null===(r=p())&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(95===n.charCodeAt(gr)?(r="_",gr++):(r=null,0===vr&&i('"_"'))));null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return e}function le(){var e,t,r,o,s;return o=gr,s=gr,91===n.charCodeAt(gr)?(e="[",gr++):(e=null,0===vr&&i('"["')),null!==e?(t=ue(),null!==t?(93===n.charCodeAt(gr)?(r="]",gr++):(r=null,0===vr&&i('"]"')),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){return Tr.host_type="IPv6",n.substring(gr,e)}(o)),null===e&&(gr=o),e}function ue(){var e,t,r,o,s,a,c,l,u,d,f,h,p,m,g,v;return m=gr,g=gr,e=de(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?(58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(gr)?(a=":",gr++):(a=null,0===vr&&i('":"')),null!==a?(c=de(),null!==c?(58===n.charCodeAt(gr)?(l=":",gr++):(l=null,0===vr&&i('":"')),null!==l?(u=de(),null!==u?(58===n.charCodeAt(gr)?(d=":",gr++):(d=null,0===vr&&i('":"')),null!==d?(f=de(),null!==f?(58===n.charCodeAt(gr)?(h=":",gr++):(h=null,0===vr&&i('":"')),null!==h?(p=fe(),null!==p?e=[e,t,r,o,s,a,c,l,u,d,f,h,p]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=de(),null!==l?(58===n.charCodeAt(gr)?(u=":",gr++):(u=null,0===vr&&i('":"')),null!==u?(d=de(),null!==d?(58===n.charCodeAt(gr)?(f=":",gr++):(f=null,0===vr&&i('":"')),null!==f?(h=fe(),null!==h?e=[e,t,r,o,s,a,c,l,u,d,f,h]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=de(),null!==l?(58===n.charCodeAt(gr)?(u=":",gr++):(u=null,0===vr&&i('":"')),null!==u?(d=fe(),null!==d?e=[e,t,r,o,s,a,c,l,u,d]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=fe(),null!==l?e=[e,t,r,o,s,a,c,l]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=fe(),null!==a?e=[e,t,r,o,s,a]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=fe(),null!==o?e=[e,t,r,o]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=fe(),null!==t?e=[e,t]:(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,"::"===n.substr(gr,2)?(e="::",gr+=2):(e=null,0===vr&&i('"::"')),null!==e?(t=de(),null!==t?e=[e,t]:(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?("::"===n.substr(gr,2)?(t="::",gr+=2):(t=null,0===vr&&i('"::"')),null!==t?(r=de(),null!==r?(58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(gr)?(a=":",gr++):(a=null,0===vr&&i('":"')),null!==a?(c=de(),null!==c?(58===n.charCodeAt(gr)?(l=":",gr++):(l=null,0===vr&&i('":"')),null!==l?(u=de(),null!==u?(58===n.charCodeAt(gr)?(d=":",gr++):(d=null,0===vr&&i('":"')),null!==d?(f=fe(),null!==f?e=[e,t,r,o,s,a,c,l,u,d,f]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?("::"===n.substr(gr,2)?(r="::",gr+=2):(r=null,0===vr&&i('"::"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=de(),null!==l?(58===n.charCodeAt(gr)?(u=":",gr++):(u=null,0===vr&&i('":"')),null!==u?(d=fe(),null!==d?e=[e,t,r,o,s,a,c,l,u,d]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?(v=gr,58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,gr=v)):(r=null,gr=v),r=null!==r?r:"",null!==r?("::"===n.substr(gr,2)?(o="::",gr+=2):(o=null,0===vr&&i('"::"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(gr)?(a=":",gr++):(a=null,0===vr&&i('":"')),null!==a?(c=de(),null!==c?(58===n.charCodeAt(gr)?(l=":",gr++):(l=null,0===vr&&i('":"')),null!==l?(u=fe(),null!==u?e=[e,t,r,o,s,a,c,l,u]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?(v=gr,58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,gr=v)):(r=null,gr=v),r=null!==r?r:"",null!==r?(v=gr,58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,gr=v)):(o=null,gr=v),o=null!==o?o:"",null!==o?("::"===n.substr(gr,2)?(s="::",gr+=2):(s=null,0===vr&&i('"::"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=fe(),null!==l?e=[e,t,r,o,s,a,c,l]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?(v=gr,58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,gr=v)):(r=null,gr=v),r=null!==r?r:"",null!==r?(v=gr,58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,gr=v)):(o=null,gr=v),o=null!==o?o:"",null!==o?(v=gr,58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,gr=v)):(s=null,gr=v),s=null!==s?s:"",null!==s?("::"===n.substr(gr,2)?(a="::",gr+=2):(a=null,0===vr&&i('"::"')),null!==a?(c=fe(),null!==c?e=[e,t,r,o,s,a,c]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?(v=gr,58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,gr=v)):(r=null,gr=v),r=null!==r?r:"",null!==r?(v=gr,58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,gr=v)):(o=null,gr=v),o=null!==o?o:"",null!==o?(v=gr,58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,gr=v)):(s=null,gr=v),s=null!==s?s:"",null!==s?(v=gr,58===n.charCodeAt(gr)?(a=":",gr++):(a=null,0===vr&&i('":"')),null!==a?(c=de(),null!==c?a=[a,c]:(a=null,gr=v)):(a=null,gr=v),a=null!==a?a:"",null!==a?("::"===n.substr(gr,2)?(c="::",gr+=2):(c=null,0===vr&&i('"::"')),null!==c?(l=de(),null!==l?e=[e,t,r,o,s,a,c,l]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g),null===e&&(g=gr,e=de(),null!==e?(v=gr,58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,gr=v)):(t=null,gr=v),t=null!==t?t:"",null!==t?(v=gr,58===n.charCodeAt(gr)?(r=":",gr++):(r=null,0===vr&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,gr=v)):(r=null,gr=v),r=null!==r?r:"",null!==r?(v=gr,58===n.charCodeAt(gr)?(o=":",gr++):(o=null,0===vr&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,gr=v)):(o=null,gr=v),o=null!==o?o:"",null!==o?(v=gr,58===n.charCodeAt(gr)?(s=":",gr++):(s=null,0===vr&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,gr=v)):(s=null,gr=v),s=null!==s?s:"",null!==s?(v=gr,58===n.charCodeAt(gr)?(a=":",gr++):(a=null,0===vr&&i('":"')),null!==a?(c=de(),null!==c?a=[a,c]:(a=null,gr=v)):(a=null,gr=v),a=null!==a?a:"",null!==a?(v=gr,58===n.charCodeAt(gr)?(c=":",gr++):(c=null,0===vr&&i('":"')),null!==c?(l=de(),null!==l?c=[c,l]:(c=null,gr=v)):(c=null,gr=v),c=null!==c?c:"",null!==c?("::"===n.substr(gr,2)?(l="::",gr+=2):(l=null,0===vr&&i('"::"')),null!==l?e=[e,t,r,o,s,a,c,l]:(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g)):(e=null,gr=g))))))))))))))),null!==e&&(e=function(e){return Tr.host_type="IPv6",n.substring(gr,e)}(m)),null===e&&(gr=m),e}function de(){var e,t,n,r,i;return i=gr,e=c(),null!==e?(t=c(),t=null!==t?t:"",null!==t?(n=c(),n=null!==n?n:"",null!==n?(r=c(),r=null!==r?r:"",null!==r?e=[e,t,n,r]:(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i),e}function fe(){var e,t,r,o;return o=gr,e=de(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=de(),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),null===e&&(e=he()),e}function he(){var e,t,r,o,s,a,c,l,u;return l=gr,u=gr,e=pe(),null!==e?(46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null!==t?(r=pe(),null!==r?(46===n.charCodeAt(gr)?(o=".",gr++):(o=null,0===vr&&i('"."')),null!==o?(s=pe(),null!==s?(46===n.charCodeAt(gr)?(a=".",gr++):(a=null,0===vr&&i('"."')),null!==a?(c=pe(),null!==c?e=[e,t,r,o,s,a,c]:(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u)):(e=null,gr=u),null!==e&&(e=function(e){return Tr.host_type="IPv4",n.substring(gr,e)}(l)),null===e&&(gr=l),e}function pe(){var e,t,r,o;return o=gr,"25"===n.substr(gr,2)?(e="25",gr+=2):(e=null,0===vr&&i('"25"')),null!==e?(/^[0-5]/.test(n.charAt(gr))?(t=n.charAt(gr),gr++):(t=null,0===vr&&i("[0-5]")),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null===e&&(o=gr,50===n.charCodeAt(gr)?(e="2",gr++):(e=null,0===vr&&i('"2"')),null!==e?(/^[0-4]/.test(n.charAt(gr))?(t=n.charAt(gr),gr++):(t=null,0===vr&&i("[0-4]")),null!==t?(r=s(),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),null===e&&(o=gr,49===n.charCodeAt(gr)?(e="1",gr++):(e=null,0===vr&&i('"1"')),null!==e?(t=s(),null!==t?(r=s(),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),null===e&&(o=gr,/^[1-9]/.test(n.charAt(gr))?(e=n.charAt(gr),gr++):(e=null,0===vr&&i("[1-9]")),null!==e?(t=s(),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null===e&&(e=s())))),e}function me(){var e,t,n,r,i,o,a;return o=gr,a=gr,e=s(),e=null!==e?e:"",null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?(r=s(),r=null!==r?r:"",null!==r?(i=s(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a),null!==e&&(e=function(e,t){return t=parseInt(t.join("")),Tr.port=t,t}(0,e)),null===e&&(gr=o),e}function ge(){var e,t,r,o;for(e=[],o=gr,59===n.charCodeAt(gr)?(t=";",gr++):(t=null,0===vr&&i('";"')),null!==t?(r=ve(),null!==r?t=[t,r]:(t=null,gr=o)):(t=null,gr=o);null!==t;)e.push(t),o=gr,59===n.charCodeAt(gr)?(t=";",gr++):(t=null,0===vr&&i('";"')),null!==t?(r=ve(),null!==r?t=[t,r]:(t=null,gr=o)):(t=null,gr=o);return e}function ve(){var e;return e=ye(),null===e&&null===(e=Ce())&&null===(e=be())&&null===(e=Se())&&null===(e=Te())&&null===(e=Ae())&&(e=Ee()),e}function ye(){var e,t,r,o;return r=gr,o=gr,"transport="===n.substr(gr,10).toLowerCase()?(e=n.substr(gr,10),gr+=10):(e=null,0===vr&&i('"transport="')),null!==e?("udp"===n.substr(gr,3).toLowerCase()?(t=n.substr(gr,3),gr+=3):(t=null,0===vr&&i('"udp"')),null===t&&("tcp"===n.substr(gr,3).toLowerCase()?(t=n.substr(gr,3),gr+=3):(t=null,0===vr&&i('"tcp"')),null===t&&("sctp"===n.substr(gr,4).toLowerCase()?(t=n.substr(gr,4),gr+=4):(t=null,0===vr&&i('"sctp"')),null===t&&("tls"===n.substr(gr,3).toLowerCase()?(t=n.substr(gr,3),gr+=3):(t=null,0===vr&&i('"tls"')),null===t&&(t=R())))),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=function(e,t){Tr.uri_params||(Tr.uri_params={}),Tr.uri_params.transport=t.toLowerCase()}(0,e[1])),null===e&&(gr=r),e}function Ce(){var e,t,r,o;return r=gr,o=gr,"user="===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"user="')),null!==e?("phone"===n.substr(gr,5).toLowerCase()?(t=n.substr(gr,5),gr+=5):(t=null,0===vr&&i('"phone"')),null===t&&("ip"===n.substr(gr,2).toLowerCase()?(t=n.substr(gr,2),gr+=2):(t=null,0===vr&&i('"ip"')),null===t&&(t=R())),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=function(e,t){Tr.uri_params||(Tr.uri_params={}),Tr.uri_params.user=t.toLowerCase()}(0,e[1])),null===e&&(gr=r),e}function be(){var e,t,r,o;return r=gr,o=gr,"method="===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"method="')),null!==e?(t=lt(),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=function(e,t){Tr.uri_params||(Tr.uri_params={}),Tr.uri_params.method=t}(0,e[1])),null===e&&(gr=r),e}function Se(){var e,t,r,o;return r=gr,o=gr,"ttl="===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"ttl="')),null!==e?(t=Yn(),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=function(e,t){Tr.params||(Tr.params={}),Tr.params.ttl=t}(0,e[1])),null===e&&(gr=r),e}function Te(){var e,t,r,o;return r=gr,o=gr,"maddr="===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"maddr="')),null!==e?(t=oe(),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),null!==e&&(e=function(e,t){Tr.uri_params||(Tr.uri_params={}),Tr.uri_params.maddr=t}(0,e[1])),null===e&&(gr=r),e}function Ae(){var e,t,r,o,s,a;return o=gr,s=gr,"lr"===n.substr(gr,2).toLowerCase()?(e=n.substr(gr,2),gr+=2):(e=null,0===vr&&i('"lr"')),null!==e?(a=gr,61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null!==t?(r=R(),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){Tr.uri_params||(Tr.uri_params={}),Tr.uri_params.lr=void 0}()),null===e&&(gr=o),e}function Ee(){var e,t,r,o,s,a;return o=gr,s=gr,e=_e(),null!==e?(a=gr,61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null!==t?(r=we(),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t,n){Tr.uri_params||(Tr.uri_params={}),n=void 0===n?void 0:n[1],Tr.uri_params[t.toLowerCase()]=n}(0,e[0],e[1])),null===e&&(gr=o),e}function _e(){var e,t,n;if(n=gr,null!==(t=Re()))for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(0,e)),null===e&&(gr=n),e}function we(){var e,t,n;if(n=gr,null!==(t=Re()))for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(0,e)),null===e&&(gr=n),e}function Re(){var e;return e=ke(),null===e&&null===(e=g())&&(e=y()),e}function ke(){var e;return 91===n.charCodeAt(gr)?(e="[",gr++):(e=null,0===vr&&i('"["')),null===e&&(93===n.charCodeAt(gr)?(e="]",gr++):(e=null,0===vr&&i('"]"')),null===e&&(47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"')),null===e&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(38===n.charCodeAt(gr)?(e="&",gr++):(e=null,0===vr&&i('"&"')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')))))))),e}function Ie(){var e,t,r,o,s,a,c;if(a=gr,63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null!==e)if(null!==(t=xe())){for(r=[],c=gr,38===n.charCodeAt(gr)?(o="&",gr++):(o=null,0===vr&&i('"&"')),null!==o?(s=xe(),null!==s?o=[o,s]:(o=null,gr=c)):(o=null,gr=c);null!==o;)r.push(o),c=gr,38===n.charCodeAt(gr)?(o="&",gr++):(o=null,0===vr&&i('"&"')),null!==o?(s=xe(),null!==s?o=[o,s]:(o=null,gr=c)):(o=null,gr=c);null!==r?e=[e,t,r]:(e=null,gr=a)}else e=null,gr=a;else e=null,gr=a;return e}function xe(){var e,t,r,o,s;return o=gr,s=gr,e=Pe(),null!==e?(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null!==t?(r=Oe(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t,n){t=t.join("").toLowerCase(),n=n.join(""),Tr.uri_headers||(Tr.uri_headers={}),Tr.uri_headers[t]?Tr.uri_headers[t].push(n):Tr.uri_headers[t]=[n]}(0,e[0],e[2])),null===e&&(gr=o),e}function Pe(){var e,t;if(t=De(),null===t&&null===(t=g())&&(t=y()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=De())&&null===(t=g())&&(t=y());else e=null;return e}function Oe(){var e,t;for(e=[],t=De(),null===t&&null===(t=g())&&(t=y());null!==t;)e.push(t),null===(t=De())&&null===(t=g())&&(t=y());return e}function De(){var e;return 91===n.charCodeAt(gr)?(e="[",gr++):(e=null,0===vr&&i('"["')),null===e&&(93===n.charCodeAt(gr)?(e="]",gr++):(e=null,0===vr&&i('"]"')),null===e&&(47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"')),null===e&&(63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null===e&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')))))))),e}function Ne(){var e;return e=ut(),null===e&&(e=Le()),e}function Le(){var e,t,n,r,i,o;return o=gr,e=lt(),null!==e?(t=f(),null!==t?(n=Me(),null!==n?(r=f(),null!==r?(i=Ze(),null!==i?e=[e,t,n,r,i]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function Me(){var e;return e=X(),null===e&&(e=Ue()),e}function Ue(){var e,t,r,o;return o=gr,e=Ye(),null!==e?(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null!==t?(r=je(),null===r&&(r=Fe()),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function je(){var e,t,r,o,s;return o=gr,e=Be(),null===e&&(e=qe()),null!==e?(s=gr,63===n.charCodeAt(gr)?(t="?",gr++):(t=null,0===vr&&i('"?"')),null!==t?(r=$e(),null!==r?t=[t,r]:(t=null,gr=s)):(t=null,gr=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),e}function Be(){var e,t,r,o;return o=gr,"//"===n.substr(gr,2)?(e="//",gr+=2):(e=null,0===vr&&i('"//"')),null!==e?(t=Ke(),null!==t?(r=qe(),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function qe(){var e,t,r;return r=gr,47===n.charCodeAt(gr)?(e="/",gr++):(e=null,0===vr&&i('"/"')),null!==e?(t=We(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e}function Fe(){var e,t,n,r;if(r=gr,null!==(e=He())){for(t=[],n=Ve();null!==n;)t.push(n),n=Ve();null!==t?e=[e,t]:(e=null,gr=r)}else e=null,gr=r;return e}function Ve(){var e;return e=m(),null===e&&null===(e=g())&&(e=y()),e}function He(){var e;return e=g(),null===e&&null===(e=y())&&(59===n.charCodeAt(gr)?(e=";",gr++):(e=null,0===vr&&i('";"')),null===e&&(63===n.charCodeAt(gr)?(e="?",gr++):(e=null,0===vr&&i('"?"')),null===e&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(64===n.charCodeAt(gr)?(e="@",gr++):(e=null,0===vr&&i('"@"')),null===e&&(38===n.charCodeAt(gr)?(e="&",gr++):(e=null,0===vr&&i('"&"')),null===e&&(61===n.charCodeAt(gr)?(e="=",gr++):(e=null,0===vr&&i('"="')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')),null===e&&(44===n.charCodeAt(gr)?(e=",",gr++):(e=null,0===vr&&i('","'))))))))))),e}function We(){var e,t,r,o,s,a;if(s=gr,null!==(e=Ge())){for(t=[],a=gr,47===n.charCodeAt(gr)?(r="/",gr++):(r=null,0===vr&&i('"/"')),null!==r?(o=Ge(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==r;)t.push(r),a=gr,47===n.charCodeAt(gr)?(r="/",gr++):(r=null,0===vr&&i('"/"')),null!==r?(o=Ge(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==t?e=[e,t]:(e=null,gr=s)}else e=null,gr=s;return e}function Ge(){var e,t,r,o,s,a;for(s=gr,e=[],t=Je();null!==t;)e.push(t),t=Je();if(null!==e){for(t=[],a=gr,59===n.charCodeAt(gr)?(r=";",gr++):(r=null,0===vr&&i('";"')),null!==r?(o=ze(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==r;)t.push(r),a=gr,59===n.charCodeAt(gr)?(r=";",gr++):(r=null,0===vr&&i('";"')),null!==r?(o=ze(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==t?e=[e,t]:(e=null,gr=s)}else e=null,gr=s;return e}function ze(){var e,t;for(e=[],t=Je();null!==t;)e.push(t),t=Je();return e}function Je(){var e;return e=g(),null===e&&null===(e=y())&&(58===n.charCodeAt(gr)?(e=":",gr++):(e=null,0===vr&&i('":"')),null===e&&(64===n.charCodeAt(gr)?(e="@",gr++):(e=null,0===vr&&i('"@"')),null===e&&(38===n.charCodeAt(gr)?(e="&",gr++):(e=null,0===vr&&i('"&"')),null===e&&(61===n.charCodeAt(gr)?(e="=",gr++):(e=null,0===vr&&i('"="')),null===e&&(43===n.charCodeAt(gr)?(e="+",gr++):(e=null,0===vr&&i('"+"')),null===e&&(36===n.charCodeAt(gr)?(e="$",gr++):(e=null,0===vr&&i('"$"')),null===e&&(44===n.charCodeAt(gr)?(e=",",gr++):(e=null,0===vr&&i('","'))))))))),e}function Ye(){var e,t,r,o,c;if(o=gr,c=gr,null!==(e=a())){for(t=[],r=a(),null===r&&null===(r=s())&&(43===n.charCodeAt(gr)?(r="+",gr++):(r=null,0===vr&&i('"+"')),null===r&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')))));null!==r;)t.push(r),null===(r=a())&&null===(r=s())&&(43===n.charCodeAt(gr)?(r="+",gr++):(r=null,0===vr&&i('"+"')),null===r&&(45===n.charCodeAt(gr)?(r="-",gr++):(r=null,0===vr&&i('"-"')),null===r&&(46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')))));null!==t?e=[e,t]:(e=null,gr=c)}else e=null,gr=c;return null!==e&&(e=function(e){Tr.scheme=n.substring(gr,e)}(o)),null===e&&(gr=o),e}function Ke(){var e;return e=Xe(),null===e&&(e=Qe()),e}function Xe(){var e,t,r,o;return r=gr,o=gr,e=ee(),null!==e?(64===n.charCodeAt(gr)?(t="@",gr++):(t=null,0===vr&&i('"@"')),null!==t?e=[e,t]:(e=null,gr=o)):(e=null,gr=o),e=null!==e?e:"",null!==e?(t=ie(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e=null!==e?e:""}function Qe(){var e,t;if(t=g(),null===t&&null===(t=y())&&(36===n.charCodeAt(gr)?(t="$",gr++):(t=null,0===vr&&i('"$"')),null===t&&(44===n.charCodeAt(gr)?(t=",",gr++):(t=null,0===vr&&i('","')),null===t&&(59===n.charCodeAt(gr)?(t=";",gr++):(t=null,0===vr&&i('";"')),null===t&&(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null===t&&(64===n.charCodeAt(gr)?(t="@",gr++):(t=null,0===vr&&i('"@"')),null===t&&(38===n.charCodeAt(gr)?(t="&",gr++):(t=null,0===vr&&i('"&"')),null===t&&(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"')))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=g())&&null===(t=y())&&(36===n.charCodeAt(gr)?(t="$",gr++):(t=null,0===vr&&i('"$"')),null===t&&(44===n.charCodeAt(gr)?(t=",",gr++):(t=null,0===vr&&i('","')),null===t&&(59===n.charCodeAt(gr)?(t=";",gr++):(t=null,0===vr&&i('";"')),null===t&&(58===n.charCodeAt(gr)?(t=":",gr++):(t=null,0===vr&&i('":"')),null===t&&(64===n.charCodeAt(gr)?(t="@",gr++):(t=null,0===vr&&i('"@"')),null===t&&(38===n.charCodeAt(gr)?(t="&",gr++):(t=null,0===vr&&i('"&"')),null===t&&(61===n.charCodeAt(gr)?(t="=",gr++):(t=null,0===vr&&i('"="')),null===t&&(43===n.charCodeAt(gr)?(t="+",gr++):(t=null,0===vr&&i('"+"'))))))))));else e=null;return e}function $e(){var e,t;for(e=[],t=Ve();null!==t;)e.push(t),t=Ve();return e}function Ze(){var e,t,r,o,a,c,l,u;if(l=gr,u=gr,"sip"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"SIP"')),null!==e)if(47===n.charCodeAt(gr)?(t="/",gr++):(t=null,0===vr&&i('"/"')),null!==t){if(null!==(o=s()))for(r=[];null!==o;)r.push(o),o=s();else r=null;if(null!==r)if(46===n.charCodeAt(gr)?(o=".",gr++):(o=null,0===vr&&i('"."')),null!==o){if(null!==(c=s()))for(a=[];null!==c;)a.push(c),c=s();else a=null;null!==a?e=[e,t,r,o,a]:(e=null,gr=u)}else e=null,gr=u;else e=null,gr=u}else e=null,gr=u;else e=null,gr=u;return null!==e&&(e=function(e){Tr.sip_version=n.substring(gr,e)}(l)),null===e&&(gr=l),e}function et(){var e;return"INVITE"===n.substr(gr,6)?(e="INVITE",gr+=6):(e=null,0===vr&&i('"INVITE"')),e}function tt(){var e;return"ACK"===n.substr(gr,3)?(e="ACK",gr+=3):(e=null,0===vr&&i('"ACK"')),e}function nt(){var e;return"OPTIONS"===n.substr(gr,7)?(e="OPTIONS",gr+=7):(e=null,0===vr&&i('"OPTIONS"')),e}function rt(){var e;return"BYE"===n.substr(gr,3)?(e="BYE",gr+=3):(e=null,0===vr&&i('"BYE"')),e}function it(){var e;return"CANCEL"===n.substr(gr,6)?(e="CANCEL",gr+=6):(e=null,0===vr&&i('"CANCEL"')),e}function ot(){var e;return"REGISTER"===n.substr(gr,8)?(e="REGISTER",gr+=8):(e=null,0===vr&&i('"REGISTER"')),e}function st(){var e;return"SUBSCRIBE"===n.substr(gr,9)?(e="SUBSCRIBE",gr+=9):(e=null,0===vr&&i('"SUBSCRIBE"')),e}function at(){var e;return"NOTIFY"===n.substr(gr,6)?(e="NOTIFY",gr+=6):(e=null,0===vr&&i('"NOTIFY"')),e}function ct(){var e;return"REFER"===n.substr(gr,5)?(e="REFER",gr+=5):(e=null,0===vr&&i('"REFER"')),e}function lt(){var e,t;return t=gr,e=et(),null===e&&null===(e=tt())&&null===(e=nt())&&null===(e=rt())&&null===(e=it())&&null===(e=ot())&&null===(e=st())&&null===(e=at())&&null===(e=ct())&&(e=R()),null!==e&&(e=function(e){return Tr.method=n.substring(gr,e),Tr.method}(t)),null===e&&(gr=t),e}function ut(){var e,t,n,r,i,o;return o=gr,e=Ze(),null!==e?(t=f(),null!==t?(n=dt(),null!==n?(r=f(),null!==r?(i=ht(),null!==i?e=[e,t,n,r,i]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function dt(){var e,t;return t=gr,e=ft(),null!==e&&(e=function(e,t){Tr.status_code=parseInt(t.join(""))}(0,e)),null===e&&(gr=t),e}function ft(){var e,t,n,r;return r=gr,e=s(),null!==e?(t=s(),null!==t?(n=s(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function ht(){var e,t,r;for(r=gr,e=[],t=m(),null===t&&null===(t=g())&&null===(t=y())&&null===(t=E())&&null===(t=_())&&null===(t=f())&&(t=h());null!==t;)e.push(t),null===(t=m())&&null===(t=g())&&null===(t=y())&&null===(t=E())&&null===(t=_())&&null===(t=f())&&(t=h());return null!==e&&(e=function(e){Tr.reason_phrase=n.substring(gr,e)}(r)),null===e&&(gr=r),e}function pt(){var e,t,n,r,i,o;if(i=gr,null!==(e=Jt())){for(t=[],o=gr,n=j(),null!==n?(r=Jt(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=Jt(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function mt(){var e,t,r,o,s,a;return o=gr,s=gr,e=x(),null!==e?(a=gr,64===n.charCodeAt(gr)?(t="@",gr++):(t=null,0===vr&&i('"@"')),null!==t?(r=x(),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){Tr=n.substring(gr,e)}(o)),null===e&&(gr=o),e}function gt(){var e,t,n,r,i,o,s;if(i=gr,null===(e=P()))if(o=gr,null!==(e=vt())){for(t=[],s=gr,n=j(),null!==n?(r=vt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=j(),null!==n?(r=vt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t,n;for(n=Tr.multi_header.length,t=0;t<n;t++)if(null===Tr.multi_header[t].parsed){Tr=null;break}Tr=null!==Tr?Tr.multi_header:-1}()),null===e&&(gr=i),e}function vt(){var e,t,n,r,i,o,s;if(i=gr,o=gr,e=K(),null===e&&(e=yt()),null!==e){for(t=[],s=gr,n=B(),null!==n?(r=bt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=bt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t;Tr.multi_header||(Tr.multi_header=[]);try{t=new Sr(Tr.uri,Tr.display_name,Tr.params),delete Tr.uri,delete Tr.display_name,delete Tr.params}catch(e){t=null}Tr.multi_header.push({possition:gr,offset:e,parsed:t})}(i)),null===e&&(gr=i),e}function yt(){var e,t,n,r,i;return i=gr,e=Ct(),e=null!==e?e:"",null!==e?(t=U(),null!==t?(n=X(),null!==n?(r=M(),null!==r?e=[e,t,n,r]:(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i),e}function Ct(){var e,t,r,i,o,s,a;if(o=gr,s=gr,null!==(e=R())){for(t=[],a=gr,r=C(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,gr=a)):(r=null,gr=a);null!==r;)t.push(r),a=gr,r=C(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,gr=a)):(r=null,gr=a);null!==t?e=[e,t]:(e=null,gr=s)}else e=null,gr=s;return null===e&&(e=G()),null!==e&&(e=function(e,t){t=n.substring(gr,e).trim(),'"'===t[0]&&(t=t.substring(1,t.length-1)),Tr.display_name=t}(o,e)),null===e&&(gr=o),e}function bt(){var e;return e=St(),null===e&&null===(e=Tt())&&(e=_t()),e}function St(){var e,t,r,o,s;return o=gr,s=gr,"q"===n.substr(gr,1).toLowerCase()?(e=n.substr(gr,1),gr++):(e=null,0===vr&&i('"q"')),null!==e?(t=D(),null!==t?(r=Et(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.params||(Tr.params={}),Tr.params.q=t}(0,e[2])),null===e&&(gr=o),e}function Tt(){var e,t,r,o,s;return o=gr,s=gr,"expires"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"expires"')),null!==e?(t=D(),null!==t?(r=At(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.params||(Tr.params={}),Tr.params.expires=t}(0,e[2])),null===e&&(gr=o),e}function At(){var e,t,n;if(n=gr,null!==(t=s()))for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){return parseInt(t.join(""))}(0,e)),null===e&&(gr=n),e}function Et(){var e,t,r,o,a,c,l,u;return c=gr,l=gr,48===n.charCodeAt(gr)?(e="0",gr++):(e=null,0===vr&&i('"0"')),null!==e?(u=gr,46===n.charCodeAt(gr)?(t=".",gr++):(t=null,0===vr&&i('"."')),null!==t?(r=s(),r=null!==r?r:"",null!==r?(o=s(),o=null!==o?o:"",null!==o?(a=s(),a=null!==a?a:"",null!==a?t=[t,r,o,a]:(t=null,gr=u)):(t=null,gr=u)):(t=null,gr=u)):(t=null,gr=u),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=l)):(e=null,gr=l),null!==e&&(e=function(e){return parseFloat(n.substring(gr,e))}(c)),null===e&&(gr=c),e}function _t(){var e,t,n,r,i,o;return r=gr,i=gr,e=R(),null!==e?(o=gr,t=D(),null!==t?(n=wt(),null!==n?t=[t,n]:(t=null,gr=o)):(t=null,gr=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=i)):(e=null,gr=i),null!==e&&(e=function(e,t,n){Tr.params||(Tr.params={}),n=void 0===n?void 0:n[1],Tr.params[t.toLowerCase()]=n}(0,e[0],e[1])),null===e&&(gr=r),e}function wt(){var e;return e=R(),null===e&&null===(e=oe())&&(e=G()),e}function Rt(){var e,t,n,r,i,o;if(i=gr,null!==(e=kt())){for(t=[],o=gr,n=B(),null!==n?(r=It(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=B(),null!==n?(r=It(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function kt(){var e;return"render"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"render"')),null===e&&("session"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"session"')),null===e&&("icon"===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"icon"')),null===e&&("alert"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"alert"')),null===e&&(e=R())))),e}function It(){var e;return e=xt(),null===e&&(e=_t()),e}function xt(){var e,t,r,o;return o=gr,"handling"===n.substr(gr,8).toLowerCase()?(e=n.substr(gr,8),gr+=8):(e=null,0===vr&&i('"handling"')),null!==e?(t=D(),null!==t?("optional"===n.substr(gr,8).toLowerCase()?(r=n.substr(gr,8),gr+=8):(r=null,0===vr&&i('"optional"')),null===r&&("required"===n.substr(gr,8).toLowerCase()?(r=n.substr(gr,8),gr+=8):(r=null,0===vr&&i('"required"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function Pt(){var e,t,n,r,i,o;if(i=gr,null!==(e=R())){for(t=[],o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function Ot(){var e,t,n;if(n=gr,null!==(t=s()))for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){Tr=parseInt(t.join(""))}(0,e)),null===e&&(gr=n),e}function Dt(){var e,t;return t=gr,e=Nt(),null!==e&&(e=function(e){Tr=n.substring(gr,e)}(t)),null===e&&(gr=t),e}function Nt(){var e,t,n,r,i,o,s,a;if(s=gr,null!==(e=Lt()))if(null!==(t=O()))if(null!==(n=qt())){for(r=[],a=gr,i=B(),null!==i?(o=Ft(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==i;)r.push(i),a=gr,i=B(),null!==i?(o=Ft(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==r?e=[e,t,n,r]:(e=null,gr=s)}else e=null,gr=s;else e=null,gr=s;else e=null,gr=s;return e}function Lt(){var e;return e=Mt(),null===e&&(e=Ut()),e}function Mt(){var e;return"text"===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"text"')),null===e&&("image"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"image"')),null===e&&("audio"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"audio"')),null===e&&("video"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"video"')),null===e&&("application"===n.substr(gr,11).toLowerCase()?(e=n.substr(gr,11),gr+=11):(e=null,0===vr&&i('"application"')),null===e&&(e=jt()))))),e}function Ut(){var e;return"message"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"message"')),null===e&&("multipart"===n.substr(gr,9).toLowerCase()?(e=n.substr(gr,9),gr+=9):(e=null,0===vr&&i('"multipart"')),null===e&&(e=jt())),e}function jt(){var e;return e=R(),null===e&&(e=Bt()),e}function Bt(){var e,t,r;return r=gr,"x-"===n.substr(gr,2).toLowerCase()?(e=n.substr(gr,2),gr+=2):(e=null,0===vr&&i('"x-"')),null!==e?(t=R(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e}function qt(){var e;return e=jt(),null===e&&(e=R()),e}function Ft(){var e,t,n,r;return r=gr,e=R(),null!==e?(t=D(),null!==t?(n=Vt(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function Vt(){var e;return e=R(),null===e&&(e=G()),e}function Ht(){var e,t,n,r;return r=gr,e=Wt(),null!==e?(t=C(),null!==t?(n=lt(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function Wt(){var e,t,n;if(n=gr,null!==(t=s()))for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){Tr.value=parseInt(t.join(""))}(0,e)),null===e&&(gr=n),e}function Gt(){var e,t;return t=gr,e=At(),null!==e&&(e=function(e,t){Tr=t}(0,e)),null===e&&(gr=t),e}function zt(){var e,t,n,r,i,o,s;if(i=gr,o=gr,null!==(e=Jt())){for(t=[],s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e,t){Tr.event=t.join("").toLowerCase()}(0,e[0])),null===e&&(gr=i),e}function Jt(){var e,t,r,o,s,a;if(s=gr,null!==(e=k())){for(t=[],a=gr,46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')),null!==r?(o=k(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==r;)t.push(r),a=gr,46===n.charCodeAt(gr)?(r=".",gr++):(r=null,0===vr&&i('"."')),null!==r?(o=k(),null!==o?r=[r,o]:(r=null,gr=a)):(r=null,gr=a);null!==t?e=[e,t]:(e=null,gr=s)}else e=null,gr=s;return e}function Yt(){var e,t,n,r,i,o,s;if(i=gr,o=gr,e=K(),null===e&&(e=yt()),null!==e){for(t=[],s=gr,n=B(),null!==n?(r=Kt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=Kt(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t=Tr.tag;try{Tr=new Sr(Tr.uri,Tr.display_name,Tr.params),t&&Tr.setParam("tag",t)}catch(e){Tr=-1}}()),null===e&&(gr=i),e}function Kt(){var e;return e=Xt(),null===e&&(e=_t()),e}function Xt(){var e,t,r,o,s;return o=gr,s=gr,"tag"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.tag=t}(0,e[2])),null===e&&(gr=o),e}function Qt(){var e,t,n;if(n=gr,null!==(t=s()))for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){Tr=parseInt(t.join(""))}(0,e)),null===e&&(gr=n),e}function $t(){var e,t;return t=gr,e=At(),null!==e&&(e=function(e,t){Tr=t}(0,e)),null===e&&(gr=t),e}function Zt(){var e,t,n,r,i,o,s,a,c,l;for(a=gr,c=gr,e=[],t=Ct();null!==t;)e.push(t),t=Ct();if(null!==e)if(null!==(t=U()))if(null!==(n=X()))if(null!==(r=M())){for(i=[],l=gr,o=B(),null!==o?(s=_t(),null!==s?o=[o,s]:(o=null,gr=l)):(o=null,gr=l);null!==o;)i.push(o),l=gr,o=B(),null!==o?(s=_t(),null!==s?o=[o,s]:(o=null,gr=l)):(o=null,gr=l);null!==i?e=[e,t,n,r,i]:(e=null,gr=c)}else e=null,gr=c;else e=null,gr=c;else e=null,gr=c;else e=null,gr=c;return null!==e&&(e=function(e){try{Tr=new Sr(Tr.uri,Tr.display_name,Tr.params)}catch(e){Tr=-1}}()),null===e&&(gr=a),e}function en(){return tn()}function tn(){var e,t,r,o,s,a,c,l;if(c=gr,"digest"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"Digest"')),null!==e)if(null!==(t=C()))if(null!==(r=on())){for(o=[],l=gr,s=j(),null!==s?(a=on(),null!==a?s=[s,a]:(s=null,gr=l)):(s=null,gr=l);null!==s;)o.push(s),l=gr,s=j(),null!==s?(a=on(),null!==a?s=[s,a]:(s=null,gr=l)):(s=null,gr=l);null!==o?e=[e,t,r,o]:(e=null,gr=c)}else e=null,gr=c;else e=null,gr=c;else e=null,gr=c;return null===e&&(e=nn()),e}function nn(){var e,t,n,r,i,o,s,a;if(s=gr,null!==(e=R()))if(null!==(t=C()))if(null!==(n=rn())){for(r=[],a=gr,i=j(),null!==i?(o=rn(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==i;)r.push(i),a=gr,i=j(),null!==i?(o=rn(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==r?e=[e,t,n,r]:(e=null,gr=s)}else e=null,gr=s;else e=null,gr=s;else e=null,gr=s;return e}function rn(){var e,t,n,r;return r=gr,e=R(),null!==e?(t=D(),null!==t?(n=R(),null===n&&(n=G()),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function on(){var e;return e=sn(),null===e&&null===(e=cn())&&null===(e=un())&&null===(e=fn())&&null===(e=hn())&&null===(e=pn())&&null===(e=mn())&&(e=rn()),e}function sn(){var e,t,r,o;return o=gr,"realm"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"realm"')),null!==e?(t=D(),null!==t?(r=an(),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function an(){var e,t;return t=gr,e=z(),null!==e&&(e=function(e,t){Tr.realm=t}(0,e)),null===e&&(gr=t),e}function cn(){var e,t,r,o,s,a,c,l,u;if(l=gr,"domain"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"domain"')),null!==e)if(null!==(t=D()))if(null!==(r=F()))if(null!==(o=ln())){if(s=[],u=gr,null!==(c=f()))for(a=[];null!==c;)a.push(c),c=f();else a=null;for(null!==a?(c=ln(),null!==c?a=[a,c]:(a=null,gr=u)):(a=null,gr=u);null!==a;){if(s.push(a),u=gr,null!==(c=f()))for(a=[];null!==c;)a.push(c),c=f();else a=null;null!==a?(c=ln(),null!==c?a=[a,c]:(a=null,gr=u)):(a=null,gr=u)}null!==s?(a=V(),null!==a?e=[e,t,r,o,s,a]:(e=null,gr=l)):(e=null,gr=l)}else e=null,gr=l;else e=null,gr=l;else e=null,gr=l;else e=null,gr=l;return e}function ln(){var e;return e=Ue(),null===e&&(e=qe()),e}function un(){var e,t,r,o;return o=gr,"nonce"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"nonce"')),null!==e?(t=D(),null!==t?(r=dn(),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function dn(){var e,t;return t=gr,e=z(),null!==e&&(e=function(e,t){Tr.nonce=t}(0,e)),null===e&&(gr=t),e}function fn(){var e,t,r,o,s;return o=gr,s=gr,"opaque"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"opaque"')),null!==e?(t=D(),null!==t?(r=z(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.opaque=t}(0,e[2])),null===e&&(gr=o),e}function hn(){var e,t,r,o,s;return o=gr,"stale"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"stale"')),null!==e?(t=D(),null!==t?(s=gr,"true"===n.substr(gr,4).toLowerCase()?(r=n.substr(gr,4),gr+=4):(r=null,0===vr&&i('"true"')),null!==r&&(r=function(e){Tr.stale=!0}()),null===r&&(gr=s),null===r&&(s=gr,"false"===n.substr(gr,5).toLowerCase()?(r=n.substr(gr,5),gr+=5):(r=null,0===vr&&i('"false"')),null!==r&&(r=function(e){Tr.stale=!1}()),null===r&&(gr=s)),null!==r?e=[e,t,r]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function pn(){var e,t,r,o,s;return o=gr,s=gr,"algorithm"===n.substr(gr,9).toLowerCase()?(e=n.substr(gr,9),gr+=9):(e=null,0===vr&&i('"algorithm"')),null!==e?(t=D(),null!==t?("md5"===n.substr(gr,3).toLowerCase()?(r=n.substr(gr,3),gr+=3):(r=null,0===vr&&i('"MD5"')),null===r&&("md5-sess"===n.substr(gr,8).toLowerCase()?(r=n.substr(gr,8),gr+=8):(r=null,0===vr&&i('"MD5-sess"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.algorithm=t.toUpperCase()}(0,e[2])),null===e&&(gr=o),e}function mn(){var e,t,r,o,s,a,c,l,u,d;if(l=gr,"qop"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"qop"')),null!==e)if(null!==(t=D()))if(null!==(r=F())){if(u=gr,null!==(o=gn())){for(s=[],d=gr,44===n.charCodeAt(gr)?(a=",",gr++):(a=null,0===vr&&i('","')),null!==a?(c=gn(),null!==c?a=[a,c]:(a=null,gr=d)):(a=null,gr=d);null!==a;)s.push(a),d=gr,44===n.charCodeAt(gr)?(a=",",gr++):(a=null,0===vr&&i('","')),null!==a?(c=gn(),null!==c?a=[a,c]:(a=null,gr=d)):(a=null,gr=d);null!==s?o=[o,s]:(o=null,gr=u)}else o=null,gr=u;null!==o?(s=V(),null!==s?e=[e,t,r,o,s]:(e=null,gr=l)):(e=null,gr=l)}else e=null,gr=l;else e=null,gr=l;else e=null,gr=l;return e}function gn(){var e,t;return t=gr,"auth-int"===n.substr(gr,8).toLowerCase()?(e=n.substr(gr,8),gr+=8):(e=null,0===vr&&i('"auth-int"')),null===e&&("auth"===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"auth"')),null===e&&(e=R())),null!==e&&(e=function(e,t){Tr.qop||(Tr.qop=[]),Tr.qop.push(t.toLowerCase())}(0,e)),null===e&&(gr=t),e}function vn(){var e,t,n,r,i,o;if(i=gr,null!==(e=R())){for(t=[],o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function yn(){var e,t,n,r,i,o,s;if(i=gr,o=gr,null!==(e=Cn())){for(t=[],s=gr,n=j(),null!==n?(r=Cn(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=j(),null!==n?(r=Cn(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t,n;for(n=Tr.multi_header.length,t=0;t<n;t++)if(null===Tr.multi_header[t].parsed){Tr=null;break}Tr=null!==Tr?Tr.multi_header:-1}()),null===e&&(gr=i),e}function Cn(){var e,t,n,r,i,o,s;if(i=gr,o=gr,null!==(e=yt())){for(t=[],s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t;Tr.multi_header||(Tr.multi_header=[]);try{t=new Sr(Tr.uri,Tr.display_name,Tr.params),delete Tr.uri,delete Tr.display_name,delete Tr.params}catch(e){t=null}Tr.multi_header.push({possition:gr,offset:e,parsed:t})}(i)),null===e&&(gr=i),e}function bn(){var e,t,r,o,s,a,c;if(s=gr,a=gr,"sip"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"SIP"')),null===e&&(e=R()),null!==e){for(t=[],c=gr,r=B(),null!==r?(o=Sn(),null!==o?r=[r,o]:(r=null,gr=c)):(r=null,gr=c);null!==r;)t.push(r),c=gr,r=B(),null!==r?(o=Sn(),null!==o?r=[r,o]:(r=null,gr=c)):(r=null,gr=c);null!==t?e=[e,t]:(e=null,gr=a)}else e=null,gr=a;return null!==e&&(e=function(e,t){if(Tr.protocol=t.toLowerCase(),Tr.params||(Tr.params={}),Tr.params.text&&'"'===Tr.params.text[0]){var n=Tr.params.text;Tr.text=n.substring(1,n.length-1),delete Tr.params.text}}(0,e[0])),null===e&&(gr=s),e}function Sn(){var e;return e=Tn(),null===e&&(e=_t()),e}function Tn(){var e,t,r,o,a,c;if(a=gr,c=gr,"cause"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"cause"')),null!==e)if(null!==(t=D())){if(null!==(o=s()))for(r=[];null!==o;)r.push(o),o=s();else r=null;null!==r?e=[e,t,r]:(e=null,gr=c)}else e=null,gr=c;else e=null,gr=c;return null!==e&&(e=function(e,t){Tr.cause=parseInt(t.join(""))}(0,e[2])),null===e&&(gr=a),e}function An(){var e,t,n,r,i,o;if(i=gr,null!==(e=R())){for(t=[],o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function En(){var e,t,n,r,i,o;if(i=gr,null!==(e=_n())){for(t=[],o=gr,n=j(),null!==n?(r=_n(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=_n(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function _n(){var e,t,n,r,i,o;if(i=gr,null!==(e=yt())){for(t=[],o=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function wn(){var e,t,n,r,i,o;if(i=gr,null!==(e=Rn())){for(t=[],o=gr,n=B(),null!==n?(r=kn(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=B(),null!==n?(r=kn(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function Rn(){var e,t;return t=gr,"active"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"active"')),null===e&&("pending"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"pending"')),null===e&&("terminated"===n.substr(gr,10).toLowerCase()?(e=n.substr(gr,10),gr+=10):(e=null,0===vr&&i('"terminated"')),null===e&&(e=R()))),null!==e&&(e=function(e){Tr.state=n.substring(gr,e)}(t)),null===e&&(gr=t),e}function kn(){var e,t,r,o,s;return o=gr,s=gr,"reason"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"reason"')),null!==e?(t=D(),null!==t?(r=In(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){void 0!==t&&(Tr.reason=t)}(0,e[2])),null===e&&(gr=o),null===e&&(o=gr,s=gr,"expires"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"expires"')),null!==e?(t=D(),null!==t?(r=At(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){void 0!==t&&(Tr.expires=t)}(0,e[2])),null===e&&(gr=o),null===e&&(o=gr,s=gr,"retry_after"===n.substr(gr,11).toLowerCase()?(e=n.substr(gr,11),gr+=11):(e=null,0===vr&&i('"retry_after"')),null!==e?(t=D(),null!==t?(r=At(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){void 0!==t&&(Tr.retry_after=t)}(0,e[2])),null===e&&(gr=o),null===e&&(e=_t()))),e}function In(){var e;return"deactivated"===n.substr(gr,11).toLowerCase()?(e=n.substr(gr,11),gr+=11):(e=null,0===vr&&i('"deactivated"')),null===e&&("probation"===n.substr(gr,9).toLowerCase()?(e=n.substr(gr,9),gr+=9):(e=null,0===vr&&i('"probation"')),null===e&&("rejected"===n.substr(gr,8).toLowerCase()?(e=n.substr(gr,8),gr+=8):(e=null,0===vr&&i('"rejected"')),null===e&&("timeout"===n.substr(gr,7).toLowerCase()?(e=n.substr(gr,7),gr+=7):(e=null,0===vr&&i('"timeout"')),null===e&&("giveup"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"giveup"')),null===e&&("noresource"===n.substr(gr,10).toLowerCase()?(e=n.substr(gr,10),gr+=10):(e=null,0===vr&&i('"noresource"')),null===e&&("invariant"===n.substr(gr,9).toLowerCase()?(e=n.substr(gr,9),gr+=9):(e=null,0===vr&&i('"invariant"')),null===e&&(e=R()))))))),e}function xn(){var e;return e=T(),e=null!==e?e:""}function Pn(){var e,t,n,r,i,o;if(i=gr,null!==(e=R())){for(t=[],o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e=null!==e?e:""}function On(){var e,t,n,r,i,o,s;if(i=gr,o=gr,e=K(),null===e&&(e=yt()),null!==e){for(t=[],s=gr,n=B(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){var t=Tr.tag;try{Tr=new Sr(Tr.uri,Tr.display_name,Tr.params),t&&Tr.setParam("tag",t)}catch(e){Tr=-1}}()),null===e&&(gr=i),e}function Dn(){var e;return e=Xt(),null===e&&(e=_t()),e}function Nn(){var e,t,n,r,i,o;if(i=gr,null!==(e=Ln())){for(t=[],o=gr,n=j(),null!==n?(r=Ln(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=j(),null!==n?(r=Ln(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function Ln(){var e,t,n,r,i,o,s,a;if(s=gr,null!==(e=Vn()))if(null!==(t=C()))if(null!==(n=Gn())){for(r=[],a=gr,i=B(),null!==i?(o=Mn(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==i;)r.push(i),a=gr,i=B(),null!==i?(o=Mn(),null!==o?i=[i,o]:(i=null,gr=a)):(i=null,gr=a);null!==r?e=[e,t,n,r]:(e=null,gr=s)}else e=null,gr=s;else e=null,gr=s;else e=null,gr=s;return e}function Mn(){var e;return e=Un(),null===e&&null===(e=jn())&&null===(e=Bn())&&null===(e=qn())&&null===(e=Fn())&&(e=_t()),e}function Un(){var e,t,r,o,s;return o=gr,s=gr,"ttl"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"ttl"')),null!==e?(t=D(),null!==t?(r=Yn(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.ttl=t}(0,e[2])),null===e&&(gr=o),e}function jn(){var e,t,r,o,s;return o=gr,s=gr,"maddr"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"maddr"')),null!==e?(t=D(),null!==t?(r=oe(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.maddr=t}(0,e[2])),null===e&&(gr=o),e}function Bn(){var e,t,r,o,s;return o=gr,s=gr,"received"===n.substr(gr,8).toLowerCase()?(e=n.substr(gr,8),gr+=8):(e=null,0===vr&&i('"received"')),null!==e?(t=D(),null!==t?(r=he(),null===r&&(r=ue()),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.received=t}(0,e[2])),null===e&&(gr=o),e}function qn(){var e,t,r,o,s;return o=gr,s=gr,"branch"===n.substr(gr,6).toLowerCase()?(e=n.substr(gr,6),gr+=6):(e=null,0===vr&&i('"branch"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.branch=t}(0,e[2])),null===e&&(gr=o),e}function Fn(){var e,t,r,o,a,c,l;if(a=gr,c=gr,"rport"===n.substr(gr,5).toLowerCase()?(e=n.substr(gr,5),gr+=5):(e=null,0===vr&&i('"rport"')),null!==e){if(l=gr,null!==(t=D())){for(r=[],o=s();null!==o;)r.push(o),o=s();null!==r?t=[t,r]:(t=null,gr=l)}else t=null,gr=l;t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=c)}else e=null,gr=c;return null!==e&&(e=function(e){"undefined"!=typeof response_port&&(Tr.rport=response_port.join(""))}()),null===e&&(gr=a),e}function Vn(){var e,t,n,r,i,o;return o=gr,e=Hn(),null!==e?(t=O(),null!==t?(n=R(),null!==n?(r=O(),null!==r?(i=Wn(),null!==i?e=[e,t,n,r,i]:(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o)):(e=null,gr=o),e}function Hn(){var e,t;return t=gr,"sip"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"SIP"')),null===e&&(e=R()),null!==e&&(e=function(e,t){Tr.protocol=t}(0,e)),null===e&&(gr=t),e}function Wn(){var e,t;return t=gr,"udp"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"UDP"')),null===e&&("tcp"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"TCP"')),null===e&&("tls"===n.substr(gr,3).toLowerCase()?(e=n.substr(gr,3),gr+=3):(e=null,0===vr&&i('"TLS"')),null===e&&("sctp"===n.substr(gr,4).toLowerCase()?(e=n.substr(gr,4),gr+=4):(e=null,0===vr&&i('"SCTP"')),null===e&&(e=R())))),null!==e&&(e=function(e,t){Tr.transport=t}(0,e)),null===e&&(gr=t),e}function Gn(){var e,t,n,r,i;return r=gr,e=zn(),null!==e?(i=gr,t=q(),null!==t?(n=Jn(),null!==n?t=[t,n]:(t=null,gr=i)):(t=null,gr=i),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e}function zn(){var e,t;return t=gr,e=he(),null===e&&null===(e=le())&&(e=se()),null!==e&&(e=function(e){Tr.host=n.substring(gr,e)}(t)),null===e&&(gr=t),e}function Jn(){var e,t,n,r,i,o,a;return o=gr,a=gr,e=s(),e=null!==e?e:"",null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?(r=s(),r=null!==r?r:"",null!==r?(i=s(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a)):(e=null,gr=a),null!==e&&(e=function(e,t){Tr.port=parseInt(t.join(""))}(0,e)),null===e&&(gr=o),e}function Yn(){var e,t,n,r,i;return r=gr,i=gr,e=s(),null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?e=[e,t,n]:(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i),null!==e&&(e=function(e,t){return parseInt(t.join(""))}(0,e)),null===e&&(gr=r),e}function Kn(){return tn()}function Xn(){var e,t,n,r,i,o;if(i=gr,null!==(e=Qn())){for(t=[],o=gr,n=B(),null!==n?(r=$n(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=B(),null!==n?(r=$n(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function Qn(){var e,t;return t=gr,e=At(),null!==e&&(e=function(e,t){Tr.expires=t}(0,e)),null===e&&(gr=t),e}function $n(){var e;return e=Zn(),null===e&&(e=_t()),e}function Zn(){var e,t,r,o,s;return o=gr,s=gr,"refresher"===n.substr(gr,9).toLowerCase()?(e=n.substr(gr,9),gr+=9):(e=null,0===vr&&i('"refresher"')),null!==e?(t=D(),null!==t?("uac"===n.substr(gr,3).toLowerCase()?(r=n.substr(gr,3),gr+=3):(r=null,0===vr&&i('"uac"')),null===r&&("uas"===n.substr(gr,3).toLowerCase()?(r=n.substr(gr,3),gr+=3):(r=null,0===vr&&i('"uas"'))),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.refresher=t.toLowerCase()}(0,e[2])),null===e&&(gr=o),e}function er(){var e,t,n,r;return r=gr,e=R(),null!==e?(t=S(),null!==t?(n=tr(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function tr(){var e,t;for(e=[],t=A(),null===t&&null===(t=_())&&(t=C());null!==t;)e.push(t),null===(t=A())&&null===(t=_())&&(t=C());return e}function nr(){var e,t;for(e=[],t=u();null!==t;)e.push(t),t=u();return e}function rr(){var e,t,r;return r=gr,"uuid:"===n.substr(gr,5)?(e="uuid:",gr+=5):(e=null,0===vr&&i('"uuid:"')),null!==e?(t=ir(),null!==t?e=[e,t]:(e=null,gr=r)):(e=null,gr=r),e}function ir(){var e,t,r,o,s,a,c,l,u,d,f;return d=gr,f=gr,e=sr(),null!==e?(45===n.charCodeAt(gr)?(t="-",gr++):(t=null,0===vr&&i('"-"')),null!==t?(r=or(),null!==r?(45===n.charCodeAt(gr)?(o="-",gr++):(o=null,0===vr&&i('"-"')),null!==o?(s=or(),null!==s?(45===n.charCodeAt(gr)?(a="-",gr++):(a=null,0===vr&&i('"-"')),null!==a?(c=or(),null!==c?(45===n.charCodeAt(gr)?(l="-",gr++):(l=null,0===vr&&i('"-"')),null!==l?(u=ar(),null!==u?e=[e,t,r,o,s,a,c,l,u]:(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f)):(e=null,gr=f),null!==e&&(e=function(e,t){Tr=n.substring(gr+5,e)}(d,e[0])),null===e&&(gr=d),e}function or(){var e,t,n,r,i;return i=gr,e=c(),null!==e?(t=c(),null!==t?(n=c(),null!==n?(r=c(),null!==r?e=[e,t,n,r]:(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i)):(e=null,gr=i),e}function sr(){var e,t,n;return n=gr,e=or(),null!==e?(t=or(),null!==t?e=[e,t]:(e=null,gr=n)):(e=null,gr=n),e}function ar(){var e,t,n,r;return r=gr,e=or(),null!==e?(t=or(),null!==t?(n=or(),null!==n?e=[e,t,n]:(e=null,gr=r)):(e=null,gr=r)):(e=null,gr=r),e}function cr(){var e,t,n,r,i,o,s;if(i=gr,o=gr,e=K(),null===e&&(e=yt()),null!==e){for(t=[],s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==n;)t.push(n),s=gr,n=B(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,gr=s)):(n=null,gr=s);null!==t?e=[e,t]:(e=null,gr=o)}else e=null,gr=o;return null!==e&&(e=function(e){try{Tr=new Sr(Tr.uri,Tr.display_name,Tr.params)}catch(e){Tr=-1}}()),null===e&&(gr=i),e}function lr(){var e,t,n,r,i,o;if(i=gr,null!==(e=ur())){for(t=[],o=gr,n=B(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==n;)t.push(n),o=gr,n=B(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,gr=o)):(n=null,gr=o);null!==t?e=[e,t]:(e=null,gr=i)}else e=null,gr=i;return e}function ur(){var e,t,r,o,s,a;return o=gr,s=gr,e=x(),null!==e?(a=gr,64===n.charCodeAt(gr)?(t="@",gr++):(t=null,0===vr&&i('"@"')),null!==t?(r=x(),null!==r?t=[t,r]:(t=null,gr=a)):(t=null,gr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e){Tr.call_id=n.substring(gr,e)}(o)),null===e&&(gr=o),e}function dr(){var e;return e=fr(),null===e&&null===(e=hr())&&null===(e=pr())&&(e=_t()),e}function fr(){var e,t,r,o,s;return o=gr,s=gr,"to-tag"===n.substr(gr,6)?(e="to-tag",gr+=6):(e=null,0===vr&&i('"to-tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.to_tag=t}(0,e[2])),null===e&&(gr=o),e}function hr(){var e,t,r,o,s;return o=gr,s=gr,"from-tag"===n.substr(gr,8)?(e="from-tag",gr+=8):(e=null,0===vr&&i('"from-tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,gr=s)):(e=null,gr=s)):(e=null,gr=s),null!==e&&(e=function(e,t){Tr.from_tag=t}(0,e[2])),null===e&&(gr=o),e}function pr(){var e,t;return t=gr,"early-only"===n.substr(gr,10)?(e="early-only",gr+=10):(e=null,0===vr&&i('"early-only"')),null!==e&&(e=function(e){Tr.early_only=!0}()),null===e&&(gr=t),e}var mr={CRLF:o,DIGIT:s,ALPHA:a,HEXDIG:c,WSP:l,OCTET:u,DQUOTE:d,SP:f,HTAB:h,alphanum:p,reserved:m,unreserved:g,mark:v,escaped:y,LWS:C,SWS:b,HCOLON:S,TEXT_UTF8_TRIM:T,TEXT_UTF8char:A,UTF8_NONASCII:E,UTF8_CONT:_,LHEX:w,token:R,token_nodot:k,separators:I,word:x,STAR:P,SLASH:O,EQUAL:D,LPAREN:N,RPAREN:L,RAQUOT:M,LAQUOT:U,COMMA:j,SEMI:B,COLON:q,LDQUOT:F,RDQUOT:V,comment:H,ctext:W,quoted_string:G,quoted_string_clean:z,qdtext:J,quoted_pair:Y,SIP_URI_noparams:K,SIP_URI:X,uri_scheme:Q,uri_scheme_sips:$,uri_scheme_sip:Z,userinfo:ee,user:te,user_unreserved:ne,password:re,hostport:ie,host:oe,hostname:se,domainlabel:ae,toplabel:ce,IPv6reference:le,IPv6address:ue,h16:de,ls32:fe,IPv4address:he,dec_octet:pe,port:me,uri_parameters:ge,uri_parameter:ve,transport_param:ye,user_param:Ce,method_param:be,ttl_param:Se,maddr_param:Te,lr_param:Ae,other_param:Ee,pname:_e,pvalue:we,paramchar:Re,param_unreserved:ke,headers:Ie,header:xe,hname:Pe,hvalue:Oe,hnv_unreserved:De,Request_Response:Ne,Request_Line:Le,Request_URI:Me,absoluteURI:Ue,hier_part:je,net_path:Be,abs_path:qe,opaque_part:Fe,uric:Ve,uric_no_slash:He,path_segments:We,segment:Ge,param:ze,pchar:Je,scheme:Ye,authority:Ke,srvr:Xe,reg_name:Qe,query:$e,SIP_Version:Ze,INVITEm:et,ACKm:tt,OPTIONSm:nt,BYEm:rt,CANCELm:it,REGISTERm:ot,SUBSCRIBEm:st,NOTIFYm:at,REFERm:ct,Method:lt,Status_Line:ut,Status_Code:dt,extension_code:ft,Reason_Phrase:ht,Allow_Events:pt,Call_ID:mt,Contact:gt,contact_param:vt,name_addr:yt,display_name:Ct,contact_params:bt,c_p_q:St,c_p_expires:Tt,delta_seconds:At,qvalue:Et,generic_param:_t,gen_value:wt,Content_Disposition:Rt,disp_type:kt,disp_param:It,handling_param:xt,Content_Encoding:Pt,Content_Length:Ot,Content_Type:Dt,media_type:Nt,m_type:Lt,discrete_type:Mt,composite_type:Ut,extension_token:jt,x_token:Bt,m_subtype:qt,m_parameter:Ft,m_value:Vt,CSeq:Ht,CSeq_value:Wt,Expires:Gt,Event:zt,event_type:Jt,From:Yt,from_param:Kt,tag_param:Xt,Max_Forwards:Qt,Min_Expires:$t,Name_Addr_Header:Zt,Proxy_Authenticate:en,challenge:tn,other_challenge:nn,auth_param:rn,digest_cln:on,realm:sn,realm_value:an,domain:cn,URI:ln,nonce:un,nonce_value:dn,opaque:fn,stale:hn,algorithm:pn,qop_options:mn,qop_value:gn,Proxy_Require:vn,Record_Route:yn,rec_route:Cn,Reason:bn,reason_param:Sn,reason_cause:Tn,Require:An,Route:En,route_param:_n,Subscription_State:wn,substate_value:Rn,subexp_params:kn,event_reason_value:In,Subject:xn,Supported:Pn,To:On,to_param:Dn,Via:Nn,via_param:Ln,via_params:Mn,via_ttl:Un,via_maddr:jn,via_received:Bn,via_branch:qn,response_port:Fn,sent_protocol:Vn,protocol_name:Hn,transport:Wn,sent_by:Gn,via_host:zn,via_port:Jn,ttl:Yn,WWW_Authenticate:Kn,Session_Expires:Xn,s_e_expires:Qn,s_e_params:$n,s_e_refresher:Zn,extension_header:er,header_value:tr,message_body:nr,uuid_URI:rr,uuid:ir,hex4:or,hex8:sr,hex12:ar,Refer_To:cr,Replaces:lr,call_id:ur,replaces_param:dr,to_tag:fr,from_tag:hr,early_flag:pr};if(void 0!==r){if(void 0===mr[r])throw new Error("Invalid rule name: "+t(r)+".")}else r="CRLF";var gr=0,vr=0,yr=0,Cr=[],br=e("./URI"),Sr=e("./NameAddrHeader"),Tr={};if(null===mr[r]()||gr!==n.length){var Ar=Math.max(gr,yr),Er=Ar<n.length?n.charAt(Ar):null,_r=function(){for(var e=1,t=1,r=!1,i=0;i<Math.max(gr,yr);i++){var o=n.charAt(i);"\n"===o?(r||e++,t=1,r=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e++,t=1,r=!0):(t++,r=!1)}return{line:e,column:t}}();return new this.SyntaxError(function(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}(Cr),Er,Ar,_r.line,_r.column),-1}return Tr},toSource:function(){return this._source}};return n.SyntaxError=function(e,n,r,i,o){this.name="SyntaxError",this.expected=e,this.found=n,this.message=function(e,n){var r,i;switch(e.length){case 0:r="end of input";break;case 1:r=e[0];break;default:r=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}return i=n?t(n):"end of input","Expected "+r+" but "+i+" found."}(e,n),this.offset=r,this.line=i,this.column=o},n.SyntaxError.prototype=Error.prototype,n}()},{"./NameAddrHeader":9,"./URI":24}],7:[function(e,t,n){var r=e("debug")("JsSIP"),i=e("../package.json");r("version %s",i.version);var o=e("rtcninja"),s=e("./Constants"),a=e("./Exceptions"),c=e("./Utils"),l=e("./UA"),u=e("./URI"),d=e("./NameAddrHeader"),f=e("./Grammar"),h=e("./WebSocketInterface"),p=t.exports={C:s,Exceptions:a,Utils:c,UA:l,URI:u,NameAddrHeader:d,WebSocketInterface:h,Grammar:f,debug:e("debug"),rtcninja:o};Object.defineProperties(p,{name:{get:function(){return i.title}},version:{get:function(){return i.version}}})},{"../package.json":40,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./UA":23,"./URI":24,"./Utils":25,"./WebSocketInterface":26,debug:33,rtcninja:43}],8:[function(e,t,n){function r(e){this.ua=e,this.data={},o.EventEmitter.call(this)}t.exports=r;var i=e("util"),o=e("events"),s=e("./Constants"),a=e("./SIPMessage"),c=e("./Utils"),l=e("./RequestSender"),u=e("./Transactions"),d=e("./Exceptions");i.inherits(r,o.EventEmitter),r.prototype.send=function(e,t,n){var r,i,o,c,u,d=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(!(e=this.ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+d);n=n||{},u=n.extraHeaders&&n.extraHeaders.slice()||[],c=n.eventHandlers||{},o=n.contentType||"text/plain",this.content_type=o;for(i in c)this.on(i,c[i]);this.closed=!1,this.ua.applicants[this]=this,u.push("Content-Type: "+o),this.request=new a.OutgoingRequest(s.MESSAGE,e,this.ua,null,u),t?(this.request.body=t,this.content=t):this.content=null,r=new l(this,this.ua),this.newMessage("local",this.request),r.send()},r.prototype.receiveResponse=function(e){var t;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:e});break;default:delete this.ua.applicants[this],t=c.sipErrorCause(e.status_code),this.emit("failed",{originator:"remote",response:e,cause:t})}},r.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:s.causes.REQUEST_TIMEOUT})},r.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:s.causes.CONNECTION_ERROR})},r.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},r.prototype.init_incoming=function(e){var t;this.request=e,this.content_type=e.getHeader("Content-Type"),e.body?this.content=e.body:this.content=null,this.newMessage("remote",e),!(t=this.ua.transactions.nist[e.via_branch])||t.state!==u.C.STATUS_TRYING&&t.state!==u.C.STATUS_PROCEEDING||e.reply(200)},r.prototype.accept=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,t,n)},r.prototype.reject=function(e){e=e||{};var t=e.status_code||480,n=e.reason_phrase,r=e.extraHeaders&&e.extraHeaders.slice()||[],i=e.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"reject" not supported for outgoing Message');if(t<300||t>=700)throw new TypeError("Invalid status_code: "+t);this.request.reply(t,n,r,i)},r.prototype.newMessage=function(e,t){"remote"===e?(this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from):"local"===e&&(this.direction="outgoing",this.local_identity=t.from,this.remote_identity=t.to),this.ua.newMessage({originator:e,message:this,request:t})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":17,"./SIPMessage":18,"./Transactions":21,"./Utils":25,events:28,util:32}],9:[function(e,t,n){function r(e,t,n){var r;if(!(e&&e instanceof i))throw new TypeError('missing or invalid "uri" parameter');this.uri=e,this.parameters={};for(r in n)this.setParam(r,n[r]);Object.defineProperties(this,{display_name:{get:function(){return t},set:function(e){t=0===e?"0":e}}})}t.exports=r;var i=e("./URI"),o=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},clone:function(){return new r(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},r.parse=function(e){return e=o.parse(e,"Name_Addr_Header"),-1!==e?e:void 0}},{"./Grammar":6,"./URI":24}],10:[function(e,t,n){function r(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(i=e.indexOf("\r\n",n)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function i(e,t,n,r){var i,o,s,l,u=t.indexOf(":",n),d=t.substring(n,u).trim(),f=t.substring(u+1,r).trim();switch(d.toLowerCase()){case"via":case"v":e.addHeader("via",f),1===e.getHeaders("via").length?(l=e.parseHeader("Via"))&&(e.via=l,e.via_branch=l.branch):l=0;break;case"from":case"f":e.setHeader("from",f),l=e.parseHeader("from"),l&&(e.from=l,e.from_tag=l.getParam("tag"));break;case"to":case"t":e.setHeader("to",f),l=e.parseHeader("to"),l&&(e.to=l,e.to_tag=l.getParam("tag"));break;case"record-route":for(l=a.parse(f,"Record_Route"),-1===l&&(l=void 0),s=l.length,o=0;o<s;o++)i=l[o],e.addHeader("record-route",f.substring(i.possition,i.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=i.parsed;break;case"call-id":case"i":e.setHeader("call-id",f),l=e.parseHeader("call-id"),l&&(e.call_id=f);break;case"contact":case"m":for(l=a.parse(f,"Contact"),-1===l&&(l=void 0),s=l.length,o=0;o<s;o++)i=l[o],e.addHeader("contact",f.substring(i.possition,i.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=i.parsed;break;case"content-length":case"l":e.setHeader("content-length",f),l=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",f),l=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",f),l=e.parseHeader("cseq"),l&&(e.cseq=l.value),e instanceof c.IncomingResponse&&(e.method=l.method);break;case"max-forwards":e.setHeader("max-forwards",f),l=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",f),l=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",f),l=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",f),l=e.parseHeader("session-expires"),l&&(e.session_expires=l.expires,e.session_expires_refresher=l.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",f),l=e.parseHeader("refer-to"),l&&(e.refer_to=l);break;case"replaces":e.setHeader("replaces",f),l=e.parseHeader("replaces"),l&&(e.replaces=l);break;case"event":case"o":e.setHeader("event",f),l=e.parseHeader("event"),l&&(e.event=l);break;default:e.setHeader(d,f),l=0}return void 0!==l||{error:'error parsing header "'+d+'"'}}var o={};t.exports=o;var s=e("debug")("JsSIP:ERROR:Parser");s.log=console.warn.bind(console);var a=e("./Grammar"),c=e("./SIPMessage");o.parseMessage=function(e,t){var n,o,l,u,d,f=0,h=e.indexOf("\r\n");if(-1===h)return void s("parseMessage() | no CRLF found, not a SIP message");if(o=e.substring(0,h),-1===(d=a.parse(o,"Request_Response")))return void s('parseMessage() | error parsing first line of SIP message: "'+o+'"');for(d.status_code?(n=new c.IncomingResponse,n.status_code=d.status_code,n.reason_phrase=d.reason_phrase):(n=new c.IncomingRequest(t),n.method=d.method,n.ruri=d.uri),n.data=e,f=h+2;;){if(-2===(h=r(e,f))){u=f+2;break}if(-1===h)return void s("parseMessage() | malformed message");if(!0!==(d=i(n,e,f,h)))return void s("parseMessage() |",d.error);f=h+2}return n.hasHeader("content-length")?(l=n.getHeader("content-length"),n.body=e.substr(u,l)):n.body=e.substring(u),n}},{"./Grammar":6,"./SIPMessage":18,debug:33}],11:[function(e,t,n){function r(e){V("new"),this.ua=e,this.status=B.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:z.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.referSubscribers={},this.data={},F.EventEmitter.call(this)}function i(e,t){var n=this,r=X.T1;this.timers.invite2xxTimer=setTimeout(function i(){n.status===B.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,["Contact: "+n.contact],t),r<X.T2&&(r*=2)>X.T2&&(r=X.T2),n.timers.invite2xxTimer=setTimeout(i,r))},r)}function o(){var e=this;this.timers.ackTimer=setTimeout(function(){e.status===B.STATUS_WAITING_FOR_ACK&&(V("no ACK received, terminating the session"),clearTimeout(e.timers.invite2xxTimer),b.call(e,z.BYE),D.call(e,"remote",null,z.causes.NO_ACK))},X.TIMER_H)}function s(e,t){var n=this;this.connection=new W.RTCPeerConnection(e,t),this.connection.onaddstream=function(e,t){n.emit("addstream",{stream:t})},this.connection.onremovestream=function(e,t){n.emit("removestream",{stream:t})},this.connection.oniceconnectionstatechange=function(e,t){n.emit("iceconnectionstatechange",{state:t}),"failed"===t&&n.terminate({cause:z.causes.RTP_TIMEOUT,status_code:200,reason_phrase:z.causes.RTP_TIMEOUT})}}function c(e,t,n,r){function i(r){s.onicecandidate=function(n,r){if(!r){if(s.onicecandidate=null,o.rtcReady=!0,t){var i={originator:"local",type:e,sdp:s.localDescription.sdp};o.emit("sdp",i),t(i.sdp)}t=null}},s.setLocalDescription(r,function(){if("complete"===s.iceGatheringState){if(o.rtcReady=!0,t){var n={originator:"local",type:e,sdp:s.localDescription.sdp};o.emit("sdp",n),t(n.sdp)}t=null}},function(e){o.rtcReady=!0,n&&n(e)})}V("createLocalDescription()");var o=this,s=this.connection;if(this.rtcReady=!1,"offer"===e)s.createOffer(i,function(e){o.rtcReady=!0,n&&n(e)},r);else{if("answer"!==e)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+e+'" was given');s.createAnswer(i,function(e){o.rtcReady=!0,n&&n(e)},r)}}function l(e,t,n){var r,i,o="UAS"===t?e.to_tag:e.from_tag,s="UAS"===t?e.from_tag:e.to_tag,a=e.call_id+o+s;return i=this.earlyDialogs[a],n?!!i||(i=new $(this,e,t,$.C.STATUS_EARLY),i.error?(V(i.error),N.call(this,"remote",e,z.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[a]=i,!0)):(this.from_tag=e.from_tag,this.to_tag=e.to_tag,i?(i.update(e,t),this.dialog=i,delete this.earlyDialogs[a],!0):(r=new $(this,e,t),r.error?(V(r.error),N.call(this,"remote",e,z.causes.INTERNAL_ERROR),!1):(this.dialog=r,!0)))}function u(e){function t(t){t=t||{},p=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==B.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}function n(){r(function(t){var n=["Contact: "+d.contact];A.call(d,e,n),d.late_sdp&&(t=S.call(d,t)),e.reply(200,null,n,t,function(){d.status=B.STATUS_WAITING_FOR_ACK,i.call(d,e,t),o.call(d)}),"function"==typeof m.callback&&m.callback()},function(){e.reply(500)})}function r(e,t){d.late_sdp?c.call(d,"offer",e,t,d.rtcOfferConstraints):(!0===d.remoteHold&&!1===h?(d.remoteHold=!1,M.call(d,"remote")):!1===d.remoteHold&&!0===h&&(d.remoteHold=!0,L.call(d,"remote")),c.call(d,"answer",e,t,d.rtcAnswerConstraints))}V("receiveReinvite()");var s,a,l,u,d=this,f=e.getHeader("Content-Type"),h=!1,p=!1,m={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("reinvite",m),!p)if(e.body){if(this.late_sdp=!1,"application/sdp"!==f)return V("invalid Content-Type"),void e.reply(415);for(s=e.parseSDP(),a=0;a<s.media.length;a++)if(u=s.media[a],-1!==ie.indexOf(u.type)){if("sendonly"!==(l=u.direction||s.direction||"sendrecv")&&"inactive"!==l){h=!1;break}h=!0}var g={originator:"remote",type:"offer",sdp:e.body};this.emit("sdp",g),this.connection.setRemoteDescription(new W.RTCSessionDescription({type:"offer",sdp:g.sdp}),n,function(){e.reply(488)})}else this.late_sdp=!0,n()}function d(e){function t(t){t=t||{},l=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==B.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}V("receiveUpdate()");var n,r,i,o,s=this,a=e.getHeader("Content-Type"),l=!1,u=!1,d={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("update",d),!l){if(!e.body){var f=[];return A.call(this,e,f),void e.reply(200,null,f)}if("application/sdp"!==a)return V("invalid Content-Type"),void e.reply(415);for(n=e.parseSDP(),r=0;r<n.media.length;r++)if(o=n.media[r],-1!==ie.indexOf(o.type)){if("sendonly"!==(i=o.direction||n.direction||"sendrecv")&&"inactive"!==i){u=!1;break}u=!0}var h={originator:"remote",type:"offer",sdp:e.body};this.emit("sdp",h),this.connection.setRemoteDescription(new W.RTCSessionDescription({type:"offer",sdp:h.sdp}),function(){!0===s.remoteHold&&!1===u?(s.remoteHold=!1,M.call(s,"remote")):!1===s.remoteHold&&!0===u&&(s.remoteHold=!0,L.call(s,"remote")),c.call(s,"answer",function(t){var n=["Contact: "+s.contact];A.call(s,e,n),e.reply(200,null,n,t),"function"==typeof d.callback&&d.callback()},function(){e.reply(500)})},function(){e.reply(488)},this.rtcAnswerConstraints)}}function f(e){function t(t,n){var o,s;if(n=n||{},t="function"==typeof t?t:null,this.status!==B.STATUS_WAITING_FOR_ACK&&this.status!==B.STATUS_CONFIRMED)return!1;o=new r(this.ua),o.on("progress",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),o.on("accepted",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),o.on("failed",function(e){e.message?i.notify(e.message.status_code,e.message.reason_phrase):i.notify(487,e.cause)}),e.refer_to.uri.hasHeader("replaces")&&(s=decodeURIComponent(e.refer_to.uri.getHeader("replaces")),n.extraHeaders=n.extraHeaders||[],n.extraHeaders.push("Replaces: "+s)),o.connect(e.refer_to.uri.toAor(),n,t)}function n(){i.notify(603)}V("receiveRefer()");var i,o=this;return void 0===a(e.refer_to)?(V("no Refer-To header field present in REFER"),void e.reply(400)):e.refer_to.uri.scheme!==z.SIP?(V("Refer-To header field points to a non-SIP URI scheme"),void e.reply(416)):(e.reply(202),i=new ne(this,e.cseq),void this.emit("refer",{request:e,accept:function(e,n){t.call(o,e,n)},reject:function(){n.call(o)}}))}function h(e){switch(V("receiveNotify()"),void 0===a(e.event)&&e.reply(400),e.event.event){case"refer":var t=e.event.params.id,n=this.referSubscribers[t];if(!n)return void e.reply(481,"Subscription does not exist");n.receiveNotify(e),e.reply(200);break;default:e.reply(489)}}function p(e){function t(t){var n;if(this.status!==B.STATUS_WAITING_FOR_ACK&&this.status!==B.STATUS_CONFIRMED)return!1;n=new r(this.ua),n.on("confirmed",function(){i.terminate()}),n.init_incoming(e,t)}function n(){V("Replaced INVITE rejected by the user"),e.reply(486)}V("receiveReplaces()");var i=this;this.emit("replaces",{request:e,accept:function(e){t.call(i,e)},reject:function(){n.call(i)}})}function m(e,t,n){function r(e){a.status!==B.STATUS_TERMINATED&&(a.localMediaStream=e,e&&a.connection.addStream(e),a.emit("peerconnection",{peerconnection:a.connection}),I.call(a,a.request),c.call(a,"offer",o,s,t))}function i(){a.status!==B.STATUS_TERMINATED&&N.call(a,"local",null,z.causes.USER_DENIED_MEDIA_ACCESS)}function o(e){a.isCanceled||a.status===B.STATUS_TERMINATED||(a.request.body=e,a.status=B.STATUS_INVITE_SENT,a.emit("sending",{request:a.request}),l.send())}function s(){a.status!==B.STATUS_TERMINATED&&N.call(a,"system",null,z.causes.WEBRTC_ERROR)}var a=this,l=new Z(a,this.ua);this.receiveResponse=function(e){g.call(a,e)},n?setTimeout(function(){r(n)}):e.audio||e.video?(this.localMediaStreamLocallyGenerated=!0,e.video&&e.video.mandatory&&"desktop"===e.video.mandatory.chromeMediaSource?W.getUserMedia({video:!1,audio:!0},function(t){a.connection.addStream(t),W.getUserMedia(e,r,i)},i):W.getUserMedia(e,r,i)):r(null)}function g(e){V("receiveInviteResponse()");var t,n,r,i=this;if(this.dialog&&e.status_code>=200&&e.status_code<=299)return this.dialog.id.call_id===e.call_id&&this.dialog.id.local_tag===e.from_tag&&this.dialog.id.remote_tag===e.to_tag?void b.call(this,z.ACK):(n=new $(this,e,"UAC"),void 0!==n.error?void V(n.error):(n.sendRequest({owner:{status:B.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},z.ACK),void n.sendRequest({owner:{status:B.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},z.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(e.status_code>=100&&e.status_code<200?this.request.cancel(this.cancelReason):e.status_code>=200&&e.status_code<299&&C.call(this,e));if(this.status===B.STATUS_INVITE_SENT||this.status===B.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this.status=B.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){V("1xx response received without to tag");break}if(e.hasHeader("contact")&&!l.call(this,e,"UAC",!0))break;if(this.status=B.STATUS_1XX_RECEIVED,x.call(this,"remote",e),!e.body)break;r={originator:"remote",type:"pranswer",sdp:e.body},this.emit("sdp",r),this.connection.setRemoteDescription(new W.RTCSessionDescription({type:"pranswer",sdp:r.sdp}),null,null);break;case/^2[0-9]{2}$/.test(e.status_code):if(this.status=B.STATUS_CONFIRMED,!e.body){C.call(this,e,400,z.causes.MISSING_SDP),N.call(this,"remote",e,z.causes.BAD_MEDIA_DESCRIPTION);break}if(!l.call(this,e,"UAC"))break;r={originator:"remote",type:"answer",sdp:e.body},this.emit("sdp",r),this.connection.setRemoteDescription(new W.RTCSessionDescription({type:"answer",sdp:r.sdp}),function(){E.call(i,e),P.call(i,"remote",e),b.call(i,z.ACK),O.call(i,"local",null)},function(){C.call(i,e,488,"Not Acceptable Here"),N.call(i,"remote",e,z.causes.BAD_MEDIA_DESCRIPTION)});break;default:t=K.sipErrorCause(e.status_code),N.call(this,"remote",e,t)}}function v(e){function t(e){if(r.status!==B.STATUS_TERMINATED&&(b.call(r,z.ACK),!a)){if(E.call(r,e),!e.body)return void n();if("application/sdp"!==e.getHeader("Content-Type"))return void n();var t={originator:"remote",type:"answer",sdp:e.body};r.emit("sdp",t),r.connection.setRemoteDescription(new W.RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){o.succeeded&&o.succeeded(e)},function(){n()})}}function n(e){o.failed&&o.failed(e)}V("sendReinvite()"),e=e||{};var r=this,i=e.extraHeaders||[],o=e.eventHandlers||{},s=e.rtcOfferConstraints||this.rtcOfferConstraints||null,a=!1;i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),c.call(this,"offer",function(e){e=S.call(r,e),new ee(r,z.INVITE).send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),a=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},s)}function y(e){function t(e){if(r.status!==B.STATUS_TERMINATED&&!l)if(E.call(r,e),a){if(!e.body)return void n();if("application/sdp"!==e.getHeader("Content-Type"))return void n();var t={originator:"remote",type:"answer",sdp:e.body};r.emit("sdp",t),r.connection.setRemoteDescription(new W.RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){o.succeeded&&o.succeeded(e)},function(){n()})}else o.succeeded&&o.succeeded(e)}function n(e){o.failed&&o.failed(e)}V("sendUpdate()"),e=e||{};var r=this,i=e.extraHeaders||[],o=e.eventHandlers||{},s=e.rtcOfferConstraints||this.rtcOfferConstraints||null,a=e.sdpOffer||!1,l=!1;if(i.push("Contact: "+this.contact),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),a)i.push("Content-Type: application/sdp"),c.call(this,"offer",function(e){e=S.call(r,e),new ee(r,z.UPDATE).send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),l=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},s);else{new ee(r,z.UPDATE).send({extraHeaders:i,eventHandlers:{onSuccessResponse:function(e){t(e)},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})}}function C(e,t,n){V("acceptAndTerminate()");var r=[];t&&(n=n||z.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause="+t+'; text="'+n+'"')),(this.dialog||l.call(this,e,"UAC"))&&(b.call(this,z.ACK),b.call(this,z.BYE,{extraHeaders:r})),this.status=B.STATUS_TERMINATED}function b(e,t){V("sendRequest()"),new ee(this,e).send(t)}function S(e){var t,n,r;if(!this.localHold&&!this.remoteHold)return e;if(e=G.parse(e),this.localHold&&!this.remoteHold)for(V("mangleOffer() | me on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],-1!==ie.indexOf(r.type)&&(r.direction?"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="sendonly");else if(this.localHold&&this.remoteHold)for(V("mangleOffer() | both on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],-1!==ie.indexOf(r.type)&&(r.direction="inactive");else if(this.remoteHold)for(V("mangleOffer() | remote on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],-1!==ie.indexOf(r.type)&&(r.direction?"sendrecv"===r.direction?r.direction="recvonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="recvonly");return G.write(e)}function T(){var e=!0,t=!0;(this.localHold||this.remoteHold)&&(e=!1,t=!1),this.audioMuted&&(e=!1),this.videoMuted&&(t=!1),w.call(this,!e),R.call(this,!t)}function A(e,t){if(this.sessionTimers.enabled){var n;e.session_expires&&e.session_expires>=z.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,n="uas"),t.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+n),this.sessionTimers.refresher="uas"===n,_.call(this)}}function E(e){if(this.sessionTimers.enabled){var t;e.session_expires&&e.session_expires>=z.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,t="uac"),this.sessionTimers.refresher="uac"===t,_.call(this)}}function _(){var e=this,t=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){e.status!==B.STATUS_TERMINATED&&(V("runSessionTimer() | sending session refresh request"),y.call(e,{eventHandlers:{succeeded:function(t){E.call(e,t)}}}))},500*t):this.sessionTimers.timer=setTimeout(function(){e.status!==B.STATUS_TERMINATED&&(H("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:z.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*t)}function w(e){var t,n,r,i,o,s=this.connection.getLocalStreams();for(r=s.length,t=0;t<r;t++)for(o=s[t].getAudioTracks(),i=o.length,n=0;n<i;n++)o[n].enabled=!e}function R(e){var t,n,r,i,o,s=this.connection.getLocalStreams();for(r=s.length,t=0;t<r;t++)for(o=s[t].getVideoTracks(),i=o.length,n=0;n<i;n++)o[n].enabled=!e}function k(e,t){V("newRTCSession"),this.ua.newRTCSession({originator:e,session:this,request:t})}function I(e){V("session connecting"),this.emit("connecting",{request:e})}function x(e,t){V("session progress"),this.emit("progress",{originator:e,response:t||null})}function P(e,t){V("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:e,response:t||null})}function O(e,t){V("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:e,ack:t||null})}function D(e,t,n){V("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:e,message:t||null,cause:n})}function N(e,t,n){V("session failed"),this.close(),this.emit("failed",{originator:e,message:t||null,cause:n})}function L(e){V("session onhold"),T.call(this),this.emit("hold",{originator:e})}function M(e){V("session onunhold"),T.call(this),this.emit("unhold",{originator:e})}function U(e){V("session onmute"),T.call(this),this.emit("muted",{audio:e.audio,video:e.video})}function j(e){V("session onunmute"),T.call(this),this.emit("unmuted",{audio:e.audio,video:e.video})}t.exports=r;var B={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};r.C=B;var q=e("util"),F=e("events"),V=e("debug")("JsSIP:RTCSession"),H=e("debug")("JsSIP:ERROR:RTCSession");H.log=console.warn.bind(console);var W=e("rtcninja"),G=e("sdp-transform"),z=e("./Constants"),J=e("./Exceptions"),Y=e("./Transactions"),K=e("./Utils"),X=e("./Timers"),Q=e("./SIPMessage"),$=e("./Dialog"),Z=e("./RequestSender"),ee=e("./RTCSession/Request"),te=e("./RTCSession/DTMF"),ne=e("./RTCSession/ReferNotifier"),re=e("./RTCSession/ReferSubscriber"),ie=["audio","video"];q.inherits(r,F.EventEmitter),r.prototype.isInProgress=function(){switch(this.status){case B.STATUS_NULL:case B.STATUS_INVITE_SENT:case B.STATUS_1XX_RECEIVED:case B.STATUS_INVITE_RECEIVED:case B.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},r.prototype.isEstablished=function(){switch(this.status){case B.STATUS_ANSWERED:case B.STATUS_WAITING_FOR_ACK:case B.STATUS_CONFIRMED:return!0;default:return!1}},r.prototype.isEnded=function(){switch(this.status){case B.STATUS_CANCELED:case B.STATUS_TERMINATED:return!0;default:return!1}},r.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},r.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},r.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?!0!==this.dialog.uac_pending_reply&&!0!==this.dialog.uas_pending_reply||(V("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(V("isReadyToReOffer() | session not established yet"),!1):(V("isReadyToReOffer() | internal WebRTC status not ready"),!1)},r.prototype.connect=function(e,t,n){V("connect()"),t=t||{};var r,i,o=e,a=t.eventHandlers||{},c=t.extraHeaders&&t.extraHeaders.slice()||[],l=t.mediaConstraints||{audio:!0,video:!0},u=t.mediaStream||null,d=t.pcConfig||{iceServers:[]},f=t.rtcConstraints||null,h=t.rtcOfferConstraints||null;if(this.rtcOfferConstraints=h,this.rtcAnswerConstraints=t.rtcAnswerConstraints||null,this.sessionTimers.enabled&&K.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=z.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=t.sessionTimersExpires:this.sessionTimers.defaultExpires=z.SESSION_EXPIRES),this.data=t.data||this.data,void 0===e)throw new TypeError("Not enough arguments");if(!W.hasWebRTC())throw new J.NotSupportedError("WebRTC not supported");if(!(e=this.ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+o);if(this.status!==B.STATUS_NULL)throw new J.InvalidStateError(this.status);for(r in a)this.on(r,a[r]);this.from_tag=K.newTag(),this.anonymous=t.anonymous||!1,this.isCanceled=!1,i={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",c.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),c.push("Privacy: id")),c.push("Contact: "+this.contact),c.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&c.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new Q.OutgoingRequest(z.INVITE,e,this.ua,i,c),this.id=this.request.call_id+this.from_tag,s.call(this,d,f),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,n?n(this):k.call(this,"local",this.request),m.call(this,l,h,u)},r.prototype.init_incoming=function(e,t){V("init_incoming()");var n,r=this,i=e.getHeader("Content-Type");return e.body&&"application/sdp"!==i?void e.reply(415):(this.status=B.STATUS_INVITE_RECEIVED,this.from_tag=e.from_tag,this.id=e.call_id+this.from_tag,this.request=e,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,e.hasHeader("expires")&&(n=1e3*e.getHeader("expires")),e.to_tag=K.newTag(),l.call(this,e,"UAS",!0)?(e.body?this.late_sdp=!1:this.late_sdp=!0,this.status=B.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){e.reply(408),N.call(r,"local",null,z.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),n&&(this.timers.expiresTimer=setTimeout(function(){r.status===B.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),N.call(r,"system",null,z.causes.EXPIRES))},n)),this.direction="incoming",this.local_identity=e.to,this.remote_identity=e.from,t?t(this):k.call(this,"remote",e),void(this.status!==B.STATUS_TERMINATED&&(e.reply(180,null,["Contact: "+r.contact]),x.call(r,"local",null)))):void e.reply(500,"Missing Contact header field"))},r.prototype.answer=function(e){function t(e){if(C.status!==B.STATUS_TERMINATED)if(C.localMediaStream=e,e&&C.connection.addStream(e),C.request.body||C.emit("peerconnection",{peerconnection:C.connection}),C.late_sdp)r();else{var t={originator:"remote",type:"offer",sdp:b.body};C.emit("sdp",t),C.connection.setRemoteDescription(new W.RTCSessionDescription({type:"offer",sdp:t.sdp}),r,function(){b.reply(488),N.call(C,"system",null,z.causes.WEBRTC_ERROR)})}}function n(){C.status!==B.STATUS_TERMINATED&&(b.reply(480),N.call(C,"local",null,z.causes.USER_DENIED_MEDIA_ACCESS))}function r(){I.call(C,b),C.late_sdp?c.call(C,"offer",a,u,C.rtcOfferConstraints):c.call(C,"answer",a,u,R)}function a(e){function t(){C.status=B.STATUS_WAITING_FOR_ACK,i.call(C,b,e),o.call(C),P.call(C,"local")}function n(){N.call(C,"system",null,z.causes.CONNECTION_ERROR)}C.status!==B.STATUS_TERMINATED&&(A.call(C,b,S),b.reply(200,null,S,e,t,n))}function u(){C.status!==B.STATUS_TERMINATED&&(b.reply(500),N.call(C,"system",null,z.causes.WEBRTC_ERROR))}V("answer()"),e=e||{};var d,f,h,p,m=!1,g=!1,v=!1,y=!1,C=this,b=this.request,S=e.extraHeaders&&e.extraHeaders.slice()||[],T=e.mediaConstraints||{},E=e.mediaStream||null,_=e.pcConfig||{iceServers:[]},w=e.rtcConstraints||null,R=e.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=R,this.rtcOfferConstraints=e.rtcOfferConstraints||null,this.sessionTimers.enabled&&K.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=z.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=e.sessionTimersExpires:this.sessionTimers.defaultExpires=z.SESSION_EXPIRES),this.data=e.data||this.data,"incoming"!==this.direction)throw new J.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==B.STATUS_WAITING_FOR_ANSWER)throw new J.InvalidStateError(this.status);if(this.status=B.STATUS_ANSWERED,!l.call(this,b,"UAS"))return void b.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),S.unshift("Contact: "+C.contact),h=b.parseSDP(),Array.isArray(h.media)||(h.media=[h.media]),d=h.media.length;d--;){var k=h.media[d];"audio"===k.type&&(m=!0,k.direction&&"sendrecv"!==k.direction||(v=!0)),"video"===k.type&&(g=!0,k.direction&&"sendrecv"!==k.direction||(y=!0))}if(E&&!1===T.audio)for(p=E.getAudioTracks(),f=p.length,d=0;d<f;d++)E.removeTrack(p[d]);if(E&&!1===T.video)for(p=E.getVideoTracks(),f=p.length,d=0;d<f;d++)E.removeTrack(p[d]);E||void 0!==T.audio||(T.audio=v),E||void 0!==T.video||(T.video=y),E||m||(T.audio=!1),E||g||(T.video=!1),s.call(this,_,w),E?t(E):T.audio||T.video?(C.localMediaStreamLocallyGenerated=!0,W.getUserMedia(T,t,n)):t(null)},r.prototype.terminate=function(e){V("terminate()"),e=e||{};var t,n,r=e.cause||z.causes.BYE,i=e.status_code,o=e.reason_phrase,s=e.extraHeaders&&e.extraHeaders.slice()||[],a=e.body,c=this;if(this.status===B.STATUS_TERMINATED)throw new J.InvalidStateError(this.status);switch(this.status){case B.STATUS_NULL:case B.STATUS_INVITE_SENT:case B.STATUS_1XX_RECEIVED:if(V("canceling session"),i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&(o=o||z.REASON_PHRASE[i]||"",t="SIP ;cause="+i+' ;text="'+o+'"'),this.status===B.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=t):this.status===B.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=t):this.status===B.STATUS_1XX_RECEIVED&&this.request.cancel(t),this.status=B.STATUS_CANCELED,N.call(this,"local",null,z.causes.CANCELED);break;case B.STATUS_WAITING_FOR_ANSWER:case B.STATUS_ANSWERED:if(V("rejecting session"),(i=i||480)<300||i>=700)throw new TypeError("Invalid status_code: "+i);this.request.reply(i,o,s,a),N.call(this,"local",null,z.causes.REJECTED);break;case B.STATUS_WAITING_FOR_ACK:case B.STATUS_CONFIRMED:if(V("terminating session"),o=e.reason_phrase||z.REASON_PHRASE[i]||"",i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&s.push("Reason: SIP ;cause="+i+'; text="'+o+'"'),this.status===B.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==Y.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(e){e.method===z.ACK&&(b.call(this,z.BYE,{extraHeaders:s,body:a}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===Y.C.STATUS_TERMINATED&&(b.call(c,z.BYE,{extraHeaders:s,body:a}),n.terminate())}),D.call(this,"local",null,r),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):(b.call(this,z.BYE,{extraHeaders:s,body:a}),D.call(this,"local",null,r))}},r.prototype.close=function(){V("close()");var e;if(this.status!==B.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(e){H("close() | error closing the RTCPeerConnection: %o",e)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(V("close() | closing local MediaStream"),W.closeMediaStream(this.localMediaStream));for(e in this.timers)clearTimeout(this.timers[e]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(e in this.earlyDialogs)this.earlyDialogs[e].terminate(),delete this.earlyDialogs[e];this.status=B.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},r.prototype.sendDTMF=function(e,t){function n(){var e,a;if(s.status===B.STATUS_TERMINATED||!s.tones||o>=s.tones.length)return void(s.tones=null);if(e=s.tones[o],o+=1,","===e)a=2e3;else{var c=new te(s);t.eventHandlers={failed:function(){s.tones=null}},c.send(e,t),a=r+i}setTimeout(n,a)}V("sendDTMF() | tones: %s",e);var r,i,o=0,s=this;if(t=t||{},r=t.duration||null,i=t.interToneGap||null,void 0===e)throw new TypeError("Not enough arguments");if(this.status!==B.STATUS_CONFIRMED&&this.status!==B.STATUS_WAITING_FOR_ACK)throw new J.InvalidStateError(this.status);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);if(r&&!K.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<te.C.MIN_DURATION?(V('"duration" value is lower than the minimum allowed, setting it to '+te.C.MIN_DURATION+" milliseconds"),r=te.C.MIN_DURATION):r>te.C.MAX_DURATION?(V('"duration" value is greater than the maximum allowed, setting it to '+te.C.MAX_DURATION+" milliseconds"),r=te.C.MAX_DURATION):r=Math.abs(r):r=te.C.DEFAULT_DURATION,t.duration=r,i&&!K.isDecimal(i))throw new TypeError("Invalid interToneGap: "+i);if(i?i<te.C.MIN_INTER_TONE_GAP?(V('"interToneGap" value is lower than the minimum allowed, setting it to '+te.C.MIN_INTER_TONE_GAP+" milliseconds"),i=te.C.MIN_INTER_TONE_GAP):i=Math.abs(i):i=te.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=e);this.tones=e,n()},r.prototype.mute=function(e){V("mute()"),e=e||{audio:!0,video:!1};var t=!1,n=!1;!1===this.audioMuted&&e.audio&&(t=!0,this.audioMuted=!0,w.call(this,!0)),!1===this.videoMuted&&e.video&&(n=!0,this.videoMuted=!0,R.call(this,!0)),!0!==t&&!0!==n||U.call(this,{audio:t,video:n})},r.prototype.unmute=function(e){V("unmute()"),e=e||{audio:!0,video:!0};var t=!1,n=!1;!0===this.audioMuted&&e.audio&&(t=!0,this.audioMuted=!1,!1===this.localHold&&w.call(this,!1)),!0===this.videoMuted&&e.video&&(n=!0,this.videoMuted=!1,!1===this.localHold&&R.call(this,!1)),!0!==t&&!0!==n||j.call(this,{audio:t,video:n})},r.prototype.hold=function(e,t){V("hold()"),e=e||{};var n,r=this;return(this.status===B.STATUS_WAITING_FOR_ACK||this.status===B.STATUS_CONFIRMED)&&(!0!==this.localHold&&(!!this.isReadyToReOffer()&&(this.localHold=!0,L.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},e.useUpdate?y.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):v.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.unhold=function(e,t){V("unhold()"),e=e||{};var n,r=this;return(this.status===B.STATUS_WAITING_FOR_ACK||this.status===B.STATUS_CONFIRMED)&&(!1!==this.localHold&&(!!this.isReadyToReOffer()&&(this.localHold=!1,M.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},e.useUpdate?y.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):v.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.renegotiate=function(e,t){V("renegotiate()"),e=e||{};var n,r=this,i=e.rtcOfferConstraints||null;return(this.status===B.STATUS_WAITING_FOR_ACK||this.status===B.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},T.call(this),e.useUpdate?y.call(this,{sdpOffer:!0,eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}):v.call(this,{eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}),!0))},r.prototype.refer=function(e,t){V("refer()");var n,r,i=this,o=e;if(this.status!==B.STATUS_WAITING_FOR_ACK&&this.status!==B.STATUS_CONFIRMED)return!1;if(!(e=this.ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+o);return n=new re(this),n.sendRefer(e,t),r=n.outgoingRequest.cseq,this.referSubscribers[r]=n,n.on("requestFailed",function(){delete i.referSubscribers[r]}),n.on("accepted",function(){delete i.referSubscribers[r]}),n.on("failed",function(){delete i.referSubscribers[r]}),n},r.prototype.receiveRequest=function(e){V("receiveRequest()");var t,n=this;if(e.method===z.CANCEL)this.status!==B.STATUS_WAITING_FOR_ANSWER&&this.status!==B.STATUS_ANSWERED||(this.status=B.STATUS_CANCELED,this.request.reply(487),N.call(this,"remote",e,z.causes.CANCELED));else switch(e.method){case z.ACK:if(this.status!==B.STATUS_WAITING_FOR_ACK)return;if(this.status=B.STATUS_CONFIRMED,clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!e.body){this.terminate({cause:z.causes.MISSING_SDP,status_code:400});break}var r={originator:"remote",type:"answer",sdp:e.body};this.emit("sdp",r),this.connection.setRemoteDescription(new W.RTCSessionDescription({type:"answer",sdp:r.sdp}),function(){n.is_confirmed||O.call(n,"remote",e)},function(){n.terminate({cause:z.causes.BAD_MEDIA_DESCRIPTION,status_code:488})})}else this.is_confirmed||O.call(this,"remote",e);break;case z.BYE:this.status===B.STATUS_CONFIRMED?(e.reply(200),D.call(this,"remote",e,z.causes.BYE)):this.status===B.STATUS_INVITE_RECEIVED?(e.reply(200),this.request.reply(487,"BYE Received"),D.call(this,"remote",e,z.causes.BYE)):e.reply(403,"Wrong Status");break;case z.INVITE:this.status===B.STATUS_CONFIRMED?e.hasHeader("replaces")?p.call(this,e):u.call(this,e):e.reply(403,"Wrong Status");break;case z.INFO:this.status===B.STATUS_CONFIRMED||this.status===B.STATUS_WAITING_FOR_ACK||this.status===B.STATUS_INVITE_RECEIVED?(t=e.getHeader("content-type"),t&&t.match(/^application\/dtmf-relay/i)?new te(this).init_incoming(e):e.reply(415)):e.reply(403,"Wrong Status");break;case z.UPDATE:this.status===B.STATUS_CONFIRMED?d.call(this,e):e.reply(403,"Wrong Status");break;case z.REFER:this.status===B.STATUS_CONFIRMED?f.call(this,e):e.reply(403,"Wrong Status");break;case z.NOTIFY:this.status===B.STATUS_CONFIRMED?h.call(this,e):e.reply(403,"Wrong Status");break;default:e.reply(501)}},r.prototype.onTransportError=function(){H("onTransportError()"),this.status!==B.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:z.causes.CONNECTION_ERROR,cause:z.causes.CONNECTION_ERROR})},r.prototype.onRequestTimeout=function(){V("onRequestTimeout"),this.status!==B.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:z.causes.REQUEST_TIMEOUT,cause:z.causes.REQUEST_TIMEOUT})},r.prototype.onDialogError=function(){H("onDialogError()"),this.status!==B.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:z.causes.DIALOG_ERROR,cause:z.causes.DIALOG_ERROR})},r.prototype.newDTMF=function(e){V("newDTMF()"),this.emit("newDTMF",e)},r.prototype.resetLocalMedia=function(){V("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,T.call(this)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./RTCSession/DTMF":12,"./RTCSession/ReferNotifier":13,"./RTCSession/ReferSubscriber":14,"./RTCSession/Request":15,"./RequestSender":17,"./SIPMessage":18,"./Timers":20,"./Transactions":21,"./Utils":25,debug:33,events:28,rtcninja:43,"sdp-transform":37,util:32}],12:[function(e,t,n){function r(e){this.owner=e,this.direction=null,this.tone=null,this.duration=null}t.exports=r;var i={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};r.C=i;var o=e("debug")("JsSIP:RTCSession:DTMF"),s=e("debug")("JsSIP:ERROR:RTCSession:DTMF");s.log=console.warn.bind(console);var a=e("../Constants"),c=e("../Exceptions"),l=e("../RTCSession");r.prototype.send=function(e,t){var n,r;if(void 0===e)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==l.C.STATUS_CONFIRMED&&this.owner.status!==l.C.STATUS_WAITING_FOR_ACK)throw new c.InvalidStateError(this.owner.status);if(t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],this.eventHandlers=t.eventHandlers||{},"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: "+e);e=e.toString()}if(!e.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+e);this.tone=e,this.duration=t.duration,n.push("Content-Type: application/dtmf-relay"),r="Signal="+this.tone+"\r\n",r+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,a.INFO,{extraHeaders:n,body:r})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):o("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){s("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){s("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){s("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},r.prototype.init_incoming=function(e){var t,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=e,e.reply(200),e.body&&(t=e.body.split("\n"),t.length>=1&&n.test(t[0])&&(this.tone=t[0].replace(n,"$2")),t.length>=2&&r.test(t[1])&&(this.duration=parseInt(t[1].replace(r,"$2"),10))),this.duration||(this.duration=i.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:e}):o("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],13:[function(e,t,n){function r(e,t,n){this.session=e,this.id=t,this.expires=n||i.expires,this.active=!0,this.notify(100)}t.exports=r;var i={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},o=e("debug")("JsSIP:RTCSession:ReferNotifier"),s=e("../Constants"),a=e("./Request");r.prototype.notify=function(e,t){o("notify()");var n,r=this;if(!1!==this.active){t=t||s.REASON_PHRASE[e]||"",n=e>=200?"terminated;reason=noresource":"active;expires="+this.expires;new a(this.session,s.NOTIFY).send({extraHeaders:["Event: "+i.event_type+";id="+r.id,"Subscription-State: "+n,"Content-Type: "+i.body_type],body:"SIP/2.0 "+e+" "+t,eventHandlers:{onErrorResponse:function(){r.active=!1}}})}}},{"../Constants":1,"./Request":15,debug:33}],14:[function(e,t,n){function r(e){this.session=e,this.timer=null,this.outgoingRequest=null,a.EventEmitter.call(this)}function i(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}t.exports=r;var o={expires:120},s=e("util"),a=e("events"),c=e("debug")("JsSIP:RTCSession:ReferSubscriber"),l=e("../Constants"),u=e("../Grammar"),d=e("./Request");s.inherits(r,a.EventEmitter),r.prototype.sendRefer=function(e,t){c("sendRefer()");var n,r,s,a=null,u=this;t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],r=t.eventHandlers||{};for(var f in r)this.on(f,r[f]);t.replaces&&(a=t.replaces.request.call_id,a+=";to-tag="+t.replaces.to_tag,a+=";from-tag="+t.replaces.from_tag,a=encodeURIComponent(a)),s="Refer-To: <"+e+(a?"?Replaces="+a:"")+">",n.push(s);var h=new d(this.session,l.REFER);this.timer=setTimeout(function(){i.call(u)},1e3*o.expires),h.send({extraHeaders:n,eventHandlers:{onSuccessResponse:function(e){u.emit("requestSucceeded",{response:e})},onErrorResponse:function(e){u.emit("requestFailed",{response:e,cause:l.causes.REJECTED})},onTransportError:function(){i.call(u),u.emit("requestFailed",{response:null,cause:l.causes.CONNECTION_ERROR})},onRequestTimeout:function(){i.call(u),u.emit("requestFailed",{response:null,cause:l.causes.REQUEST_TIMEOUT})},onDialogError:function(){i.call(u),u.emit("requestFailed",{response:null,cause:l.causes.DIALOG_ERROR})}}}),this.outgoingRequest=h.outgoingRequest},r.prototype.receiveNotify=function(e){c("receiveNotify()");var t;if(e.body){if(-1===(t=u.parse(e.body,"Status_Line")))return void c('receiveNotify() | error parsing NOTIFY body: "'+e.body+'"');switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):i.call(this),this.emit("accepted",{request:e,status_line:t});break;default:i.call(this),this.emit("failed",{request:e,status_line:t})}}}},{"../Constants":1,"../Grammar":6,"./Request":15,debug:33,events:28,util:32}],15:[function(e,t,n){function r(e,t){if(i("new | %s",t),this.session=e,this.method=t,this.outgoingRequest=null,this.session.status!==c.C.STATUS_1XX_RECEIVED&&this.session.status!==c.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==c.C.STATUS_WAITING_FOR_ACK&&this.session.status!==c.C.STATUS_CONFIRMED&&this.session.status!==c.C.STATUS_TERMINATED)throw new a.InvalidStateError(this.session.status);if(this.session.status===c.C.STATUS_TERMINATED&&t!==s.BYE)throw new a.InvalidStateError(this.session.status)}t.exports=r;var i=e("debug")("JsSIP:RTCSession:Request"),o=e("debug")("JsSIP:ERROR:RTCSession:Request");o.log=console.warn.bind(console);var s=e("../Constants"),a=e("../Exceptions"),c=e("../RTCSession");r.prototype.send=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body||null;this.eventHandlers=e.eventHandlers||{},this.outgoingRequest=this.session.dialog.sendRequest(this,this.method,{extraHeaders:t,body:n})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):i("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(e);break;case/^2[0-9]{2}$/.test(e.status_code):i("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:i("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){o("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){o("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){o("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],16:[function(e,t,n){function r(e,t){this.ua=e,this.transport=t,this.registrar=e.configuration.registrar_server,this.expires=e.configuration.register_expires,this.call_id=o.createRandomToken(22),this.cseq=0,this.to_uri=e.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'}t.exports=r;var i=e("debug")("JsSIP:Registrator"),o=e("./Utils"),s=e("./Constants"),a=e("./SIPMessage"),c=e("./RequestSender");r.prototype={setExtraHeaders:function(e){Array.isArray(e)||(e=[]),this.extraHeaders=e.slice()},setExtraContactParams:function(e){e instanceof Object||(e={}),this.extraContactParams="";for(var t in e){var n=e[t];this.extraContactParams+=";"+t,n&&(this.extraContactParams+="="+n)}},register:function(){var e,t,n,r=this;n=this.extraHeaders.slice(),n.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),n.push("Expires: "+this.expires),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},n),e=new c(this,this.ua),this.receiveResponse=function(e){var n,a,c=e.getHeaders("contact").length;if(e.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(e.hasHeader("expires")&&(a=e.getHeader("expires")),!c){i("no Contact header in response to REGISTER, response ignored");break}for(;c--;){if(n=e.parseHeader("contact",c),n.uri.user===this.ua.contact.uri.user){a=n.getParam("expires");break}n=null}if(!n){i("no Contact header pointing to us, response ignored");break}a||(a=this.expires),this.registrationTimer=setTimeout(function(){r.registrationTimer=null,r.register()},1e3*a-3e3),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:e}));break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(this.expires=e.getHeader("min-expires"),this.register()):(i("423 response received for REGISTER without Min-Expires"),this.registrationFailure(e,s.causes.SIP_FAILURE_CODE));break;default:t=o.sipErrorCause(e.status_code),this.registrationFailure(e,t)}},this.onRequestTimeout=function(){this.registrationFailure(null,s.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,s.causes.CONNECTION_ERROR)},e.send()},unregister:function(e){var t;if(!this.registered)return void i("already unregistered");e=e||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),t=this.extraHeaders.slice(),e.all?(t.push("Contact: *"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t)):(t.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t));var n=new c(this,this.ua);this.receiveResponse=function(e){var t;switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this.unregistered(e);break;default:t=o.sipErrorCause(e.status_code),this.unregistered(e,t)}},this.onRequestTimeout=function(){this.unregistered(null,s.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,s.causes.CONNECTION_ERROR)},n.send()},registrationFailure:function(e,t){this.ua.registrationFailed({response:e||null,cause:t}),this.registered&&(this.registered=!1,this.ua.unregistered({response:e||null,cause:t}))},unregistered:function(e,t){this.registered=!1,this.ua.unregistered({response:e||null,cause:t||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":17,"./SIPMessage":18,"./Utils":25,debug:33}],17:[function(e,t,n){function r(e,t){this.ua=t,this.applicant=e,this.method=e.request.method,this.request=e.request,this.auth=null,this.challenged=!1,this.staled=!1,t.status!==s.C.STATUS_USER_CLOSED||this.method===o.BYE&&this.method===o.ACK||this.onTransportError()}t.exports=r;var i=e("debug")("JsSIP:RequestSender"),o=e("./Constants"),s=e("./UA"),a=e("./DigestAuthentication"),c=e("./Transactions");r.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new c.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new c.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new c.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t,n,r,s=e.status_code;if(401!==s&&407!==s||null===this.ua.configuration.password&&null===this.ua.configuration.ha1)this.applicant.receiveResponse(e);else{if(401===e.status_code?(n=e.parseHeader("www-authenticate"),r="authorization"):(n=e.parseHeader("proxy-authenticate"),r="proxy-authorization"),!n)return i(e.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(e);if(!this.challenged||!this.staled&&!0===n.stale){if(this.auth||(this.auth=new a({username:this.ua.configuration.authorization_user,password:this.ua.configuration.password,realm:this.ua.configuration.realm,ha1:this.ua.configuration.ha1})),!this.auth.authenticate(this.request,n))return void this.applicant.receiveResponse(e);this.challenged=!0,this.ua.set("realm",this.auth.get("realm")),this.ua.set("ha1",this.auth.get("ha1")),n.stale&&(this.staled=!0),t=e.method===o.REGISTER?this.applicant.cseq+=1:this.request.dialog?this.request.dialog.local_seqnum+=1:this.request.cseq+1,this.request=this.applicant.request=this.request.clone(),this.request.cseq=t,this.request.setHeader("cseq",t+" "+this.method),this.request.setHeader(r,this.auth.toString()),this.send()}else this.applicant.receiveResponse(e)}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":21,"./UA":23,debug:33}],18:[function(e,t,n){function r(e,t,n,r,i,o){var s,a,c,f;if(r=r||{},!e||!t||!n)return null;this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=o,this.extraHeaders=i&&i.slice()||[],r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<"+n.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",l.MAX_FORWARDS),s=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"",s+="<"+(r.to_uri||t)+">",s+=r.to_tag?";tag="+r.to_tag:"",this.to=new d.parse(s),this.setHeader("to",s),a=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':n.configuration.display_name?'"'+n.configuration.display_name+'" ':"",a+="<"+(r.from_uri||n.configuration.uri)+">;tag=",a+=r.from_tag||u.newTag(),this.from=new d.parse(a),this.setHeader("from",a),c=r.call_id||n.configuration.jssip_id+u.createRandomToken(15),this.call_id=c,this.setHeader("call-id",c),f=r.cseq||Math.floor(1e4*Math.random()),this.cseq=f,this.setHeader("cseq",f+" "+e)}function i(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function o(e){this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function s(){this.headers={},this.status_code=null,this.reason_phrase=null}t.exports={OutgoingRequest:r,IncomingRequest:o,IncomingResponse:s};var a=e("debug")("JsSIP:SIPMessage"),c=e("sdp-transform"),l=e("./Constants"),u=e("./Utils"),d=e("./NameAddrHeader"),f=e("./Grammar");r.prototype={setHeader:function(e,t){var n,r;for(n=new RegExp("^\\s*"+e+"\\s*:","i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[u.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){var t,n,r=this.extraHeaders.length,i=this.headers[u.headerize(e)];if(i){if(i[0])return i[0]}else for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(i=this.extraHeaders[n],t.test(i))return i.substring(i.indexOf(":")+1).trim()},getHeaders:function(e){var t,n,r,i=this.headers[u.headerize(e)],o=[];if(i){for(n=i.length,t=0;t<n;t++)o.push(i[t]);return o}for(n=this.extraHeaders.length,r=new RegExp("^\\s*"+e+"\\s*:","i"),t=0;t<n;t++)i=this.extraHeaders[t],r.test(i)&&o.push(i.substring(i.indexOf(":")+1).trim());return o},hasHeader:function(e){var t,n,r=this.extraHeaders.length;if(this.headers[u.headerize(e)])return!0;for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(t.test(this.extraHeaders[n]))return!0;return!1},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=c.parse(this.body||""),this.sdp)},toString:function(){var e,t,n,r="",i=[];r+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(e in this.headers)for(t=this.headers[e].length,n=0;n<t;n++)r+=e+": "+this.headers[e][n]+"\r\n";for(t=this.extraHeaders.length,n=0;n<t;n++)r+=this.extraHeaders[n].trim()+"\r\n";switch(this.method){case l.REGISTER:i.push("path","gruu");break;case l.INVITE:this.ua.configuration.session_timers&&i.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&i.push("gruu"),i.push("ice","replaces");break;case l.UPDATE:this.ua.configuration.session_timers&&i.push("timer"),i.push("ice")}return i.push("outbound"),r+="Allow: "+l.ALLOWED_METHODS+"\r\n",r+="Supported: "+i+"\r\n",r+="User-Agent: "+l.USER_AGENT+"\r\n",this.body?(t=u.str_utf8_length(this.body),r+="Content-Length: "+t+"\r\n\r\n",r+=this.body):r+="Content-Length: 0\r\n\r\n",r},clone:function(){var e=new r(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(t){e.headers[t]=this.headers[t].slice()},this),e.body=this.body,e.extraHeaders=this.extraHeaders&&this.extraHeaders.slice()||[],e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e}},i.prototype={addHeader:function(e,t){var n={raw:t};e=u.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]},getHeader:function(e){var t=this.headers[u.headerize(e)];if(t)return t[0]?t[0].raw:void 0},getHeaders:function(e){var t,n,r=this.headers[u.headerize(e)],i=[];if(!r)return[];for(n=r.length,t=0;t<n;t++)i.push(r[t].raw);return i},hasHeader:function(e){return!!this.headers[u.headerize(e)]},parseHeader:function(e,t){var n,r,i;return e=u.headerize(e),t=t||0,this.headers[e]?t>=this.headers[e].length?void a('not so many "'+e+'" headers present'):(n=this.headers[e][t],r=n.raw,n.parsed?n.parsed:(i=f.parse(r,e.replace(/-/g,"_")),-1===i?(this.headers[e].splice(t,1),void a('error parsing "'+e+'" header field with value "'+r+'"')):(n.parsed=i,i))):void a('header "'+e+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(e,t){var n={raw:t};this.headers[u.headerize(e)]=[n]},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=c.parse(this.body||""),this.sdp)},toString:function(){return this.data}},o.prototype=new i,o.prototype.reply=function(e,t,n,r,i,o){var s,a,c,d,f,h=[],p=this.getHeader("To"),m=0,g=0;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);if(t=t||l.REASON_PHRASE[e]||"",n=n&&n.slice()||[],f="SIP/2.0 "+e+" "+t+"\r\n",this.method===l.INVITE&&e>100&&e<=200)for(s=this.getHeaders("record-route"),c=s.length,m;m<c;m++)f+="Record-Route: "+s[m]+"\r\n";for(a=this.getHeaders("via"),c=a.length,g;g<c;g++)f+="Via: "+a[g]+"\r\n";for(!this.to_tag&&e>100?p+=";tag="+u.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),f+="To: "+p+"\r\n",f+="From: "+this.getHeader("From")+"\r\n",f+="Call-ID: "+this.call_id+"\r\n",f+="CSeq: "+this.cseq+" "+this.method+"\r\n",c=n.length,d=0;d<c;d++)f+=n[d].trim()+"\r\n";switch(this.method){case l.INVITE:this.ua.configuration.session_timers&&h.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&h.push("gruu"),h.push("ice","replaces");break;case l.UPDATE:this.ua.configuration.session_timers&&h.push("timer"),r&&h.push("ice"),h.push("replaces")}h.push("outbound"),this.method===l.OPTIONS?(f+="Allow: "+l.ALLOWED_METHODS+"\r\n",f+="Accept: "+l.ACCEPTED_BODY_TYPES+"\r\n"):405===e?f+="Allow: "+l.ALLOWED_METHODS+"\r\n":415===e&&(f+="Accept: "+l.ACCEPTED_BODY_TYPES+"\r\n"),f+="Supported: "+h+"\r\n",r?(c=u.str_utf8_length(r),f+="Content-Type: application/sdp\r\n",f+="Content-Length: "+c+"\r\n\r\n",f+=r):f+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(e,f,i,o)},o.prototype.reply_sl=function(e,t){var n,r,i=0,o=this.getHeaders("via"),s=o.length;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);for(t=t||l.REASON_PHRASE[e]||"",r="SIP/2.0 "+e+" "+t+"\r\n",i;i<s;i++)r+="Via: "+o[i]+"\r\n";n=this.getHeader("To"),!this.to_tag&&e>100?n+=";tag="+u.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(n+=";tag="+this.to_tag),r+="To: "+n+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},s.prototype=new i},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":25,debug:33,"sdp-transform":37}],19:[function(e,t,n){function r(){}t.exports=r;var i=e("./Utils"),o=e("./Grammar"),s=e("debug")("JsSIP:ERROR:Socket");s.log=console.warn.bind(console),r.isSocket=function(e){if(Array.isArray(e))return!1;if(void 0===e)return s("undefined JsSIP.Socket instance"),!1;try{if(!i.isString(e.url))throw s("missing or invalid JsSIP.Socket url property"),new Error;if(!i.isString(e.via_transport))throw s("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===o.parse(e.sip_uri,"SIP_URI"))throw s("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(e){return!1}try{["connect","disconnect","send"].forEach(function(t){if(!i.isFunction(e[t]))throw s("missing or invalid JsSIP.Socket method: "+t),new Error})}catch(e){return!1}return!0}},{"./Grammar":6,"./Utils":25,debug:33}],20:[function(e,t,n){var r=500,i={T1:r,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};t.exports=i},{}],21:[function(e,t,n){function r(e,t,n){var r;this.type=l.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),d.EventEmitter.call(this)}function i(e,t,n){var r,i=this;this.type=l.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e){i.cancel_request(i,e)},d.EventEmitter.call(this)}function o(e,t,n){var r;this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),d.EventEmitter.call(this)}function s(e,t){this.type=l.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=l.STATUS_TRYING,t.newTransaction(this),d.EventEmitter.call(this)}function a(e,t){this.type=l.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=l.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100),d.EventEmitter.call(this)}function c(e,t){var n;switch(t.method){case v.INVITE:if(n=e.transactions.ist[t.via_branch]){switch(n.state){case l.STATUS_PROCEEDING:n.transport.send(n.last_response);break;case l.STATUS_ACCEPTED:}return!0}break;case v.ACK:if(!(n=e.transactions.ist[t.via_branch]))return!1;if(n.state===l.STATUS_ACCEPTED)return!1;if(n.state===l.STATUS_COMPLETED)return n.state=l.STATUS_CONFIRMED,n.I=setTimeout(function(){n.timer_I()},y.TIMER_I),!0;break;case v.CANCEL:return n=e.transactions.ist[t.via_branch],n?(t.reply_sl(200),n.state!==l.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=e.transactions.nist[t.via_branch]){switch(n.state){case l.STATUS_TRYING:break;case l.STATUS_PROCEEDING:case l.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}t.exports={C:null,NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:o,NonInviteServerTransaction:s,InviteServerTransaction:a,checkTransaction:c};var l={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};t.exports.C=l;var u=e("util"),d=e("events"),f=e("debug")("JsSIP:NonInviteClientTransaction"),h=e("debug")("JsSIP:InviteClientTransaction"),p=e("debug")("JsSIP:AckClientTransaction"),m=e("debug")("JsSIP:NonInviteServerTransaction"),g=e("debug")("JsSIP:InviteServerTransaction"),v=e("./Constants"),y=e("./Timers");u.inherits(r,d.EventEmitter),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var e=this;this.stateChanged(l.STATUS_TRYING),this.F=setTimeout(function(){e.timer_F()},y.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){f("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){f("Timer F expired for transaction "+this.id),this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n<200)switch(this.state){case l.STATUS_TRYING:case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_PROCEEDING),this.request_sender.receiveResponse(e)}else switch(this.state){case l.STATUS_TRYING:case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(e),this.K=setTimeout(function(){t.timer_K()},y.TIMER_K);break;case l.STATUS_COMPLETED:}},u.inherits(i,d.EventEmitter),i.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){var e=this;this.stateChanged(l.STATUS_CALLING),this.B=setTimeout(function(){e.timer_B()},y.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==l.STATUS_ACCEPTED&&(h("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.timer_M=function(){h("Timer M expired for transaction "+this.id),this.state===l.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){h("Timer B expired for transaction "+this.id),this.state===l.STATUS_CALLING&&(this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){h("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(l.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(e){var t=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+e.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){t.timer_D()},y.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(e,t){var n=e.request;this.cancel=v.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",t&&(this.cancel+="Reason: "+t+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===l.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n>=100&&n<=199)switch(this.state){case l.STATUS_CALLING:this.stateChanged(l.STATUS_PROCEEDING),this.request_sender.receiveResponse(e);break;case l.STATUS_PROCEEDING:this.request_sender.receiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case l.STATUS_CALLING:case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_ACCEPTED),this.M=setTimeout(function(){t.timer_M()},y.TIMER_M),this.request_sender.receiveResponse(e);break;case l.STATUS_ACCEPTED:this.request_sender.receiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case l.STATUS_CALLING:case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_COMPLETED),this.sendACK(e),this.request_sender.receiveResponse(e);break;case l.STATUS_COMPLETED:this.sendACK(e)}},u.inherits(o,d.EventEmitter),o.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},o.prototype.onTransportError=function(){p("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},u.inherits(s,d.EventEmitter),s.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.timer_J=function(){m("Timer J expired for transaction "+this.id),this.stateChanged(l.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,m("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(l.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.receiveResponse=function(e,t,n,r){var i=this;if(100===e)switch(this.state){case l.STATUS_TRYING:this.stateChanged(l.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case l.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=200&&e<=699)switch(this.state){case l.STATUS_TRYING:case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout(function(){i.timer_J()},y.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r());break;case l.STATUS_COMPLETED:}},u.inherits(a,d.EventEmitter),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){g("Timer H expired for transaction "+this.id),this.state===l.STATUS_COMPLETED&&g("ACK not received, dialog will be terminated"),this.stateChanged(l.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(l.STATUS_TERMINATED)},a.prototype.timer_L=function(){g("Timer L expired for transaction "+this.id),this.state===l.STATUS_ACCEPTED&&(this.stateChanged(l.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,g("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(l.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(e,t,n,r){var i=this;if(e>=100&&e<=199)switch(this.state){case l.STATUS_PROCEEDING:this.transport.send(t)||this.onTransportError(),this.last_response=t}if(e>100&&e<=199&&this.state===l.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){i.resend_provisional()},y.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case l.STATUS_PROCEEDING:this.stateChanged(l.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout(function(){i.timer_L()},y.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case l.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=300&&e<=699)switch(this.state){case l.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(l.STATUS_COMPLETED),this.H=setTimeout(function(){i.timer_H()},y.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}}},{"./Constants":1,"./Timers":20,debug:33,events:28,util:32}],22:[function(e,t,n){function r(e,t){if(u("new()"),this.status=f.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=t||f.recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,void 0===e)throw new TypeError("Invalid argument. undefined 'sockets' argument");e instanceof Array||(e=[e]),e.forEach(function(e){if(!l.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:f.SOCKET_STATUS_READY})},this),Object.defineProperties(this,{via_transport:{get:function(){return this.socket.via_transport}},url:{get:function(){return this.socket.url}},sip_uri:{get:function(){return this.socket.sip_uri}}}),c.call(this)}function i(){this.recover_attempts=0,this.status=f.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}function o(e,t,n){this.status=f.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),this.close_requested||(e&&(this.socket.status=f.SOCKET_STATUS_ERROR),a.call(this,e))}function s(e){if("\r\n"===e)return void u("received message with CRLF Keep Alive response");if("string"!=typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void u("received binary message failed to be converted into string, message discarded")}u("received binary message:\n\n"+e+"\n")}else u("received text message:\n\n"+e+"\n");this.ondata({transport:this,message:e})}function a(){var e,t=this;this.recover_attempts+=1,e=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1),e<this.recovery_options.min_interval?e=this.recovery_options.min_interval:e>this.recovery_options.max_interval&&(e=this.recovery_options.max_interval),u("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+e+" seconds"),this.recovery_timer=setTimeout(function(){t.close_requested||t.isConnected()||t.isConnecting()||(c.call(t),t.connect())},1e3*e)}function c(){var e=[];if(this.sockets.forEach(function(t){t.status!==f.SOCKET_STATUS_ERROR&&(0===e.length?e.push(t):t.weight>e[0].weight?e=[t]:t.weight===e[0].weight&&e.push(t))}),0===e.length)return this.sockets.forEach(function(e){e.status=f.SOCKET_STATUS_READY}),void c.call(this);var t=Math.floor(Math.random()*e.length);this.socket=e[t].socket}t.exports=r;var l=e("./Socket"),u=e("debug")("JsSIP:Transport"),d=e("debug")("JsSIP:ERROR:Transport"),f={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};r.prototype.connect=function(){return u("connect()"),this.isConnected()?void u("Transport is already connected"):this.isConnecting()?void u("Transport is connecting"):(this.close_requested=!1,this.status=f.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),void(this.close_requested||(this.socket.onconnect=i.bind(this),this.socket.ondisconnect=o.bind(this),this.socket.ondata=s.bind(this),this.socket.connect())))},r.prototype.disconnect=function(){u("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=f.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect()},r.prototype.send=function(e){if(u("send()"),!this.isConnected())return d("unable to send message, transport is not connected"),!1;var t=e.toString();return u("sending message:\n\n"+t+"\n"),this.socket.send(t)},r.prototype.isConnected=function(){return this.status===f.STATUS_CONNECTED},r.prototype.isConnecting=function(){return this.status===f.STATUS_CONNECTING}},{"./Socket":19,debug:33}],23:[function(e,t,n){function r(e){if(d("new() [configuration:%o]",e),this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=c.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===e)throw new TypeError("Not enough arguments");try{this.loadConfig(e)}catch(e){throw this.status=c.STATUS_NOT_READY,this.error=c.CONFIGURATION_ERROR,e}this._registrator=new m(this),u.EventEmitter.call(this),h.called||h()}function i(e){this.emit("connecting",e)}function o(e){this.status!==c.STATUS_USER_CLOSED&&(this.status=c.STATUS_READY,this.error=null,this.emit("connected",e),this.dynConfiguration.register&&this._registrator.register())}function s(e){var t,n,r,i=["nict","ict","nist","ist"];for(r=i.length,t=0;t<r;t++)for(n in this.transactions[i[t]])this.transactions[i[t]][n].onTransportError();this.emit("disconnected",e),this._registrator.onTransportClosed(),this.status!==c.STATUS_USER_CLOSED&&(this.status=c.STATUS_NOT_READY,this.error=c.NETWORK_ERROR)}function a(e){var t,n=e.transport,i=e.message;if((i=w.parseMessage(i,this))&&!(this.status===r.C.STATUS_USER_CLOSED&&i instanceof R.IncomingRequest)&&k(i,this,n))if(i instanceof R.IncomingRequest)i.transport=n,this.receiveRequest(i);else if(i instanceof R.IncomingResponse)switch(i.method){case p.INVITE:t=this.transactions.ict[i.via_branch],t&&t.receiveResponse(i);break;case p.ACK:break;default:t=this.transactions.nict[i.via_branch],t&&t.receiveResponse(i)}}t.exports=r;var c={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};r.C=c;var l=e("util"),u=e("events"),d=e("debug")("JsSIP:UA"),f=e("debug")("JsSIP:ERROR:UA");f.log=console.warn.bind(console);var h=e("rtcninja"),p=e("./Constants"),m=e("./Registrator"),g=e("./RTCSession"),v=e("./Message"),y=e("./Transactions"),C=e("./Transport"),b=e("./WebSocketInterface"),S=e("./Socket"),T=e("./Utils"),A=e("./Exceptions"),E=e("./URI"),_=e("./Grammar"),w=e("./Parser"),R=e("./SIPMessage"),k=e("./sanityCheck");l.inherits(r,u.EventEmitter),r.prototype.start=function(){function e(){d("restarting UA"),t.status=c.STATUS_READY,t.transport.connect()}d("start()");var t=this;this.status===c.STATUS_INIT?this.transport.connect():this.status===c.STATUS_USER_CLOSED?this.isConnected()?this.once("disconnected",e):e():d(this.status===c.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},r.prototype.register=function(){d("register()"),this.dynConfiguration.register=!0,this._registrator.register()},r.prototype.unregister=function(e){d("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(e)},r.prototype.registrator=function(){return this._registrator},r.prototype.isRegistered=function(){return!!this._registrator.registered},r.prototype.isConnected=function(){return this.transport.isConnected()},r.prototype.call=function(e,t){d("call()");var n;return n=new g(this),n.connect(e,t),n},r.prototype.sendMessage=function(e,t,n){d("sendMessage()");var r;return r=new v(this),r.send(e,t,n),r},r.prototype.terminateSessions=function(e){d("terminateSessions()");for(var t in this.sessions)this.sessions[t].isEnded()||this.sessions[t].terminate(e)},r.prototype.stop=function(){d("stop()");var e,t,n,r=this;if(this.dynConfiguration={},this.status===c.STATUS_USER_CLOSED)return void d("UA already closed");this._registrator.close(),n=Object.keys(this.sessions).length;for(e in this.sessions){d("closing session "+e);try{this.sessions[e].terminate()}catch(e){}}for(t in this.applicants)try{this.applicants[t].close()}catch(e){}this.status=c.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===this.ictTransactionsCount&&0===this.istTransactionsCount&&0===n?r.transport.disconnect():setTimeout(function(){r.transport.disconnect()},2e3)},r.prototype.normalizeTarget=function(e){return T.normalizeTarget(e,this.configuration.hostport_params)},r.prototype.get=function(e){switch(e){case"realm":return this.configuration.realm;case"ha1":return this.configuration.ha1;default:return void f('get() | cannot get "%s" parameter in runtime',e)}return!0},r.prototype.set=function(e,t){switch(e){case"password":this.configuration.password=String(t);break;case"realm":this.configuration.realm=String(t);break;case"ha1":this.configuration.ha1=String(t),this.configuration.password=null;break;case"display_name":if(-1===_.parse('"'+t+'"',"display_name"))return f('set() | wrong "display_name"'),!1;this.configuration.display_name=t;break;default:return f('set() | cannot set "%s" parameter in runtime',e),!1}return!0},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.newMessage=function(e){this.emit("newMessage",e)},r.prototype.newRTCSession=function(e){this.emit("newRTCSession",e)},r.prototype.registered=function(e){this.emit("registered",e)},r.prototype.unregistered=function(e){this.emit("unregistered",e)},r.prototype.registrationFailed=function(e){this.emit("registrationFailed",e)},r.prototype.receiveRequest=function(e){var t,n,r,i,o=e.method;if(e.ruri.user!==this.configuration.uri.user&&e.ruri.user!==this.contact.uri.user)return d("Request-URI does not point to us"),void(e.method!==p.ACK&&e.reply_sl(404));if(e.ruri.scheme===p.SIPS)return void e.reply_sl(416);if(!y.checkTransaction(this,e)){if(o===p.INVITE?new y.InviteServerTransaction(e,this):o!==p.ACK&&o!==p.CANCEL&&new y.NonInviteServerTransaction(e,this),o===p.OPTIONS)e.reply(200);else if(o===p.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);r=new v(this),r.init_incoming(e)}else if(o===p.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);if(e.to_tag)t=this.findDialog(e.call_id,e.from_tag,e.to_tag),t?t.receiveRequest(e):o===p.NOTIFY?(n=this.findSession(e),n?n.receiveRequest(e):(d("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist"))):o!==p.ACK&&e.reply(481);else switch(o){case p.INVITE:h.hasWebRTC()?e.hasHeader("replaces")?(i=e.replaces,t=this.findDialog(i.call_id,i.from_tag,i.to_tag),t?(n=t.owner,n.isEnded()?e.reply(603):n.receiveRequest(e)):e.reply(481)):(n=new g(this),n.init_incoming(e)):(d("INVITE received but WebRTC is not supported"),e.reply(488));break;case p.BYE:e.reply(481);break;case p.CANCEL:n=this.findSession(e),n?n.receiveRequest(e):d("received CANCEL request for a non existent session");break;case p.ACK:break;default:e.reply(405)}}},r.prototype.findSession=function(e){var t=e.call_id+e.from_tag,n=this.sessions[t],r=e.call_id+e.to_tag,i=this.sessions[r];return n||(i||null)},r.prototype.findDialog=function(e,t,n){var r=e+t+n,i=this.dialogs[r];return i||(r=e+n+t,(i=this.dialogs[r])||null)},r.prototype.loadConfig=function(e){var t,n,c,l,u,h={via_host:T.createRandomToken(12)+".invalid",contact_uri:null,password:null,realm:null,ha1:null,register_expires:600,register:!0,registrar_server:null,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0};for(t in r.configuration_check.mandatory){if(!e.hasOwnProperty(t))throw new A.ConfigurationError(t);if(n=e[t],void 0===(c=r.configuration_check.mandatory[t].call(this,n)))throw new A.ConfigurationError(t,n);h[t]=c}for(t in r.configuration_check.optional)if(e.hasOwnProperty(t)){if(n=e[t],T.isEmpty(n))continue;if(void 0===(c=r.configuration_check.optional[t].call(this,n,e)))throw new A.ConfigurationError(t,n);h[t]=c}0===h.display_name&&(h.display_name="0"),h.instance_id||(h.instance_id=T.newUUID()),h.jssip_id=T.createRandomToken(5),l=h.uri.clone(),l.user=null,h.hostport_params=l.toString().replace(/^sip:/i,"");var p=[];if(h.ws_servers&&Array.isArray(h.ws_servers)&&(p=p.concat(h.ws_servers)),h.sockets&&Array.isArray(h.sockets)&&(p=p.concat(h.sockets)),0===p.length)throw new A.ConfigurationError("sockets");try{this.transport=new C(p,{max_interval:h.connection_recovery_max_interval,min_interval:h.connection_recovery_min_interval}),this.transport.onconnecting=i.bind(this),this.transport.onconnect=o.bind(this),this.transport.ondisconnect=s.bind(this),this.transport.ondata=a.bind(this),delete h.connection_recovery_max_interval,delete h.connection_recovery_min_interval,delete h.ws_servers,delete h.sockets}catch(e){throw f(e),new A.ConfigurationError("sockets",p)}h.authorization_user||(h.authorization_user=h.uri.user),h.registrar_server||(u=h.uri.clone(),u.user=null,u.clearParams(),u.clearHeaders(),h.registrar_server=u),h.no_answer_timeout=1e3*h.no_answer_timeout,h.contact_uri?h.via_host=h.contact_uri.host:h.contact_uri=new E("sip",T.createRandomToken(8),h.via_host,null,{transport:"ws"}),this.contact={pub_gruu:null,temp_gruu:null,uri:h.contact_uri,toString:function(e){e=e||{};var t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};for(t in h)r.configuration_skeleton[t].value=h[t];Object.defineProperties(this.configuration,r.configuration_skeleton);for(t in h)r.configuration_skeleton[t].value="";d("configuration parameters after validation:");for(t in h)switch(t){case"uri":case"registrar_server":d("- "+t+": "+h[t]);break;case"password":case"ha1":d("- "+t+": NOT SHOWN");break;default:d("- "+t+": "+JSON.stringify(h[t]))}},r.configuration_skeleton=function(){var e,t,n,r={},i=["jssip_id","hostport_params","uri","authorization_user","contact_uri","display_name","instance_id","no_answer_timeout","session_timers","password","realm","ha1","register_expires","registrar_server","sockets","use_preloaded_route","ws_servers","via_core_value","via_host"],o=["password","realm","ha1","display_name"];for(e in i)t=i[e],n=-1!==o.indexOf(t),r[t]={value:"",writable:n,configurable:!1};return r.register={value:"",writable:!0,configurable:!1},r}(),r.configuration_check={mandatory:{uri:function(e){var t;return/^sip:/i.test(e)||(e=p.SIP+":"+e),t=E.parse(e),t&&t.user?t:void 0}},optional:{authorization_user:function(e){return-1===_.parse('"'+e+'"',"quoted_string")?void 0:e},connection_recovery_max_interval:function(e){var t;if(T.isDecimal(e)&&(t=Number(e))>0)return t},connection_recovery_min_interval:function(e){var t;if(T.isDecimal(e)&&(t=Number(e))>0)return t},contact_uri:function(e){if("string"==typeof e){var t=_.parse(e,"SIP_URI");if(-1!==t)return t}},display_name:function(e){return-1===_.parse('"'+e+'"',"display_name")?void 0:e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===_.parse(e,"uuid")?void 0:e},no_answer_timeout:function(e){var t;if(T.isDecimal(e)&&(t=Number(e))>0)return t},session_timers:function(e){if("boolean"==typeof e)return e},password:function(e){return String(e)},realm:function(e){return String(e)},ha1:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){var t;if(T.isDecimal(e)&&(t=Number(e))>0)return t},registrar_server:function(e){var t;return/^sip:/i.test(e)||(e=p.SIP+":"+e),t=E.parse(e),t?t.user?void 0:t:void 0},sockets:function(e){var t,n;if(S.isSocket(e))e=[{socket:e}];else{if(!Array.isArray(e)||!e.length)return;for(n=e.length,t=0;t<n;t++)S.isSocket(e[t])&&(e[t]={socket:e[t]})}return e},use_preloaded_route:function(e){if("boolean"==typeof e)return e},ws_servers:function(e){var t,n,r=[];if("string"==typeof e)e=[{ws_uri:e}];else{if(!Array.isArray(e)||!e.length)return;for(n=e.length,t=0;t<n;t++)"string"==typeof e[t]&&(e[t]={ws_uri:e[t]})}for(n=e.length,t=0;t<n;t++)try{r.push({socket:new b(e[t].ws_uri),weight:e[t].weight||0})}catch(e){return void f(e)}return r}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./Parser":10,"./RTCSession":11,"./Registrator":16,"./SIPMessage":18,"./Socket":19,"./Transactions":21,"./Transport":22,"./URI":24,"./Utils":25,"./WebSocketInterface":26,"./sanityCheck":27,debug:33,events:28,rtcninja:43,util:32}],24:[function(e,t,n){function r(e,t,n,r,o,s){var a,c;if(!n)throw new TypeError('missing or invalid "host" parameter');e=e||i.SIP,this.parameters={},this.headers={};for(a in o)this.setParam(a,o[a]);for(c in s)this.setHeader(c,s[c]);Object.defineProperties(this,{scheme:{get:function(){return e},set:function(t){e=t.toLowerCase()}},user:{get:function(){return t},set:function(e){t=e}},host:{get:function(){return n},set:function(e){n=e.toLowerCase()}},port:{get:function(){return r},set:function(e){r=0===e?e:parseInt(e,10)||null}}})}t.exports=r;var i=e("./Constants"),o=e("./Utils"),s=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(e,t){this.headers[o.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){if(e)return this.headers[o.headerize(e)]},hasHeader:function(e){if(e)return this.headers.hasOwnProperty(o.headerize(e))&&!0||!1},deleteHeader:function(e){var t;if(e=o.headerize(e),this.headers.hasOwnProperty(e))return t=this.headers[e],delete this.headers[e],t},clearHeaders:function(){this.headers={}},clone:function(){return new r(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var e,t,n,r,i=[];r=this.scheme+":",this.user&&(r+=o.escapeUser(this.user)+"@"),r+=this.host,(this.port||0===this.port)&&(r+=":"+this.port);for(t in this.parameters)r+=";"+t,null!==this.parameters[t]&&(r+="="+this.parameters[t]);for(e in this.headers)for(n=0;n<this.headers[e].length;n++)i.push(e+"="+this.headers[e][n]);return i.length>0&&(r+="?"+i.join("&")),r},toAor:function(e){var t;return t=this.scheme+":",this.user&&(t+=o.escapeUser(this.user)+"@"),t+=this.host,e&&(this.port||0===this.port)&&(t+=":"+this.port),t}},r.parse=function(e){return e=s.parse(e,"SIP_URI"),-1!==e?e:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":25}],25:[function(e,t,n){var r={};t.exports=r;var i=e("./Constants"),o=e("./URI"),s=e("./Grammar");r.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length},r.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},r.isString=function(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)},r.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},r.isEmpty=function(e){if(null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e))return!0},r.hasMethods=function(e){for(var t,n=1;t=arguments[n++];)if(this.isFunction(e[t]))return!1;return!0},r.createRandomToken=function(e,t){var n,r,i="";for(t=t||32,n=0;n<e;n++)r=Math.random()*t|0,i+=r.toString(t);return i},r.newTag=function(){return r.createRandomToken(10)},r.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},r.hostType=function(e){if(e)return-1!==(e=s.parse(e,"host"))?e.host_type:void 0},r.normalizeTarget=function(e,t){var n,s,a,c;if(e){if(e instanceof o)return e;if("string"==typeof e){switch(s=e.split("@"),s.length){case 1:if(!t)return;a=e,c=t;break;case 2:a=s[0],c=s[1];break;default:a=s.slice(0,s.length-1).join("@"),c=s[s.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),e=i.SIP+":"+r.escapeUser(a)+"@"+c,(n=o.parse(e))?n:void 0}}else;},r.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},r.headerize=function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",o=r.length;for(t=0;t<o;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},r.sipErrorCause=function(e){var t;for(t in i.SIP_ERROR_CAUSES)if(-1!==i.SIP_ERROR_CAUSES[t].indexOf(e))return i.causes[t];return i.causes.SIP_FAILURE_CODE},r.getRandomTestNetIP=function(){return"192.0.2."+function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(1,254)},r.calculateMD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,o,s;return i=2147483648&e,o=2147483648&t,n=1073741824&e,r=1073741824&t,s=(1073741823&e)+(1073741823&t),n&r?2147483648^s^i^o:n|r?1073741824&s?3221225472^s^i^o:1073741824^s^i^o:s^i^o}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function o(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function a(e,i,o,s,a,c,l){return e=n(e,n(n(r(i,o,s),a),l)),n(t(e,c),i)}function c(e,r,o,s,a,c,l){return e=n(e,n(n(i(r,o,s),a),l)),n(t(e,c),r)}function l(e,r,i,s,a,c,l){return e=n(e,n(n(o(r,i,s),a),l)),n(t(e,c),r)}function u(e,r,i,o,a,c,l){return e=n(e,n(n(s(r,i,o),a),l)),n(t(e,c),r)}function d(e){var t,n,r="",i="";for(n=0;n<=3;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r}var f,h,p,m,g,v,y,C,b,S=[];for(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e),S=function(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,o=16*(i+1),s=new Array(o-1),a=0,c=0;c<n;)t=(c-c%4)/4,a=c%4*8,s[t]=s[t]|e.charCodeAt(c)<<a,c++;return t=(c-c%4)/4,a=c%4*8,s[t]=s[t]|128<<a,s[o-2]=n<<3,s[o-1]=n>>>29,s}(e),v=1732584193,y=4023233417,C=2562383102,b=271733878,f=0;f<S.length;f+=16)h=v,p=y,m=C,g=b,v=a(v,y,C,b,S[f+0],7,3614090360),b=a(b,v,y,C,S[f+1],12,3905402710),C=a(C,b,v,y,S[f+2],17,606105819),y=a(y,C,b,v,S[f+3],22,3250441966),v=a(v,y,C,b,S[f+4],7,4118548399),b=a(b,v,y,C,S[f+5],12,1200080426),C=a(C,b,v,y,S[f+6],17,2821735955),y=a(y,C,b,v,S[f+7],22,4249261313),v=a(v,y,C,b,S[f+8],7,1770035416),b=a(b,v,y,C,S[f+9],12,2336552879),C=a(C,b,v,y,S[f+10],17,4294925233),y=a(y,C,b,v,S[f+11],22,2304563134),v=a(v,y,C,b,S[f+12],7,1804603682),b=a(b,v,y,C,S[f+13],12,4254626195),C=a(C,b,v,y,S[f+14],17,2792965006),y=a(y,C,b,v,S[f+15],22,1236535329),v=c(v,y,C,b,S[f+1],5,4129170786),b=c(b,v,y,C,S[f+6],9,3225465664),C=c(C,b,v,y,S[f+11],14,643717713),y=c(y,C,b,v,S[f+0],20,3921069994),v=c(v,y,C,b,S[f+5],5,3593408605),b=c(b,v,y,C,S[f+10],9,38016083),C=c(C,b,v,y,S[f+15],14,3634488961),y=c(y,C,b,v,S[f+4],20,3889429448),v=c(v,y,C,b,S[f+9],5,568446438),b=c(b,v,y,C,S[f+14],9,3275163606),C=c(C,b,v,y,S[f+3],14,4107603335),y=c(y,C,b,v,S[f+8],20,1163531501),v=c(v,y,C,b,S[f+13],5,2850285829),b=c(b,v,y,C,S[f+2],9,4243563512),C=c(C,b,v,y,S[f+7],14,1735328473),y=c(y,C,b,v,S[f+12],20,2368359562),v=l(v,y,C,b,S[f+5],4,4294588738),b=l(b,v,y,C,S[f+8],11,2272392833),C=l(C,b,v,y,S[f+11],16,1839030562),y=l(y,C,b,v,S[f+14],23,4259657740),v=l(v,y,C,b,S[f+1],4,2763975236),b=l(b,v,y,C,S[f+4],11,1272893353),C=l(C,b,v,y,S[f+7],16,4139469664),y=l(y,C,b,v,S[f+10],23,3200236656),v=l(v,y,C,b,S[f+13],4,681279174),b=l(b,v,y,C,S[f+0],11,3936430074),C=l(C,b,v,y,S[f+3],16,3572445317),y=l(y,C,b,v,S[f+6],23,76029189),v=l(v,y,C,b,S[f+9],4,3654602809),b=l(b,v,y,C,S[f+12],11,3873151461),C=l(C,b,v,y,S[f+15],16,530742520),y=l(y,C,b,v,S[f+2],23,3299628645),v=u(v,y,C,b,S[f+0],6,4096336452),b=u(b,v,y,C,S[f+7],10,1126891415),C=u(C,b,v,y,S[f+14],15,2878612391),y=u(y,C,b,v,S[f+5],21,4237533241),v=u(v,y,C,b,S[f+12],6,1700485571),b=u(b,v,y,C,S[f+3],10,2399980690),C=u(C,b,v,y,S[f+10],15,4293915773),y=u(y,C,b,v,S[f+1],21,2240044497),v=u(v,y,C,b,S[f+8],6,1873313359),b=u(b,v,y,C,S[f+15],10,4264355552),C=u(C,b,v,y,S[f+6],15,2734768916),y=u(y,C,b,v,S[f+13],21,1309151649),v=u(v,y,C,b,S[f+4],6,4149444226),b=u(b,v,y,C,S[f+11],10,3174756917),C=u(C,b,v,y,S[f+2],15,718787259),y=u(y,C,b,v,S[f+9],21,3951481745),v=n(v,h),y=n(y,p),C=n(C,m),b=n(b,g);return(d(v)+d(y)+d(C)+d(b)).toLowerCase()}},{"./Constants":1,"./Grammar":6,"./URI":24}],26:[function(e,t,n){function r(e){l('new() [url:"%s"]',e);var t=null,n=null;this.ws=null,Object.defineProperties(this,{via_transport:{get:function(){return"WS"},set:function(e){n=e.toUpperCase()}},sip_uri:{get:function(){return t}},url:{get:function(){return e}}});var r=c.parse(e,"absoluteURI");if(-1===r)throw u("invalid WebSocket URI: "+e),new TypeError("Invalid argument: "+e);if("wss"!==r.scheme&&"ws"!==r.scheme)throw u("invalid WebSocket URI scheme: "+r.scheme),new TypeError("Invalid argument: "+e);t="sip:"+r.host+(r.port?":"+r.port:"")+";transport=ws",this.via_transport=r.scheme}function i(){l("WebSocket "+this.url+" connected"),this.onconnect()}function o(e){l("WebSocket "+this.url+" closed"),!1===e.wasClean&&l("WebSocket abrupt disconnection"),this.ondisconnect(e.wasClean,e.code,e.reason)}function s(e){l("received WebSocket message"),this.ondata(e.data)}function a(e){u("WebSocket "+this.url+" error: "+e)}t.exports=r;var c=e("./Grammar"),l=e("debug")("JsSIP:WebSocketInterface"),u=e("debug")("JsSIP:ERROR:WebSocketInterface");u.log=console.warn.bind(console),r.prototype.connect=function(){if(l("connect()"),this.isConnected())return void l("WebSocket "+this.url+" is already connected");if(this.isConnecting())return void l("WebSocket "+this.url+" is connecting");this.ws&&this.ws.close(),l("connecting to WebSocket "+this.url);try{this.ws=new WebSocket(this.url,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=i.bind(this),this.ws.onclose=o.bind(this),this.ws.onmessage=s.bind(this),this.ws.onerror=a.bind(this)}catch(e){a.call(this,e)}},r.prototype.disconnect=function(){l("disconnect()"),this.ws&&(this.ws.close(),this.ws=null)},r.prototype.send=function(e){return l("send()"),this.isConnected()?(this.ws.send(e),!0):(u("unable to send message, WebSocket is not open"),!1)},r.prototype.isConnected=function(){return this.ws&&this.ws.readyState===this.ws.OPEN},r.prototype.isConnecting=function(){return this.ws&&this.ws.readyState===this.ws.CONNECTING}},{"./Grammar":6,debug:33}],27:[function(e,t,n){function r(e,t,n){var r;for(f=e,h=t,p=n,r=S.length;r--;)if(!1===S[r](f))return!1;if(f instanceof v.IncomingRequest){for(r=C.length;r--;)if(!1===C[r](f))return!1}else if(f instanceof v.IncomingResponse)for(r=b.length;r--;)if(!1===b[r](f))return!1;return!0}function i(){if("sip"!==f.s("to").uri.scheme)return d(416),!1}function o(){if(!f.to_tag&&f.call_id.substr(0,5)===h.configuration.jssip_id)return d(482),!1}function s(){if(y.str_utf8_length(f.body)<f.getHeader("content-length"))return d(400),!1}function a(){var e,t,n=f.from_tag,r=f.call_id,i=f.cseq;if(!f.to_tag)if(f.method===g.INVITE){if(h.transactions.ist[f.via_branch])return!1;for(t in h.transactions.ist)if(e=h.transactions.ist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return d(482),!1}else{if(h.transactions.nist[f.via_branch])return!1;for(t in h.transactions.nist)if(e=h.transactions.nist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return d(482),!1}}function c(){if(f.getHeaders("via").length>1)return m("more than one Via header field present in the response, dropping the response"),!1}function l(){if(y.str_utf8_length(f.body)<f.getHeader("content-length"))return m("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function u(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!f.hasHeader(e[t]))return m("missing mandatory header field : "+e[t]+", dropping the response"),!1}function d(e){var t,n="SIP/2.0 "+e+" "+g.REASON_PHRASE[e]+"\r\n",r=f.getHeaders("via"),i=r.length,o=0;for(o;o<i;o++)n+="Via: "+r[o]+"\r\n";t=f.getHeader("To"),f.to_tag||(t+=";tag="+y.newTag()),n+="To: "+t+"\r\n",n+="From: "+f.getHeader("From")+"\r\n",n+="Call-ID: "+f.call_id+"\r\n",n+="CSeq: "+f.cseq+" "+f.method+"\r\n",n+="\r\n",p.send(n)}t.exports=r;var f,h,p,m=e("debug")("JsSIP:sanityCheck"),g=e("./Constants"),v=e("./SIPMessage"),y=e("./Utils"),C=[],b=[],S=[];C.push(i),C.push(o),C.push(s),C.push(a),b.push(c),b.push(l),S.push(u)},{"./Constants":1,"./SIPMessage":18,"./Utils":25,debug:33}],28:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function c(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,a,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(n=this._events[e],c(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,a=0;a<r;a++)l[a].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=c(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],29:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&c())}function c(){if(!g){var e=o(a);g=!0;for(var t=m.length;t;){for(p=m,m=[];++v<t;)p&&p[v].run();v=-1,t=m.length}p=null,g=!1,s(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var d,f,h=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(e){d=r}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var p,m=[],g=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new l(e,t)),1!==m.length||g||o(c)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],30:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],31:[function(e,t,n){t.exports=function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],32:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),g(t)?n.showHidden=t:t&&r._extend(n,t),T(n.showHidden)&&(n.showHidden=!1),T(n.depth)&&(n.depth=2),T(n.colors)&&(n.colors=!1),T(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),l(n,e,n.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function c(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,n){if(e.customInspect&&t&&R(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return b(i)||(i=l(e,i,n)),i}var o=u(e,t);if(o)return o;var s=Object.keys(t),a=c(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),w(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(R(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(A(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(_(t))return e.stylize(Date.prototype.toString.call(t),"date");if(w(t))return d(t)}var v="",y=!1,C=["{","}"];if(m(t)&&(y=!0,C=["[","]"]),R(t)){v=" [Function"+(t.name?": "+t.name:"")+"]"}if(A(t)&&(v=" "+RegExp.prototype.toString.call(t)),_(t)&&(v=" "+Date.prototype.toUTCString.call(t)),w(t)&&(v=" "+d(t)),0===s.length&&(!y||0==t.length))return C[0]+v+C[1];if(n<0)return A(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=y?f(e,t,n,a,s):s.map(function(r){return h(e,t,n,a,r,y)}),e.seen.pop(),p(S,v,C)}function u(e,t){if(T(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return C(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)O(t,String(s))?o.push(h(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,n,r,i,!0))}),o}function h(e,t,n,r,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),O(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=v(n)?l(e,c.value,null):l(e,c.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),T(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function m(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return null==e}function C(e){return"number"==typeof e}function b(e){return"string"==typeof e}function S(e){return"symbol"===(void 0===e?"undefined":a(e))}function T(e){return void 0===e}function A(e){return E(e)&&"[object RegExp]"===I(e)}function E(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function _(e){return E(e)&&"[object Date]"===I(e)}function w(e){return E(e)&&("[object Error]"===I(e)||e instanceof Error)}function R(e){return"function"==typeof e}function k(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":a(e))||void 0===e}function I(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":");return[e.getDate(),L[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])v(a)||!E(a)?s+=" "+a:s+=" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(T(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return o};var D,N={};r.debuglog=function(e){if(T(D)&&(D=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!N[e])if(new RegExp("\\b"+e+"\\b","i").test(D)){var n=t.pid;N[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else N[e]=function(){};return N[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=m,r.isBoolean=g,r.isNull=v,r.isNullOrUndefined=y,r.isNumber=C,r.isString=b,r.isSymbol=S,r.isUndefined=T,r.isRegExp=A,r.isObject=E,r.isDate=_,r.isError=w,r.isFunction=R,r.isPrimitive=k,r.isBuffer=e("./support/isBuffer");var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",P(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":31,_process:29,inherits:30}],33:[function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r),e}function o(){return"object"===("undefined"==typeof console?"undefined":a(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}}function c(){var e;try{e=n.storage.debug}catch(e){}return e}n=t.exports=e("./debug"),n.log=o,n.formatArgs=i,n.save=s,n.load=c,n.useColors=r,n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(c())},{"./debug":34}],34:[function(e,t,n){function r(){return n.colors[u++%n.colors.length]}function i(e){function t(){}function i(){var e=i,t=+new Date,o=t-(l||t);e.diff=o,e.prev=l,e.curr=t,l=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;a++;var i=n.formatters[r];if("function"==typeof i){var o=s[a];t=i.call(e,o),s.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s)),(i.log||n.log||console.log.bind(console)).apply(e,s)}t.enabled=!1,i.enabled=!0;var o=n.enabled(e)?i:t;return o.namespace=e,o}function o(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&(e=t[i].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function s(){n.enable("")}function a(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=i,n.coerce=c,n.disable=s,n.enable=o,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var l,u=0},{ms:35}],35:[function(e,t,n){function r(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*l;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function i(e){return e>=u?Math.round(e/u)+"d":e>=l?Math.round(e/l)+"h":e>=c?Math.round(e/c)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function o(e){return s(e,u,"day")||s(e,l,"hour")||s(e,c,"minute")||s(e,a,"second")||e+" ms"}function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,c=60*a,l=60*c,u=24*l,d=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?r(e):t.long?o(e):i(e)}},{}],36:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],37:[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./parser":38,"./writer":39}],38:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))},o=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},s=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(i))return o(c,r,i)}}),t.media=n,t};var c=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(c,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t}},{"./grammar":36}],39:[function(e,t,n){var r=e("./grammar"),i=function(e){var t=1,n=arguments,r=n.length;return e.replace(/%[sdv%]/g,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},o=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,o=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?o.push(n[t.name][a]):o.push(n[t.names[s]])}else o.push(n[t.name]);return i.apply(null,o)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,i=t.innerOrder||a,c=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},{"./grammar":36}],40:[function(e,t,n){t.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"2.0.6",homepage:"http://jssip.net",author:"JosĂŠ Luis MillĂĄn <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["IĂąaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","SaĂşl Ibarra CorretgĂŠ <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.7.0","sdp-transform":"^1.6.2"},devDependencies:{browserify:"^13.1.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"1.8.8","gulp-jshint":"^2.0.1","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^2.0.0","gulp-util":"^3.0.7",jshint:"^2.9.3","jshint-stylish":"^2.2.1",pegjs:"0.7.0","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}],41:[function(e,t,r){(function(n){function r(e){function t(e){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+e+" [browser: "+i.name+" "+i.version+"]")}}if(C&&i.chrome&&y>=32||i.android&&i.chrome&&y>=39||C&&i.opera&&y>=27||i.android&&i.opera&&y>=24||i.android&&i.webkit&&!i.chrome&&y>=37||T.webkitGetUserMedia&&S.webkitRTCPeerConnection)b=!0,c=T.webkitGetUserMedia.bind(T),l=T.mediaDevices,u=S.webkitRTCPeerConnection,d=S.RTCSessionDescription,f=S.RTCIceCandidate,h=S.MediaStreamTrack,h&&h.getSources?p=h.getSources.bind(h):T.getMediaDevices&&(p=T.getMediaDevices.bind(T)),m=function(e,t){return e.src=URL.createObjectURL(t),e},g=!0,v=!1;else if(i.firefox&&y<47||T.mozGetUserMedia&&S.mozRTCPeerConnection)b=!0,c=T.mozGetUserMedia.bind(T),l=T.mediaDevices,u=S.mozRTCPeerConnection,d=S.mozRTCSessionDescription,f=S.mozRTCIceCandidate,h=S.MediaStreamTrack,m=function(e,t){return e.src=URL.createObjectURL(t),e},g=!1,v=!1;else if((i.firefox||i.gecko)&&y>=47)b=!0,c=T.mozGetUserMedia.bind(T),l=T.mediaDevices,u=S.RTCPeerConnection,d=S.RTCSessionDescription,f=S.RTCIceCandidate,h=S.MediaStreamTrack,m=function(e,t){return e.src=URL.createObjectURL(t),e},g=!1,v=!1;else if(e.plugin&&"function"==typeof e.plugin.isRequired&&e.plugin.isRequired()&&"function"==typeof e.plugin.isInstalled&&e.plugin.isInstalled()){var n=e.plugin.interface;b=!0,c=n.getUserMedia,l=n.mediaDevices,u=n.RTCPeerConnection,d=n.RTCSessionDescription,f=n.RTCIceCandidate,h=n.MediaStreamTrack,h&&h.getSources?p=h.getSources.bind(h):T.getMediaDevices&&(p=T.getMediaDevices.bind(T)),m=n.attachMediaStream,g=n.canRenegotiate,v=!0}else T.getUserMedia&&S.RTCPeerConnection&&(b=!0,c=T.getUserMedia.bind(T),l=T.mediaDevices,u=S.RTCPeerConnection,d=S.RTCSessionDescription,f=S.RTCIceCandidate,h=S.MediaStreamTrack,h&&h.getSources?p=h.getSources.bind(h):T.getMediaDevices&&(p=T.getMediaDevices.bind(T)),m=S.attachMediaStream||function(e,t){return e.src=URL.createObjectURL(t),e},g=!0,v=!1);return r.hasWebRTC=function(){return b},r.getUserMedia=c?function(e,t,n){o("getUserMedia() | constraints: %o",e);try{c(e,function(e){o("getUserMedia() | success"),t&&t(e)},function(e){o("getUserMedia() | error:",e),n&&n(e)})}catch(e){s("getUserMedia() | error:",e),n&&n(e)}}:function(e,n,r){s("getUserMedia() | WebRTC not supported"),r?r(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+i.name+" "+i.version+"]")):t("getUserMedia")},r.mediaDevices=l,r.RTCPeerConnection=u||t("RTCPeerConnection"),r.RTCSessionDescription=d||t("RTCSessionDescription"),r.RTCIceCandidate=f||t("RTCIceCandidate"),r.MediaStreamTrack=h||t("MediaStreamTrack"),r.getMediaDevices=p,r.attachMediaStream=m||t("attachMediaStream"),r.canRenegotiate=g,r.closeMediaStream=function(e){if(e)try{o("closeMediaStream() | calling stop() on all the MediaStreamTrack");var t,n,r;if(e.getTracks)for(t=e.getTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();else{for(t=e.getAudioTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();for(t=e.getVideoTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop()}}catch(t){"function"!=typeof e.stop&&"object"!==a(e.stop)||(o("closeMediaStream() | calling stop() on the MediaStream"),e.stop())}},r.fixPeerConnectionConfig=function(e){var t,n,r,i,o;for(Array.isArray(e.iceServers)||(e.iceServers=[]),t=0,n=e.iceServers.length;t<n;t+=1)r=e.iceServers[t],i=r.hasOwnProperty("urls"),o=r.hasOwnProperty("url"),"object"===(void 0===r?"undefined":a(r))&&(i&&!o?r.url=Array.isArray(r.urls)?r.urls[0]:r.urls:!i&&o&&(r.urls=Array.isArray(r.url)?r.url.slice():r.url),o&&Array.isArray(r.url)&&(r.url=r.url[0]))},r.fixRTCOfferOptions=function(e){e=e||{},v?(e.hasOwnProperty("offerToReceiveAudio")&&(e.mandatory=e.mandatory||{},e.mandatory.OfferToReceiveAudio=!!e.offerToReceiveAudio),e.hasOwnProperty("offerToReceiveVideo")&&(e.mandatory=e.mandatory||{},e.mandatory.OfferToReceiveVideo=!!e.offerToReceiveVideo)):(e.mandatory&&e.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(e.offerToReceiveAudio=e.mandatory.OfferToReceiveAudio?1:0),e.mandatory&&e.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(e.offerToReceiveVideo=e.mandatory.OfferToReceiveVideo?1:0),delete e.mandatory)},r}t.exports=r;var i=e("bowser"),o=e("debug")("rtcninja:Adapter"),s=e("debug")("rtcninja:ERROR:Adapter"),c=null,l=null,u=null,d=null,f=null,h=null,p=null,m=null,g=!1,v=!1,y=Number(i.version)||0,C=!(i.mobile||i.tablet&&!(i.msie&&y>=10)),b=!1,S=n.window||n,T=S.navigator||{};s.log=console.warn.bind(console)}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:45,debug:46}],42:[function(e,t,n){function r(e,t){d("new | [pcConfig:%o, pcConstraints:%o]",e,t),i.call(this,e),this.pcConstraints=t,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,a.call(this),l.call(this)}function i(e){this.pcConfig=u(!0,e),h.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,d("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function o(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function s(){var e=this,t=this.pc;t.onnegotiationneeded=function(t){o.call(e)||(d("onnegotiationneeded()"),e.onnegotiationneeded&&e.onnegotiationneeded(t))},t.onicecandidate=function(t){var n,r,i;if(!o.call(e)&&!e.ignoreIceGathering&&!e.options.iceTransportsNone)if(n=t.candidate){if(r=p.REGEXP_RELAY_CANDIDATE.test(n.candidate),e.options.iceTransportsRelay&&!r)return;r&&!e.timerGatheringTimeoutAfterRelay&&"number"==typeof e.options.gatheringTimeoutAfterRelay&&(d("onicecandidate() | first relay candidate found, ending gathering in %d ms",e.options.gatheringTimeoutAfterRelay),e.timerGatheringTimeoutAfterRelay=setTimeout(function(){o.call(e)||(d("forced end of candidates after timeout"),delete e.timerGatheringTimeoutAfterRelay,clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,e.ignoreIceGathering=!0,e.onicecandidate&&e.onicecandidate({candidate:null},null))},e.options.gatheringTimeoutAfterRelay)),i=new h.RTCIceCandidate({sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,candidate:n.candidate}),null===m.normalizeCandidate&&(p.REGEXP_NORMALIZED_CANDIDATE.test(n.candidate)?m.normalizeCandidate=!1:(d('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),m.normalizeCandidate=!0)),m.normalizeCandidate&&(i.candidate=n.candidate.replace(p.REGEXP_FIX_CANDIDATE,"")),d("onicecandidate() | m%d(%s) %s",i.sdpMLineIndex,i.sdpMid||"no mid",i.candidate),e.onicecandidate&&e.onicecandidate(t,i)}else d("onicecandidate() | end of candidates"),clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,e.onicecandidate&&e.onicecandidate(t,null)},t.onaddstream=function(t){o.call(e)||(d("onaddstream() | stream: %o",t.stream),e.onaddstream&&e.onaddstream(t,t.stream))},t.onremovestream=function(t){o.call(e)||(d("onremovestream() | stream: %o",t.stream),e.onremovestream&&e.onremovestream(t,t.stream))},t.ondatachannel=function(t){o.call(e)||(d("ondatachannel() | datachannel: %o",t.channel),e.ondatachannel&&e.ondatachannel(t,t.channel))},t.onsignalingstatechange=function(n){t.signalingState!==e.ourSignalingState&&(d("onsignalingstatechange() | signalingState: %s",t.signalingState),e.ourSignalingState=t.signalingState,e.onsignalingstatechange&&e.onsignalingstatechange(n,t.signalingState))},t.oniceconnectionstatechange=function(n){t.iceConnectionState!==e.ourIceConnectionState&&(d("oniceconnectionstatechange() | iceConnectionState: %s",t.iceConnectionState),e.ourIceConnectionState=t.iceConnectionState,e.oniceconnectionstatechange&&e.oniceconnectionstatechange(n,t.iceConnectionState))},t.onicegatheringstatechange=function(n){o.call(e)||t.iceGatheringState!==e.ourIceGatheringState&&(d("onicegatheringstatechange() | iceGatheringState: %s",t.iceGatheringState),e.ourIceGatheringState=t.iceGatheringState,e.onicegatheringstatechange&&e.onicegatheringstatechange(n,t.iceGatheringState))},t.onidentityresult=function(t){o.call(e)||(d("onidentityresult()"),e.onidentityresult&&e.onidentityresult(t))},t.onpeeridentity=function(t){o.call(e)||(d("onpeeridentity()"),e.onpeeridentity&&e.onpeeridentity(t))},t.onidpassertionerror=function(t){o.call(e)||(d("onidpassertionerror()"),e.onidpassertionerror&&e.onidpassertionerror(t))},t.onidpvalidationerror=function(t){o.call(e)||(d("onidpvalidationerror()"),e.onidpvalidationerror&&e.onidpvalidationerror(t))}}function a(){this.pcConstraints?this.pc=new h.RTCPeerConnection(this.pcConfig,this.pcConstraints):this.pc=new h.RTCPeerConnection(this.pcConfig),s.call(this)}function c(){var e=this.pc,t=this.options,n=null;return e.localDescription?(t.iceTransportsRelay?n=e.localDescription.sdp.replace(p.REGEXP_SDP_NON_RELAY_CANDIDATES,""):t.iceTransportsNone&&(n=e.localDescription.sdp.replace(p.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new h.RTCSessionDescription({type:e.localDescription.type,sdp:n||e.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function l(){var e=this;Object.defineProperties(this,{peerConnection:{get:function(){return e.pc}},signalingState:{get:function(){return e.pc.signalingState}},iceConnectionState:{get:function(){return e.pc.iceConnectionState}},iceGatheringState:{get:function(){return e.pc.iceGatheringState}},localDescription:{get:function(){return c.call(e)}},remoteDescription:{get:function(){return e.pc.remoteDescription}},peerIdentity:{get:function(){return e.pc.peerIdentity}}})}t.exports=r;var u=e("merge"),d=e("debug")("rtcninja:RTCPeerConnection"),f=e("debug")("rtcninja:ERROR:RTCPeerConnection"),h=e("./Adapter"),p={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},m={normalizeCandidate:null};f.log=console.warn.bind(console),r.prototype.createOffer=function(e,t,n){d("createOffer()");var r=this;h.fixRTCOfferOptions(n),this.pc.createOffer(function(t){o.call(r)||(d("createOffer() | success"),e&&e(t))},function(e){o.call(r)||(f("createOffer() | error:",e),t&&t(e))},n)},r.prototype.createAnswer=function(e,t,n){d("createAnswer()");var r=this;this.pc.createAnswer(function(t){o.call(r)||(d("createAnswer() | success"),e&&e(t))},function(e){o.call(r)||(f("createAnswer() | error:",e),t&&t(e))},n)},r.prototype.setLocalDescription=function(e,t,n){function r(){"number"==typeof i.options.gatheringTimeout&&"complete"!==i.pc.iceGatheringState&&(d("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",i.options.gatheringTimeout),i.timerGatheringTimeout=setTimeout(function(){o.call(i)||(d("forced end of candidates after gatheringTimeout timeout"),delete i.timerGatheringTimeout,clearTimeout(i.timerGatheringTimeoutAfterRelay),delete i.timerGatheringTimeoutAfterRelay,i.ignoreIceGathering=!0,i.onicecandidate&&i.onicecandidate({candidate:null},null))},i.options.gatheringTimeout))}d("setLocalDescription()");var i=this;this.pc.setLocalDescription(e,function(){o.call(i)||(d("setLocalDescription() | success"),clearTimeout(i.timerGatheringTimeout),delete i.timerGatheringTimeout,clearTimeout(i.timerGatheringTimeoutAfterRelay),delete i.timerGatheringTimeoutAfterRelay,r(),t&&t())},function(e){o.call(i)||(f("setLocalDescription() | error:",e),n&&n(e))}),this.ignoreIceGathering=!1},r.prototype.setRemoteDescription=function(e,t,n){d("setRemoteDescription()");var r=this;this.pc.setRemoteDescription(e,function(){o.call(r)||(d("setRemoteDescription() | success"),t&&t())},function(e){o.call(r)||(f("setRemoteDescription() | error:",e),n&&n(e))})},r.prototype.updateIce=function(e){d("updateIce() | pcConfig: %o",e),i.call(this,e),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},r.prototype.addIceCandidate=function(e,t,n){d("addIceCandidate() | candidate: %o",e);var r=this;this.pc.addIceCandidate(e,function(){o.call(r)||(d("addIceCandidate() | success"),t&&t())},function(e){o.call(r)||(f("addIceCandidate() | error:",e),n&&n(e))})},r.prototype.getConfiguration=function(){return d("getConfiguration()"),this.pc.getConfiguration()},r.prototype.getLocalStreams=function(){return d("getLocalStreams()"),this.pc.getLocalStreams()},r.prototype.getRemoteStreams=function(){return d("getRemoteStreams()"),this.pc.getRemoteStreams()},r.prototype.getStreamById=function(e){return d("getStreamById() | streamId: %s",e),this.pc.getStreamById(e)},r.prototype.addStream=function(e){d("addStream() | stream: %s",e),this.pc.addStream(e)},r.prototype.removeStream=function(e){d("removeStream() | stream: %o",e),this.pc.removeStream(e)},r.prototype.close=function(){d("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},r.prototype.createDataChannel=function(){return d("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},r.prototype.createDTMFSender=function(e){return d("createDTMFSender()"),this.pc.createDTMFSender?this.pc.createDTMFSender(e):null},r.prototype.getStats=function(){return d("getStats()"),this.pc.getStats.apply(this.pc,arguments)},r.prototype.setIdentityProvider=function(){return d("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},r.prototype.getIdentityAssertion=function(){return d("getIdentityAssertion()"),this.pc.getIdentityAssertion()},r.prototype.reset=function(e){d("reset() | pcConfig: %o",e);var t=this.pc;t.onnegotiationneeded=null,t.onicecandidate=null,t.onaddstream=null,t.onremovestream=null,t.ondatachannel=null,t.onsignalingstatechange=null,t.oniceconnectionstatechange=null,t.onicegatheringstatechange=null,t.onidentityresult=null,t.onpeeridentity=null,t.onidpassertionerror=null,t.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,d("reset() | closing current peerConnection"),t.close(),i.call(this,e),a.call(this)}},{"./Adapter":41,debug:46,merge:49}],43:[function(e,t,n){function r(e){var t=c(e||{});return u=!0,r.RTCPeerConnection=l,r.getUserMedia=t.getUserMedia,r.mediaDevices=t.mediaDevices,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCIceCandidate=t.RTCIceCandidate,r.MediaStreamTrack=t.MediaStreamTrack,r.getMediaDevices=t.getMediaDevices,r.attachMediaStream=t.attachMediaStream,r.closeMediaStream=t.closeMediaStream,r.canRenegotiate=t.canRenegotiate,t.hasWebRTC()?(o("WebRTC supported"),!0):(s("WebRTC not supported"),!1)}t.exports=r;var i=e("bowser"),o=e("debug")("rtcninja"),s=e("debug")("rtcninja:ERROR"),a=e("./version"),c=e("./Adapter"),l=e("./RTCPeerConnection"),u=!1;s.log=console.warn.bind(console),o("version %s",a),o("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",i.name,i.version,!!i.mobile,!!i.tablet,!!i.android,!!i.ios),r.hasWebRTC=function(){return u||r(),c.hasWebRTC()},Object.defineProperty(r,"version",{get:function(){return a}}),Object.defineProperty(r,"called",{get:function(){return u}}),r.debug=e("debug"),r.browser=i},{"./Adapter":41,"./RTCPeerConnection":42,"./version":44,bowser:45,debug:46}],44:[function(e,t,n){t.exports=e("../package.json").version},{"../package.json":50}],45:[function(t,n,r){/*!
     * Bowser - a browser detector
     * https://github.com/ded/bowser
     * MIT License | (c) Dustin Diaz 2015
     */
!function(t,r){void 0!==n&&n.exports?n.exports=r():"function"==typeof e&&e.amd?e("bowser",r):this.bowser=r()}(0,function(){function e(e){function t(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}var n,r=t(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(e),o=!i&&/android/i.test(e),a=/nexus\s*[0-6]\s*/i.test(e),c=!a&&/nexus\s*[0-9]+/i.test(e),l=/CrOS/.test(e),u=/silk/i.test(e),d=/sailfish/i.test(e),f=/tizen/i.test(e),h=/(web|hpw)os/i.test(e),p=/windows phone/i.test(e),m=(/SamsungBrowser/i.test(e),!p&&/windows/i.test(e)),g=!r&&!u&&/macintosh/i.test(e),v=!o&&!d&&!f&&!h&&/linux/i.test(e),y=t(/edge\/(\d+(\.\d+)?)/i),C=t(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(e),S=!b&&/[^-]mobi/i.test(e),T=/xbox/i.test(e);/opera/i.test(e)?n={name:"Opera",opera:s,version:C||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(e)?n={name:"Opera",opera:s,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||C}:/SamsungBrowser/i.test(e)?n={name:"Samsung Internet for Android",samsungBrowser:s,version:C||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?n={name:"Opera Coast",coast:s,version:C||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?n={name:"Yandex Browser",yandexbrowser:s,version:C||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?n={name:"UC Browser",ucbrowser:s,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?n={name:"Maxthon",maxthon:s,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?n={name:"Epiphany",epiphany:s,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?n={name:"Puffin",puffin:s,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?n={name:"Sleipnir",sleipnir:s,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?n={name:"K-Meleon",kMeleon:s,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:p?(n={name:"Windows Phone",windowsphone:s},y?(n.msedge=s,n.version=y):(n.msie=s,n.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?n={name:"Internet Explorer",msie:s,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:l?n={name:"Chrome",chromeos:s,chromeBook:s,chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?n={name:"Microsoft Edge",msedge:s,version:y}:/vivaldi/i.test(e)?n={name:"Vivaldi",vivaldi:s,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||C}:d?n={name:"Sailfish",sailfish:s,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?n={name:"SeaMonkey",seamonkey:s,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(n={name:"Firefox",firefox:s,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(n.firefoxos=s)):u?n={name:"Amazon Silk",silk:s,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?n={name:"PhantomJS",phantom:s,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?n={name:"SlimerJS",slimer:s,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?n={name:"BlackBerry",blackberry:s,version:C||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(n={name:"WebOS",webos:s,version:C||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(n.touchpad=s)):/bada/i.test(e)?n={name:"Bada",bada:s,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:f?n={name:"Tizen",tizen:s,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||C}:/qupzilla/i.test(e)?n={name:"QupZilla",qupzilla:s,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||C}:/chromium/i.test(e)?n={name:"Chromium",chromium:s,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||C}:/chrome|crios|crmo/i.test(e)?n={name:"Chrome",chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?n={name:"Android",version:C}:/safari|applewebkit/i.test(e)?(n={name:"Safari",safari:s},C&&(n.version=C)):r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},C&&(n.version=C)):n=/googlebot/i.test(e)?{name:"Googlebot",googlebot:s,version:t(/googlebot\/(\d+(\.\d+))/i)||C}:{name:t(/^(.*)\/(.*) /),version:function(t){var n=e.match(t);return n&&n.length>1&&n[2]||""}(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(n.name=n.name||"Blink",n.blink=s):(n.name=n.name||"Webkit",n.webkit=s),!n.version&&C&&(n.version=C)):!n.opera&&/gecko\//i.test(e)&&(n.name=n.name||"Gecko",n.gecko=s,n.version=n.version||t(/gecko\/(\d+(\.\d+)?)/i)),n.msedge||!o&&!n.silk?r?(n[r]=s,n.ios=s):g?n.mac=s:T?n.xbox=s:m?n.windows=s:v&&(n.linux=s):n.android=s;var A="";n.windowsphone?A=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r?(A=t(/os (\d+([_\s]\d+)*) like mac os x/i),A=A.replace(/[_\s]/g,".")):o?A=t(/android[ \/-](\d+(\.\d+)*)/i):n.webos?A=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?A=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?A=t(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(A=t(/tizen[\/\s](\d+(\.\d+)*)/i)),A&&(n.osversion=A);var E=A.split(".")[0];return b||c||"ipad"==r||o&&(3==E||E>=4&&!S)||n.silk?n.tablet=s:(S||"iphone"==r||"ipod"==r||o||a||n.blackberry||n.webos||n.bada)&&(n.mobile=s),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=s:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=s:n.x=s,n}function t(e){return e.split(".").length}function n(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)r.push(t(e[n]));return r}function r(e){for(var r=Math.max(t(e[0]),t(e[1])),i=n(e,function(e){var i=r-t(e);return e+=new Array(i+1).join(".0"),n(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--r>=0;){if(i[0][r]>i[1][r])return 1;if(i[0][r]!==i[1][r])return-1;if(0===r)return 0}}function i(t,n,i){var o=a;"string"==typeof n&&(i=n,n=void 0),void 0===n&&(n=!1),i&&(o=e(i));var s=""+o.version;for(var c in t)if(t.hasOwnProperty(c)&&o[c])return r([s,t[c]])<0;return n}function o(e,t,n){return!i(e,t,n)}var s=!0,a=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return a.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in a)return!0}return!1},a.isUnsupportedBrowser=i,a.compareVersions=r,a.check=o,a._detect=e,a})},{}],46:[function(e,t,n){arguments[4][33][0].apply(n,arguments)},{"./debug":47,dup:33}],47:[function(e,t,n){arguments[4][34][0].apply(n,arguments)},{dup:34,ms:48}],48:[function(e,t,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],49:[function(e,t,n){!function(e){function n(e,t){if("object"!==i(e))return t;for(var r in t)"object"===i(e[r])&&"object"===i(t[r])?e[r]=n(e[r],t[r]):e[r]=t[r];return e}function r(e,t,r){var s=r[0],a=r.length;(e||"object"!==i(s))&&(s={});for(var c=0;c<a;++c){var l=r[c];if("object"===i(l))for(var u in l){var d=e?o.clone(l[u]):l[u];s[u]=t?n(s[u],d):d}}return s}function i(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var o=function(e){return r(!0===e,!1,arguments)};o.recursive=function(e){return r(!0===e,!0,arguments)},o.clone=function(e){var t,n,r=e,s=i(e);if("array"===s)for(r=[],n=e.length,t=0;t<n;++t)r[t]=o.clone(e[t]);else if("object"===s){r={};for(t in e)r[t]=o.clone(e[t])}return r},e?t.exports=o:window.merge=o}("object"===(void 0===t?"undefined":a(t))&&t&&"object"===a(t.exports)&&t.exports)},{}],50:[function(e,t,n){t.exports={name:"rtcninja",version:"0.7.0",description:"WebRTC API wrapper to deal with different browsers",author:"IĂąaki Baz Castillo <inaki.baz@eface2face.com> (http://eface2face.com)",contributors:["JesĂşs PĂŠrez <jesus.perez@eface2face.com>"],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.12.0"},dependencies:{bowser:"^1.4.6",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^13.1.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.8.8","gulp-jscs":"^3.0.2","gulp-jscs-stylish":"^1.4.0","gulp-jshint":"^2.0.1","gulp-rename":"^1.2.2","gulp-uglify":"^1.5.4",jshint:"^2.9.3","jshint-stylish":"^2.2.1","vinyl-source-stream":"^1.1.0"}}},{}]},{},[7])(7)})}).call(t,n(13))},162:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.ErizoCallListener=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.engine=e,n}return o(t,e),s(t,[{key:"onNewCall",value:function(e,t,n){nucleus.getLogger().d("CallListener","onNewCall"),t.callDirection=e,t.callState=CubeSignalingState.Invite}},{key:"onInProgress",value:function(e){nucleus.getLogger().d("CallListener","onInProgress"),e.callState=CubeSignalingState.Progress}},{key:"onCallRinging",value:function(e){nucleus.getLogger().d("CallListener","onCallRinging"),e.callState=CubeSignalingState.Ringing}},{key:"onCallConnected",value:function(e){nucleus.getLogger().d("CallListener","onCallConnected"),e.callState=CubeSignalingState.Incall;var t=this.engine.getConferenceService();null!==t&&t.delegate.onConferenceConnected(t.getConference())}},{key:"onCallEnded",value:function(e){nucleus.getLogger().d("CallListener","onCallEnded"),e.callState=CubeSignalingState.End;var t=this.engine.getConferenceService();null!==t&&(t.delegate.onConferenceSipEnd(t.curConference),t.curConference=null,t.flagTerminated=!1,t.confStatus=0)}},{key:"onCallAddStream",value:function(e,t){nucleus.getLogger().d("CallListener","onCallAddStream");var n=this.engine.getConferenceService();null!==n&&n.delegate.onConferenceAddStream(n.getConference(),t)}},{key:"onCallRemoveStream",value:function(e,t){nucleus.getLogger().d("CallListener","onCallRemoveStream");var n=this.engine.getConferenceService();null!==n&&n.delegate.onConferenceRemoveStream(n.getConference(),t)}},{key:"onCallFailed",value:function(e,t){nucleus.getLogger().d("CallListener","onCallFailed");var n=this.engine.getConferenceService();if(null!==n){var r=n.getConference();null!==r&&(n.hangup(),n.quit(r.conferenceId)),n.confStatus=0,n.curConference=null,n.flagTerminated=!1,n.delegate.onConferenceFailed(new CubeError(t,"Call Conference Error"),r)}e.callState=CubeSignalingState.None}}]),t}(CubeCallListener)},163:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.SipCallListener=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.engine=e,n}return o(t,e),s(t,[{key:"onCall",value:function(e,t,n){nucleus.getLogger().d("CallListener","onCall"),t.callDirection=e,t.callState=CubeSignalingState.Invite,this.engine.sipService.localVideo.style.visibility="visible"}},{key:"onNewCall",value:function(e,t,n){nucleus.getLogger().d("CallListener","onNewCall"),t.callDirection=e,t.callState=CubeSignalingState.Invite,this.engine.sipService.localVideo.style.visibility="visible"}},{key:"onInProgress",value:function(e){nucleus.getLogger().d("CallListener","onInProgress"),e.callState=CubeSignalingState.Progress}},{key:"onCallRinging",value:function(e){nucleus.getLogger().d("CallListener","onCallRinging"),e.callState=CubeSignalingState.Ringing}},{key:"onCallConnected",value:function(e){nucleus.getLogger().d("CallListener","onCallConnected"),e.callState=CubeSignalingState.Incall;var t=this.engine.getConferenceService();if(null!==t&&t.delegate.onConferenceConnected(t.getConference()),this.engine.sipService.remoteVideo.style.visibility="visible",null!==t&&e.callPeer.name.length<=4){var n=this.engine.getMediaService(),r=this;setTimeout(function(){r.engine.sipService.videoEnabled&&n._startAutoCapture(e.name)},2e3)}}},{key:"onCallEnded",value:function(e){nucleus.getLogger().d("CallListener","onCallEnded"),e.callState=CubeSignalingState.End,this.engine.sipService.localVideo.style.visibility="hidden",this.engine.sipService.remoteVideo.style.visibility="hidden";var t=this.engine.getConferenceService();null!==t&&(t.delegate.onConferenceSipEnd(t.curConference),t.curConference=null,t.flagTerminated=!1,t.confStatus=0),this.engine.getMediaService()._stopAutoCapture()}},{key:"onCallFailed",value:function(e,t){nucleus.getLogger().d("CallListener","onCallFailed"),this.engine.sipService.localVideo.style.visibility="hidden",this.engine.sipService.remoteVideo.style.visibility="hidden";var n=this.engine.getConferenceService();if(null!==n){var r=n.getConference();null!==r&&n.quit(r.conferenceId),n.confStatus=0,n.curConference=null,n.flagTerminated=!1,n.delegate.onConferenceFailed(r,new CubeError(t,"Call Conference Error"))}e.callState=CubeSignalingState.None,this.engine.getMediaService()._stopAutoCapture()}}]),t}(CubeCallListener)},164:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.SipRegistrationListener=function(){function e(t){r(this,e),this.engine=t}return i(e,[{key:"onRegistrationProgress",value:function(e){nucleus.getLogger().d("SipRegistrationListener","onRegistrationProgress")}},{key:"onRegistrationOk",value:function(e){nucleus.getLogger().d("SipRegistrationListener","onRegistrationOk")}},{key:"onRegistrationCleared",value:function(e){nucleus.getLogger().d("SipRegistrationListener","onRegistrationCleared")}},{key:"onRegistrationFailed",value:function(e){nucleus.getLogger().d("SipRegistrationListener","onRegistrationFailed")}}]),e}()},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CubeConst={ActionLicense:"license",ActionLicenseAck:"license-ack",ActionLicenseNotify:"license-notify",ActionLogin:"login",ActionLoginAck:"login-ack",ActionLoginSync:"login-sync",ActionLogout:"logout",ActionLogoutAck:"logout-ack",ActionQuery:"query",ActionQueryAck:"query-ack",ActionQueryDevice:"query-device",ActionQueryDeviceAck:"query-device-ack",ActionQueryByIdDevice:"query-device-by-id",ActionQueryByIdDeviceAck:"query-device-by-id-ack",ActionUpdate:"update",ActionUpdateAck:"update-ack",ActionUpdateSync:"update-sync",ActionUpdateNotifyConfig:"update-notify-config",ActionUpdateDisturbConfig:"update-disturb-config",ActionAddTop:"add-top",ActionRemoveTop:"remove-top",ActionAddMute:"add-mute",ActionRemoveMute:"remove-mute",ActionQuerySetting:"query-setting",ActionSyncSetting:"sync-setting",ActionUpdateDeviceToken:"update-device-token",ActionCreateGroup:"create-group",ActionCreateGroupAck:"create-group-ack",ActionCreateGroupSync:"create-group-sync",ActionCreateGroupNotify:"create-group-notify",ActionDestroyGroup:"destroy-group",ActionDestroyGroupAck:"destroy-group-ack",ActionDestroyGroupSync:"destroy-group-sync",ActionDestroyGroupNotify:"destroy-group-notify",ActionAddMember:"add-group-member",ActionAddMemberAck:"add-group-member-ack",ActionAddMemberSync:"add-group-member-sync",ActionAddMemberNotify:"add-group-member-notify",ActionRemoveMember:"remove-group-member",ActionRemoveGroupMemberAck:"remove-group-member-ack",ActionRemoveGroupMemberSync:"remove-group-member-sync",ActionRemoveGroupMemberNotify:"remove-group-member-notify",ActionQuitGroup:"quit-group",ActionQuitGroupAck:"quit-group-ack",ActionQuitGroupSync:"quit-group-sync",ActionQuitGroupNotify:"quit-group-notify",ActionQueryGroups:"query-groups",ActionQueryGroupsAck:"query-groups-ack",ActionQueryGroupsSync:"query-groups-sync",ActionQueryGroupsNotify:"query-groups-notify",ActionAddMaster:"add-group-master",ActionAddMasterAck:"add-group-master-ack",ActionAddMasterSync:"add-group-master-sync",ActionAddMasterNotify:"add-group-master-notify",ActionRemoveMaster:"remove-group-master",ActionRemoveMasterAck:"remove-group-master-ack",ActionRemoveMasterSync:"remove-group-master-sync",ActionRemoveMasterNotify:"remove-group-master-notify",ActionUpdateGroup:"update-group",ActionUpdateGroupAck:"update-group-ack",ActionUpdateGroupSync:"update-group-sync",ActionUpdateGroupNotify:"update-group-notify",ActionInviteGroupMember:"invite-group-member",ActionInviteGroupMemberAck:"invite-group-member-ack",ActionInviteGroupMemberSync:"invite-group-member-sync",ActionInviteGroupMemberNotify:"invite-group-member-notify",AcitonRejectGroupInvite:"reject-group-invite",AcitonRejectGroupInviteAck:"reject-group-invite-ack",AcitonRejectGroupInviteSync:"reject-group-invite-sync",AcitonRejectGroupInviteNotify:"reject-group-invite-notify",ActionAcceptGroupInvite:"accept-group-invite",ActionAcceptGroupInviteAck:"accept-group-invite-ack",ActionAcceptGroupInviteSync:"accept-group-invite-sync",ActionAcceptGroupInviteNotify:"accept-group-invite-notify",ActionApplyJoinGroup:"apply-join-group",ActionApplyJoinGroupAck:"apply-join-group-ack",ActionApplyJoinGroupSync:"apply-join-group-sync",ActionApplyJoinGroupNotify:"apply-join-group-notify",ActionAcceptApplyGroup:"accept-apply-group",ActionAcceptApplyGroupAck:"accept-apply-group-ack",ActionAcceptApplyGroupSync:"accept-apply-group-sync",ActionAcceptApplyGroupNotify:"accept-apply-group-notify",ActionRejectApplyGroup:"reject-apply-group",ActionRejectApplyGroupAck:"reject-apply-group-ack",ActionRejectApplyGroupSync:"reject-apply-group-sync",ActionRejectApplyGroupNotify:"reject-apply-group-notify",ActionPush:"push",ActionPushAck:"push-ack",ActionPushSync:"push-sync",ActionPushNotify:"push-notify",ActionPull:"pull",ActionPullAck:"pull-ack",ActionNotify:"notify",ActionRecall:"recall",ActionRecallAck:"recall-ack",ActionRecallSync:"recall-sync",ActionRecallNotify:"recall-notify",ActionReceipt:"receipt",ActionReceiptAck:"receipt-ack",ActionReceiptAll:"receipt-all",ActionReceiptAllAck:"receipt-all-ack",ActionReceiptOffline:"receipt-offline",ActionReceiptOfflineAck:"receipt-offline-ack",ActionForward:"forward",ActionForwardAck:"forward-ack",ActionHistory:"history",ActionHistoryAck:"history-ack",ActionSearchMsg:"search-msg",ActionSearchMsgAck:"search-msg-ack",ActionSearchMsgs:"search-msgs",ActionSearchMsgsAck:"search-msgs-ack",ActionSync:"sync",ActionSyncAck:"sync-ack",ActionUpdateTop:"update-top",ActionUpdateTopAck:"update-top-ack",ActionMsgSync:"message-sync",ActionMsgSyncAck:"message-sync-ack",ActionMsgPull:"message-pull",ActionMsgPullAck:"message-pull-ack",ActionMessageHistorySns:"message-history-sns",ActionMessageHistorySnsAck:"message-history-sns-ack",ActionInvite:"invite",ActionInviteAck:"invite-ack",ActionInviteSync:"invite-sync",ActionInviteNotify:"invite-notify",ActionAnswer:"answer",ActionAnswerAck:"answer-ack",ActionAnswerSync:"answer-sync",ActionAnswerNotify:"answer-notify",ActionCancel:"cancel",ActionCancelAck:"cancel-ack",ActionCancelSync:"cancel-sync",ActionCancelNotify:"cancel-notify",ActionBye:"bye",ActionByeAck:"bye-ack",ActionByeSync:"bye-sync",ActionByeNotify:"bye-notify",ActionCandidate:"candidate",ActionCandidateAck:"candidate-ack",ActionCandidateNotify:"candidate-notify",ActionConsult:"consult",ActionConsultAck:"consult-ack",ActionConsultNotify:"consult-notify",ActionReply:"reply",ActionReplyAck:"reply-ack",ActionTryReInvite:"try-reinvite",ActionTryReInviteAck:"try-reinvite-ack",ActionReverseCall:"reverse-call",ActionShare:"share",ActionShareAck:"share-ack",ActionRevoke:"revoke",ActionRevokeAck:"revoke-ack",ActionVGCmd:"vg-cmd",ActionVGCmdAck:"vg-cmd-ack",ActionRestrain:"restrain",ActionRestrainAck:"restrain-ack",ActionQueryWB:"query-wb",ActionQueryWBAck:"query-wb-ack",ActionQueryShared:"query-shared",ActionQuerySharedAck:"query-shared-ack",ActionRejectWE:"reject-wb",ActionRejectWEAck:"reject-wb-ack",ActionCreateWhiteboard:"create-whiteboard",ActionCreateWhiteboardAck:"create-whiteboard-ack",ActionCreateWhiteboardSync:"create-whiteboard-sync",ActionCreateWhiteboardNotify:"create-whiteboard-notify",ActionDestroyWhiteboard:"destroy-whiteboard",ActionDestroyWhiteboardAck:"destroy-whiteboard-ack",ActionDestroyWhiteboardSync:"destroy-whiteboard-sync",ActionDestroyWhiteboardNotify:"destroy-whiteboard-notify",ActionApplyjoinWhiteboard:"apply-join-whiteboard",ActionApplyjoinWhiteboardAck:"apply-join-whiteboard-ack",ActionApplyjoinWhiteboardSync:"apply-join-whiteboard-sync",ActionApplyjoinWhiteboardNotify:"apply-join-whiteboard-notify",ActionQuitWhiteboard:"quit-whiteboard",ActionQuitWhiteboardAck:"quit-whiteboard-ack",ActionQuitWhiteboardSync:"quit-whiteboard-sync",ActionQuitWhiteboardNotify:"quit-whiteboard-notify",ActionInviteWhiteboard:"invite-whiteboard",ActionInviteWhiteboardAck:"invite-whiteboard-ack",ActionInviteWhiteboardSync:"invite-whiteboard-sync",ActionInviteWhiteboardNotify:"invite-whiteboard-notify",ActionAcceptApplyWhiteboard:"accept-apply-whiteboard",ActionAcceptApplyWhiteboardAck:"accept-apply-whiteboard-ack",ActionAcceptApplyWhiteboardSync:"accept-apply-whiteboard-sync",ActionAcceptApplyWhiteboardNotify:"accept-apply-whiteboard-notify",ActionRejectApplyWhiteboard:"reject-apply-whiteboard",ActionRejectApplyWhiteboardAck:"reject-apply-whiteboard-ack",ActionRejectApplyWhiteboardSync:"reject-apply-whiteboard-sync",ActionRejectApplyWhiteboardNotify:"reject-apply-whiteboard-notify",ActionRejectWhiteboardInvite:"reject-whiteboard-invite",ActionRejectWhiteboardInviteAck:"reject-whiteboard-invite-ack",ActionRejectWhiteboardInviteSync:"reject-whiteboard-invite-sync",ActionRejectWhiteboardInviteNotify:"reject-whiteboard-invite-notify",ActionAcceptWhiteboardInvite:"accept-whiteboard-invite",ActionAcceptWhiteboardInviteAck:"accept-whiteboard-invite-ack",ActionAcceptWhiteboardInviteSync:"accept-whiteboard-invite-sync",ActionAcceptWhiteboardInviteNotify:"accept-whiteboard-invite-notify",ActionRestrainWhiteboard:"restrain-whiteboard",ActionRestrainWhiteboardAck:"restrain-whiteboard-ack",ActionRestrainWhiteboardSync:"restrain-whiteboard-sync",ActionRestrainWhiteboardNotify:"restrain-whiteboard-notify",ActionVgCmdWhiteboard:"vg-cmd-whiteboard",ActionVgCmdWhiteboardAck:"vg-cmd-whiteboard-ack",ActionVgCmdWhiteboardSync:"vg-cmd-whiteboard-sync",ActionVgCmdWhiteboardNotify:"vg-cmd-whiteboard-notify",ActionJoinWhiteboard:"join-whiteboard",ActionJoinWhiteboardAck:"join-whiteboard-ack",ActionJoinWhiteboardSync:"join-whiteboard-sync",ActionJoinWhiteboardNotify:"join-whiteboard-notify",ActionConference:"conference",ActionConferenceAck:"conference-ack",ActionQueryConference:"query-conference",ActionQueryConferenceAck:"query-conference-ack",ActionQueryAllConference:"query-all-conference",ActionQueryAllConferenceAck:"query-all-conference-ack",ActionApplyJoinConference:"apply-join-conference",ActionApplyJoinConferenceAck:"apply-join-conference-ack",ActionApplyJoinConferenceNotify:"apply-join-conference-notify",ActionApplyConference:"apply-conference",ActionApplyConferenceAck:"apply-conference-ack",ActionCloseConference:"close-conference",ActionCloseConferenceAck:"close-conference-ack",ActionRejectConference:"reject-conference",ActionRejectConferenceAck:"reject-conference-ack",ActionInviteConference:"invite-conference",ActionInviteConferenceAck:"invite-conference-ack",ActionTryReInviteConference:"try-reinvite-conference",ActionTryReInviteConferenceAck:"try-reinvite-conference-ack",ActionCreateConference:"create-conference",ActionCreateConferenceAck:"create-conference-ack",ActionCreateConferenceNotify:"create-conference-notify",ActionCreateConferenceSync:"create-conference-sync",ActionDestroyConference:"destroy-conference",ActionDestroyConferenceAck:"destroy-conference-ack",ActionDestroyConferenceNotify:"destroy-conference-notify",ActionDestroyConferenceSync:"destroy-conference-sync",ActionInviteConferenceMember:"invite-conference-member",ActionInviteConferenceMemberAck:"invite-conference-member-ack",ActionInviteConferenceMemberNotify:"invite-conference-member-notify",ActionInviteConferenceMemberSync:"invite-conference-member-sync",ActionRejectConferenceInvite:"reject-conference-invite",ActionRejectConferenceInviteAck:"reject-conference-invite-ack",ActionRejectConferenceInviteNotify:"reject-conference-invite-notify",ActionRejectConferenceInviteSync:"reject-conference-invite-sync",ActionAcceptConferenceInvite:"accept-conference-invite",ActionAcceptConferenceInviteAck:"accept-conference-invite-ack",ActionAcceptConferenceInviteNotify:"accept-conference-invite-notify",ActionAcceptConferenceInviteSync:"accept-conference-invite-sync",ActionConferenceControl:"control-conference",ActionConferenceControlAck:"control-conference-ack",ActionConferenceControlSync:"control-conference-sync",ActionConferenceControlNotify:"control-conference-notify",ActionQuitConference:"quit-conference",ActionQuitConferenceAck:"quit-conference-ack",ActionQuitConferenceNotify:"quit-conference-notify",ActionQuitConferenceSync:"quit-conference-sync",ActionReinviteConference:"reinvite-conference",ActionReinviteConferenceAck:"reinvite-conference-ack",ActionCallConference:"call-conference",ActionCallConferenceAck:"call-conference-ack",ActionRejectApplyConference:"reject-apply-conference",ActionRejectApplyConferenceAck:"reject-apply-conference-ack",ActionRejectApplyConferenceNotify:"reject-apply-conference-notify",ActionAcceptApplyConference:"accept-apply-conference",ActionAcceptApplyConferenceAck:"accept-apply-conference-ack",ActionAcceptApplyConferenceNotify:"accept-apply-conference-notify",ActionAcceptApplyConferenceSync:"accept-apply-conference-sync",ActionJoinConference:"join-conference",ActionJoinConferenceAck:"join-conference-ack",ActionJoinConferenceSync:"join-conference-sync",ActionJoinConferenceNotify:"join-conference-notify",ActionUpdateConference:"update-conference",ActionUpdateConferenceAck:"update-conference-ack",ActionUpdateConferenceSync:"update-conference-sync",ActionUpdateConferenceNotify:"update-conference-notify",ActionAccept:"accept",ActionAcceptAck:"accept-ack",ActionTime:"time",ActionTimeAck:"time-ack",ActionRespond:"respond",ActionRespondAck:"respond-ack",ActionQueryRespond:"query-respond",ActionQueryRespondAck:"query-respond-ack",ActionGo:"go",ActionGoAck:"go-ack",ActionGoNotify:"go-notify",ActionPrepare:"prepare",ActionPrepareAck:"prepare-ack",ActionFeedback:"feedback",ActionFeedbackAck:"feedback-ack",ActionFeedbackNotify:"feedback-notify",ActionLast:"last",ActionLastAck:"last-ack",Unknown:"unknown"}},61:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.ConferenceListener=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"onConferenceFailed",value:function(e,t){}},{key:"onConferenceCreated",value:function(e,t){}},{key:"onConferenceCreatedOther",value:function(e,t){}},{key:"onConferenceDestroyed",value:function(e,t){}},{key:"onConferenceDestroyedOther",value:function(e,t){}},{key:"onConferenceApplied",value:function(e,t){}},{key:"onConferenceRejectApplied",value:function(e,t,n){}},{key:"onConferenceApplyJoined",value:function(e,t,n){}},{key:"onAudioEnable",value:function(e,t){}},{key:"onVideoEnable",value:function(e,t){}},{key:"onConferenceInvited",value:function(e,t,n){}},{key:"onConferenceInvitedOther",value:function(e,t,n){}},{key:"onConferenceAcceptInvited",value:function(e,t,n){}},{key:"onConferenceAcceptInvitedOther",value:function(e,t,n){}},{key:"onConferenceRejectInvited",value:function(e,t,n){}},{key:"onConferenceRejectInvitedOther",value:function(e,t,n){}},{key:"onConferenceJoinFromOthers",value:function(e,t,n){}},{key:"onConferenceUpdated",value:function(e,t){}},{key:"onConferenceQuited",value:function(e,t){}},{key:"onConferenceQuitedOther",value:function(e,t){}},{key:"onConferenceJoined",value:function(e,t){}},{key:"onConferenceJoinedOther",value:function(e,t){}},{key:"onConferenceConnected",value:function(e){}},{key:"onConferenceSipEnd",value:function(e){}},{key:"onConferenceAddStream",value:function(e,t){}},{key:"onConferenceRemoveStream",value:function(e,t){}},{key:"onConferenceCallDisConnected",value:function(){}}]),t}(CubeListener)},62:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConferenceType={UnKnown:"UnKnown",VoiceCall:"voice-call",VideoCall:"video-call",VoiceConference:"voice-conference",VideoConference:"video-conference",VoiceDeskTop:"voice-desktop",ShareScreen:"share-screen",VoiceCiscoConference:"voice-cisco-conference",VideoCiscoConference:"video-cisco-conference"}},97:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.ConferenceConfig=function(e){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:9,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:[];r(this,t);var p=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,a,f,h));return p.isMux=e,p.force=n,p.number=o,p.maxMember=c,p.startTime=l,p.duration=u,p.autoNotify=d,p}return o(t,e),t}(CubeGroupConfig)},98:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConferenceServiceWorker=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(61),u=n(157),d=n(159),f=n(158),h=n(4),p=n(62);t.ConferenceServiceWorker=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.ConferenceListener,CELLET.Conference));return n.callbackMap=new HashMap,n.curConference=null,n.flagTerminated=!1,n.confStatus=0,n.applyJoinCallback=null,n.queryAllCallback=null,n.dialogue=n._getDialogue(),n.handleFailed=n._getHandleFailed(),n.videoEnabled=!1,n.session=null,n.autoVideo=!0,n.custom=null,n}return o(t,e),c(t,[{key:"_getHandleFailed",value:function(){var e=[h.CubeConst.ActionCallConferenceAck],t=[!0];return this._createObj(e,t)}},{key:"_getDialogue",value:function(){var e=[h.CubeConst.ActionConferenceControlNotify,h.CubeConst.ActionConferenceControlAck,h.CubeConst.ActionCreateConferenceAck,h.CubeConst.ActionCreateConferenceNotify,h.CubeConst.ActionCreateConferenceSync,h.CubeConst.ActionDestroyConferenceAck,h.CubeConst.ActionDestroyConferenceNotify,h.CubeConst.ActionDestroyConferenceSync,h.CubeConst.ActionInviteConferenceMemberAck,h.CubeConst.ActionInviteConferenceMemberNotify,h.CubeConst.ActionInviteConferenceMemberSync,h.CubeConst.ActionAcceptConferenceInviteAck,h.CubeConst.ActionAcceptConferenceInviteNotify,h.CubeConst.ActionAcceptConferenceInviteSync,h.CubeConst.ActionRejectConferenceInviteAck,h.CubeConst.ActionRejectConferenceInviteNotify,h.CubeConst.ActionRejectConferenceInviteSync,h.CubeConst.ActionQuitConferenceAck,h.CubeConst.ActionQuitConferenceNotify,h.CubeConst.ActionQuitConferenceSync,h.CubeConst.ActionApplyJoinConferenceNotify,h.CubeConst.ActionRejectApplyConferenceAck,h.CubeConst.ActionRejectApplyConferenceNotify,h.CubeConst.ActionAcceptApplyConferenceAck,h.CubeConst.ActionAcceptApplyConferenceNotify,h.CubeConst.ActionAcceptApplyConferenceSync,h.CubeConst.ActionCallConferenceAck,h.CubeConst.ActionJoinConferenceAck,h.CubeConst.ActionJoinConferenceSync,h.CubeConst.ActionJoinConferenceNotify],t=["_processConferenceControlNotify","_processConferenceControlAck","_processCreateConferenceAck","_processCreateConferenceNotify","_processCreateConferenceSync","_processDestroyConferenceAck","_processDestroyConferenceNotify","_processDestroyConferenceSync","_processInviteConferenceMemberAck","_processInviteConferenceMemberNotify","_processInviteConferenceMemberSync","_processAcceptConferenceInviteAck","_processAcceptConferenceInviteNotify","_processAcceptConferenceInviteSync","_processRejectConferenceInviteAck","_processRejectConferenceInviteNotify","_processRejectConferenceInviteSync","_processQuitConferenceAck","_processQuitConferenceNotify","_processQuitConferenceSync","_processApplyJoinConferenceNotify","_processRejectApplyConferenceAck","_processRejectApplyConferenceNotify","_processAcceptApplyConferenceAck","_processAcceptApplyConferenceNotify","_processAcceptApplyConferenceSync","_processCallConferenceAck","_processJoinConferenceAck","_processJoinConferenceSync","_processJoinConferenceNotify"];return this._createObj(e,t)}},{key:"_createObj",value:function(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r],o=t[r];n[i]=o}return n}},{key:"join",value:function(e,t){if(null==e)return nucleus.getLogger().e("CubeConference#join","conferenceId is null"),!1;null!=t&&(this.custom=t);var n={token:this.engine.accToken,conferenceId:e};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionJoinConference,n)}},{key:"create",value:function(e){if(null==e)return nucleus.getLogger().e("CubeConference#create","conferenceConfig is null"),!1;if(!e instanceof CubeConferenceConfig)return nucleus.getLogger().e("CubeConference#create","conferenceConfig is not CubeConferenceConfig"),!1;e.type==p.ConferenceType.ShareScreen&&(e.isMux=!1),e.type.includes("sfu")&&delete e.isMux;var t={token:this.engine.accToken,conference:e};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionCreateConference,t)}},{key:"destroy",value:function(e){if(null==e)return nucleus.getLogger().e("CubeConference#destory","conferenceId is null"),!1;var t={token:this.engine.accToken,conferenceId:e};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionDestroyConference,t)}},{key:"quit",value:function(e){if(null==e)return nucleus.getLogger().e("CubeConference#quit","conferenceId is null"),!1;var t={token:this.engine.accToken,conferenceId:e};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionQuitConference,t)}},{key:"inviteMembers",value:function(e,t){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#inviteMembers","conferenceId or members is null"),!1;if(!t instanceof Array)return nucleus.getLogger().e("CubeConference#inviteMembers","members is not Array"),!1;var n={token:this.engine.accToken,conferenceId:e,members:t};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionInviteConferenceMember,n)}},{key:"rejectInvite",value:function(e,t){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#rejectInvite","conferenceId or cubeId is null"),!1;var n={token:this.engine.accToken,conferenceId:e,cubeId:t};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionRejectConferenceInvite,n)}},{key:"acceptInvite",value:function(e,t){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#acceptInvite","conferenceId or cubeId is null"),!1;var n={token:this.engine.accToken,conferenceId:e,cubeId:t};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionAcceptConferenceInvite,n)}},{key:"consult",value:function(e,t){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#acceptInvite","conferenceId or operation is null"),!1;var n={conferenceId:e,cubeId:this.engine.accName};for(var r in t)n[r]=t[r];return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionUpdateConference,n)}},{key:"applyMaster",value:function(e,t,n,r,i){var o=this._getHttpUrl("/conference/master"),s={conferenceId:e,tag:window.nucleus.tag,cubeId:t,master:n};NucleusAjax.newRequest(o).method("POST").content(s).send(function(e){var t=JSON.parse(e.data);t.state&&200==t.state.code?"function"==typeof r&&r(t.data):"function"==typeof i&&i(t.errcode,t.errmsg)})}},{key:"setAudioEnabled",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==e)return nucleus.getLogger().e("CubeConference#setAudioEnabled","conferenceId is null"),!1;if(n){var r=function(){t.multimediaJoin(e,!1)};this.utils.hasMedia().then(function(e){var n=a(e,2),i=n[0],o=n[1];if(t.autoVideo=!(!i||!o),!i&&!o)return t.terminateCall(),t.delegate.onConferenceFailed(t.curConference,new CubeError(CubeStateCode.MicphoneOpenFailed,"Join Conference Failed!"));r()})}else this.hangup(),this.delegate.onAudioEnable(e,!1)}},{key:"setVideoEnabled",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==e)return nucleus.getLogger().e("CubeConference#setVideoEnabled","conferenceId is null"),!1;if(n){var r=function(){t.multimediaJoin(e,!0)},i=this.curConference&&this.curConference.type===CubeConferenceType.ShareScreen;this.utils.hasMedia().then(function(e){var n=a(e,2),i=n[0],o=n[1];if(t.autoVideo=!(!i||!o),!i&&!o)return t.terminateCall(),t.delegate.onConferenceFailed(t.curConference,new CubeError(CubeStateCode.MicphoneOpenFailed,"Not Found Media Device!"));r()})}else this.hangup(),this.delegate.onVideoEnable(e,!1)}},{key:"mediaVisible",value:function(e,t,n,r){if(null==e||null==t||null==n)return nucleus.getLogger().e("CubeConference#media","conferenceId,cubeId,video,audio is null"),!1;n?window.cube.getMediaService().openVideo()&&this._sendConferenceControl(e,d.ControlAction.MEDIA,t,r,{videoEnable:n}):window.cube.getMediaService().closeVideo()&&this._sendConferenceControl(e,d.ControlAction.MEDIA,t,r,{videoEnable:n}),r="function"==typeof r?r:function(){}}},{key:"multimediaJoin",value:function(e,t){var n=this;if(this.videoEnabled=t,this.engine.getUtils().hasCamera().then(function(e){n.videoEnabled&&!e&&(n.videoEnabled=e)}),this.confStatus>0){var r={muteObj:{video:!t},unmuteObj:{video:t}};return this._changeVideo(r),void(t?this.delegate.onVideoEnable(this.curConference,!0):this.delegate.onAudioEnable(this.curConference,!0))}return this.confStatus=1,this._queryConference(e)}},{key:"startSip",value:function(e){var t=this;if(this.curConference=e,this.engine.session.setCallPeer(new CubePeer(e.id,e)),this.engine.session.callState=CubeSignalingState.Progress,e.type.includes("video")&&this.utils.hasMedia().then(function(e){var n=a(e,2),r=n[0],i=n[1];if(t.autoVideo=!(!r||!i),!r&&!i)return t.terminateCall(),t.delegate.onConferenceFailed(t.curConference,new CubeError(CubeStateCode.MicphoneOpenFailed,"Not Found Media Device!"))}),e.type.includes("sfu"))this.engine.erizoService.connect(e.status[this.engine.accName].token,[{video:this.videoEnabled,audio:!0,videoSize:[320,240,640,480],attributes:{cubeId:this.engine.accName,conferenceId:e.conferenceId,header:this.custom||{}}}]);else{this.engine.sipService.setAddress(void 0!==e.domain?e.domain:e.host,e.host,e.wsPort,e.wssPort);var n=this.session.name;if(null==e.status[this.session.name])return void this.delegate.onConferenceFailed(e,new CubeError(CubeStateCode.ConferenceNotStatus,"can not find status!"));var r=e.status[this.session.name].sipPassword;this.engine.sipService.registerWith(n,r,this.engine.accDisplayName);var i=e.type===CubeConferenceType.ShareScreen;i&&(this.autoVideo=!0),i&&e.founder!==this.engine.accName&&(this.autoVideo=!1);!function(){if(console.log("进行会议呼叫",t.autoVideo),t.engine.sipService.invite(e.number,t.autoVideo,i))return!0;t.engine.sipService.unregister(),t.delegate.onConferenceFailed(e,new CubeError(CubeStateCode.ConferenceSipInviteFailed,"sip invite Failed!"))}()}}},{key:"terminateCall",value:function(){this.curConference&&this.quit(this.curConference.conferenceId)}},{key:"hangup",value:function(){var e=this;this.confStatus=0,this.custom=null,this.engine.sipService.unregister(function(){e.curConference=null}),this.engine.erizoService.disconnect(function(){e.curConference=null})}},{key:"addPresenter",value:function(e,t,n){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#addPresenter","conferenceId or cubeId is null"),!1;n="function"==typeof n?n:function(){},this._sendConferenceControl(e,d.ControlAction.PRESENTER,t,n,{presenter:!0})}},{key:"removePresenter",value:function(e,t,n){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#removePresenter","conferenceId or cubeId is null"),!1;n="function"==typeof n?n:function(){},this._sendConferenceControl(e,d.ControlAction.PRESENTER,t,n,{presenter:!1})}},{key:"changeSpeaker",value:function(e,t,n){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#changeSpeaker","conferenceId or cubeId is null"),!1;n="function"==typeof n?n:function(){},this._sendConferenceControl(e,d.ControlAction.SPEAKER,t,n)}},{key:"setMemberDeaf",value:function(e,t,n,r){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#setMemberDeaf","conferenceId or cubeId is null"),!1;r="function"==typeof r?r:function(){},n=null==n||n,this._sendConferenceControl(e,d.ControlAction.HEAR,t,r,{deaf:n})}},{key:"setMemberMute",value:function(e,t,n,r){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#setMemberMute","conferenceId or cubeId is null"),!1;r="function"==typeof r?r:function(){},n=null==n||n,this._sendConferenceControl(e,d.ControlAction.MUTE,t,r,{mute:n})}},{key:"kickMember",value:function(e,t,n){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#kickMember","conferenceId or cubeId is null"),!1;n="function"==typeof n?n:function(){},this._sendConferenceControl(e,d.ControlAction.KICK,t,n)}},{key:"getCapturedCameraImages",value:function(e,t,n){var r=[];if(void 0!==n&&n)for(var i=0;i<t.length;i++)r[i]={cube:t[i],name:t[i],url:_CUBE_CONF_CAPTURE_SERVICE+t[i]+"/cube_captured_camera.jpg",thumbUrl:_CUBE_CONF_CAPTURE_SERVICE+t[i]+"/cube_captured_camera_small.jpg"};else{var o=this.utils.isSecure?_CUBE_HTTPS_SERVICE:_CUBE_HTTP_SERVICE;o+="/conference/capture/get?";for(var i=0;i<t.length;i++)r[i]={cube:t[i],name:t[i],url:o+"name="+t[i]+"&small=false",thumbUrl:o+"name="+t[i]+"&small=true"}}return r}},{key:"setMemberWatch",value:function(e,t,n,r){if(null==e||null==t)return nucleus.getLogger().e("CubeConference#setMemberWatch","conferenceId or cubeId is null"),!1;r="function"==typeof r?r:function(){},n=null==n||n,this._sendConferenceControl(e,d.ControlAction.VMUTE,t,r,{vmute:!n})}},{key:"_sendConferenceControl",value:function(e,t,n,r,i){var o=new String(Date.now());void 0!==r&&this.callbackMap.put(o,r);var s={conferenceId:e.toString(),action:t,controlled:n.toString(),timestamp:o,token:this.engine.accToken};for(var a in i)s[a]=i[a];return!!this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionConferenceControl,s)||(this.callbackMap.remove(o),!1)}},{key:"onDialogue",value:function(e,t){if(null!=this.dialogue[e]){nucleus.getLogger().d("ConferenceWorker#onDialogue",this.dialogue[e]);var n=t.getParamAsString("state"),r=t.getParamAsString("data");if(null==n||200==n.code||this.handleFailed[e]){"function"===s(this[this.dialogue[e]])&&(r=null!=r?r:{},this[this.dialogue[e]](r,t))}else{var i=null!=r?r.conference:"";this.delegate.onConferenceFailed(i||this.curConference,new CubeError(n.code,n.desc))}}}},{key:"getLocalView",value:function(){var e=this.engine.sipService.localStream;return window.URL?window.URL.createObjectURL(e):e}},{key:"getRemoteView",value:function(){var e=this.engine.sipService.remoteStream;return window.URL?window.URL.createObjectURL(e):e}},{key:"isConference",value:function(e){return e instanceof f.Conference}},{key:"parse",value:function(e){if(null==e||"object"!=(void 0===e?"undefined":s(e)))return nucleus.getLogger().e("CubeConference#parse","Error of parameters"),!1;var t=new f.Conference;for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t}},{key:"_queryConference",value:function(e){var t={token:this.engine.accToken,conferenceId:e.toString()};this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionCallConference,t)}},{key:"_getHttpUrl",value:function(e){return _CUBE_HTTP_SERVICES+e}},{key:"queryAllConference",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._getHttpUrl("/v3/conference/query"),n={token:this.engine.accToken};NucleusAjax.newRequest(t).method("POST").content(n).send(function(t){var n=JSON.parse(t.data);if(200==n.state.code)return void e(n.data.conferences);e()})}},{key:"queryConferences",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=this._getHttpUrl("/v3/conference/query"),i={token:this.engine.accToken};e[0].indexOf("-")>0?i.conferenceType=JSON.stringify(e):0==e[0].indexOf("g")?i.groupIds=JSON.stringify(e):i.conferenceIds=JSON.stringify(e),NucleusAjax.newRequest(r).method("POST").content(i).send(function(e){var r=JSON.parse(e.data);200==r.state.code?t(r.data.conferences):n()})}},{key:"_changeVideo",value:function(e){this.engine.sipService.rtcSession.mute(e.muteObj),this.engine.sipService.rtcSession.unmute(e.unmuteObj)}},{key:"_processCallConferenceAck",value:function(e,t){var n=t.getParamAsString("state"),r=n.code,i=e.conference,o=null==i?null:i.conferenceId;if(200===r){if(this.flagTerminated)return void this.delegate.didEnd(this,o,"cancel");this.confStatus=2,this.startSip(i)}else this.hangup(),this.delegate.onConferenceFailed(this.curConference,new CubeError(n.code,n.desc))}},{key:"_processConferenceControlNotify",value:function(e,t){var n=t.getParamAsString("data"),r=n.conference.actions[n.conference.actions.length-1],i=r.controlled.cubeId;console.log("会控",r),(null==n.conference||this.curConference&&n.conference.bindGroup==this.curConference.bindGroup)&&(this.curConference=n.conference),r.action==d.ControlAction.KICK&&i&&i===this.engine.accName&&this.hangup(),r.action!=d.ControlAction.VIDEO&&r.action!=d.ControlAction.VOICE||this.curConference&&n.conference.bindGroup==this.curConference.bindGroup&&this.engine.accName==i&&this.hangup(),this.delegate.onConferenceUpdated(n.conference,n.conference.actions)}},{key:"_processConferenceControlAck",value:function(e,t){var n=t.getParamAsString("state"),r=t.getParamAsString("data"),i=r.conference.actions[r.conference.actions.length-1].timestamp;if(200==n.code){var o=this.callbackMap.get(i);null!=o&&(o.call(null,n.code,r.conference,r.cmd),this.callbackMap.remove(i))}else{nucleus.getLogger().w("CubeConferenceUA","Ack state: "+n.code);var s=this.callbackMap.get(i);null!=s&&(s.call(null,n.code,r),this.callbackMap.remove(i))}}},{key:"_processCreateConferenceAck",value:function(e){var t=e.conference,n=e.from;t.isSelf=!0,this.delegate.onConferenceCreated(t,n)}},{key:"_processCreateConferenceNotify",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceCreated(t,n)}},{key:"_processCreateConferenceSync",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceCreatedOther(t,n)}},{key:"_processDestroyConferenceAck",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceDestroyed(t,n)}},{key:"_processDestroyConferenceNotify",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceDestroyed(t,n)}},{key:"_processDestroyConferenceSync",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceDestroyedOther(t,n)}},{key:"_processInviteConferenceMemberAck",value:function(e){var t=e.conference,n=e.members,r=e.from;this.delegate.onConferenceInvited(t,r,n)}},{key:"_processInviteConferenceMemberNotify",value:function(e){var t=e.conference,n=e.members,r=e.from;this.delegate.onConferenceInvited(t,r,n)}},{key:"_processInviteConferenceMemberSync",value:function(e){var t=e.conference,n=e.members,r=e.from;this.delegate.onConferenceInvitedOther(t,r,n)}},{key:"_processAcceptConferenceInviteAck",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceAcceptInvited(t,n,r)}},{key:"_processAcceptConferenceInviteNotify",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceAcceptInvited(t,n,r)}},{key:"_processAcceptConferenceInviteSync",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceAcceptInvitedOther(t,n,r)}},{key:"_processRejectConferenceInviteAck",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceRejectInvited(t,n,r)}},{key:"_processRejectConferenceInviteNotify",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceRejectInvited(t,n,r)}},{key:"_processRejectConferenceInviteSync",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceRejectInvitedOther(t,n,r)}},{key:"_processQuitConferenceAck",value:function(e){var t=e.conference,n=e.from;this.hangup(),this.delegate.onConferenceQuited(t,n)}},{key:"_processQuitConferenceNotify",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceQuited(t,n)}},{key:"_processQuitConferenceSync",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceQuitedOther(t,n)}},{key:"_processApplyJoinConferenceNotify",value:function(e){var t=e.conference,n=e.user;this.delegate.onConferenceApplied(t,n)}},{key:"_processRejectApplyConferenceAck",value:function(e){var t=e.conference,n=e.user;this.delegate.onConferenceApplied(t,null,n)}},{key:"_processRejectApplyConferenceNotify",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceRejectApplied(t,n,r)}},{key:"_processAcceptApplyConferenceAck",value:function(e){var t=e.conference,n=e.user;this.delegate.onConferenceApplyJoined(t,null,n)}},{key:"_processAcceptApplyConferenceNotify",value:function(e){var t=e.conference,n=e.user;this.delegate.onConferenceApplyJoined(t,null,n)}},{key:"_processAcceptApplyConferenceSync",value:function(e){var t=e.conference,n=e.from,r=e.user;this.delegate.onConferenceJoinFromOthers(t,n,r)}},{key:"_processJoinConferenceAck",value:function(e){var t=e.conference,n=e.from;this.curConference=t,t.isSelf=!0,this.delegate.onConferenceJoined(t,n)}},{key:"_processJoinConferenceSync",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceJoinedOther(t,n)}},{key:"_processJoinConferenceNotify",value:function(e){var t=e.conference,n=e.from;this.delegate.onConferenceJoined(t,n)}},{key:"onInCall",value:function(e){var t=this;if(!this.videoEnabled&&this.engine.session.isSipConference()){var n=this.engine.sipService;n.rtcSession.mute({video:!0}),n.attachMediaStream(n.localVideo,n.localStream)}var r=this.videoEnabled?d.ControlAction.VIDEO:d.ControlAction.VOICE,i=function(n,r,i){t.curConference=r,t.videoEnabled?t.delegate.onVideoEnable(r,!0):t.delegate.onAudioEnable(r,!0),e&&e()};this._sendConferenceControl(this.curConference.conferenceId,r,this.engine.accName,i,{video:!!this.videoEnabled})}},{key:"getConference",value:function(){return this.curConference}},{key:"onRegisterStateChanged",value:function(e){if(this.session=e,this.engine.registered){var t={token:this.engine.accToken};return this.engine.connect.send(CELLET.Conference,h.CubeConst.ActionReinviteConference,t)}this.engine.session.callPeer&&"conference"==this.engine.session.callPeer.type&&(this.engine.session.callState=CubeSignalingState.End)}}]),t}(u.ConferenceService)},99:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ErizoServiceWorker=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(160);var o=n(162);t.ErizoServiceWorker=function(){function e(t){r(this,e),this.engine=t,this.utils=t.getUtils(),this.room=null,this.localStreams=[],this.remoteStreams=[],this.domain=null,this.host=null,this.wsPort=5066,this.wssPort=7443,this.localVideo=null,this.remoteVideo=null,this.bellAudio=null,this.localStream=null,this.remoteStream=null,this.regListener=null,this.callListener=null,this.direction=null,this.videoEnabled=!0,this.sip=null,this.rtcSession=null,this.maxVideoSize=null,this.maxFrameRate=15,this.minFrameRate=5,this._checkTerminateTimer=0,this.reconnection=0,this.muteAudio=!1,this.muteVideo=!1}return i(e,[{key:"setAddress",value:function(e,t,n,r){this.domain=e,this.host=t,this.wsPort=void 0!==n?n:5066,this.wssPort=void 0!==r?r:7443}},{key:"connect",value:function(e,t){var n=this;null!=e&&(this.room=Erizo.Room({token:e}),Erizo.Logger.setLogLevel(Erizo.Logger.ERROR),null==this.callListener&&(this.callListener=new o.ErizoCallListener(this.engine)),this.room.connect({singlePC:!1}),this.room.addEventListener("room-connected",function(e){nucleus.getLogger().d("ErizoWorker","room-connected"),n.getParameterByName("simulcast")&&(options.simulcast={numSpatialLayers:2}),n.subscribeToStreams(e.streams),n.publish(t),n.engine.getConferenceService().onInCall(function(){n.callListener.onCallConnected(n.engine.session)})}),this.room.addEventListener("room-disconnected",function(e){n.room=null,nucleus.getLogger().d("ErizoWorker","room-disconnected")}),this.room.addEventListener("room-error",function(e){nucleus.getLogger().d("ErizoWorker","room-error"),n.callListener.onCallFailed(n.engine.session,CubeStateCode.ConnectionFailed)}),this.room.addEventListener("stream-subscribed",function(e){nucleus.getLogger().d("ErizoWorker","stream-subscribed");var t=e.stream;n.remoteStreams.push(t),n.callListener.onCallAddStream(n.engine.session,t),t.muteAudio(n.muteAudio)}),this.room.addEventListener("stream-added",function(e){nucleus.getLogger().d("ErizoWorker","stream-added");var t=[];t.push(e.stream),n.subscribeToStreams(t)}),this.room.addEventListener("stream-removed",function(e){nucleus.getLogger().d("ErizoWorker","stream-removed");var t=e.stream;n.removeStreams(t),n.callListener.onCallRemoveStream(n.engine.session,t)}),this.room.addEventListener("stream-failed",function(){nucleus.getLogger().d("ErizoWorker","stream-failed"),n.callListener.onCallFailed(n.engine.session,CubeStateCode.ConnectionFailed)}))}},{key:"publish",value:function(e){var t=this;for(var n in e)!function(n){"string"==typeof e[n].video&&(e[n].video={deviceId:e[n].video,maxWidth:640,maxHeight:480});var r=Erizo.Stream(e[n]);r.addEventListener("access-accepted",function(){nucleus.getLogger().d("ErizoWorker","stream: access-accepted"),t.localStreams.push(r);var e={metadata:{type:"publisher"},maxVideoBW:3e3};t.room.publish(r,e),t.callListener.onCallAddStream(t.engine.session,r)}),r.addEventListener("access-denied",function(e){console.log("Access to webcam and/or microphone rejected")}),t.onNewSession(r),r.init()}(n)}},{key:"disconnect",value:function(e){var t=this;if(null!=this.room){this.room.addEventListener("room-disconnected",function(n){e&&e(),t.room=null,nucleus.getLogger().d("ErizoWorker","room-disconnected")});try{this.remoteStreams=[],this.localStreams=[],this.room.disconnect()}catch(e){nucleus.getLogger().d("ErizoWorker",e)}}}},{key:"subscribeToStreams",value:function(e){var t=this,n=function(e){console.log("Bandwidth Alert",e.msg,e.bandwidth)};e.forEach(function(e){t.localStreams.length&&t.localStreams[0].getID()===e.getID()||(t.room.subscribe(e,{slideShowMode:!1,metadata:{type:"subscriber"}}),e.addEventListener("bandwidth-alert",n))})}},{key:"removeStreams",value:function(e){for(var t in this.localStreams)this.localStreams[t].getID()==e.getID()&&this.localStreams.splice(t,1);for(var n in this.remoteStreams)this.remoteStreams[n].getID()==e.getID()&&this.remoteStreams.splice(n,1)}},{key:"consult",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.engine.getConferenceService(),i=r.curConference;if(i){var o={},s="open"==t;"video"==e?n?o.videoEnabled=s:this.muteVideo=!s:n?o.canSpeak=s:this.muteAudio=!s;var a={status:o};n&&r.consult(i.conferenceId,a)}}},{key:"getParameterByName",value:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}},{key:"onNewSession",value:function(e){e.addEventListener("access-denied",function(){nucleus.getLogger().d("ErizoWorker","stream: access-denied")}),e.addEventListener("stream-added",function(){nucleus.getLogger().d("ErizoWorker","stream: stream-added")}),e.addEventListener("stream-data",function(){nucleus.getLogger().d("ErizoWorker","stream: stream-data")}),e.addEventListener("stream-attributes-update",function(){nucleus.getLogger().d("ErizoWorker","stream: stream-attributes-update")}),e.addEventListener("stream-failed",function(){nucleus.getLogger().d("ErizoWorker","stream: stream-failed")}),e.addEventListener("stream-ended",function(){nucleus.getLogger().d("ErizoWorker","stream: stream-ended")})}}]),e}()}});
//# sourceMappingURL=cube-sipworker.js.map
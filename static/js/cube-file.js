!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=121)}({1:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.CubeError=function e(t,n){i(this,e),this.code=t,this.message=n}},11:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.FileInfo=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(18);t.FileInfo=function(){function e(t,n,o,r,l,a,u,s,c,f,d){i(this,e),this.fileId=t,this.name=n,this.progress=o,this.size=r,this.type=l,this.md5=a,this.createTime=u,this.parentId=s,this.permission=c,this.url=f,this.expires=d,this.file=null}return r(e,[{key:"getType",value:function(){if(!this.type){var e=this.name.split(".");if(e.length>0){var t=e[e.length-1],n={"":l.FileType.Folder,png:l.FileType.Image,jpeg:l.FileType.Image,jpg:l.FileType.Image,gif:l.FileType.Image,doc:l.FileType.Word,docx:l.FileType.Word,xls:l.FileType.Excel,xlsx:l.FileType.Excel,pdf:l.FileType.Pdf,pptx:l.FileType.Ptt,mp3:l.FileType.Audio,wma:l.FileType.Audio,wav:l.FileType.Audio,avi:l.FileType.Video,rmvb:l.FileType.Video,rm:l.FileType.Video,exe:l.FileType.App,com:l.FileType.App,app:l.FileType.App,rar:l.FileType.Zip,zip:l.FileType.Zip};this.type=null==n[t]?l.FileType.Other:n[t]}}return this.type}}],[{key:"parse",value:function(t){null!=t&&"object"==(void 0===t?"undefined":o(t))||nucleus.getLogger().e("CubeFileInfo#parse","Error of parameters");var n=new e;for(var i in t)n.hasOwnProperty(i)&&(n[i]=t[i]);return n.getType(),n}}]),e}()},12:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileAction={Uploader:"/v3/file/upload",FileList:"/v3/file/list",Mkdir:"/v3/file/mkdir",DeleteFiles:"/v3/file/delete",CopyFile:"/v3/file/copy",MoveFile:"/v3/file/move",RenameFile:"/v3/file/rename",FileInfo:"/v3/file/info",searchFile:"/v3/file/search",CancelFile:"/v3/file/cancel",ResumeFile:"/v3/file/resume",PauseFile:"/v3/file/pause",CreateUploadFile:"/v3/file/createUpload",ProgressFile:"/v3/file/progress"}},121:function(e,t,n){"use strict";var i=n(82),o=n(46),r=n(11),l=n(18),a=n(81),u=n(80);!function(e){e.CubeFileManagerServiceWorker=i.FileManagerServiceWorker,e.CubeFileManagerListener=o.FileManagerListener,e.CubeFileInfo=r.FileInfo,e.CubeFileType=l.FileType,e.CubeFilePermission=a.FilePermission,e.CubeFileStatusListener=u.FileStatusListener}(window)},122:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.FileManagerService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),l(t,[{key:"mkdir",value:function(e,t){}},{key:"deleteFile",value:function(e){}},{key:"rename",value:function(e,t){}},{key:"move",value:function(e,t){}},{key:"copy",value:function(e,t){}},{key:"list",value:function(e,t){}},{key:"queryByName",value:function(e,t){}},{key:"queryById",value:function(e,t){}},{key:"upload",value:function(e,t){}},{key:"pauseUpload",value:function(e,t){}},{key:"resumeUpload",value:function(e,t){}},{key:"cancelUpload",value:function(e){}},{key:"download",value:function(e){}},{key:"pauseDownload",value:function(e){}},{key:"resumeDownload",value:function(e){}},{key:"cancelDownload",value:function(e){}}]),t}(CubeService)},123:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.DBFileManagerService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(124),l=n(11);t.DBFileManagerService=function(){function e(t){i(this,e),this.engine=t,this.dbm=null}return o(e,[{key:"startup",value:function(){this.dbm=new CubeDBManager("CubeFileManagerDataBase"),this.dbm.loadEntity(r.CubeDBFile),this.dbm.connect(function(){})}},{key:"shutdown",value:function(){null!=this.dbm&&this.dbm.disconnect(function(){}),this.dbm=null}},{key:"storageFileInfo",value:function(e){var t=l.FileInfo.parse(e),n=new r.CubeDBFile(t.fileId);n=Object.assign(n,t),this.dbm.setEntity(n,function(e){})}},{key:"queryFileInfoByFileId",value:function(e,t){var n=new r.CubeDBFile(e);this.dbm.getEntity(n,function(e,n){if(e)t(e);else if(null!=n){var i=l.FileInfo.parse(n);t(!1,i)}else t(!1,null)})}}]),e}()},124:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.CubeDBFile=function(e){function t(e,n,r,l,a,u,s,c,f,d,p,y,v){i(this,t);var g=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"CubeDBFile"));return g.fileId=n,g.name=r,g.progress=l,g.size=a,g.type=u,g.md5=s,g.createTime=c,g.parentId=f,g.permission=d,g.url=p,g.expires=y,g.file=v,g}return r(t,e),t}(CubeDBEntity)},18:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileType={Folder:1,Pdf:2,Word:3,Excel:4,Ptt:5,Image:11,Office:12,Video:13,Audio:14,App:15,Zip:16,Whiteboard:20,File:99,Other:100}},46:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.FileManagerListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),l(t,[{key:"onFileAdded",value:function(e,t){}},{key:"onFileDeleted",value:function(e,t){}},{key:"onFileRenamed",value:function(e,t){}},{key:"onFileMoved",value:function(e,t){}},{key:"onFileUploading",value:function(e,t,n){}},{key:"onFilePaused",value:function(e,t,n){}},{key:"onFileStart",value:function(e){}},{key:"onFileResumed",value:function(e,t,n){}},{key:"onFileUploadCompleted",value:function(e){}},{key:"onDownloading",value:function(e,t,n){}},{key:"onDownloadCompleted",value:function(e){}},{key:"onFileManagerFailed",value:function(e,t){}}]),t}(CubeListener)},80:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.FileStatusListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),l(t,[{key:"onStarted",value:function(e){}},{key:"onProgress",value:function(e,t,n){}},{key:"onCompleted",value:function(e){}},{key:"onCanceled",value:function(e){}},{key:"onPause",value:function(e){}},{key:"onFail",value:function(e){}}]),t}(CubeListener)},81:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilePermission={READ:1,NEW_FILE:2,NEW_FOLDER:4,MOVE:8,RENAME:16,DELETE:32,DOWNLOAD:64,SHARE:128}},82:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.FileManagerServiceWorker=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(46),u=n(123),s=n(122),c=n(12),f=n(11),d=n(1);t.FileManagerServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.FileManagerListener));return n.queryHttp=e.utils.isSecure?_CUBE_HTTPS_STORAGE_SERVICE:_CUBE_HTTP_STORAGE_SERVICE,n.createHttp=e.utils.isSecure?_CUBE_HTTPS_FILE_SERVICE:_CUBE_HTTP_FILE_SERVICE,n.session=null,n.server=new CubeRequest(n.queryHttp),n.uploadProcessFiles=new HashMap,n.dbService=new u.DBFileManagerService(e),n}return r(t,e),l(t,[{key:"mkdir",value:function(e,t){var n=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#mkdir","dir is null"),!1;var i={name:e,parentId:t,token:this.engine.accToken};this._sendPostHttp(c.FileAction.Mkdir,i,function(e,i){var o=i.data.fileInfo,r=f.FileInfo.parse(o);n.dbService.storageFileInfo(r),null==t?n.delegate.onFileAdded(r,null):n.queryById(t,function(e){var t=e.data,i=f.FileInfo.parse(t);n.delegate.onFileAdded(r,i)})})}},{key:"deleteFile",value:function(e){var t=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#deleteFile","fileId is null"),!1;var n=void 0;n=!e instanceof Array?[e]:e,n=JSON.stringify(n);var i={fileIds:n,token:this.engine.accToken};this._sendPostHttp(c.FileAction.DeleteFiles,i,function(e,n){var i=n.data.fileInfos,o=[],r=!0,l=!1,a=void 0;try{for(var u,s=i[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var c=u.value;o.push(f.FileInfo.parse(c))}}catch(e){l=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(l)throw a}}t.delegate.onFileDeleted(o,null)})}},{key:"upload",value:function(e,t){var n=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#upload","file is null"),!1;var i={token:this.engine.accToken,name:e.name,parentId:t,permission:e.permission,md5:e.md5,size:e.size};this._sendPostHttp(c.FileAction.CreateUploadFile,i,function(t,i){var o=n,r=i.data.fileInfo;r.file=e.file;var l=r.secondUpload?new Blob:e.file.slice(0,e.file.size);l.name=r.name;var a={token:n.engine.accToken,fileId:r.fileId};n.uploadProcessFiles.put(r.fileId,{file:r,completed:!1,paused:!1,cancel:!1}),o.delegate.onFileStart(r),o.dbService.storageFileInfo(r),o._progressTask(r),o._fileUpload(l,a)},this.createHttp)}},{key:"rename",value:function(e,t){var n=this;if(null==e||null==t)return nucleus.getLogger().e("CubeFileManager#rename","fileId or newName is null"),!1;var i={fileId:e,name:t,token:this.engine.accToken};this._sendPostHttp(c.FileAction.RenameFile,i,function(t,i){var o=i.data.fileInfo,r=f.FileInfo.parse(o);n.dbService.storageFileInfo(r),n.queryById(e,function(e){n.delegate.onFileRenamed(e[0],r)})})}},{key:"move",value:function(e,t){var n=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#move","fileId is null"),!1;var i={fileIds:this._toIds(e),parentId:t,token:this.engine.accToken};this._sendPostHttp(c.FileAction.MoveFile,i,function(e,t){var i=t.data.fileInfo,o=f.FileInfo.parse(i);null==o.parentId?n.delegate.onFileMoved(o,null):n.queryById(o.parentId,function(e){var t=e.data,i=f.FileInfo.parse(t);n.delegate.onFileMoved(o,i)})})}},{key:"copy",value:function(e,t){var n=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#copy","fileId is null"),!1;var i={fileIds:this._toIds(e),parentId:t,token:this.engine.accToken};this._sendPostHttp(c.FileAction.CopyFile,i,function(e,t){var i=t.data.fileInfo,o=f.FileInfo.parse(i);n.dbService.storageFileInfo(newFile),null==o.parentId?n.delegate.onFileAdded(o,null):n.queryById(o.parentId,function(e){var t=e.data,i=f.FileInfo.parse(t);n.delegate.onFileAdded(o,i)})})}},{key:"list",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i={token:this.engine.accToken,parentId:e};this._sendPostHttp(c.FileAction.FileList,i,function(e,i){var o=i.data.fileInfos;if(null!=o)for(var r=0;r<o.length;r++){var l=o[r];o[r]=f.FileInfo.parse(l),t.dbService.storageFileInfo(o[r])}n(o)})}},{key:"queryByName",value:function(e,t){var n=this;if(null==fileId)return nucleus.getLogger().e("CubeFileManager#copy","fileId is null"),!1;var i={keyword:e,token:this.engine.accToken,offset:0,limit:10};this._sendPostHttp(c.FileAction.FileList,i,function(e,i){if(e)return nucleus.getLogger().w("FileManagerService#queryByName","queryByName failed! error code is "+e.status),!1;if(200==i.state){var o=i.data.fileInfos;if(null!=o)for(var r=0;r<o.length;r++){var l=o[r];o[r]=f.FileInfo.parse(l),n.dbService.storageFileInfo(o[r])}t(o)}else nucleus.getLogger().w("FileManagerService#list","queryByName failed! error code is "+i.state)})}},{key:"queryById",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(null==e)return nucleus.getLogger().e("CubeFileManager#queryById","fileId is null"),!1;var i={fileIds:this._toIds(e),token:this.engine.accToken};this._sendPostHttp(c.FileAction.FileInfo,i,function(e,i){var o=i.data.fileInfos,r=[],l=void 0,a=!0,u=!1,s=void 0;try{for(var c,d=o[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var p=c.value;l=f.FileInfo.parse(p),r.push(l),t.dbService.storageFileInfo(l)}}catch(e){u=!0,s=e}finally{try{!a&&d.return&&d.return()}finally{if(u)throw s}}n(r,!1)})}},{key:"pauseUpload",value:function(e,t){if(null==e)return nucleus.getLogger().e("CubeFileManager#pauseUpload","file is null"),!1;var n=this.uploadProcessFiles.get(e.fileId);if(null==n||n.paused)return!1;n.paused=!0;var i={fileId:e.fileId,token:this.engine.accToken};this._sendPostHttp(c.FileAction.PauseFile,i,function(e,t){(e||200!=t.state.code)&&(n.paused=!1)},this.createHttp)}},{key:"resumeUpload",value:function(e,t){if(null==e)return nucleus.getLogger().e("CubeFileManager#resumeUpload","file is null"),!1;var n=this.uploadProcessFiles.get(e.fileId);n.paused=!1;var i=n.file,o=i.file.slice(i.progress,i.size);o.name=i.name;var r={fileId:e.fileId,token:this.engine.accToken};this._progressTask(i),this.delegate.onFileResumed(i,i.progress,i.size),this._fileUpload(o,r)}},{key:"_fileUpload",value:function(e,t){var n=this,i=this;i._sendFile(c.FileAction.Uploader,{name:"file",value:e},t,function(e,t){if(e)n.delegate.onFileManagerFailed(null,i._getCubeError(t.state));else if(200!=t.state.code){var o=null==t.data?null:t.data.fileInfo;n.delegate.onFileManagerFailed(o,i._getCubeError(t.state))}else{var r=t.data.fileInfo;if(r.size==r.progress)n.uploadProcessFiles.remove(r.fileId),i.delegate.onFileUploadCompleted(r);else{var l=n.uploadProcessFiles.get(r.fileId);l.file.progress=r.progress,n.delegate.onFilePaused(r,r.progress,r.size)}}},this.createHttp)}},{key:"cancelUpload",value:function(e){var t=this;if(null==e)return nucleus.getLogger().e("CubeFileManager#cancelUpload","fileId is null"),!1;var n=this.uploadProcessFiles.get(e);if(null!=n&&null!=n.xhr&&(n.xhr.abort(),n.xhr.onreadystatechange=function(){console.log("取消请求"),console.log(n.xhr.readyState)}),null==n||n.cancel)return!1;n.cancel=!0;var i={fileId:e,token:this.engine.accToken};this._sendPostHttp(c.FileAction.CancelFile,i,function(e,i){if(e||200!=i.state.code)n.cancel=!1;else{console.log("取消成功");var o=i.data.fileInfo;t.uploadProcessFiles.remove(o.fileId)}},this.createHttp)}},{key:"download",value:function(e){if(null==e)return nucleus.getLogger().e("CubeFileManager#download","fileId is null"),!1;var t=this;this.queryById(e,function(e){console.log("下载的文件",e),t._download(e[0])})}},{key:"_download",value:function(e){var t=e.url;if(null==t)return!1;var n=document.createElement("a");if(n.setAttribute("download",e.name),n.setAttribute("href",t),n.setAttribute("target","_blank"),n.style.display="none",document.body.appendChild(n),n.click)n.click();else{var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),n.dispatchEvent(i)}document.body.removeChild(n)}},{key:"_sendPostHttp",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.queryHttp,o=this,r={};for(var l in t)null!=t[l]&&(r[l]=t[l]);NucleusAjax.newRequest(i+e).method("POST").content(r).send(function(e){o._httpCallBack(e,n)})}},{key:"_httpCallBack",value:function(e,t){var n=this,i=e.getStatus(),o=void 0;try{o=JSON.parse(e.getData())}catch(t){o=e.getData()}if(200===i)if(200==o.state.code)t(!1,o);else{var r=null==o.data?null:o.data.fileInfo;this.delegate.onFileManagerFailed(r,n._getCubeError(o.state))}else this.delegate.onFileManagerFailed(null,i)}},{key:"_getCubeError",value:function(e){return this.uploadProcessFiles.clear(),new d.CubeError(e.code,e.desc)}},{key:"onRegisterStateChanged",value:function(e){this.session=e,this.engine.registered?(this.queryHttp=this.engine.utils.isSecure?_CUBE_HTTPS_FILE_SERVICE:_CUBE_HTTP_FILE_SERVICE,this.createHttp=this.engine.utils.isSecure?_CUBE_HTTPS_STORAGE_SERVICE:_CUBE_HTTP_STORAGE_SERVICE,this.server=new CubeRequest(_CUBE_SERVICE),this.dbService.startup()):(this.server=null,this.dbService.shutdown())}},{key:"_toIds",value:function(e){var t=void 0;return t=e instanceof Array?e:[e],t=JSON.stringify(t)}},{key:"_sendFile",value:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.queryHttp;if(window.FormData){var r=new FormData;for(var l in n)r.append(l,n[l]);if(t.value instanceof HTMLElement){var a=t.value.files[0];r.append(t.name,a,a.name)}else t.value instanceof Blob&&r.append(t.name,t.value,t.value.name);var u=new XMLHttpRequest;this.uploadProcessFiles.get(n.fileId).xhr=u,u.open("post",o+e,!0),u.onload=function(){if(200===u.status){var e=void 0;try{e=JSON.parse(u.responseText)}catch(t){e=u.responseText}i(!1,e)}else i({status:u.status})},u.send(r)}}},{key:"_progressTask",value:function(e){var t=this,n=this,i=function i(){var o=t.uploadProcessFiles.get(e.fileId);if(null!=o&&!o.completed&&!o.paused){setTimeout(function(){i(e)},500);var r={token:t.engine.accToken,fileId:e.fileId};n._sendPostHttp(c.FileAction.ProgressFile,r,function(e,t){var i=t.data.fileInfo;n.delegate.onFileUploading(i,i.progress,i.size)},t.createHttp)}};setTimeout(function(){i()},200)}}]),t}(s.FileManagerService)}});
//# sourceMappingURL=cube-file.js.map
!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=142)}({10:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.User=function(){function e(t){for(var n=arguments.length,i=Array(n>3?n-3:0),c=3;c<n;c++)i[c-3]=arguments[c];var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";o(this,e),this.cubeId=t,this.displayName=s,this.avatar=a,this.name=t,"object"==r(arguments[0])&&this.set(arguments[0])}return i(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)?this[t]=e[t]:delete this[t]}}]),e}()},142:function(e,t,n){"use strict";var o=n(87),r=n(54),i=n(55),c=n(56);!function(e){e.CubeShareDesktopMember=c.ShareDesktopMember,e.CubeShareDesktopConfig=i.ShareDesktopConfig,e.CubeShareDesktopServiceWorker=o.ShareDesktopServiceWorker,e.CubeShareDesktopListener=r.ShareDesktopListener}(window)},143:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.ShareDesktopService=function(e){function t(){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),c(t,[{key:"create",value:function(e){}},{key:"join",value:function(e){}},{key:"invite",value:function(e,t){}},{key:"acceptInvite",value:function(e,t){}},{key:"rejectInvite",value:function(e,t){}},{key:"destroy",value:function(e){}},{key:"quit",value:function(e){}},{key:"queryRemoteDesktop",value:function(e,t){}},{key:"syncShareDesktop",value:function(e,t){}}]),t}(CubeService)},144:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ShareDesktop=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n(15),t.ShareDesktop=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,CubeGroupType.SHARE_WB,e));return i.bindGroupId=n,i.host=null,i.sharePort=null,i.receivePort=null,i.desktopId=null,"object"==c(arguments[0])&&i.set(arguments[0]),i}return i(t,e),t}(CubeGroup)},145:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Action={Create:"create",CreateAck:"create-Ack",Invite:"invite",Share:"share",ShareAck:"share-ack",Apply:"apply",ApplyAck:"apply-ack",RevokeShare:"revoke-share",RevokeShareAck:"revoke-share-ack",Leave:"leave",LeaveAck:"leave-ack",Destroy:"destroy",DestroyAck:"destroy-ack",queryDesktop:"query-desktop",queryDesktopAck:"query-desktop-ack",CreateSD:"create-sd",CreateSDAck:"create-sd-ack",CreateSDSync:"create-sd-sync",CreateSDNotify:"create-sd-notify",InviteSD:"invite-sd",InviteSDAck:"invite-sd-ack",InviteSDSync:"invite-sd-sync",InviteSDNotify:"invite-sd-notify",DestroySD:"destroy-sd",DestroySDAck:"destroy-sd-ack",DestroySDSync:"destroy-sd-sync",DestroySDNotify:"destroy-sd-notify",QuitSD:"quit-sd",QuitSDAck:"quit-sd-ack",QuitSDSync:"quit-sd-sync",QuitSDNotify:"quit-sd-notify",AcceptInviteSD:"accept-sd-invite",AcceptInviteSDAck:"accept-sd-invite-ack",AcceptInviteSDSync:"accept-sd-invite-sync",AcceptInviteSDNotify:"accept-sd-invite-notify",RejectSDInvite:"reject-sd-invite",RejectSDInviteAck:"reject-sd-invite-ack",RejectSDInviteSync:"reject-sd-invite-sync",RejectSDInviteNotify:"reject-sd-invite-notify",JoinSD:"join-sd",JoinSDAck:"join-sd-ack",JoinSDSync:"join-sd-sync",JoinSDNotify:"join-sd-notify",AcceptJoinSD:"accept-join-sd",AcceptJoinSDAck:"accept-join-sd-ack",AcceptJoinSDSync:"accept-join-sd-sync",AcceptJoinSDNotify:"accept-join-sd-notify",RejectJoinSD:"reject-join-sd",RejectJoinSDAck:"reject-join-sd-ack",RejectJoinSDSync:"reject-join-sd-sync",RejectJoinSDNotify:"reject-join-sd-notify"}},15:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.GroupConfig=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];o(this,e),this.type=t,this.displayName=n,this.expired=0,this.maxNumber=0,this.bindGroupId="",this.isOpen=!0,this.masters=c,this.members=i,this.invites=[],"object"==r(arguments.length<=4?void 0:arguments[4])&&this.set(arguments.length<=4?void 0:arguments[4])}return i(e,[{key:"set",value:function(e){for(var t in this)this.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(this[t]=e[t])}}]),e}()},16:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Member=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(10);n(17),t.Member=function(e){function t(e,n){for(var i=arguments.length,s=Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];o(this,t);var u=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.cubeId=e,u.remarkName="",u.role=n,u.joinTime=0,u.inviteTime=0,"object"==c(arguments[0])&&u.set(arguments[0]),u}return i(t,e),t}(s.User)},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MemberRole={OWNER:"owner",MASTER:"master",MEMBER:"member",GUEST:"guest"}},54:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.ShareDesktopListener=function(e){function t(){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),c(t,[{key:"onShareDesktopCreated",value:function(e,t){}},{key:"onShareDesktopConnectShare",value:function(e,t){}},{key:"onShareDesktopJoined",value:function(e,t){}},{key:"onShareDesktopDestroyed",value:function(e,t){}},{key:"onShareDesktopQuitd",value:function(e,t){}},{key:"onShareDesktopInvited",value:function(e,t){}},{key:"onShareDesktopInviteJoined",value:function(e,t,n){}},{key:"onShareDesktopRejectInvited",value:function(e,t,n){}},{key:"onShareDesktopFailed",value:function(e){}}]),t}(CubeListener)},55:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ShareDesktopConfig=void 0;var c=n(15);t.ShareDesktopConfig=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,CubeGroupType.SHARE_WB,e));return i.bindGroupId=n,i}return i(t,e),t}(c.GroupConfig)},56:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ShareDesktopMember=void 0;var c=n(16);t.ShareDesktopMember=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),t}(c.Member)},87:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ShareDesktopServiceWorker=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(143),a=n(54),u=n(145),l=(n(56),n(55),n(144));t.ShareDesktopServiceWorker=function(e){function t(e,n,i){o(this,t);var c=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.ShareDesktopListener,CELLET.ShareDesktop));return c.msgCache=new HashMap,c.rdWorker=n,c.shareMachine=null,c.clientMachine=null,c.viewDom=i,c.timeout=1e4,c.lastShareWithTime=0,c.currentRdId=null,c.peers=null,c.sharer=null,c.lastScreenInfo={},c.sharerViewUpdate=!0,c}return i(t,e),c(t,[{key:"create",value:function(e){var t={sd:{name:e.displayName},token:this.engine.accToken};e.bindGroupId&&(t.sd.bindGroupId=e.bindGroupId),this.engine.connect.send(CELLET.ShareDesktop,u.Action.CreateSD,t)}},{key:"join",value:function(e){var t={desktopId:e,token:this.engine.accToken};this.engine.connect.send(CELLET.ShareDesktop,u.Action.JoinSD,t)}},{key:"quit",value:function(e){if(null!=this.clientMachine){var t={desktopId:e,token:this.engine.accToken};this.clientMachine.stop(),this.clientMachine=null,this.engine.connect.send(CELLET.ShareDesktop,u.Action.QuitSD,t)}}},{key:"destroy",value:function(e){if(null!=this.shareMachine){var t={desktopId:e,token:this.engine.accToken};this.shareMachine.stop(),this.shareMachine=null,this.engine.connect.send(CELLET.ShareDesktop,u.Action.DestroySD,t)}}},{key:"invite",value:function(e,t){var n={desktopId:e,members:t,token:this.engine.accToken};this.engine.connect.send(CELLET.ShareDesktop,u.Action.InviteSD,n)}},{key:"acceptInvite",value:function(e,t){var n={desktopId:e,cubeId:t,token:this.engine.accToken};this.engine.connect.send(CELLET.ShareDesktop,u.Action.AcceptInviteSD,n)}},{key:"rejectInvite",value:function(e,t){var n={desktopId:e,cubeId:t,token:this.engine.accToken};this.engine.connect.send(CELLET.ShareDesktop,u.Action.RejectSDInvite,n)}},{key:"queryShareDesktop",value:function(e,t){var n=this.utils.isSecure?"https":"http",o=(e.length,n+"://"+_CUBE_DOMAIN+":"+_CUBE_PORT+"/v3/sd"),r={desktopIds:e,token:this.engine.accToken};NucleusAjax.newRequest(o).method("POST").content(r).send(function(e){var n=JSON.parse(e.data);200==n.state.code&&t(n.data.sds)})}},{key:"syncShareDesktop",value:function(e,t){var n=this.utils.isSecure?"https":"http",o=n+"://"+_CUBE_DOMAIN+":"+_CUBE_PORT+"/v3/users/100001/sd",r={cubeId:this.engine.accName,offset:e,limit:t,token:this.engine.accToken};Ajax.newRequest(o).method("POST").content(r).send(function(e){var t=JSON.parse(e.data);200==t.state.code&&callback(t.data)})}},{key:"_updateView",value:function(e,t,n,o,r){var i=document.getElementById("__cube_remote_desktop_canvas"),c=1920/(r+1),s=1080/(o+1),a=null;null===i&&(i=document.createElement("canvas"),i.id="__cube_remote_desktop_canvas",i.width=1920,i.height=1080,i=this.viewDom.appendChild(i)),null===a&&(a=i.getContext("2d"));var u=new ImageData(new Uint8ClampedArray(e,0,e.length),c,s);a.putImageData(u,n*c,t*s)}},{key:"_processDestroy",value:function(e,t){this.currentRdId===e.desktopId&&(null!=this.shareMachine&&(this.shareMachine.stop(),this.clientMachine=null),null!=this.clientMachine&&(this.clientMachine.stop(),this.clientMachine=null),this.currentRdId=null),this.delegate.onShareDesktopDestroyed(e,t)}},{key:"_processActionJoinSDAck",value:function(e){var t=this;e.owner==this.engine.accName?(this.currentRdId=e.desktopId,this.lastScreenInfo={},this.shareMachine=this.rdWorker.createSharer(e.host+":"+e.sharePort,e.desktopId+"",this.engine.accName),this.shareMachine.on("bitmap",function(e,n,o,r,i){t.sharerViewUpdate&&t._updateView(e,n,o,r,i)}),this.shareMachine.start()):this._processApply(e),this.delegate.onShareDesktopJoined(e,new CubeGroupMember(this.engine.accName))}},{key:"_processApply",value:function(e){var t=this;this.lastScreenInfo={},this.clientMachine=this.rdWorker.createClient(e.host+":"+e.receivePort,e.desktopId+""),this.sharer=e.sharer;var n=this;this.clientMachine.on("connect",function(){n.delegate.onShareDesktopConnectShare(e)}),this.clientMachine.on("bitmap",function(e,n,o,r,i){t._updateView(e,n,o,r,i)}),this.clientMachine.on("cursor",function(e,t){var o=document.getElementById("__cube_remote_desktop_cursor");null===o&&(o=document.createElement("img"),o.id="__cube_remote_desktop_cursor",o.style.display="block",o.style.position="absolute",o.style.transition="left .3s, top .3s",o.style.width="15px",o.src=n.engine.resourcePath+"/rd/cursor.png",n.viewDom.appendChild(o)),o.style.left=e+"px",o.style.top=t+"px"}),this.clientMachine.on("close",function(){}),this.clientMachine.start()}},{key:"_processActionQuitSDAck",value:function(e,t){this.shareMachine&&this.shareMachine.stop(),this.delegate.onShareDesktopQuitd(e,t)}},{key:"onRegisterStateChanged",value:function(e){null!=this.shareMachine&&(this.shareMachine.stop(),this.clientMachine=null),null!=this.clientMachine&&(this.clientMachine.stop(),this.clientMachine=null),this.currentRdId=null}},{key:"onDialogue",value:function(e,t){var n=t.getParamAsString("state"),o=t.getParamAsString("data"),r=new l.ShareDesktop(o.sd);if(o.sd.config)for(var i in o.sd.config)r[i]=o.sd.config[i];var c=new CubeUser(o.from?o.from:o.user?this.engine.accName:"");if(n.code&&200!=n.code)return void this.delegate.onShareDesktopFailed(new CubeError(n.code,n.desc),this);switch(e.indexOf("ack")>-1&&(r.isSelf=!0),e){case u.Action.CreateSDAck:case u.Action.CreateSDSync:case u.Action.CreateSDNotify:this.delegate.onShareDesktopCreated(r,c);break;case u.Action.InviteSDAck:case u.Action.InviteSDSync:case u.Action.InviteSDNotify:this.delegate.onShareDesktopInvited(r,c,o.members);break;case u.Action.JoinSDAck:this._processActionJoinSDAck(r);break;case u.Action.JoinSDSync:case u.Action.JoinSDNotify:this.delegate.onShareDesktopJoined(r,c);break;case u.Action.DestroySDAck:case u.Action.DestroySDSync:case u.Action.DestroySDNotify:this._processDestroy(r,c);break;case u.Action.QuitSDAck:this._processActionQuitSDAck(r,c);break;case u.Action.QuitSDSync:case u.Action.QuitSDNotify:this.delegate.onShareDesktopQuitd(r,c);break;case u.Action.AcceptInviteSDAck:case u.Action.AcceptInviteSDSync:case u.Action.AcceptInviteSDNotify:this.delegate.onShareDesktopInviteJoined(r,c);break;case u.Action.RejectSDInviteAck:case u.Action.RejectSDInviteSync:case u.Action.RejectSDInviteNotify:this.delegate.onShareDesktopRejectInvited(r,c)}}}]),t}(s.ShareDesktopService)}});
//# sourceMappingURL=cube-rd.js.map
!function(e){function t(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=151)}({151:function(e,t,i){"use strict";var o=i(89),r=i(59),n=i(58);!function(e){e.CubeAdvancedRecorder=o.CubeAdvancedRecorder,e.CubeRecorder=r.CubeRecorder,e.bytesToSize=n.bytesToSize}(window)},58:function(e,t,i){"use strict";function o(e,t){function i(){t.disableLogs||console.debug("started recording "+t.type+" stream.");m?window.StereoRecorder:window.MediaStreamRecorder;return"video"===t.type&&m&&window.WhammyRecorder,"gif"===t.type&&window.GifRecorder,"canvas"===t.type&&window.CanvasRecorder,t.recorderType&&t.recorderType,l=new u(e),l=n(l,t),l.onAudioProcessStarted=function(){t.onAudioProcessStarted&&t.onAudioProcessStarted()},l.onGifPreview=function(e){t.onGifPreview&&t.onGifPreview(e)},l.record(),h}function r(e){function i(){for(var i in l)h&&(h[i]=l[i]),o&&(o[i]=l[i]);var r=l.blob;if(e){var n=URL.createObjectURL(r);e(n)}r&&!t.disableLogs&&console.debug(r.type,"->",s(r.size)),t.autoWriteToDisk&&c(function(e){var i={};i[t.type+"Blob"]=e,p.Store(i)})}if(!l)return console.warn(f);var o=this;t.disableLogs||console.warn("Stopped recording "+t.type+" stream."),"gif"!==t.type?l.stop(i):(l.stop(),i())}function a(){if(!l)return console.warn(f);l.pause?l.pause():t.disableLogs||console.warn('This recording library is having no "pause" method.')}function d(){if(!l)return console.warn(f);l.resume?l.resume():t.disableLogs||console.warn('This recording library is having no "resume" method.')}function c(e,i){if(!e)throw"Pass a callback function over getDataURL.";var o=i?i.blob:l.blob;if(!o)return t.disableLogs||console.warn("Blob encoder did not yet finished its job."),void setTimeout(function(){c(e,i)},1e3);if(window.Worker){var r=function(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {readFile(e.data);}"],{type:"application/javascript"})),i=new Worker(t);return URL.revokeObjectURL(t),i}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});r.onmessage=function(t){e(t.data)},r.postMessage(o)}else{var n=new FileReader;n.readAsDataURL(o),n.onload=function(t){e(t.target.result)}}}if(t=t||{},!e)throw"MediaStream is mandatory.";t.type||(t.type="audio");var l,h=this,f='It seems that "startRecording" is not invoked for '+t.type+" recorder.",g={startRecording:i,stopRecording:r,pauseRecording:a,resumeRecording:d,getBlob:function(){return l?l.blob:console.warn(f)},getDataURL:c,toURL:function(){return l?URL.createObjectURL(l.blob):console.warn(f)},save:function(e){if(!l){var t=this;return setTimeout(function(){t.save(e)},2e3),console.warn(f)}var i=document.createElement("a");i.href=URL.createObjectURL(l.blob),i.target="_blank",i.download=(e||Math.round(9999999999*Math.random())+888888888)+"."+l.blob.type.split("/")[1];var o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(o),(window.URL||window.webkitURL).revokeObjectURL(i.href)},getFromDisk:function(e){if(!l)return console.warn(f);o.getFromDisk(t.type,e)},setAdvertisementArray:function(e){this.advertisement=[];for(var t=e.length,i=0;i<t;i++)this.advertisement.push({duration:i,image:e[i]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return g;for(var v in g)this[v]=g[v];return g}/**
 * MRecordRTC runs top over {@link RecordRTC} to bring multiple recordings in single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://www.webrtc-experiment.com/licence/|MIT}
 * @author {@link https://www.MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true,
 *     video: true,
 *     gif: true
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 */
function r(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){!m&&e&&e.getAudioTracks&&e.getAudioTracks().length&&e.getVideoTracks().length&&(this.mediaType.audio=!1),this.mediaType.audio&&(this.audioRecorder=new o(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate}),this.audioRecorder.startRecording()),this.mediaType.video&&(this.videoRecorder=new o(e,{type:"video",video:this.video,canvas:this.canvas}),this.videoRecorder.startRecording()),this.mediaType.gif&&(this.gifRecorder=new o(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.getBlob=function(e){var t={};this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t)},this.getDataURL=function(e){function t(e,t){if(window.Worker){var o=i(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});o.onmessage=function(e){t(e.data)},o.postMessage(e)}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}}function i(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {readFile(e.data);}"],{type:"application/javascript"})),i=new Worker(t);return URL.revokeObjectURL(t),i}this.getBlob(function(i){t(i.audio,function(o){t(i.video,function(t){e({audio:o,video:t})})})})},this.writeToDisk=function(){o.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}function n(e,t){t=a(t);for(var i in t)"function"!=typeof t[i]&&(e[i]=t[i]);return e}function a(e){var t={};for(var i in e)if(-1!==i.indexOf("-")){var o=i.split("-"),r=o[0]+o[1].split("")[0].toUpperCase()+o[1].substr(1);t[r]=e[i]}else t[i]=e[i];return t}function s(e){var t=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 Bytes";var i=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,i)).toPrecision(3)+" "+t[i]}function d(e){var t=this;if(t.mimeType&&"video/webm"!==t.mimeType&&e.getVideoTracks&&e.getVideoTracks().length){var i=new AudioContext,o=i.createMediaStreamSource(e),r=i.createMediaStreamDestination();o.connect(r),e=r.stream}var n=!1;this.record=function(){a=new window.MediaRecorder(e),a.ondataavailable=function(e){if(!n){if(!e.data.size)return void(t.disableLogs||console.warn("Recording of",e.data.type,"failed."));n=!0,t.blob=new Blob([e.data],{type:e.data.type||t.mimeType||"audio/ogg"}),t.callback&&t.callback()}},a.onerror=function(e){t.disableLogs||console.warn(e),a.stop(),t.record(0)},a.start(0),t.onAudioProcessStarted&&t.onAudioProcessStarted()},this.stop=function(e){a&&(this.callback=e,"recording"===a.state&&a.stop())},this.pause=function(){a&&"recording"===a.state&&(a.pause(),this.disableLogs||console.debug("Paused recording."))},this.resume=function(){a&&"paused"===a.state&&(a.resume(),this.disableLogs||console.debug("Resumed recording."))};var a}function u(e){var t=this;this.record=function(){i=new c(e,this),i.onAudioProcessStarted=function(){t.onAudioProcessStarted&&t.onAudioProcessStarted()},i.record()},this.stop=function(e){i&&i.stop(function(){for(var o in i)t[o]=i[o];e&&e()})},this.pause=function(){i&&i.pause()},this.resume=function(){i&&i.resume()};var i}function c(e,t){function i(e,t){function i(e){function t(e,t){for(var i=new Float64Array(t),o=0,r=e.length,n=0;n<r;n++){var a=e[n];i.set(a,o),o+=a.length}return i}function i(e,t,i){for(var o=i.length,r=0;r<o;r++)e.setUint8(t+r,i.charCodeAt(r))}var o=e.leftBuffers,r=e.rightBuffers,n=e.sampleRate;o=t(o[0],o[1]),r=t(r[0],r[1]);var a=function(e,t){for(var i=e.length+t.length,o=new Float64Array(i),r=0,n=0;n<i;)o[n++]=e[r],o[n++]=t[r],r++;return o}(o,r),s=a.length,d=44+2*s,u=new ArrayBuffer(d),c=new DataView(u);i(c,0,"RIFF");c.setUint32(4,44+2*s,!0),i(c,8,"WAVE"),i(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,2,!0),c.setUint32(24,n,!0),c.setUint32(28,4*n,!0),c.setUint16(32,4,!0),c.setUint16(34,16,!0),i(c,36,"data"),c.setUint32(40,2*s,!0);for(var l,h=44,f=0;f<s;f++,h+=2){var g=Math.max(-1,Math.min(1,a[f])),m=g<0?32768*g:32767*g;e.leftChannel?(m!==l&&c.setInt16(h,m,!0),l=m):c.setInt16(h,m,!0)}postMessage({buffer:u,view:c})}var r=o(i);r.onmessage=function(e){t(e.data.buffer,e.data.view)},r.postMessage(e)}function o(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),i=new Worker(t);return URL.revokeObjectURL(t),i}if(!e.getAudioTracks().length)throw"Your stream has no audio tracks.";var r=this,n=[],a=[],s=!1,d=0;this.record=function(){n.length=a.length=0,d=0,s=!0},this.stop=function(e){s=!1,c.disconnect(),i({sampleRate:f,leftChannel:t.leftChannel,leftBuffers:[n,d],rightBuffers:[a,d]},function(t,i){r.blob=new Blob([i],{type:"audio/wav"}),r.buffer=new ArrayBuffer(i),r.view=i,r.sampleRate=f,r.bufferSize=h,r.length=d,e&&e(),m=!1})},b.AudioContextConstructor||(b.AudioContextConstructor=new b.AudioContext);var u=b.AudioContextConstructor,c=u.createMediaStreamSource(e),l=[0,256,512,1024,2048,4096,8192,16384],h=void 0===t.bufferSize?4096:t.bufferSize;-1===l.indexOf(h)&&(t.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(l,null,"\t")));var f=void 0!==t.sampleRate?t.sampleRate:u.sampleRate||44100;if((f<22050||f>96e3)&&(t.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.")),u.createJavaScriptNode)v=u.createJavaScriptNode(h,2,2);else{if(!u.createScriptProcessor)throw"WebAudio API has no support on this browser.";v=u.createScriptProcessor(h,2,2)}c.connect(v),h=v.bufferSize,t.disableLogs||(console.log("sample-rate",f),console.log("buffer-size",h));var g=!1;this.pause=function(){g=!0,t.disableLogs||console.debug("Paused recording.")},this.resume=function(){g=!1,t.disableLogs||console.debug("Resumed recording.")};var m=!1;v.onaudioprocess=function(t){if(!g){if(e.ended)return void(v.onaudioprocess=function(){});if(!s)return void c.disconnect();m||(m=!0,r.onAudioProcessStarted&&r.onAudioProcessStarted());var i=t.inputBuffer.getChannelData(0),o=t.inputBuffer.getChannelData(1);n.push(new Float32Array(i)),a.push(new Float32Array(o)),d+=h}},v.connect(u.destination)}function l(e){function t(){if(o)return r=(new Date).getTime(),setTimeout(t,100);window.html2canvas(e,{onrendered:function(e){var o=(new Date).getTime()-r;if(!o)return t();r=(new Date).getTime(),n.frames.push({duration:o,image:e.toDataURL("image/webp")}),i&&requestAnimationFrame(t)}})}if(!window.html2canvas)throw"Please link: //cdn.webrtc-experiment.com/screenshot.js";var i;this.record=function(){i=!0,n.frames=[],t()},this.stop=function(e){i=!1;var t=this;n.compile(function(i){t.blob=i,t.blob.forEach&&(t.blob=new Blob([],{type:"video/webm"})),e&&e(t.blob)})};var o=!1;this.pause=function(){o=!0,this.disableLogs||console.debug("Paused recording.")},this.resume=function(){o=!1,this.disableLogs||console.debug("Resumed recording.")};var r=(new Date).getTime(),n=new w.Video(100)}function h(e){function t(){var e=(new Date).getTime()-a;return e?r?(a=(new Date).getTime(),setTimeout(t,100)):(a=(new Date).getTime(),n.paused&&n.play(),u.drawImage(n,0,0,d.width,d.height),s.frames.push({duration:e,image:d.toDataURL("image/webp")}),void(o||setTimeout(t,10))):setTimeout(t,10)}function i(e,t,i,o){var r=document.createElement("canvas");r.width=d.width,r.height=d.height;for(var n=r.getContext("2d"),a=[],s=-1===t,u=t&&t>0&&t<=e.length?t:e.length,c={r:0,g:0,b:0},l=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),h=i&&i>=0&&i<=1?i:0,f=o&&o>=0&&o<=1?o:0,g=!1,m=0;m<u;m++){var v,b,w;if(!g){var p=new Image;p.src=e[m].image,n.drawImage(p,0,0,d.width,d.height);var R=n.getImageData(0,0,d.width,d.height);v=0,b=R.data.length,w=R.data.length/4;for(var y=0;y<b;y+=4){var L={r:R.data[y],g:R.data[y+1],b:R.data[y+2]};Math.sqrt(Math.pow(L.r-c.r,2)+Math.pow(L.g-c.g,2)+Math.pow(L.b-c.b,2))<=l*h&&v++}}!g&&w-v<=w*f||(s&&(g=!0),a.push(e[m]))}return a=a.concat(e.slice(u)),a.length<=0&&a.push(e[e.length-1]),a}this.record=function(){this.width||(this.width=320),this.height||(this.height=240),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),d.width=this.canvas.width,d.height=this.canvas.height,u=d.getContext("2d"),this.video&&this.video instanceof HTMLVideoElement?n=this.video.cloneNode():(n=document.createElement("video"),n.src=URL.createObjectURL(e),n.width=this.video.width,n.height=this.video.height),n.muted=!0,n.play(),a=(new Date).getTime(),s=new w.Video,this.disableLogs||(console.log("canvas resolutions",d.width,"*",d.height),console.log("video width/height",n.width||d.width,"*",n.height||d.height)),t()};var o=!1;this.stop=function(e){o=!0;var t=this;setTimeout(function(){s.frames=i(s.frames,-1),this.advertisement&&this.advertisement.length&&(s.frames=this.advertisement.concat(s.frames)),s.compile(function(i){t.blob=i,t.blob.forEach&&(t.blob=new Blob([],{type:"video/webm"})),e&&e(t.blob)})},10)};var r=!1;this.pause=function(){r=!0,this.disableLogs||console.debug("Paused recording.")},this.resume=function(){r=!1,this.disableLogs||console.debug("Resumed recording.")};var n,a,s,d=document.createElement("canvas"),u=d.getContext("2d")}function f(e){if(!window.GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.record=function(){function e(n){if(t)return setTimeout(function(){e(n)},100);u=requestAnimationFrame(e),void 0===(void 0===s?"undefined":g(s))&&(s=n),n-s<90||(r.paused&&r.play(),o.drawImage(r,0,0,i.width,i.height),a.onGifPreview&&a.onGifPreview(i.toDataURL("image/png")),d.addFrame(o),s=n)}this.width||(this.width=r.offsetWidth||320),this.height||(this.height=r.offsetHeight||240),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),i.width=this.canvas.width,i.height=this.canvas.height,r.width=this.video.width,r.height=this.video.height,d=new window.GIFEncoder,d.setRepeat(0),d.setDelay(this.frameRate||200),d.setQuality(this.quality||10),d.start(),n=Date.now();var a=this;u=requestAnimationFrame(e)},this.stop=function(){u&&cancelAnimationFrame(u),a=Date.now(),this.blob=new Blob([new Uint8Array(d.stream().bin)],{type:"image/gif"}),d.stream().bin=[]};var t=!1;this.pause=function(){t=!0,this.disableLogs||console.debug("Paused recording.")},this.resume=function(){t=!1,this.disableLogs||console.debug("Resumed recording.")};var i=document.createElement("canvas"),o=i.getContext("2d"),r=document.createElement("video");r.muted=!0,r.autoplay=!0,r.src=URL.createObjectURL(e),r.play();var n,a,s,d,u=null}/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a JavaScript-based media-recording library for modern web-browsers (supporting WebRTC getUserMedia API). It is optimized for different devices and browsers to bring all client-side (pluginfree) recording solutions in single place.
 * @summary JavaScript audio/video recording library runs top over WebRTC getUserMedia API.
 * @license {@link https://www.webrtc-experiment.com/licence/|MIT}
 * @author {@link https://www.MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recordRTC = RecordRTC(mediaStream, {
 *     type: 'video' // audio or video or gif or canvas
 * });
 *
 * // or, you can even use keyword "new"
 * var recordRTC = new RecordRTC(mediaStream[, config]);
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */
Object.defineProperty(t,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.RecordRTC=o,t.MRecordRTC=r,t.mergeProps=n,t.reformatProps=a,t.bytesToSize=s,t.MediaStreamRecorder=d,t.StereoRecorder=u,t.StereoAudioRecorder=c,t.CanvasRecorder=l,t.WhammyRecorder=h,t.GifRecorder=f,o.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),p.Fetch(function(i,o){"all"!==e&&o===e+"Blob"&&t&&t(i),"all"===e&&t&&t(i,o.replace("Blob",""))})},o.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),e=e||{},e.audio&&e.video&&e.gif?e.audio.getDataURL(function(t){e.video.getDataURL(function(i){e.gif.getDataURL(function(e){p.Store({audioBlob:t,videoBlob:i,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){p.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){p.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){p.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){p.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){p.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){p.Store({gifBlob:e})})},r.getFromDisk=o.getFromDisk,r.writeToDisk=o.writeToDisk,window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame),window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext),window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream);var m=!!navigator.webkitGetUserMedia;0===location.href.indexOf("file:")&&console.warn("Please load this HTML file on HTTP or HTTPS.");var v,b={AudioContext:window.AudioContext||window.webkitAudioContext},w=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=100}function t(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),i=new Worker(t);return URL.revokeObjectURL(t),i}function i(e){function t(e){var t=o(e);if(!t)return[];for(var r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:h(t.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],n=0,a=0;n<e.length;){var d=[],u=0;do{d.push(e[n]),u+=e[n].duration,n++}while(n<e.length&&u<3e4);var c={id:524531317,data:i(a,0,d)};r[1].data.push(c),a+=u}return s(r)}function i(e,t,i){return[{data:e,id:231}].concat(i.map(function(e){var i=d({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:i,id:163}}))}function o(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,i=e[0].height,o=e[0].duration,r=1;r<e.length;r++)o+=e[r].duration;return{duration:o,width:t,height:i}}function r(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function n(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function a(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var i=0;i<e.length;i+=8)t.push(parseInt(e.substr(i,8),2));return new Uint8Array(t)}function s(e){for(var t=[],i=0;i<e.length;i++){var o=e[i].data;"object"===(void 0===o?"undefined":g(o))&&(o=s(o)),"number"==typeof o&&(o=a(o.toString(2))),"string"==typeof o&&(o=n(o));var d=o.size||o.byteLength||o.length,u=Math.ceil(Math.ceil(Math.log(d)/Math.log(2))/8),c=d.toString(2),l=new Array(7*u+7+1-c.length).join("0")+c,h=new Array(u).join("0")+"1"+l;t.push(r(e[i].id)),t.push(a(h)),t.push(o)}return new Blob(t,{type:"video/webm"})}function d(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}function u(e){for(var t=e.RIFF[0].WEBP[0],i=t.indexOf("*"),o=0,r=[];o<4;o++)r[o]=t.charCodeAt(i+3+o);var n,a,s;return s=r[1]<<8|r[0],n=16383&s,s=r[3]<<8|r[2],a=16383&s,{width:n,height:a,data:t,riff:e}}function c(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)}function l(e){for(var t=0,i={};t<e.length;){var o=e.substr(t,4),r=c(e,t),n=e.substr(t+4+4,r);t+=8+r,i[o]=i[o]||[],"RIFF"===o||"LIST"===o?i[o].push(l(n)):i[o].push(n)}return i}function h(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}var f=new t(e.map(function(e){var t=u(l(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(f)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var o=t(i);o.onmessage=function(t){if(t.data.error)return void console.error(t.data.error);e(t.data)},o.postMessage(this.frames)},{Video:e}}(),p={init:function(){function e(e){e.createObjectStore(o.dataStoreName)}function t(){function e(e){t.objectStore(o.dataStoreName).get(e).onsuccess=function(t){o.callback&&o.callback(t.target.result,e)}}var t=i.transaction([o.dataStoreName],"readwrite");o.videoBlob&&t.objectStore(o.dataStoreName).put(o.videoBlob,"videoBlob"),o.gifBlob&&t.objectStore(o.dataStoreName).put(o.gifBlob,"gifBlob"),o.audioBlob&&t.objectStore(o.dataStoreName).put(o.audioBlob,"audioBlob"),e("audioBlob"),e("videoBlob"),e("gifBlob")}var i,o=this,r=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,n=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),a=r.open(n,1);a.onerror=o.onError,a.onsuccess=function(){if(i=a.result,i.onerror=o.onError,i.setVersion)if(1!==i.version){var r=i.setVersion(1);r.onsuccess=function(){e(i),t()}}else t();else t()},a.onupgradeneeded=function(t){e(t.target.result)}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};window.StereoRecorder=u},59:function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeRecorder=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=i(58);t.CubeRecorder=function(){function e(t){o(this,e),this.isFirefox=!!navigator.mozGetUserMedia,this.recording=!1,this.recordEnd=null,this.maxWidth=320,this.maxHeight=240,this.maxFrameRate=15,this.minFrameRate=5,this.recordVideo=null,this.recordAudio=null,this.videoUrl=null,this.audioUrl=null,this.preview=null,this.stream=null,this.startTime=0,this.duration=0,this.db=null,void 0!==t&&(this.preview=t)}return r(e,[{key:"dispose",value:function(){this.stream=null,this.recordEnd=null}},{key:"startRecording",value:function(e){var t=this;if(this.recording)return!1;this.recording=!0,this.startTime=0,this.duration=0;var i=function(e){t.stream=e,null!=t.preview&&(t.attachMediaStream(t.preview,e),t.preview.muted=!0,t.preview.controls=!1,t.preview.style.visibility="visible"),t.isFirefox||(t.recordAudio=(0,n.RecordRTC)(e,{bufferSize:16384,sampleRate:45e3,onAudioProcessStarted:function(){t.recordVideo.startRecording()}})),t.recordVideo=(0,n.RecordRTC)(e,{type:"video"}),null!=t.recordAudio?t.recordAudio.startRecording():t.recordVideo.startRecording(),t.startTime=Date.now()};if(void 0===e||null==e){var o=null;o=this.isFirefox?{width:{min:160,max:this.maxWidth},height:{min:120,max:this.maxHeight},frameRate:parseInt(this.maxFrameRate),require:["width","height","frameRate"]}:{mandatory:{maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:160,minHeight:120,maxFrameRate:this.maxFrameRate,minFrameRate:this.minFrameRate}},navigator.getUserMedia({audio:!0,video:o},function(e){i(e)},function(e){alert(JSON.stringify(e))})}else i(e);return!0}},{key:"stopRecording",value:function(e){var t=this;if(!this.recording)return!1;this.recording=!1;var i=null!=this.recordVideo?1:0;i+=null!=this.recordAudio?1:0,null!=this.recordVideo&&this.recordVideo.stopRecording(function(o){if(t.duration=Date.now()-t.startTime,t.videoUrl=o,--i,void 0!==e&&0==i&&e.call(null,t),null!=t.recordEnd&&t.recordEnd.call(null,t),null!=t.preview){t.preview.src="";try{t.stream.stop()}catch(e){}}t.stream=null}),null!=this.recordAudio&&this.recordAudio.stopRecording(function(o){t.audioUrl=o,--i,void 0!==e&&0==i&&e.call(null,t)})}},{key:"replay",value:function(e,t){var i=this;return!this.recording&&(null!=this.recordAudio&&(e.onplay=function(e){t.play()},e.onpause=function(e){t.pause()},t.muted=!1,window.URL?t.src=window.URL.createObjectURL(this.recordAudio.getBlob()):t.src=this.recordAudio.getBlob()),null!=this.recordVideo&&(e.muted=!1,e.controls=!0,e.onended=function(o){i.isFirefox?window.URL?e.src=window.URL.createObjectURL(i.recordVideo.getBlob()):e.src=i.recordVideo.getBlob():null!=i.recordAudio&&(t.pause(),window.URL?t.src=window.URL.createObjectURL(i.recordAudio.getBlob()):t.src=i.recordAudio.getBlob())},window.URL?e.src=window.URL.createObjectURL(this.recordVideo.getBlob()):e.src=this.recordVideo.getBlob()),!0)}},{key:"getVideoUrl",value:function(){return this.videoUrl}},{key:"save",value:function(e,t,i){var o=this,r=null!=this.recordVideo,n=null!=this.recordAudio,a=null,s=null,d=r?this.recordVideo.blob.size:0,u=n?this.recordAudio.blob.size:0,c=new Date(this.startTime),l=[e,"_",c.getFullYear(),c.getMonth()+1<10?"0"+(c.getMonth()+1):c.getMonth()+1,c.getDate()<10?"0"+c.getDate():c.getDate(),c.getHours()<10?"0"+c.getHours():c.getHours(),c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds(),"_",parseInt(this.duration/1e3)],h=l.join(""),f=this.startTime,g=null,m=null;if(r){var v=new FileReader;v.onload=function(e){a=e.target.result,n&&null!=s?(g={time:f,video:{name:h+".webm",size:d,data:a},audio:{name:h+".wav",size:u,data:s}},o._save(m,g,t,i)):n||(g={time:f,video:{name:h+".webm",size:d,data:a}},o._save(m,g,t,i))},v.readAsDataURL(this.recordVideo.blob)}if(n){var v=new FileReader;v.onload=function(e){s=e.target.result,r&&null!=a?(g={time:f,video:{name:h+".webm",size:d,data:a},audio:{name:h+".wav",size:u,data:s}},o._save(m,g,t,i)):r||(g={time:f,audio:{name:h+".wav",size:u,data:s}},o._save(m,g,t,i))},v.readAsDataURL(this.recordAudio.blob)}var b=window.indexedDB.open("_cube_recording",1);return b.onerror=function(e){nucleus.getLogger().e("CubeRecorder","Can NOT use IndexedDB")},b.onupgradeneeded=function(e){if(m=e.target.result,!m.objectStoreNames.contains("recording")){m.createObjectStore("recording",{keyPath:"time"}).createIndex("time","time",{unique:!0})}},b.onsuccess=function(e){m=e.target.result,o._save(m,g,t,i)},f}},{key:"_save",value:function(e,t,i,o){if(null!=e&&null!=t){var r=e.transaction(["recording"],"readwrite");r.oncomplete=function(e){i.call(null,t)},r.onerror=function(e){o.call(null,t)},r.objectStore("recording").add(t)}}},{key:"uploadTo",value:function(e,t,i,o){return this._upload(e,t,"cube",i,o)}},{key:"upload",value:function(e,t,i,o,r){if(null==e||null==t)return!1;var n=!0;return void 0!==r&&(n=r),this._upload(n,{account:e},t,i,o)}},{key:"_upload",value:function(e,t,i,o,r){var n=this;if(null==e||null==t||null==i)return!1;var a=new Date(this.startTime),s=[i,"_",a.getFullYear(),a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,a.getDate()<10?"0"+a.getDate():a.getDate(),a.getHours()<10?"0"+a.getHours():a.getHours(),a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds(),"_",parseInt(this.duration/1e3)],d=s.join(""),u=null!=this.recordVideo,c=null!=this.recordAudio,l=null,h=null;if(u){var f=new FileReader;f.onload=function(i){l=i.target.result,c&&null!=h?n._post(e,t,{name:d+".webm",size:n.recordVideo.blob.size,data:l},{name:d+".wav",size:n.recordAudio.blob.size,data:h},o,r):c||n._post(e,t,{name:d+".webm",size:n.recordVideo.blob.size,data:l},null,o,r)},f.readAsDataURL(this.recordVideo.blob)}if(c){var f=new FileReader;f.onload=function(i){h=i.target.result,u&&null!=l?n._post(e,t,{name:d+".webm",size:n.recordVideo.blob.size,data:l},{name:d+".wav",size:n.recordAudio.blob.size,data:h},o,r):u||n._post(e,t,null,{name:d+".wav",size:n.recordAudio.blob.size,data:h},o,r)},f.readAsDataURL(this.recordAudio.blob)}return!0}},{key:"_uploadFromDB",value:function(e,t,i,o){var r=this,n=this.startTime,a=null,s=window.indexedDB.open("_cube_recording",1);s.onerror=function(e){nucleus.getLogger().e("CubeRecorder","Can NOT use IndexedDB"),o.call(null,r)},s.onupgradeneeded=function(e){if(a=e.target.result,r.db=a,!a.objectStoreNames.contains("recording")){a.createObjectStore("recording",{keyPath:"time"}).createIndex("time","time",{unique:!0})}},s.onsuccess=function(s){a=s.target.result,r.db=a,a.transaction(["recording"]).objectStore("recording").get(n).onsuccess=function(n){var a=n.target.result,s=void 0!==a.video?a.video:null,d=void 0!==a.audio?a.audio:null;r._post(e,t,s,d,i,o),nucleus.getLogger().d("CubeRecorder","Post data to "+e)}}}},{key:"_deleteFromDB",value:function(){var e=this;if(null==this.db){var t=null,i=window.indexedDB.open("_cube_recording",1);i.onerror=function(e){nucleus.getLogger().e("CubeRecorder","Can NOT use IndexedDB")},i.onupgradeneeded=function(i){if(t=i.target.result,e.db=t,!t.objectStoreNames.contains("recording")){t.createObjectStore("recording",{keyPath:"time"}).createIndex("time","time",{unique:!0})}},i.onsuccess=function(i){t=i.target.result,e.db=t,t.transaction(["recording"],"readwrite").objectStore("recording").delete(e.startTime)}}else this.db.transaction(["recording"],"readwrite").objectStore("recording").delete(this.startTime)}},{key:"_post",value:function(e,t,i,o,r,n){var a=this,s=new FormData;s.append("param",JSON.stringify(t)),null!=i&&(s.append("video-filename",i.name),s.append("video-size",i.size),s.append("video-data",i.data)),null!=o&&(s.append("audio-filename",o.name),s.append("audio-size",o.size),s.append("audio-data",o.data));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?void 0!==r&&r.call(null,a,t):void 0!==n&&n.call(null,a,t))},"string"==typeof e?d.open("POST",e):e?d.open("POST",window._cube_cross.host+"/archive/save"):d.open("POST","archive/save"),d.send(s)}},{key:"clear",value:function(){this.recordVideo=null,this.recordAudio=null}},{key:"getDuration",value:function(){return 0==this.startTime?0:0==this.duration?Date.now()-this.startTime:this.duration}},{key:"getSize",value:function(){var e=0;return e+=null!=this.recordVideo?this.recordVideo.blob.size:0,e+=null!=this.recordAudio?this.recordAudio.blob.size:0}},{key:"attachMediaStream",value:function(e,t){window.URL?e.src=window.URL.createObjectURL(t):e.src=t,e.onloadedmetadata=function(t){e.play()}}}]),e}()},89:function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeAdvancedRecorder=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=i(59);t.CubeAdvancedRecorder=function(){function e(t,i){o(this,e),this.preview=null,this.maxWidth=i.maxWidth||320,this.maxHeight=i.maxHeight||240,this.maxFrameRate=i.maxFrameRate||20,this.minFrameRate=i.minFrameRate||5,this.minHeight=i.minHeight||120,this.minWidth=i.minWidth||160,this.stream=null,this.recorder=null,this.timer=0,this.storeKeyList=[],this.durationList=[],this.sizeList=[],this.prefix="cube",this.interval=i.interval||3e4,void 0!==t&&null!=t&&(this.preview=t),nucleus.getLogger().d("AdvancedRecorder","config: "+JSON.stringify(i))}return r(e,[{key:"startRecording",value:function(e){var t=this;if(this.timer>0)return!1;this.prefix=""+parseInt(Date.now()/1e3);var i=function(e){t.stream=e,null!=t.preview&&(t.attachMediaStream(t.preview,e),t.preview.muted=!0,t.preview.controls=!1,t.preview.style.visibility="visible"),t.recorder=new n.CubeRecorder,t.recorder.startRecording(t.stream),t.timer=setTimeout(function(){t._continue()},t.interval)};if(void 0===e||null==e){var o=null;o=cube.utils.isFirefox?{width:{min:this.minWidth,max:this.maxWidth},height:{min:this.minWidth,max:this.maxHeight},frameRate:parseInt(this.maxFrameRate),require:["width","height","frameRate"]}:{mandatory:{maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight,maxFrameRate:this.maxFrameRate,minFrameRate:this.minFrameRate}},console.log("constraints",o),navigator.getUserMedia({audio:!0,video:o},function(e){i(e)},function(e){alert(JSON.stringify(e))})}else i(e);return!0}},{key:"stopRecording",value:function(e){var t=this;clearTimeout(this.timer),this.timer=0,this.recorder.stopRecording(function(i){t.storeKeyList.push(t.recorder.startTime+0),t.durationList.push(t.recorder.duration+0),t.sizeList.push(t.recorder.getSize()+0);var o=t.recorder;o.save(t.prefix,function(){o.dispose(),o=null});if(t.recorder=null,null!=t.preview){t.preview.src=cube.utils.isFirefox?null:"";try{t.stream.stop()}catch(e){}}t.stream=null,e.call(null,t)})}},{key:"pauseRecording",value:function(){}},{key:"resumeRecording",value:function(){}},{key:"uploadRecordings",value:function(e,t,i,o){var r=this;if(this.storeKeyList.length>0){var a=this.storeKeyList.shift(),s=new n.CubeRecorder;s.startTime=a,s._uploadFromDB(e,t,function(){s._deleteFromDB(),r.storeKeyList.length>0?setTimeout(function(){r.uploadRecordings(e,t,i,o)},10):i.call(null,r,t),s=null},o)}return!0}},{key:"replay",value:function(e,t){alert()}},{key:"clearAll",value:function(){var e=null,t=window.indexedDB.open("_cube_recording",1);t.onerror=function(e){nucleus.getLogger().e("CubeRecorder","Can NOT use IndexedDB")},t.onupgradeneeded=function(t){if(e=t.target.result,!e.objectStoreNames.contains("recording")){e.createObjectStore("recording",{keyPath:"time"}).createIndex("time","time",{unique:!0})}},t.onsuccess=function(t){e=t.target.result}}},{key:"numRecordings",value:function(){return this.storeKeyList.length}},{key:"getDuration",value:function(){var e=0;if(this.durationList.length>0)for(var t=0;t<this.durationList.length;++t)e+=this.durationList[t];return null!=this.recorder&&(e+=this.recorder.getDuration()),e}},{key:"getSize",value:function(){var e=0;if(this.sizeList.length>0)for(var t=0;t<this.sizeList.length;++t)e+=this.sizeList[t];return null==this.recorder||this.recorder.recording||(e+=this.recorder.getSize()),e}},{key:"_continue",value:function(){var e=this;if(null!=this.recorder){clearTimeout(this.timer);var t=this.recorder;this.recorder.stopRecording(function(i){var o=t.save(e.prefix,function(){t.dispose()});e.storeKeyList.push(o),e.durationList.push(t.duration+0),e.sizeList.push(t.getSize()+0)}),this.recorder=new n.CubeRecorder,this.recorder.startRecording(this.stream),this.timer=setTimeout(function(){e._continue()},this.interval)}}},{key:"attachMediaStream",value:function(e,t){window.URL?e.src=window.URL.createObjectURL(t):e.src=t,e.onloadedmetadata=function(t){e.play()}}}]),e}()}});
//# sourceMappingURL=cube-recorder.js.map